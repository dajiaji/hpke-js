var X=class extends Error{constructor(e){let r;e instanceof Error?r=e.message:typeof e=="string"?r=e:r="",super(r),this.name=this.constructor.name}},fe=class extends X{};var $=class extends X{},Z=class extends X{},Ze=class extends X{},We=class extends X{};var ve=class extends X{},J=class extends X{};var wr={},ft=pr(globalThis,wr);function pr(t,e){return new Proxy(t,{get(r,n,i){return n in e?e[n]:t[n]},set(r,n,i){return n in e&&delete e[n],t[n]=i,!0},deleteProperty(r,n){let i=!1;return n in e&&(delete e[n],i=!0),n in t&&(delete t[n],i=!0),i},ownKeys(r){let n=Reflect.ownKeys(t),i=Reflect.ownKeys(e),s=new Set(i);return[...n.filter(o=>!s.has(o)),...i]},defineProperty(r,n,i){return n in e&&delete e[n],Reflect.defineProperty(t,n,i),!0},getOwnPropertyDescriptor(r,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(t,n)},has(r,n){return n in e||n in t}})}async function xr(){if(ft!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:t}=await import("crypto");return t.subtle}catch(t){throw new J(t)}}var Ee=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await xr())}};var re={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48,MlKem512:64,MlKem768:65,MlKem1024:66,XWing:25722},Ye={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3};var j=new Uint8Array(0);var Xe=new Uint8Array([75,69,77,0,0]);var ne=t=>typeof t=="object"&&t!==null&&typeof t.privateKey=="object"&&typeof t.publicKey=="object";function Te(t,e){if(e<=0)throw new Error("i2Osp: too small size");if(t>=256**e)throw new Error("i2Osp: too large integer");let r=new Uint8Array(e);for(let n=0;n<e&&t;n++)r[e-(n+1)]=t%256,t=t>>8;return r}function ue(t,e){let r=new Uint8Array(t.length+e.length);return r.set(t,0),r.set(e,t.length),r}var mr=new Uint8Array([101,97,101,95,112,114,107]),gr=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);function _r(t,e,r){let n=new Uint8Array(t.length+e.length+r.length);return n.set(t,0),n.set(e,t.length),n.set(r,t.length+e.length),n}var Se=class{constructor(e,r,n){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e,this._prim=r,this._kdf=n;let i=new Uint8Array(Xe);i.set(Te(this.id,2),3),this._kdf.init(i)}async serializePublicKey(e){return await this._prim.serializePublicKey(e)}async deserializePublicKey(e){return await this._prim.deserializePublicKey(e)}async serializePrivateKey(e){return await this._prim.serializePrivateKey(e)}async deserializePrivateKey(e){return await this._prim.deserializePrivateKey(e)}async importKey(e,r,n=!0){return await this._prim.importKey(e,r,n)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>8192)throw new fe("Too long ikm");return await this._prim.deriveKeyPair(e)}async encap(e){let r;e.ekm===void 0?r=await this.generateKeyPair():ne(e.ekm)?r=e.ekm:r=await this.deriveKeyPair(e.ekm);let n=await this._prim.serializePublicKey(r.publicKey),i=await this._prim.serializePublicKey(e.recipientPublicKey);try{let s;if(e.senderKey===void 0)s=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey));else{let f=ne(e.senderKey)?e.senderKey.privateKey:e.senderKey,h=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey)),c=new Uint8Array(await this._prim.dh(f,e.recipientPublicKey));s=ue(h,c)}let o;if(e.senderKey===void 0)o=ue(new Uint8Array(n),new Uint8Array(i));else{let f=ne(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),h=await this._prim.serializePublicKey(f);o=_r(new Uint8Array(n),new Uint8Array(i),new Uint8Array(h))}let a=await this._generateSharedSecret(s,o);return{enc:n,sharedSecret:a}}catch(s){throw new Ze(s)}}async decap(e){let r=await this._prim.deserializePublicKey(e.enc),n=ne(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,i=ne(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),s=await this._prim.serializePublicKey(i);try{let o;if(e.senderPublicKey===void 0)o=new Uint8Array(await this._prim.dh(n,r));else{let f=new Uint8Array(await this._prim.dh(n,r)),h=new Uint8Array(await this._prim.dh(n,e.senderPublicKey));o=ue(f,h)}let a;if(e.senderPublicKey===void 0)a=ue(new Uint8Array(e.enc),new Uint8Array(s));else{let f=await this._prim.serializePublicKey(e.senderPublicKey);a=new Uint8Array(e.enc.byteLength+s.byteLength+f.byteLength),a.set(new Uint8Array(e.enc),0),a.set(new Uint8Array(s),e.enc.byteLength),a.set(new Uint8Array(f),e.enc.byteLength+s.byteLength)}return await this._generateSharedSecret(o,a)}catch(o){throw new We(o)}}async _generateSharedSecret(e,r){let n=this._kdf.buildLabeledIkm(mr,e),i=this._kdf.buildLabeledInfo(gr,r,this.secretSize);return await this._kdf.extractAndExpand(j.buffer,n.buffer,i.buffer,this.secretSize)}};var le=["deriveBits"],Ke=new Uint8Array([100,107,112,95,112,114,107]),Oe=new Uint8Array([115,107]);var bn=new Uint8Array([99,97,110,100,105,100,97,116,101]),yn=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),wn=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),pn=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),xn=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),mn=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),gn=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]);var W=class{constructor(e,r,n,i=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=r,this.type=n,this.algorithm={name:e},this.usages=i,n==="public"&&(this.usages=[])}};var It=new Uint8Array([72,80,75,69,45,118,49]),ut=class extends Ee{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Ye.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:j}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(e){this._suiteId=e}buildLabeledIkm(e,r){this._checkInit();let n=new Uint8Array(7+this._suiteId.byteLength+e.byteLength+r.byteLength);return n.set(It,0),n.set(this._suiteId,7),n.set(e,7+this._suiteId.byteLength),n.set(r,7+this._suiteId.byteLength+e.byteLength),n}buildLabeledInfo(e,r,n){this._checkInit();let i=new Uint8Array(9+this._suiteId.byteLength+e.byteLength+r.byteLength);return i.set(new Uint8Array([0,n]),0),i.set(It,2),i.set(this._suiteId,9),i.set(e,9+this._suiteId.byteLength),i.set(r,9+this._suiteId.byteLength+e.byteLength),i}async extract(e,r){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)throw new fe("The salt length must be the same as the hashSize");let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,r)}async expand(e,r,n){await this._setup();let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),s=new ArrayBuffer(n),o=new Uint8Array(s),a=j,f=new Uint8Array(r),h=new Uint8Array(1);if(n>255*this.hashSize)throw new Error("Entropy limit reached");let c=new Uint8Array(this.hashSize+f.length+1);for(let b=1,w=0;w<o.length;b++)h[0]=b,c.set(a,0),c.set(f,a.length),c.set(h,a.length+f.length),a=new Uint8Array(await this._api.sign("HMAC",i,c.slice(0,a.length+f.length+1))),o.length-w>=a.length?(o.set(a,w),w+=a.length):(o.set(a.slice(0,o.length-w),w),w+=o.length-w);return s}async extractAndExpand(e,r,n,i){await this._setup();let s=await this._api.importKey("raw",r,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:n},s,i*8)}async labeledExtract(e,r,n){return await this.extract(e,this.buildLabeledIkm(r,n).buffer)}async labeledExpand(e,r,n,i){return await this.expand(e,this.buildLabeledInfo(r,n,i).buffer,i)}_checkInit(){if(this._suiteId===j)throw new Error("Not initialized. Call init()")}},De=class extends ut{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Ye.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}};var he=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Pe(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ne(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function R(t,...e){if(!Pe(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Lt(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ne(t.outputLen),Ne(t.blockLen)}function Be(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ut(t,e){R(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function de(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function $e(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function V(t,e){return t<<32-e|t>>>e}var zt=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",vr=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ie(t){if(R(t),zt)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=vr[t[r]];return e}var Q={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ht(t){if(t>=Q._0&&t<=Q._9)return t-Q._0;if(t>=Q.A&&t<=Q.F)return t-(Q.A-10);if(t>=Q.a&&t<=Q.f)return t-(Q.a-10)}function ke(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(zt)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){let o=Ht(t.charCodeAt(s)),a=Ht(t.charCodeAt(s+1));if(o===void 0||a===void 0){let f=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}n[i]=o*16+a}return n}function Tt(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Re(t){return typeof t=="string"&&(t=Tt(t)),R(t),t}function Y(...t){let e=0;for(let n=0;n<t.length;n++){let i=t[n];R(i),e+=i.length}let r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){let s=t[n];r.set(s,i),i+=s.length}return r}var Ae=class{};function Ot(t){let e=n=>t().update(Re(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function lt(t=32){if(he&&typeof he.getRandomValues=="function")return he.getRandomValues(new Uint8Array(t));if(he&&typeof he.randomBytes=="function")return Uint8Array.from(he.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var Je=class extends Ae{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Lt(e);let n=Re(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),de(s)}update(e){return Be(this),this.iHash.update(e),this}digestInto(e){Be(this),R(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ce=(t,e,r)=>new Je(t,e).update(r).digest();Ce.create=(t,e)=>new Je(t,e);function Er(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),f=n?4:0,h=n?0:4;t.setUint32(e+f,o,n),t.setUint32(e+h,a,n)}function Dt(t,e,r){return t&e^~t&r}function Nt(t,e,r){return t&e^t&r^e&r}var Qe=class extends Ae{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=$e(this.buffer)}update(e){Be(this),e=Re(e),R(e);let{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){let a=Math.min(i-this.pos,s-o);if(a===i){let f=$e(e);for(;i<=s-o;o+=i)this.process(f,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Be(this),Ut(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:i,isLE:s}=this,{pos:o}=this;r[o++]=128,de(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let b=o;b<i;b++)r[b]=0;Er(n,i-8,BigInt(this.length*8),s),this.process(n,0);let a=$e(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let h=f/4,c=this.get();if(h>c.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<h;b++)a.setUint32(4*b,c[b],s)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},F=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Sr=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),oe=new Uint32Array(64),Fe=class extends Qe{constructor(e=32){super(64,e,8,!1),this.A=F[0]|0,this.B=F[1]|0,this.C=F[2]|0,this.D=F[3]|0,this.E=F[4]|0,this.F=F[5]|0,this.G=F[6]|0,this.H=F[7]|0}get(){let{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:f}=this;return[e,r,n,i,s,o,a,f]}set(e,r,n,i,s,o,a,f){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=f|0}process(e,r){for(let b=0;b<16;b++,r+=4)oe[b]=e.getUint32(r,!1);for(let b=16;b<64;b++){let w=oe[b-15],_=oe[b-2],P=V(w,7)^V(w,18)^w>>>3,A=V(_,17)^V(_,19)^_>>>10;oe[b]=A+oe[b-7]+P+oe[b-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:f,G:h,H:c}=this;for(let b=0;b<64;b++){let w=V(a,6)^V(a,11)^V(a,25),_=c+w+Dt(a,f,h)+Sr[b]+oe[b]|0,A=(V(n,2)^V(n,13)^V(n,22))+Nt(n,i,s)|0;c=h,h=f,f=a,a=o+_|0,o=s,s=i,i=n,n=_+A|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,f=f+this.F|0,h=h+this.G|0,c=c+this.H|0,this.set(n,i,s,o,a,f,h,c)}roundClean(){de(oe)}destroy(){this.set(0,0,0,0,0,0,0,0),de(this.buffer)}};var et=Ot(()=>new Fe);var Rt=et;var Ie=class extends De{async extract(e,r){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return Ce(Rt,new Uint8Array(e),new Uint8Array(r)).buffer;let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,r)}};var bt=BigInt(0),dt=BigInt(1);function je(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function qe(t){let e=t.toString(16);return e.length&1?"0"+e:e}function Ct(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?bt:BigInt("0x"+t)}function He(t){return Ct(ie(t))}function yt(t){return R(t),Ct(ie(Uint8Array.from(t).reverse()))}function tt(t,e){return ke(t.toString(16).padStart(e*2,"0"))}function wt(t,e){return tt(t,e).reverse()}function C(t,e,r){let n;if(typeof e=="string")try{n=ke(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Pe(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}var ht=t=>typeof t=="bigint"&&bt<=t;function jt(t,e,r){return ht(t)&&ht(e)&&ht(r)&&e<=t&&t<r}function qt(t,e,r,n){if(!jt(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Mt(t){let e;for(e=0;t>bt;t>>=dt,e+=1);return e}var be=t=>(dt<<BigInt(t))-dt;function Gt(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=_=>new Uint8Array(_),i=_=>Uint8Array.of(_),s=n(t),o=n(t),a=0,f=()=>{s.fill(1),o.fill(0),a=0},h=(..._)=>r(o,s,..._),c=(_=n(0))=>{o=h(i(0),_),s=h(),_.length!==0&&(o=h(i(1),_),s=h())},b=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let _=0,P=[];for(;_<e;){s=h();let A=s.slice();P.push(A),_+=s.length}return Y(...P)};return(_,P)=>{f(),c(_);let A;for(;!(A=P(b()));)c();return f(),A}}function Me(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){let a=t[i];if(o&&a===void 0)return;let f=typeof a;if(f!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${f}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function pt(t){let e=new WeakMap;return(r,...n)=>{let i=e.get(r);if(i!==void 0)return i;let s=t(r,...n);return e.set(r,s),s}}var N=BigInt(0),O=BigInt(1),ye=BigInt(2),Kr=BigInt(3),Wt=BigInt(4),Yt=BigInt(5),Xt=BigInt(8);function q(t,e){let r=t%e;return r>=N?r:e+r}function M(t,e,r){let n=t;for(;e-- >N;)n*=n,n%=r;return n}function Vt(t,e){if(t===N)throw new Error("invert: expected non-zero number");if(e<=N)throw new Error("invert: expected positive modulus, got "+e);let r=q(t,e),n=e,i=N,s=O,o=O,a=N;for(;r!==N;){let h=n/r,c=n%r,b=i-o*h,w=s-a*h;n=r,r=c,i=o,s=a,o=b,a=w}if(n!==O)throw new Error("invert: does not exist");return q(i,e)}function $t(t,e){let r=(t.ORDER+O)/Wt,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function Ar(t,e){let r=(t.ORDER-Yt)/Xt,n=t.mul(e,ye),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,ye),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Pr(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-O,r=0;for(;e%ye===N;)e/=ye,r++;let n=ye,i=we(t);for(;Zt(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return $t;let s=i.pow(n,e),o=(e+O)/ye;return function(f,h){if(f.is0(h))return h;if(Zt(f,h)!==1)throw new Error("Cannot find square root");let c=r,b=f.mul(f.ONE,s),w=f.pow(h,e),_=f.pow(h,o);for(;!f.eql(w,f.ONE);){if(f.is0(w))return f.ZERO;let P=1,A=f.sqr(w);for(;!f.eql(A,f.ONE);)if(P++,A=f.sqr(A),P===c)throw new Error("Cannot find square root");let z=O<<BigInt(c-P-1),G=f.pow(b,z);c=P,b=f.sqr(G),w=f.mul(w,b),_=f.mul(_,G)}return _}}function Br(t){return t%Wt===Kr?$t:t%Xt===Yt?Ar:Pr(t)}var kr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function xt(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=kr.reduce((n,i)=>(n[i]="function",n),e);return Me(t,r),t}function Ir(t,e,r){if(r<N)throw new Error("invalid exponent, negatives unsupported");if(r===N)return t.ONE;if(r===O)return e;let n=t.ONE,i=e;for(;r>N;)r&O&&(n=t.mul(n,i)),i=t.sqr(i),r>>=O;return n}function rt(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,f)=>t.is0(a)?o:(n[f]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,f)=>t.is0(a)?o:(n[f]=t.mul(o,n[f]),t.mul(o,a)),s),n}function Zt(t,e){let r=(t.ORDER-O)/ye,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Jt(t,e){e!==void 0&&Ne(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function we(t,e,r=!1,n={}){if(t<=N)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let c=e;c.BITS&&(i=c.BITS),c.sqrt&&(s=c.sqrt),typeof c.isLE=="boolean"&&(r=c.isLE)}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);let{nBitLength:o,nByteLength:a}=Jt(t,i);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let f,h=Object.freeze({ORDER:t,isLE:r,BITS:o,BYTES:a,MASK:be(o),ZERO:N,ONE:O,create:c=>q(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return N<=c&&c<t},is0:c=>c===N,isValidNot0:c=>!h.is0(c)&&h.isValid(c),isOdd:c=>(c&O)===O,neg:c=>q(-c,t),eql:(c,b)=>c===b,sqr:c=>q(c*c,t),add:(c,b)=>q(c+b,t),sub:(c,b)=>q(c-b,t),mul:(c,b)=>q(c*b,t),pow:(c,b)=>Ir(h,c,b),div:(c,b)=>q(c*Vt(b,t),t),sqrN:c=>c*c,addN:(c,b)=>c+b,subN:(c,b)=>c-b,mulN:(c,b)=>c*b,inv:c=>Vt(c,t),sqrt:s||(c=>(f||(f=Br(t)),f(h,c))),toBytes:c=>r?wt(c,a):tt(c,a),fromBytes:c=>{if(c.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+c.length);return r?yt(c):He(c)},invertBatch:c=>rt(h,c),cmov:(c,b,w)=>w?b:c});return Object.freeze(h)}function Qt(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function mt(t){let e=Qt(t);return e+Math.ceil(e/2)}function Ft(t,e,r=!1){let n=t.length,i=Qt(e),s=mt(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let o=r?yt(t):He(t),a=q(o,e-O)+O;return r?wt(a,i):tt(a,i)}var Ue=BigInt(0),pe=BigInt(1);function Le(t,e){let r=e.negate();return t?r:e}function nr(t,e,r){let n=e==="pz"?o=>o.pz:o=>o.ez,i=rt(t.Fp,r.map(n));return r.map((o,a)=>o.toAffine(i[a])).map(t.fromAffine)}function ir(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function gt(t,e){ir(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=be(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function er(t,e,r){let{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r,a=Number(t&i),f=t>>o;a>n&&(a-=s,f+=pe);let h=e*n,c=h+Math.abs(a)-1,b=a===0,w=a<0,_=e%2!==0;return{nextN:f,offset:c,isZero:b,isNeg:w,isNegF:_,offsetF:h}}function Hr(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Lr(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var _t=new WeakMap,or=new WeakMap;function vt(t){return or.get(t)||1}function tr(t){if(t!==Ue)throw new Error("invalid wNAF")}function sr(t,e){return{constTimeNegate:Le,hasPrecomputes(r){return vt(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Ue;)n&pe&&(i=i.add(s)),s=s.double(),n>>=pe;return i},precomputeWindow(r,n){let{windows:i,windowSize:s}=gt(n,e),o=[],a=r,f=a;for(let h=0;h<i;h++){f=a,o.push(f);for(let c=1;c<s;c++)f=f.add(a),o.push(f);a=f.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE,a=gt(r,e);for(let f=0;f<a.windows;f++){let{nextN:h,offset:c,isZero:b,isNeg:w,isNegF:_,offsetF:P}=er(i,f,a);i=h,b?o=o.add(Le(_,n[P])):s=s.add(Le(w,n[c]))}return tr(i),{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){let o=gt(r,e);for(let a=0;a<o.windows&&i!==Ue;a++){let{nextN:f,offset:h,isZero:c,isNeg:b}=er(i,a,o);if(i=f,!c){let w=n[h];s=s.add(b?w.negate():w)}}return tr(i),s},getPrecomputes(r,n,i){let s=_t.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&(typeof i=="function"&&(s=i(s)),_t.set(n,s))),s},wNAFCached(r,n,i){let s=vt(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){let o=vt(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){ir(n,e),or.set(r,n),_t.delete(r)}}}function ar(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Ue||n>Ue;)r&pe&&(s=s.add(i)),n&pe&&(o=o.add(i)),i=i.double(),r>>=pe,n>>=pe;return{p1:s,p2:o}}function cr(t,e,r,n){Hr(r,t),Lr(n,e);let i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=Mt(BigInt(i)),f=1;a>12?f=a-3:a>4?f=a-2:a>0&&(f=2);let h=be(f),c=new Array(Number(h)+1).fill(o),b=Math.floor((e.BITS-1)/f)*f,w=o;for(let _=b;_>=0;_-=f){c.fill(o);for(let A=0;A<s;A++){let z=n[A],G=Number(z>>BigInt(_)&h);c[G]=c[G].add(r[A])}let P=o;for(let A=c.length-1,z=o;A>0;A--)z=z.add(c[A]),P=P.add(z);if(w=w.add(P),_!==0)for(let A=0;A<f;A++)w=w.double()}return w}function rr(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return xt(e),e}else return we(t)}function fr(t,e,r={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let f=e[a];if(!(typeof f=="bigint"&&f>Ue))throw new Error(`CURVE.${a} must be positive bigint`)}let n=rr(e.p,r.Fp),i=rr(e.n,r.Fn),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:i}}function ur(t){t.lowS!==void 0&&je("lowS",t.lowS),t.prehash!==void 0&&je("prehash",t.prehash)}var Et=class extends Error{constructor(e=""){super(e)}},ee={Err:Et,_tlv:{encode:(t,e)=>{let{Err:r}=ee;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let n=e.length/2,i=qe(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?qe(i.length/2|128):"";return qe(t)+s+i+e},decode(t,e){let{Err:r}=ee,n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");let i=e[n++],s=!!(i&128),o=0;if(!s)o=i;else{let f=i&127;if(!f)throw new r("tlv.decode(long): indefinite length not supported");if(f>4)throw new r("tlv.decode(long): byte length is too big");let h=e.subarray(n,n+f);if(h.length!==f)throw new r("tlv.decode: length bytes not complete");if(h[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let c of h)o=o<<8|c;if(n+=f,o<128)throw new r("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){let{Err:e}=ee;if(t<Ge)throw new e("integer: negative integers are not allowed");let r=qe(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=ee;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return He(t)}},toSig(t){let{Err:e,_int:r,_tlv:n}=ee,i=C("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:f}=n.decode(2,s),{v:h,l:c}=n.decode(2,f);if(c.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(h)}},hexFromSig(t){let{_tlv:e,_int:r}=ee,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Ge=BigInt(0),Ve=BigInt(1),zr=BigInt(2),nt=BigInt(3),Tr=BigInt(4);function Or(t,e,r){function n(i){let s=t.sqr(i),o=t.mul(s,i);return t.add(t.add(o,t.mul(i,e)),r)}return n}function lr(t,e,r){let{BYTES:n}=t;function i(s){let o;if(typeof s=="bigint")o=s;else{let a=C("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let f=new Uint8Array(n);f.set(a,f.length-a.length),a=f}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return i}function Dr(t,e={}){let{Fp:r,Fn:n}=fr("weierstrass",t,e),{h:i,n:s}=t;Me(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:o}=e;if(o&&(!r.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(I,u,y){let{x:l,y:d}=u.toAffine(),p=r.toBytes(l);if(je("isCompressed",y),y){a();let g=!r.isOdd(d);return Y(hr(g),p)}else return Y(Uint8Array.of(4),p,r.toBytes(d))}function h(I){R(I);let u=r.BYTES,y=u+1,l=2*u+1,d=I.length,p=I[0],g=I.subarray(1);if(d===y&&(p===2||p===3)){let x=r.fromBytes(g);if(!r.isValid(x))throw new Error("bad point: is not on curve, wrong x");let m=w(x),E;try{E=r.sqrt(m)}catch(B){let S=B instanceof Error?": "+B.message:"";throw new Error("bad point: is not on curve, sqrt error"+S)}a();let v=r.isOdd(E);return(p&1)===1!==v&&(E=r.neg(E)),{x,y:E}}else if(d===l&&p===4){let x=r.fromBytes(g.subarray(u*0,u*1)),m=r.fromBytes(g.subarray(u*1,u*2));if(!_(x,m))throw new Error("bad point: is not on curve");return{x,y:m}}else throw new Error(`bad point: got length ${d}, expected compressed=${y} or uncompressed=${l}`)}let c=e.toBytes||f,b=e.fromBytes||h,w=Or(r,t.a,t.b);function _(I,u){let y=r.sqr(u),l=w(I);return r.eql(y,l)}if(!_(t.Gx,t.Gy))throw new Error("bad curve params: generator point");let P=r.mul(r.pow(t.a,nt),Tr),A=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(P,A)))throw new Error("bad curve params: a or b");function z(I,u,y=!1){if(!r.isValid(u)||y&&r.is0(u))throw new Error(`bad point coordinate ${I}`);return u}function G(I){if(!(I instanceof K))throw new Error("ProjectivePoint expected")}let xe=pt((I,u)=>{let{px:y,py:l,pz:d}=I;if(r.eql(d,r.ONE))return{x:y,y:l};let p=I.is0();u==null&&(u=p?r.ONE:r.inv(d));let g=r.mul(y,u),x=r.mul(l,u),m=r.mul(d,u);if(p)return{x:r.ZERO,y:r.ZERO};if(!r.eql(m,r.ONE))throw new Error("invZ was invalid");return{x:g,y:x}}),se=pt(I=>{if(I.is0()){if(e.allowInfinityPoint&&!r.is0(I.py))return;throw new Error("bad point: ZERO")}let{x:u,y}=I.toAffine();if(!r.isValid(u)||!r.isValid(y))throw new Error("bad point: x or y not field elements");if(!_(u,y))throw new Error("bad point: equation left != right");if(!I.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function me(I,u,y,l,d){return y=new K(r.mul(y.px,I),y.py,y.pz),u=Le(l,u),y=Le(d,y),u.add(y)}class K{constructor(u,y,l){this.px=z("x",u),this.py=z("y",y,!0),this.pz=z("z",l),Object.freeze(this)}static fromAffine(u){let{x:y,y:l}=u||{};if(!u||!r.isValid(y)||!r.isValid(l))throw new Error("invalid affine point");if(u instanceof K)throw new Error("projective point not allowed");return r.is0(y)&&r.is0(l)?K.ZERO:new K(y,l,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(u){return nr(K,"pz",u)}static fromBytes(u){return R(u),K.fromHex(u)}static fromHex(u){let y=K.fromAffine(b(C("pointHex",u)));return y.assertValidity(),y}static fromPrivateKey(u){let y=lr(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return K.BASE.multiply(y(u))}static msm(u,y){return cr(K,n,u,y)}precompute(u=8,y=!0){return te.setWindowSize(this,u),y||this.multiply(nt),this}_setWindowSize(u){this.precompute(u)}assertValidity(){se(this)}hasEvenY(){let{y:u}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(u)}equals(u){G(u);let{px:y,py:l,pz:d}=this,{px:p,py:g,pz:x}=u,m=r.eql(r.mul(y,x),r.mul(p,d)),E=r.eql(r.mul(l,x),r.mul(g,d));return m&&E}negate(){return new K(this.px,r.neg(this.py),this.pz)}double(){let{a:u,b:y}=t,l=r.mul(y,nt),{px:d,py:p,pz:g}=this,x=r.ZERO,m=r.ZERO,E=r.ZERO,v=r.mul(d,d),H=r.mul(p,p),B=r.mul(g,g),S=r.mul(d,p);return S=r.add(S,S),E=r.mul(d,g),E=r.add(E,E),x=r.mul(u,E),m=r.mul(l,B),m=r.add(x,m),x=r.sub(H,m),m=r.add(H,m),m=r.mul(x,m),x=r.mul(S,x),E=r.mul(l,E),B=r.mul(u,B),S=r.sub(v,B),S=r.mul(u,S),S=r.add(S,E),E=r.add(v,v),v=r.add(E,v),v=r.add(v,B),v=r.mul(v,S),m=r.add(m,v),B=r.mul(p,g),B=r.add(B,B),v=r.mul(B,S),x=r.sub(x,v),E=r.mul(B,H),E=r.add(E,E),E=r.add(E,E),new K(x,m,E)}add(u){G(u);let{px:y,py:l,pz:d}=this,{px:p,py:g,pz:x}=u,m=r.ZERO,E=r.ZERO,v=r.ZERO,H=t.a,B=r.mul(t.b,nt),S=r.mul(y,p),L=r.mul(l,g),U=r.mul(d,x),T=r.add(y,l),k=r.add(p,g);T=r.mul(T,k),k=r.add(S,L),T=r.sub(T,k),k=r.add(y,d);let D=r.add(p,x);return k=r.mul(k,D),D=r.add(S,U),k=r.sub(k,D),D=r.add(l,d),m=r.add(g,x),D=r.mul(D,m),m=r.add(L,U),D=r.sub(D,m),v=r.mul(H,k),m=r.mul(B,U),v=r.add(m,v),m=r.sub(L,v),v=r.add(L,v),E=r.mul(m,v),L=r.add(S,S),L=r.add(L,S),U=r.mul(H,U),k=r.mul(B,k),L=r.add(L,U),U=r.sub(S,U),U=r.mul(H,U),k=r.add(k,U),S=r.mul(L,k),E=r.add(E,S),S=r.mul(D,k),m=r.mul(T,m),m=r.sub(m,S),S=r.mul(T,L),v=r.mul(D,v),v=r.add(v,S),new K(m,E,v)}subtract(u){return this.add(u.negate())}is0(){return this.equals(K.ZERO)}multiply(u){let{endo:y}=e;if(!n.isValidNot0(u))throw new Error("invalid scalar: out of range");let l,d,p=g=>te.wNAFCached(this,g,K.normalizeZ);if(y){let{k1neg:g,k1:x,k2neg:m,k2:E}=y.splitScalar(u),{p:v,f:H}=p(x),{p:B,f:S}=p(E);d=H.add(S),l=me(y.beta,v,B,g,m)}else{let{p:g,f:x}=p(u);l=g,d=x}return K.normalizeZ([l,d])[0]}multiplyUnsafe(u){let{endo:y}=e,l=this;if(!n.isValid(u))throw new Error("invalid scalar: out of range");if(u===Ge||l.is0())return K.ZERO;if(u===Ve)return l;if(te.hasPrecomputes(this))return this.multiply(u);if(y){let{k1neg:d,k1:p,k2neg:g,k2:x}=y.splitScalar(u),{p1:m,p2:E}=ar(K,l,p,x);return me(y.beta,m,E,d,g)}else return te.wNAFCachedUnsafe(l,u)}multiplyAndAddUnsafe(u,y,l){let d=this.multiplyUnsafe(y).add(u.multiplyUnsafe(l));return d.is0()?void 0:d}toAffine(u){return xe(this,u)}isTorsionFree(){let{isTorsionFree:u}=e;return i===Ve?!0:u?u(K,this):te.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){let{clearCofactor:u}=e;return i===Ve?this:u?u(K,this):this.multiplyUnsafe(i)}toBytes(u=!0){return je("isCompressed",u),this.assertValidity(),c(K,this,u)}toRawBytes(u=!0){return this.toBytes(u)}toHex(u=!0){return ie(this.toBytes(u))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}K.BASE=new K(t.Gx,t.Gy,r.ONE),K.ZERO=new K(r.ZERO,r.ONE,r.ZERO),K.Fp=r,K.Fn=n;let ae=n.BITS,te=sr(K,e.endo?Math.ceil(ae/2):ae);return K}function hr(t){return Uint8Array.of(t?2:3)}function Nr(t,e,r={}){Me(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=e.randomBytes||lt,i=e.hmac||((l,...d)=>Ce(e.hash,l,Y(...d))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:f}=o;function h(l){let d=a>>Ve;return l>d}function c(l){return h(l)?o.neg(l):l}function b(l,d){if(!o.isValidNot0(d))throw new Error(`invalid signature ${l}: out of range 1..CURVE.n`)}class w{constructor(d,p,g){b("r",d),b("s",p),this.r=d,this.s=p,g!=null&&(this.recovery=g),Object.freeze(this)}static fromCompact(d){let p=o.BYTES,g=C("compactSignature",d,p*2);return new w(o.fromBytes(g.subarray(0,p)),o.fromBytes(g.subarray(p,p*2)))}static fromDER(d){let{r:p,s:g}=ee.toSig(C("DER",d));return new w(p,g)}assertValidity(){}addRecoveryBit(d){return new w(this.r,this.s,d)}recoverPublicKey(d){let p=s.ORDER,{r:g,s:x,recovery:m}=this;if(m==null||![0,1,2,3].includes(m))throw new Error("recovery id invalid");if(a*zr<p&&m>1)throw new Error("recovery id is ambiguous for h>1 curve");let v=m===2||m===3?g+a:g;if(!s.isValid(v))throw new Error("recovery id 2 or 3 invalid");let H=s.toBytes(v),B=t.fromHex(Y(hr((m&1)===0),H)),S=o.inv(v),L=se(C("msgHash",d)),U=o.create(-L*S),T=o.create(x*S),k=t.BASE.multiplyUnsafe(U).add(B.multiplyUnsafe(T));if(k.is0())throw new Error("point at infinify");return k.assertValidity(),k}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,o.neg(this.s),this.recovery):this}toBytes(d){if(d==="compact")return Y(o.toBytes(this.r),o.toBytes(this.s));if(d==="der")return ke(ee.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ie(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ie(this.toBytes("compact"))}}let _=lr(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),P={isValidPrivateKey(l){try{return _(l),!0}catch{return!1}},normPrivateKeyToScalar:_,randomPrivateKey:()=>{let l=a;return Ft(n(mt(l)),l)},precompute(l=8,d=t.BASE){return d.precompute(l,!1)}};function A(l,d=!0){return t.fromPrivateKey(l).toBytes(d)}function z(l){if(typeof l=="bigint")return!1;if(l instanceof t)return!0;let p=C("key",l).length,g=s.BYTES,x=g+1,m=2*g+1;if(!(r.allowedPrivateKeyLengths||o.BYTES===x))return p===x||p===m}function G(l,d,p=!0){if(z(l)===!0)throw new Error("first arg must be private key");if(z(d)===!1)throw new Error("second arg must be public key");return t.fromHex(d).multiply(_(l)).toBytes(p)}let xe=e.bits2int||function(l){if(l.length>8192)throw new Error("input is too large");let d=He(l),p=l.length*8-f;return p>0?d>>BigInt(p):d},se=e.bits2int_modN||function(l){return o.create(xe(l))},me=be(f);function K(l){return qt("num < 2^"+f,l,Ge,me),o.toBytes(l)}function ae(l,d,p=te){if(["recovered","canonical"].some(T=>T in p))throw new Error("sign() legacy options not supported");let{hash:g}=e,{lowS:x,prehash:m,extraEntropy:E}=p;x==null&&(x=!0),l=C("msgHash",l),ur(p),m&&(l=C("prehashed msgHash",g(l)));let v=se(l),H=_(d),B=[K(H),K(v)];if(E!=null&&E!==!1){let T=E===!0?n(s.BYTES):E;B.push(C("extraEntropy",T))}let S=Y(...B),L=v;function U(T){let k=xe(T);if(!o.isValidNot0(k))return;let D=o.inv(k),ze=t.BASE.multiply(k).toAffine(),ge=o.create(ze.x);if(ge===Ge)return;let ce=o.create(D*o.create(L+ge*H));if(ce===Ge)return;let ct=(ze.x===ge?0:2)|Number(ze.y&Ve),_e=ce;return x&&h(ce)&&(_e=c(ce),ct^=1),new w(ge,_e,ct)}return{seed:S,k2sig:U}}let te={lowS:e.lowS,prehash:!1},I={lowS:e.lowS,prehash:!1};function u(l,d,p=te){let{seed:g,k2sig:x}=ae(l,d,p);return Gt(e.hash.outputLen,o.BYTES,i)(g,x)}t.BASE.precompute(8);function y(l,d,p,g=I){let x=l;d=C("msgHash",d),p=C("publicKey",p),ur(g);let{lowS:m,prehash:E,format:v}=g;if("strict"in g)throw new Error("options.strict was renamed to lowS");if(v!==void 0&&!["compact","der","js"].includes(v))throw new Error('format must be "compact", "der" or "js"');let H=typeof x=="string"||Pe(x),B=!H&&!v&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!H&&!B)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let S,L;try{if(B)if(v===void 0||v==="js")S=new w(x.r,x.s);else throw new Error("invalid format");if(H){try{v!=="compact"&&(S=w.fromDER(x))}catch(_e){if(!(_e instanceof ee.Err))throw _e}!S&&v!=="der"&&(S=w.fromCompact(x))}L=t.fromHex(p)}catch{return!1}if(!S||m&&S.hasHighS())return!1;E&&(d=e.hash(d));let{r:U,s:T}=S,k=se(d),D=o.inv(T),ze=o.create(k*D),ge=o.create(U*D),ce=t.BASE.multiplyUnsafe(ze).add(L.multiplyUnsafe(ge));return ce.is0()?!1:o.create(ce.x)===U}return Object.freeze({getPublicKey:A,getSharedSecret:G,sign:u,verify:y,utils:P,Point:t,Signature:w})}function Rr(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=we(e.n,t.nBitLength),i={Fp:r,Fn:n,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function Cr(t){let{CURVE:e,curveOpts:r}=Rr(t),n={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,ecdsaOpts:n}}function jr(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function dr(t){let{CURVE:e,curveOpts:r,ecdsaOpts:n}=Cr(t),i=Dr(e,r),s=Nr(i,n,r);return jr(t,s)}function br(t,e){let r=n=>dr({...t,hash:n});return{...r(e),create:r}}var it={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},ho=BigInt(0),qr=BigInt(1),St=BigInt(2),yr=(t,e)=>(t+e/St)/e;function Mr(t){let e=it.p,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),f=BigInt(88),h=t*t*t%e,c=h*h*t%e,b=M(c,r,e)*c%e,w=M(b,r,e)*c%e,_=M(w,St,e)*h%e,P=M(_,i,e)*_%e,A=M(P,s,e)*P%e,z=M(A,a,e)*A%e,G=M(z,f,e)*z%e,xe=M(G,a,e)*A%e,se=M(xe,r,e)*c%e,me=M(se,o,e)*P%e,K=M(me,n,e)*h%e,ae=M(K,St,e);if(!Kt.eql(Kt.sqr(ae),t))throw new Error("Cannot find square root");return ae}var Kt=we(it.p,void 0,void 0,{sqrt:Mr}),ot=br({...it,Fp:Kt,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=it.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-qr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=yr(s*t,e),f=yr(-n*t,e),h=q(t-a*r-f*i,e),c=q(-a*n-f*s,e),b=h>o,w=c>o;if(b&&(h=e-h),w&&(c=e-c),h>o||c>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:b,k1:h,k2neg:w,k2:c}}}},et);var st="ECDH",at=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=33,this._nSk=32}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(r){throw new $(r)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(r){throw new Z(r)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(r){throw new $(r)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(r){throw new Z(r)}}async importKey(e,r,n){try{if(e!=="raw")throw new Error("Unsupported format");return await this._importRawKey(r,n)}catch(i){throw new Z(i)}}async generateKeyPair(){try{let e=ot.utils.randomPrivateKey(),r=new W(st,e,"private",le);return{publicKey:await this.derivePublicKey(r),privateKey:r}}catch(e){throw new J(e)}}async deriveKeyPair(e){try{let r=await this._hkdf.labeledExtract(j.buffer,Ke,new Uint8Array(e)),n=await this._hkdf.labeledExpand(r,Oe,j,this._nSk),i=new W(st,new Uint8Array(n),"private",le);return{privateKey:i,publicKey:await this.derivePublicKey(i)}}catch(r){throw new ve(r)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(r){throw new Z(r)}}async dh(e,r){try{return await this._dh(e,r)}catch(n){throw new $(n)}}_serializePublicKey(e){return new Promise(r=>{r(e.key.buffer)})}_serializePrivateKey(e){return new Promise(r=>{r(e.key.buffer)})}_importRawKey(e,r){return new Promise((n,i)=>{r&&e.byteLength!==this._nPk&&i(new Error("Invalid length of the key")),!r&&e.byteLength!==this._nSk&&i(new Error("Invalid length of the key")),n(new W(st,new Uint8Array(e),r?"public":"private",r?[]:le))})}_derivePublicKey(e){return new Promise((r,n)=>{try{let i=ot.getPublicKey(e.key);r(new W(st,i,"public"))}catch(i){n(i)}})}_dh(e,r){return new Promise((n,i)=>{try{n(ot.getSharedSecret(e.key,r.key).buffer)}catch(s){i(s)}})}};var At=class extends Se{constructor(){let e=new Ie;super(re.DhkemSecp256k1HkdfSha256,new at(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:re.DhkemSecp256k1HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:33}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:33}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};export{At as DhkemSecp256k1HkdfSha256};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
