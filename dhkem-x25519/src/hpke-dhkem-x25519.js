var Sn={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48},Jt=Sn,vn={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},te=vn;function Te(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function In(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function ee(e,...t){if(!In(e))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Oe(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Te(e.outputLen),Te(e.blockLen)}function yt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ce(e,t){ee(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}function Un(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}var Kt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),W=(e,t)=>e<<32-t|e>>>t,Hn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Hn)throw new Error("Non little-endian hardware is not supported");function Pn(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function _t(e){if(typeof e=="string"&&(e=Pn(e)),!Un(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var bt=class{clone(){return this._cloneInto()}},Gr={}.toString;function Ne(e){let t=r=>e().update(_t(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}var kt=class extends bt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Oe(t);let r=_t(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return yt(this),this.iHash.update(t),this}digestInto(t){yt(this),ee(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ne=(e,t,n)=>new kt(e,t).update(n).digest();ne.create=(e,t)=>new kt(e,t);function Kn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,i,r),e.setUint32(t+u,a,r)}var Tt=class extends bt{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Kt(this.buffer)}update(t){yt(this);let{view:n,buffer:r,blockLen:o}=this;t=_t(t);let s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Kt(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){yt(this),Ce(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;Kn(r,o-8,BigInt(this.length*8),s),this.process(r,0);let a=Kt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};var kn=(e,t,n)=>e&t^~e&n,Tn=(e,t,n)=>e&t^e&n^t&n,On=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),at=new Uint32Array(64),re=class extends Tt{constructor(){super(64,32,8,!1),this.A=ct[0]|0,this.B=ct[1]|0,this.C=ct[2]|0,this.D=ct[3]|0,this.E=ct[4]|0,this.F=ct[5]|0,this.G=ct[6]|0,this.H=ct[7]|0}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[t,n,r,o,s,i,a,c]}set(t,n,r,o,s,i,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,n){for(let l=0;l<16;l++,n+=4)at[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let y=at[l-15],A=at[l-2],v=W(y,7)^W(y,18)^y>>>3,I=W(A,17)^W(A,19)^A>>>10;at[l]=I+at[l-7]+v+at[l-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let y=W(a,6)^W(a,11)^W(a,25),A=f+y+kn(a,c,u)+On[l]+at[l]|0,I=(W(r,2)^W(r,13)^W(r,22))+Tn(r,o,s)|0;f=u,u=c,c=a,a=i+A|0,i=s,s=o,o=r,r=A+I|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,u,f)}roundClean(){at.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Re=Ne(()=>new re);var Cn={},De=Nn(globalThis,Cn);function Nn(e,t){return new Proxy(e,{get(n,r,o){return r in t?t[r]:e[r]},set(n,r,o){return r in t&&delete t[r],e[r]=o,!0},deleteProperty(n,r){let o=!1;return r in t&&(delete t[r],o=!0),r in e&&(delete e[r],o=!0),o},ownKeys(n){let r=Reflect.ownKeys(e),o=Reflect.ownKeys(t),s=new Set(o);return[...r.filter(i=>!s.has(i)),...o]},defineProperty(n,r,o){return r in t&&delete t[r],Reflect.defineProperty(e,r,o),!0},getOwnPropertyDescriptor(n,r){return r in t?Reflect.getOwnPropertyDescriptor(t,r):Reflect.getOwnPropertyDescriptor(e,r)},has(n,r){return r in t||r in e}})}var oe=class extends Error{constructor(t){let n;t instanceof Error?n=t.message:typeof t=="string"?n=t:n="",super(n),this.name=this.constructor.name}},tt=class extends oe{},xt=class extends tt{};var wt=class extends tt{},lt=class extends tt{},Ot=class extends tt{},Ct=class extends tt{};var Nt=class extends tt{},gt=class extends tt{};async function Dn(){if(De!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:e}=await import("crypto");return e.subtle}catch(e){throw new gt(e)}}var Rt=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await Dn())}};var et=new Uint8Array(0);var ze=new Uint8Array([72,80,75,69,45,118,49]),ie=class extends Rt{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:te.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:et}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(t){this._suiteId=t}buildLabeledIkm(t,n){this._checkInit();let r=new Uint8Array(7+this._suiteId.byteLength+t.byteLength+n.byteLength);return r.set(ze,0),r.set(this._suiteId,7),r.set(t,7+this._suiteId.byteLength),r.set(n,7+this._suiteId.byteLength+t.byteLength),r}buildLabeledInfo(t,n,r){this._checkInit();let o=new Uint8Array(9+this._suiteId.byteLength+t.byteLength+n.byteLength);return o.set(new Uint8Array([0,r]),0),o.set(ze,2),o.set(this._suiteId,9),o.set(t,9+this._suiteId.byteLength),o.set(n,9+this._suiteId.byteLength+t.byteLength),o}async extract(t,n){if(await this._setup(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)throw new xt("The salt length must be the same as the hashSize");let r=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",r,n)}async expand(t,n,r){await this._setup();let o=await this._api.importKey("raw",t,this.algHash,!1,["sign"]),s=new ArrayBuffer(r),i=new Uint8Array(s),a=et,c=new Uint8Array(n),u=new Uint8Array(1);if(r>255*this.hashSize)throw new Error("Entropy limit reached");let f=new Uint8Array(this.hashSize+c.length+1);for(let l=1,y=0;y<i.length;l++)u[0]=l,f.set(a,0),f.set(c,a.length),f.set(u,a.length+c.length),a=new Uint8Array(await this._api.sign("HMAC",o,f.slice(0,a.length+c.length+1))),i.length-y>=a.length?(i.set(a,y),y+=a.length):(i.set(a.slice(0,i.length-y),y),y+=i.length-y);return s}async extractAndExpand(t,n,r,o){await this._setup();let s=await this._api.importKey("raw",n,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:t,info:r},s,o*8)}async labeledExtract(t,n,r){return await this.extract(t,this.buildLabeledIkm(n,r))}async labeledExpand(t,n,r,o){return await this.expand(t,this.buildLabeledInfo(n,r,o),o)}_checkInit(){if(this._suiteId===et)throw new Error("Not initialized. Call init()")}},Dt=class extends ie{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:te.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}};var zt=class extends Dt{async extract(t,n){if(await this._setup(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)return ne(Re,new Uint8Array(t),new Uint8Array(n));let r=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",r,n)}};var qe=new Uint8Array([75,69,77,0,0]);var mt=e=>typeof e=="object"&&e!==null&&typeof e.privateKey=="object"&&typeof e.publicKey=="object";function Me(e,t){if(t<=0)throw new Error("i2Osp: too small size");if(e>=256**t)throw new Error("i2Osp: too large integer");let n=new Uint8Array(t);for(let r=0;r<t&&e;r++)n[t-(r+1)]=e%256,e=e>>8;return n}function At(e,t){let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n}function se(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}var qn=new Uint8Array([101,97,101,95,112,114,107]),Mn=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);function Gn(e,t,n){let r=new Uint8Array(e.length+t.length+n.length);return r.set(e,0),r.set(t,e.length),r.set(n,e.length+t.length),r}var qt=class{constructor(t,n,r){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=t,this._prim=n,this._kdf=r;let o=new Uint8Array(qe);o.set(Me(this.id,2),3),this._kdf.init(o)}async serializePublicKey(t){return await this._prim.serializePublicKey(t)}async deserializePublicKey(t){return await this._prim.deserializePublicKey(t)}async serializePrivateKey(t){return await this._prim.serializePrivateKey(t)}async deserializePrivateKey(t){return await this._prim.deserializePrivateKey(t)}async importKey(t,n,r=!0){return await this._prim.importKey(t,n,r)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(t){if(t.byteLength>8192)throw new xt("Too long ikm");return await this._prim.deriveKeyPair(t)}async encap(t){let n;t.ekm===void 0?n=await this.generateKeyPair():mt(t.ekm)?n=t.ekm:n=await this.deriveKeyPair(t.ekm);let r=await this._prim.serializePublicKey(n.publicKey),o=await this._prim.serializePublicKey(t.recipientPublicKey);try{let s;if(t.senderKey===void 0)s=new Uint8Array(await this._prim.dh(n.privateKey,t.recipientPublicKey));else{let c=mt(t.senderKey)?t.senderKey.privateKey:t.senderKey,u=new Uint8Array(await this._prim.dh(n.privateKey,t.recipientPublicKey)),f=new Uint8Array(await this._prim.dh(c,t.recipientPublicKey));s=At(u,f)}let i;if(t.senderKey===void 0)i=At(new Uint8Array(r),new Uint8Array(o));else{let c=mt(t.senderKey)?t.senderKey.publicKey:await this._prim.derivePublicKey(t.senderKey),u=await this._prim.serializePublicKey(c);i=Gn(new Uint8Array(r),new Uint8Array(o),new Uint8Array(u))}let a=await this._generateSharedSecret(s,i);return{enc:r,sharedSecret:a}}catch(s){throw new Ot(s)}}async decap(t){let n=await this._prim.deserializePublicKey(t.enc),r=mt(t.recipientKey)?t.recipientKey.privateKey:t.recipientKey,o=mt(t.recipientKey)?t.recipientKey.publicKey:await this._prim.derivePublicKey(t.recipientKey),s=await this._prim.serializePublicKey(o);try{let i;if(t.senderPublicKey===void 0)i=new Uint8Array(await this._prim.dh(r,n));else{let c=new Uint8Array(await this._prim.dh(r,n)),u=new Uint8Array(await this._prim.dh(r,t.senderPublicKey));i=At(c,u)}let a;if(t.senderPublicKey===void 0)a=At(new Uint8Array(t.enc),new Uint8Array(s));else{let c=await this._prim.serializePublicKey(t.senderPublicKey);a=new Uint8Array(t.enc.byteLength+s.byteLength+c.byteLength),a.set(new Uint8Array(t.enc),0),a.set(new Uint8Array(s),t.enc.byteLength),a.set(new Uint8Array(c),t.enc.byteLength+s.byteLength)}return await this._generateSharedSecret(i,a)}catch(i){throw new Ct(i)}}async _generateSharedSecret(t,n){let r=this._kdf.buildLabeledIkm(qn,t),o=this._kdf.buildLabeledInfo(Mn,n,this.secretSize);return await this._kdf.extractAndExpand(et,r,o,this.secretSize)}};function jn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function ce(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ge(e,t){jn(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Mt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var je=e=>e instanceof Uint8Array;var jt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);var $n=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!$n)throw new Error("Non little-endian hardware is not supported");function ae(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function fe(e){if(typeof e=="string"&&(e=ae(e)),!je(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function $e(...e){let t=new Uint8Array(e.reduce((r,o)=>r+o.length,0)),n=0;return e.forEach(r=>{if(!je(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var Gt=class{clone(){return this._cloneInto()}},Ao={}.toString;function Fe(e){let t=r=>e().update(fe(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function ue(e=32){if(Mt&&typeof Mt.getRandomValues=="function")return Mt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Fn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,i,r),e.setUint32(t+u,a,r)}var $t=class extends Gt{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=jt(this.buffer)}update(t){ce(this);let{view:n,buffer:r,blockLen:o}=this;t=fe(t);let s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=jt(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ce(this),Ge(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;Fn(r,o-8,BigInt(this.length*8),s),this.process(r,0);let a=jt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};var Ft=BigInt(4294967295),he=BigInt(32);function Ve(e,t=!1){return t?{h:Number(e&Ft),l:Number(e>>he&Ft)}:{h:Number(e>>he&Ft)|0,l:Number(e&Ft)|0}}function Vn(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let o=0;o<e.length;o++){let{h:s,l:i}=Ve(e[o],t);[n[o],r[o]]=[s,i]}return[n,r]}var Zn=(e,t)=>BigInt(e>>>0)<<he|BigInt(t>>>0),Xn=(e,t,n)=>e>>>n,Wn=(e,t,n)=>e<<32-n|t>>>n,Yn=(e,t,n)=>e>>>n|t<<32-n,Qn=(e,t,n)=>e<<32-n|t>>>n,Jn=(e,t,n)=>e<<64-n|t>>>n-32,tr=(e,t,n)=>e>>>n-32|t<<64-n,er=(e,t)=>t,nr=(e,t)=>e,rr=(e,t,n)=>e<<n|t>>>32-n,or=(e,t,n)=>t<<n|e>>>32-n,ir=(e,t,n)=>t<<n-32|e>>>64-n,sr=(e,t,n)=>e<<n-32|t>>>64-n;function cr(e,t,n,r){let o=(t>>>0)+(r>>>0);return{h:e+n+(o/2**32|0)|0,l:o|0}}var ar=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),fr=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,ur=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),hr=(e,t,n,r,o)=>t+n+r+o+(e/2**32|0)|0,lr=(e,t,n,r,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(o>>>0),dr=(e,t,n,r,o,s)=>t+n+r+o+s+(e/2**32|0)|0;var pr={fromBig:Ve,split:Vn,toBig:Zn,shrSH:Xn,shrSL:Wn,rotrSH:Yn,rotrSL:Qn,rotrBH:Jn,rotrBL:tr,rotr32H:er,rotr32L:nr,rotlSH:rr,rotlSL:or,rotlBH:ir,rotlBL:sr,add:cr,add3L:ar,add3H:fr,add4L:ur,add4H:hr,add5H:dr,add5L:lr},g=pr;var[yr,br]=g.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ft=new Uint32Array(80),ut=new Uint32Array(80),le=class extends $t{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:n,Bh:r,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:f,Fh:l,Fl:y,Gh:A,Gl:v,Hh:I,Hl:S}=this;return[t,n,r,o,s,i,a,c,u,f,l,y,A,v,I,S]}set(t,n,r,o,s,i,a,c,u,f,l,y,A,v,I,S){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=y|0,this.Gh=A|0,this.Gl=v|0,this.Hh=I|0,this.Hl=S|0}process(t,n){for(let d=0;d<16;d++,n+=4)ft[d]=t.getUint32(n),ut[d]=t.getUint32(n+=4);for(let d=16;d<80;d++){let m=ft[d-15]|0,x=ut[d-15]|0,N=g.rotrSH(m,x,1)^g.rotrSH(m,x,8)^g.shrSH(m,x,7),X=g.rotrSL(m,x,1)^g.rotrSL(m,x,8)^g.shrSL(m,x,7),K=ft[d-2]|0,T=ut[d-2]|0,q=g.rotrSH(K,T,19)^g.rotrBH(K,T,61)^g.shrSH(K,T,6),R=g.rotrSL(K,T,19)^g.rotrBL(K,T,61)^g.shrSL(K,T,6),$=g.add4L(X,R,ut[d-7],ut[d-16]),O=g.add4H($,N,q,ft[d-7],ft[d-16]);ft[d]=O|0,ut[d]=$|0}let{Ah:r,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:f,Eh:l,El:y,Fh:A,Fl:v,Gh:I,Gl:S,Hh:z,Hl:j}=this;for(let d=0;d<80;d++){let m=g.rotrSH(l,y,14)^g.rotrSH(l,y,18)^g.rotrBH(l,y,41),x=g.rotrSL(l,y,14)^g.rotrSL(l,y,18)^g.rotrBL(l,y,41),N=l&A^~l&I,X=y&v^~y&S,K=g.add5L(j,x,X,br[d],ut[d]),T=g.add5H(K,z,m,N,yr[d],ft[d]),q=K|0,R=g.rotrSH(r,o,28)^g.rotrBH(r,o,34)^g.rotrBH(r,o,39),$=g.rotrSL(r,o,28)^g.rotrBL(r,o,34)^g.rotrBL(r,o,39),O=r&s^r&a^s&a,Bt=o&i^o&c^i&c;z=I|0,j=S|0,I=A|0,S=v|0,A=l|0,v=y|0,{h:l,l:y}=g.add(u|0,f|0,T|0,q|0),u=a|0,f=c|0,a=s|0,c=i|0,s=r|0,i=o|0;let it=g.add3L(q,$,Bt);r=g.add3H(it,T,R,O),o=it|0}({h:r,l:o}=g.add(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:i}=g.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=g.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=g.add(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:y}=g.add(this.Eh|0,this.El|0,l|0,y|0),{h:A,l:v}=g.add(this.Fh|0,this.Fl|0,A|0,v|0),{h:I,l:S}=g.add(this.Gh|0,this.Gl|0,I|0,S|0),{h:z,l:j}=g.add(this.Hh|0,this.Hl|0,z|0,j|0),this.set(r,o,s,i,a,c,u,f,l,y,A,v,I,S,z,j)}roundClean(){ft.fill(0),ut.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var de=Fe(()=>new le);var To=BigInt(0),xr=BigInt(1),wr=BigInt(2),Vt=e=>e instanceof Uint8Array,gr=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Zt(e){if(!Vt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=gr[e[n]];return t}function Ze(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Xe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){let o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function We(e){return Ze(Zt(e))}function nt(e){if(!Vt(e))throw new Error("Uint8Array expected");return Ze(Zt(Uint8Array.from(e).reverse()))}function pe(e,t){return Xe(e.toString(16).padStart(t*2,"0"))}function dt(e,t){return pe(e,t).reverse()}function F(e,t,n){let r;if(typeof t=="string")try{r=Xe(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Vt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function ye(...e){let t=new Uint8Array(e.reduce((r,o)=>r+o.length,0)),n=0;return e.forEach(r=>{if(!Vt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}var Ye=e=>(wr<<BigInt(e-1))-xr;var mr={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ht(e,t,n={}){let r=(o,s,i)=>{let a=mr[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=e[o];if(!(i&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(let[o,s]of Object.entries(t))r(o,s,!1);for(let[o,s]of Object.entries(n))r(o,s,!0);return e}var C=BigInt(0),k=BigInt(1),pt=BigInt(2),Br=BigInt(3),be=BigInt(4),Qe=BigInt(5),Je=BigInt(8),_r=BigInt(9),Ar=BigInt(16);function P(e,t){let n=e%t;return n>=C?n:t+n}function xe(e,t,n){if(n<=C||t<C)throw new Error("Expected power/modulo > 0");if(n===k)return C;let r=k;for(;t>C;)t&k&&(r=r*e%n),e=e*e%n,t>>=k;return r}function Z(e,t,n){let r=e;for(;t-- >C;)r*=r,r%=n;return r}function tn(e,t){if(e===C||t<=C)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=P(e,t),r=t,o=C,s=k,i=k,a=C;for(;n!==C;){let u=r/n,f=r%n,l=o-i*u,y=s-a*u;r=n,n=f,o=i,s=a,i=l,a=y}if(r!==k)throw new Error("invert: does not exist");return P(o,t)}function Lr(e){let t=(e-k)/pt,n,r,o;for(n=e-k,r=0;n%pt===C;n/=pt,r++);for(o=pt;o<e&&xe(o,t,e)!==e-k;o++);if(r===1){let i=(e+k)/be;return function(c,u){let f=c.pow(u,i);if(!c.eql(c.sqr(f),u))throw new Error("Cannot find square root");return f}}let s=(n+k)/pt;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=r,f=a.pow(a.mul(a.ONE,o),n),l=a.pow(c,s),y=a.pow(c,n);for(;!a.eql(y,a.ONE);){if(a.eql(y,a.ZERO))return a.ZERO;let A=1;for(let I=a.sqr(y);A<u&&!a.eql(I,a.ONE);A++)I=a.sqr(I);let v=a.pow(f,k<<BigInt(u-A-1));f=a.sqr(v),l=a.mul(l,v),y=a.mul(y,f),u=A}return l}}function Sr(e){if(e%be===Br){let t=(e+k)/be;return function(r,o){let s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%Je===Qe){let t=(e-Qe)/Je;return function(r,o){let s=r.mul(o,pt),i=r.pow(s,t),a=r.mul(o,i),c=r.mul(r.mul(a,pt),i),u=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return e%Ar,Lr(e)}var en=(e,t)=>(P(e,t)&k)===k,vr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=vr.reduce((r,o)=>(r[o]="function",r),t);return ht(e,n)}function Ir(e,t,n){if(n<C)throw new Error("Expected power > 0");if(n===C)return e.ONE;if(n===k)return t;let r=e.ONE,o=t;for(;n>C;)n&k&&(r=e.mul(r,o)),o=e.sqr(o),n>>=k;return r}function Ur(e,t){let n=new Array(t.length),r=t.reduce((s,i,a)=>e.is0(i)?s:(n[a]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,a)=>e.is0(i)?s:(n[a]=e.mul(s,n[a]),e.mul(s,i)),o),n}function we(e,t){let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function rn(e,t,n=!1,r={}){if(e<=C)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:s}=we(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=Sr(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:Ye(o),ZERO:C,ONE:k,create:c=>P(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return C<=c&&c<e},is0:c=>c===C,isOdd:c=>(c&k)===k,neg:c=>P(-c,e),eql:(c,u)=>c===u,sqr:c=>P(c*c,e),add:(c,u)=>P(c+u,e),sub:(c,u)=>P(c-u,e),mul:(c,u)=>P(c*u,e),pow:(c,u)=>Ir(a,c,u),div:(c,u)=>P(c*tn(u,e),e),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>tn(c,e),sqrt:r.sqrt||(c=>i(a,c)),invertBatch:c=>Ur(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>n?dt(c,s):pe(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?nt(c):We(c)}});return Object.freeze(a)}function on(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");let n=e.sqrt(t);return e.isOdd(n)?e.neg(n):n}var Hr=BigInt(0),ge=BigInt(1);function sn(e,t){let n=(o,s)=>{let i=s.negate();return o?i:s},r=o=>{let s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,a=o;for(;s>Hr;)s&ge&&(i=i.add(a)),a=a.double(),s>>=ge;return i},precomputeWindow(o,s){let{windows:i,windowSize:a}=r(s),c=[],u=o,f=u;for(let l=0;l<i;l++){f=u,c.push(f);for(let y=1;y<a;y++)f=f.add(u),c.push(f);u=f.double()}return c},wNAF(o,s,i){let{windows:a,windowSize:c}=r(o),u=e.ZERO,f=e.BASE,l=BigInt(2**o-1),y=2**o,A=BigInt(o);for(let v=0;v<a;v++){let I=v*c,S=Number(i&l);i>>=A,S>c&&(S-=y,i+=ge);let z=I,j=I+Math.abs(S)-1,d=v%2!==0,m=S<0;S===0?f=f.add(n(d,s[z])):u=u.add(n(m,s[j]))}return{p:u,f}},wNAFCached(o,s,i,a){let c=o._WINDOW_SIZE||1,u=s.get(o);return u||(u=this.precomputeWindow(o,c),c!==1&&s.set(o,a(u))),this.wNAF(c,u,i)}}}function cn(e){return nn(e.Fp),ht(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...we(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}var Y=BigInt(0),V=BigInt(1),Xt=BigInt(2),Pr=BigInt(8),Kr={zip215:!0};function kr(e){let t=cn(e);return ht(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Wt(e){let t=kr(e),{Fp:n,n:r,prehash:o,hash:s,randomBytes:i,nByteLength:a,h:c}=t,u=Xt<<BigInt(a*8)-V,f=n.create,l=t.uvRatio||((p,h)=>{try{return{isValid:!0,value:n.sqrt(p*n.inv(h))}}catch{return{isValid:!1,value:Y}}}),y=t.adjustScalarBytes||(p=>p),A=t.domain||((p,h,b)=>{if(h.length||b)throw new Error("Contexts/pre-hash are not supported");return p}),v=p=>typeof p=="bigint"&&Y<p,I=(p,h)=>v(p)&&v(h)&&p<h,S=p=>p===Y||I(p,u);function z(p,h){if(I(p,h))return p;throw new Error(`Expected valid scalar < ${h}, got ${typeof p} ${p}`)}function j(p){return p===Y?p:z(p,r)}let d=new Map;function m(p){if(!(p instanceof x))throw new Error("ExtendedPoint expected")}class x{constructor(h,b,w,E){if(this.ex=h,this.ey=b,this.ez=w,this.et=E,!S(h))throw new Error("x required");if(!S(b))throw new Error("y required");if(!S(w))throw new Error("z required");if(!S(E))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(h){if(h instanceof x)throw new Error("extended point not allowed");let{x:b,y:w}=h||{};if(!S(b)||!S(w))throw new Error("invalid affine point");return new x(b,w,V,f(b*w))}static normalizeZ(h){let b=n.invertBatch(h.map(w=>w.ez));return h.map((w,E)=>w.toAffine(b[E])).map(x.fromAffine)}_setWindowSize(h){this._WINDOW_SIZE=h,d.delete(this)}assertValidity(){let{a:h,d:b}=t;if(this.is0())throw new Error("bad point: ZERO");let{ex:w,ey:E,ez:B,et:L}=this,H=f(w*w),_=f(E*E),U=f(B*B),D=f(U*U),M=f(H*h),Q=f(U*f(M+_)),G=f(D+f(b*f(H*_)));if(Q!==G)throw new Error("bad point: equation left != right (1)");let st=f(w*E),J=f(B*L);if(st!==J)throw new Error("bad point: equation left != right (2)")}equals(h){m(h);let{ex:b,ey:w,ez:E}=this,{ex:B,ey:L,ez:H}=h,_=f(b*H),U=f(B*E),D=f(w*H),M=f(L*E);return _===U&&D===M}is0(){return this.equals(x.ZERO)}negate(){return new x(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){let{a:h}=t,{ex:b,ey:w,ez:E}=this,B=f(b*b),L=f(w*w),H=f(Xt*f(E*E)),_=f(h*B),U=b+w,D=f(f(U*U)-B-L),M=_+L,Q=M-H,G=_-L,st=f(D*Q),J=f(M*G),Ht=f(D*G),Pt=f(Q*M);return new x(st,J,Pt,Ht)}add(h){m(h);let{a:b,d:w}=t,{ex:E,ey:B,ez:L,et:H}=this,{ex:_,ey:U,ez:D,et:M}=h;if(b===BigInt(-1)){let ve=f((B-E)*(U+_)),Ie=f((B+E)*(U-_)),Qt=f(Ie-ve);if(Qt===Y)return this.double();let Ue=f(L*Xt*M),He=f(H*Xt*D),Pe=He+Ue,Ke=Ie+ve,ke=He-Ue,Bn=f(Pe*Qt),_n=f(Ke*ke),An=f(Pe*ke),Ln=f(Qt*Ke);return new x(Bn,_n,Ln,An)}let Q=f(E*_),G=f(B*U),st=f(H*w*M),J=f(L*D),Ht=f((E+B)*(_+U)-Q-G),Pt=J-st,Le=J+st,Se=f(G-b*Q),wn=f(Ht*Pt),gn=f(Le*Se),mn=f(Ht*Se),En=f(Pt*Le);return new x(wn,gn,En,mn)}subtract(h){return this.add(h.negate())}wNAF(h){return K.wNAFCached(this,d,h,x.normalizeZ)}multiply(h){let{p:b,f:w}=this.wNAF(z(h,r));return x.normalizeZ([b,w])[0]}multiplyUnsafe(h){let b=j(h);return b===Y?X:this.equals(X)||b===V?this:this.equals(N)?this.wNAF(b).p:K.unsafeLadder(this,b)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return K.unsafeLadder(this,r).is0()}toAffine(h){let{ex:b,ey:w,ez:E}=this,B=this.is0();h==null&&(h=B?Pr:n.inv(E));let L=f(b*h),H=f(w*h),_=f(E*h);if(B)return{x:Y,y:V};if(_!==V)throw new Error("invZ was invalid");return{x:L,y:H}}clearCofactor(){let{h}=t;return h===V?this:this.multiplyUnsafe(h)}static fromHex(h,b=!1){let{d:w,a:E}=t,B=n.BYTES;h=F("pointHex",h,B);let L=h.slice(),H=h[B-1];L[B-1]=H&-129;let _=nt(L);_===Y||(b?z(_,u):z(_,n.ORDER));let U=f(_*_),D=f(U-V),M=f(w*U-E),{isValid:Q,value:G}=l(D,M);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");let st=(G&V)===V,J=(H&128)!==0;if(!b&&G===Y&&J)throw new Error("Point.fromHex: x=0 and x_0=1");return J!==st&&(G=f(-G)),x.fromAffine({x:G,y:_})}static fromPrivateKey(h){return R(h).point}toRawBytes(){let{x:h,y:b}=this.toAffine(),w=dt(b,n.BYTES);return w[w.length-1]|=h&V?128:0,w}toHex(){return Zt(this.toRawBytes())}}x.BASE=new x(t.Gx,t.Gy,V,f(t.Gx*t.Gy)),x.ZERO=new x(Y,V,V,Y);let{BASE:N,ZERO:X}=x,K=sn(x,a*8);function T(p){return P(p,r)}function q(p){return T(nt(p))}function R(p){let h=a;p=F("private key",p,h);let b=F("hashed private key",s(p),2*h),w=y(b.slice(0,h)),E=b.slice(h,2*h),B=q(w),L=N.multiply(B),H=L.toRawBytes();return{head:w,prefix:E,scalar:B,point:L,pointBytes:H}}function $(p){return R(p).pointBytes}function O(p=new Uint8Array,...h){let b=ye(...h);return q(s(A(b,F("context",p),!!o)))}function Bt(p,h,b={}){p=F("message",p),o&&(p=o(p));let{prefix:w,scalar:E,pointBytes:B}=R(h),L=O(b.context,w,p),H=N.multiply(L).toRawBytes(),_=O(b.context,H,B,p),U=T(L+_*E);j(U);let D=ye(H,dt(U,n.BYTES));return F("result",D,a*2)}let it=Kr;function It(p,h,b,w=it){let{context:E,zip215:B}=w,L=n.BYTES;p=F("signature",p,2*L),h=F("message",h),o&&(h=o(h));let H=nt(p.slice(L,2*L)),_,U,D;try{_=x.fromHex(b,B),U=x.fromHex(p.slice(0,L),B),D=N.multiplyUnsafe(H)}catch{return!1}if(!B&&_.isSmallOrder())return!1;let M=O(E,U.toRawBytes(),_.toRawBytes(),h);return U.add(_.multiplyUnsafe(M)).subtract(D).clearCofactor().equals(x.ZERO)}return N._setWindowSize(8),{CURVE:t,getPublicKey:$,sign:Bt,verify:It,ExtendedPoint:x,utils:{getExtendedPublicKey:R,randomPrivateKey:()=>i(n.BYTES),precompute(p=8,h=x.BASE){return h._setWindowSize(p),h.multiply(BigInt(3)),h}}}}var Lt=BigInt(0),me=BigInt(1);function Tr(e){return ht(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function an(e){let t=Tr(e),{P:n}=t,r=d=>P(d,n),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,a=t.adjustScalarBytes||(d=>d),c=t.powPminus2||(d=>xe(d,n-BigInt(2),n));function u(d,m,x){let N=r(d*(m-x));return m=r(m-N),x=r(x+N),[m,x]}function f(d){if(typeof d=="bigint"&&Lt<=d&&d<n)return d;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}let l=(t.a-BigInt(2))/BigInt(4);function y(d,m){let x=f(d),N=f(m),X=x,K=me,T=Lt,q=x,R=me,$=Lt,O;for(let it=BigInt(o-1);it>=Lt;it--){let It=N>>it&me;$^=It,O=u($,K,q),K=O[0],q=O[1],O=u($,T,R),T=O[0],R=O[1],$=It;let Ut=K+T,p=r(Ut*Ut),h=K-T,b=r(h*h),w=p-b,E=q+R,B=q-R,L=r(B*Ut),H=r(E*h),_=L+H,U=L-H;q=r(_*_),R=r(X*r(U*U)),K=r(p*b),T=r(w*(p+r(l*w)))}O=u($,K,q),K=O[0],q=O[1],O=u($,T,R),T=O[0],R=O[1];let Bt=c(T);return r(K*Bt)}function A(d){return dt(r(d),s)}function v(d){let m=F("u coordinate",d,s);return i===s&&(m[i-1]&=127),nt(m)}function I(d){let m=F("scalar",d);if(m.length!==s&&m.length!==i)throw new Error(`Expected ${s} or ${i} bytes, got ${m.length}`);return nt(a(m))}function S(d,m){let x=v(m),N=I(d),X=y(x,N);if(X===Lt)throw new Error("Invalid private or public key received");return A(X)}let z=A(t.Gu);function j(d){return S(d,z)}return{scalarMult:S,scalarMultBase:j,getSharedSecret:(d,m)=>S(d,m),getPublicKey:d=>j(d),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:z}}var St=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),fn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Qo=BigInt(0),Or=BigInt(1),Ee=BigInt(2),Cr=BigInt(5),un=BigInt(10),Nr=BigInt(20),Rr=BigInt(40),hn=BigInt(80);function ln(e){let t=St,r=e*e%t*e%t,o=Z(r,Ee,t)*r%t,s=Z(o,Or,t)*e%t,i=Z(s,Cr,t)*s%t,a=Z(i,un,t)*i%t,c=Z(a,Nr,t)*a%t,u=Z(c,Rr,t)*c%t,f=Z(u,hn,t)*u%t,l=Z(f,hn,t)*u%t,y=Z(l,un,t)*i%t;return{pow_p_5_8:Z(y,Ee,t)*e%t,b2:r}}function dn(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Dr(e,t){let n=St,r=P(t*t*t,n),o=P(r*r*t,n),s=ln(e*o).pow_p_5_8,i=P(e*r*s,n),a=P(t*i*i,n),c=i,u=P(i*fn,n),f=a===e,l=a===P(-e,n),y=a===P(-e*fn,n);return f&&(i=c),(l||y)&&(i=u),en(i,n)&&(i=P(-i,n)),{isValid:f||l,value:i}}var rt=rn(St,void 0,!0),Be={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:rt,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:de,randomBytes:ue,adjustScalarBytes:dn,uvRatio:Dr},pn=Wt(Be);function yn(e,t,n){if(t.length>255)throw new Error("Context is too big");return $e(ae("SigEd25519 no Ed25519 collisions"),new Uint8Array([n?1:0,t.length]),t,e)}var Jo=Wt({...Be,domain:yn}),ti=Wt({...Be,domain:yn,prehash:de}),_e=an({P:St,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let t=St,{pow_p_5_8:n,b2:r}=ln(e);return P(Z(n,BigInt(3),t)*r,t)},adjustScalarBytes:dn,randomBytes:ue});var zr=(rt.ORDER+BigInt(3))/BigInt(8),ei=rt.pow(Ee,zr),ni=rt.sqrt(rt.neg(rt.ONE)),ri=(rt.ORDER-BigInt(5))/BigInt(8),oi=BigInt(486662);var ii=on(rt,rt.neg(BigInt(486664)));var si=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),ci=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ai=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),fi=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");var ui=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var vt=["deriveBits"],bn=new Uint8Array([100,107,112,95,112,114,107]),xn=new Uint8Array([115,107]);var ot=class{constructor(t,n,r,o=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=n,this.type=r,this.algorithm={name:t},this.usages=o,r==="public"&&(this.usages=[])}};var Et="X25519",Yt=class{constructor(t){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,this._nPk=32,this._nSk=32}async serializePublicKey(t){try{return await this._serializePublicKey(t)}catch(n){throw new wt(n)}}async deserializePublicKey(t){try{return await this._importRawKey(t,!0)}catch(n){throw new lt(n)}}async serializePrivateKey(t){try{return await this._serializePrivateKey(t)}catch(n){throw new wt(n)}}async deserializePrivateKey(t){try{return await this._importRawKey(t,!1)}catch(n){throw new lt(n)}}async importKey(t,n,r){try{if(t==="raw")return await this._importRawKey(n,r);if(n instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(n,r)}catch(o){throw new lt(o)}}async generateKeyPair(){try{let t=pn.utils.randomPrivateKey(),n=new ot(Et,t,"private",vt);return{publicKey:await this.derivePublicKey(n),privateKey:n}}catch(t){throw new gt(t)}}async deriveKeyPair(t){try{let n=await this._hkdf.labeledExtract(et,bn,new Uint8Array(t)),r=await this._hkdf.labeledExpand(n,xn,et,this._nSk),o=new ot(Et,new Uint8Array(r),"private",vt);return{privateKey:o,publicKey:await this.derivePublicKey(o)}}catch(n){throw new Nt(n)}}async derivePublicKey(t){try{return await this._derivePublicKey(t)}catch(n){throw new lt(n)}}async dh(t,n){try{return await this._dh(t,n)}catch(r){throw new wt(r)}}_serializePublicKey(t){return new Promise(n=>{n(t.key.buffer)})}_serializePrivateKey(t){return new Promise(n=>{n(t.key.buffer)})}_importRawKey(t,n){return new Promise((r,o)=>{n&&t.byteLength!==this._nPk&&o(new Error("Invalid length of the key")),!n&&t.byteLength!==this._nSk&&o(new Error("Invalid length of the key")),r(new ot(Et,new Uint8Array(t),n?"public":"private",n?[]:vt))})}_importJWK(t,n){return new Promise((r,o)=>{(typeof t.kty>"u"||t.kty!=="OKP")&&o(new Error(`Invalid kty: ${t.kty}`)),(typeof t.crv>"u"||t.crv!=="X25519")&&o(new Error(`Invalid crv: ${t.crv}`)),n?(typeof t.d<"u"&&o(new Error("Invalid key: `d` should not be set")),typeof t.x>"u"&&o(new Error("Invalid key: `x` not found")),r(new ot(Et,se(t.x),"public"))):(typeof t.d!="string"&&o(new Error("Invalid key: `d` not found")),r(new ot(Et,se(t.d),"private",vt)))})}_derivePublicKey(t){return new Promise((n,r)=>{try{let o=_e.getPublicKey(t.key);n(new ot(Et,o,"public"))}catch(o){r(o)}})}_dh(t,n){return new Promise((r,o)=>{try{r(_e.getSharedSecret(t.key,n.key).buffer)}catch(s){o(s)}})}};var Ae=class extends qt{constructor(){let t=new zt;super(Jt.DhkemX25519HkdfSha256,new Yt(t),t),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Jt.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};export{Ae as DhkemX25519HkdfSha256};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
