var wt=e=>e instanceof Uint8Array;var K=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),it=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),dt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dt)throw new Error("Non little-endian hardware is not supported");function Z(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function J(e){if(typeof e=="string"&&(e=Z(e)),!wt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var bt=e=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function ct(e,t){if(t!==void 0&&(typeof t!="object"||!bt(t)))throw new Error("options must be object or undefined");return Object.assign(e,t)}function F(e,t){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof t=="number"&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}function at(e,t){if(e.length!==t.length)throw new Error("equalBytes: Different size of Uint8Arrays");let n=!0;for(let r=0;r<e.length;r++)n&&(n=e[r]===t[r]);return n}function tt(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let c=BigInt(32),s=BigInt(4294967295),f=Number(n>>c&s),o=Number(n&s),y=r?4:0,h=r?0:4;e.setUint32(t+y,f,r),e.setUint32(t+h,o,r)}function et(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function mt(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function ht(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ut(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");et(e.outputLen),et(e.blockLen)}function At(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Et(e,t){ht(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Lt={number:et,bool:mt,bytes:ht,hash:Ut,exists:At,output:Et},v=Lt;var N=(e,t)=>e[t++]&255|(e[t++]&255)<<8,rt=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=J(t),F(t,32);let n=N(t,0),r=N(t,2),c=N(t,4),s=N(t,6),f=N(t,8),o=N(t,10),y=N(t,12),h=N(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|c<<6)&7939,this.r[3]=(c>>>7|s<<9)&8191,this.r[4]=(s>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|o<<2)&8191,this.r[7]=(o>>>11|y<<5)&8065,this.r[8]=(y>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let u=0;u<8;u++)this.pad[u]=N(t,16+2*u)}process(t,n,r=!1){let c=r?0:2048,{h:s,r:f}=this,o=f[0],y=f[1],h=f[2],u=f[3],d=f[4],L=f[5],j=f[6],C=f[7],_=f[8],T=f[9],H=N(t,n+0),R=N(t,n+2),$=N(t,n+4),D=N(t,n+6),z=N(t,n+8),P=N(t,n+10),O=N(t,n+12),k=N(t,n+14),a=s[0]+(H&8191),g=s[1]+((H>>>13|R<<3)&8191),w=s[2]+((R>>>10|$<<6)&8191),l=s[3]+(($>>>7|D<<9)&8191),p=s[4]+((D>>>4|z<<12)&8191),b=s[5]+(z>>>1&8191),m=s[6]+((z>>>14|P<<2)&8191),U=s[7]+((P>>>11|O<<5)&8191),A=s[8]+((O>>>8|k<<8)&8191),E=s[9]+(k>>>5|c),i=0,S=i+a*o+g*(5*T)+w*(5*_)+l*(5*C)+p*(5*j);i=S>>>13,S&=8191,S+=b*(5*L)+m*(5*d)+U*(5*u)+A*(5*h)+E*(5*y),i+=S>>>13,S&=8191;let I=i+a*y+g*o+w*(5*T)+l*(5*_)+p*(5*C);i=I>>>13,I&=8191,I+=b*(5*j)+m*(5*L)+U*(5*d)+A*(5*u)+E*(5*h),i+=I>>>13,I&=8191;let B=i+a*h+g*y+w*o+l*(5*T)+p*(5*_);i=B>>>13,B&=8191,B+=b*(5*C)+m*(5*j)+U*(5*L)+A*(5*d)+E*(5*u),i+=B>>>13,B&=8191;let M=i+a*u+g*h+w*y+l*o+p*(5*T);i=M>>>13,M&=8191,M+=b*(5*_)+m*(5*C)+U*(5*j)+A*(5*L)+E*(5*d),i+=M>>>13,M&=8191;let q=i+a*d+g*u+w*h+l*y+p*o;i=q>>>13,q&=8191,q+=b*(5*T)+m*(5*_)+U*(5*C)+A*(5*j)+E*(5*L),i+=q>>>13,q&=8191;let G=i+a*L+g*d+w*u+l*h+p*y;i=G>>>13,G&=8191,G+=b*o+m*(5*T)+U*(5*_)+A*(5*C)+E*(5*j),i+=G>>>13,G&=8191;let V=i+a*j+g*L+w*d+l*u+p*h;i=V>>>13,V&=8191,V+=b*y+m*o+U*(5*T)+A*(5*_)+E*(5*C),i+=V>>>13,V&=8191;let W=i+a*C+g*j+w*L+l*d+p*u;i=W>>>13,W&=8191,W+=b*h+m*y+U*o+A*(5*T)+E*(5*_),i+=W>>>13,W&=8191;let X=i+a*_+g*C+w*j+l*L+p*d;i=X>>>13,X&=8191,X+=b*u+m*h+U*y+A*o+E*(5*T),i+=X>>>13,X&=8191;let Y=i+a*T+g*_+w*C+l*j+p*L;i=Y>>>13,Y&=8191,Y+=b*d+m*u+U*h+A*y+E*o,i+=Y>>>13,Y&=8191,i=(i<<2)+i|0,i=i+S|0,S=i&8191,i=i>>>13,I+=i,s[0]=S,s[1]=I,s[2]=B,s[3]=M,s[4]=q,s[5]=G,s[6]=V,s[7]=W,s[8]=X,s[9]=Y}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),c=t[1]>>>13;t[1]&=8191;for(let o=2;o<10;o++)t[o]+=c,c=t[o]>>>13,t[o]&=8191;t[0]+=c*5,c=t[0]>>>13,t[0]&=8191,t[1]+=c,c=t[1]>>>13,t[1]&=8191,t[2]+=c,r[0]=t[0]+5,c=r[0]>>>13,r[0]&=8191;for(let o=1;o<10;o++)r[o]=t[o]+c,c=r[o]>>>13,r[o]&=8191;r[9]-=8192;let s=(c^1)-1;for(let o=0;o<10;o++)r[o]&=s;s=~s;for(let o=0;o<10;o++)t[o]=t[o]&s|r[o];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let f=t[0]+n[0];t[0]=f&65535;for(let o=1;o<8;o++)f=(t[o]+n[o]|0)+(f>>>16)|0,t[o]=f&65535}update(t){v.exists(this);let{buffer:n,blockLen:r}=this;t=J(t);let c=t.length;for(let s=0;s<c;){let f=Math.min(r-this.pos,c-s);if(f===r){for(;r<=c-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+f),this.pos),this.pos+=f,s+=f,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){v.exists(this),v.output(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:c}=this;if(c){for(n[c++]=1;c<16;c++)n[c]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let f=0;f<8;f++)t[s++]=r[f]>>>0,t[s++]=r[f]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function _t(e){let t=(r,c)=>e(c).update(J(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var lt=_t(e=>new rt(e));var Bt=Z("expand 16-byte k"),St=Z("expand 32-byte k"),It=K(Bt),Ct=K(St),xt=e=>!(e.byteOffset%4),ut=e=>{let{core:t,rounds:n,counterRight:r,counterLen:c,allow128bitKeys:s,extendNonceFn:f,blockLen:o}=ct({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},e);v.number(c),v.number(n),v.number(o),v.bool(r),v.bool(s);let y=o/4;if(o%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(h,u,d,L,j=0)=>{if(v.bytes(h),v.bytes(u),v.bytes(d),L||(L=new Uint8Array(d.length)),v.bytes(L),v.number(j),j<0||j>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(L.length<d.length)throw new Error(`Salsa/ChaCha: output (${L.length}) is shorter than data (${d.length})`);let C=[],_,T;if(h.length===32)_=h,T=Ct;else if(h.length===16&&s)_=new Uint8Array(32),_.set(h),_.set(h,16),T=It,C.push(_);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${h.length}`);if(f){if(u.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");_=f(T,_,u.subarray(0,16),new Uint8Array(32)),C.push(_),u=u.subarray(16)}let H=16-c;if(u.length!==H)throw new Error(`Salsa/ChaCha: nonce must be ${H} or 16 bytes`);if(H!==12){let a=new Uint8Array(12);a.set(u,r?0:12-u.length),C.push(u=a)}let R=new Uint8Array(o),$=K(R),D=K(_),z=K(u),P=xt(d)&&K(d),O=xt(L)&&K(L);C.push($);let k=d.length;for(let a=0,g=j;a<k;g++){if(t(T,D,z,$,g,n),g>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let w=Math.min(o,k-a);if(w===o&&O&&P){let l=a/4;if(a%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let p=0;p<y;p++)O[l+p]=P[l+p]^$[p];a+=o;continue}for(let l=0;l<w;l++)L[a+l]=d[a+l]^R[l];a+=w}for(let a=0;a<C.length;a++)C[a].fill(0);return L}};var x=(e,t)=>e<<t|e>>>32-t;function Pt(e,t,n,r,c,s=20){let f=e[0],o=e[1],y=e[2],h=e[3],u=t[0],d=t[1],L=t[2],j=t[3],C=t[4],_=t[5],T=t[6],H=t[7],R=c,$=n[0],D=n[1],z=n[2],P=f,O=o,k=y,a=h,g=u,w=d,l=L,p=j,b=C,m=_,U=T,A=H,E=R,i=$,S=D,I=z;for(let M=0;M<s;M+=2)P=P+g|0,E=x(E^P,16),b=b+E|0,g=x(g^b,12),P=P+g|0,E=x(E^P,8),b=b+E|0,g=x(g^b,7),O=O+w|0,i=x(i^O,16),m=m+i|0,w=x(w^m,12),O=O+w|0,i=x(i^O,8),m=m+i|0,w=x(w^m,7),k=k+l|0,S=x(S^k,16),U=U+S|0,l=x(l^U,12),k=k+l|0,S=x(S^k,8),U=U+S|0,l=x(l^U,7),a=a+p|0,I=x(I^a,16),A=A+I|0,p=x(p^A,12),a=a+p|0,I=x(I^a,8),A=A+I|0,p=x(p^A,7),P=P+w|0,I=x(I^P,16),U=U+I|0,w=x(w^U,12),P=P+w|0,I=x(I^P,8),U=U+I|0,w=x(w^U,7),O=O+l|0,E=x(E^O,16),A=A+E|0,l=x(l^A,12),O=O+l|0,E=x(E^O,8),A=A+E|0,l=x(l^A,7),k=k+p|0,i=x(i^k,16),b=b+i|0,p=x(p^b,12),k=k+p|0,i=x(i^k,8),b=b+i|0,p=x(p^b,7),a=a+g|0,S=x(S^a,16),m=m+S|0,g=x(g^m,12),a=a+g|0,S=x(S^a,8),m=m+S|0,g=x(g^m,7);let B=0;r[B++]=f+P|0,r[B++]=o+O|0,r[B++]=y+k|0,r[B++]=h+a|0,r[B++]=u+g|0,r[B++]=d+w|0,r[B++]=L+l|0,r[B++]=j+p|0,r[B++]=C+b|0,r[B++]=_+m|0,r[B++]=T+U|0,r[B++]=H+A|0,r[B++]=R+E|0,r[B++]=$+i|0,r[B++]=D+S|0,r[B++]=z+I|0}var Ot=ut({core:Pt,counterRight:!1,counterLen:4,allow128bitKeys:!1});var kt=new Uint8Array(16),pt=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(kt.subarray(n))},yt=(e,t,n,r,c)=>{let s=e(t,n,new Uint8Array(32)),f=lt.create(s);c&&pt(f,c),pt(f,r);let o=new Uint8Array(16),y=it(o);tt(y,0,BigInt(c?c.length:0),!0),tt(y,8,BigInt(r.length),!0),f.update(o);let h=f.digest();return s.fill(0),h},jt=e=>(t,n,r)=>(F(t,32),F(n),{tagLength:16,encrypt:(s,f)=>{let o=s.length,y=o+16;f?F(f,y):f=new Uint8Array(y),e(t,n,s,f,1);let h=yt(e,t,n,f.subarray(0,-16),r);return f.set(h,o),f},decrypt:(s,f)=>{let o=s.length,y=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");f?F(f,y):f=new Uint8Array(y);let h=s.subarray(0,-16),u=s.subarray(-16),d=yt(e,t,n,h,r);if(!at(u,d))throw new Error("invalid tag");return e(t,n,h,f,1),f}}),nt=jt(Ot);var Tt=new Uint8Array(0);var ot=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}checkInit(){if(typeof this._api>"u")throw new Error("Not initialized. Call init()")}},Q=class extends ot{constructor(){super()}init(t){this._api=t}};var Nt={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},gt=Nt;var st=class{constructor(t,n){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=t,this._key=new Uint8Array(n)}async seal(t,n,r){return await this._seal(t,n,r)}async open(t,n,r){return await this._open(t,n,r)}_seal(t,n,r){return new Promise(c=>{let s=nt(this._key,new Uint8Array(t),new Uint8Array(r)).encrypt(new Uint8Array(n));c(s.buffer)})}_open(t,n,r){return new Promise(c=>{let s=nt(this._key,new Uint8Array(t),new Uint8Array(r)).decrypt(new Uint8Array(n));c(s.buffer)})}},ft=class extends Q{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:gt.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(t){return new st(this._api,t)}};export{ft as Chacha20Poly1305};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
