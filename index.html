<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>hpke-js</title><meta name="description" content="Documentation for hpke-js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">hpke-js</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>hpke-js </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><h1 align="center">hpke-js</h1>

<div align="center">

<p><a href="https://npm.im/hpke-js"><img src="https://img.shields.io/npm/v/hpke-js.svg" alt="Stable Release"></a>
<img src="https://github.com/dajiaji/hpke-js/actions/workflows/ci.yml/badge.svg" alt="Github CI">
<a href="https://codecov.io/gh/dajiaji/hpke-js"><img src="https://codecov.io/gh/dajiaji/hpke-js/branch/main/graph/badge.svg?token=7I7JGKDDJ2" alt="codecov"></a></p>
</div>

<div align="center">
A TypeScript <a href="https://datatracker.ietf.org/doc/html/rfc9180">Hybrid Public Key Encryption (HPKE)</a>
implementation build on top of <a href="https://www.w3.org/TR/WebCryptoAPI/">Web Cryptography API</a>.
This library works on both web browsers and Node.js.
</div>

<div align="center">
<b>Currently, Deno is not supported.</b>
</div>

<p></p>

<div align="center">

<p><a href="https://dajiaji.github.io/hpke-js/">API Documentation</a></p>
</div>


<a href="#index" id="index" style="color: inherit; text-decoration: none;">
  <h2>Index</h2>
</a>
<ul>
<li><a href="#supported-features">Supported Features</a></li>
<li><a href="#warnings-and-restrictions">Warnings and Restrictions</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#base-mode">Base mode</a></li>
<li><a href="#base-mode-with-single-shot-apis">Base mode with Single-Shot APIs</a></li>
<li><a href="#base-mode-with-bidirectional-encryption">Base mode with bidirectional encryption</a></li>
<li><a href="#base-mode-with-export-only-aead">Base mode with export-only AEAD</a></li>
<li><a href="#psk-mode">PSK mode</a></li>
<li><a href="#auth-mode">Auth mode</a></li>
<li><a href="#authpsk-mode">AuthPSK mode</a></li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#references">References</a></li>
</ul>

<a href="#supported-features" id="supported-features" style="color: inherit; text-decoration: none;">
  <h2>Supported Features</h2>
</a>

<a href="#hpke-modes" id="hpke-modes" style="color: inherit; text-decoration: none;">
  <h3>HPKE Modes</h3>
</a>
<table>
<thead>
<tr>
<th>Base</th>
<th>PSK</th>
<th>Auth</th>
<th>AuthPSK</th>
</tr>
</thead>
<tbody><tr>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody></table>

<a href="#key-encapsulation-machanisms-kems" id="key-encapsulation-machanisms-kems" style="color: inherit; text-decoration: none;">
  <h3>Key Encapsulation Machanisms (KEMs)</h3>
</a>
<table>
<thead>
<tr>
<th>KEMs</th>
<th>Browser</th>
<th>Node.js</th>
<th>Deno</th>
</tr>
</thead>
<tbody><tr>
<td>DHKEM (P-256, HKDF-SHA256)</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>DHKEM (P-384, HKDF-SHA384)</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>DHKEM (P-521, HKDF-SHA512)</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>DHKEM (X25519, HKDF-SHA256)</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>DHKEM (X448, HKDF-SHA512)</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
</tbody></table>

<a href="#key-derivation-functions-kdfs" id="key-derivation-functions-kdfs" style="color: inherit; text-decoration: none;">
  <h3>Key Derivation Functions (KDFs)</h3>
</a>
<table>
<thead>
<tr>
<th>KDFs</th>
<th>Browser</th>
<th>Node.js</th>
<th>Deno</th>
</tr>
</thead>
<tbody><tr>
<td>HKDF-SHA256</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>HKDF-SHA384</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>HKDF-SHA512</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
</tbody></table>

<a href="#authenticated-encryption-with-associated-data-aead-functions" id="authenticated-encryption-with-associated-data-aead-functions" style="color: inherit; text-decoration: none;">
  <h3>Authenticated Encryption with Associated Data (AEAD) Functions</h3>
</a>
<table>
<thead>
<tr>
<th>AEADs</th>
<th>Browser</th>
<th>Node.js</th>
<th>Deno</th>
</tr>
</thead>
<tbody><tr>
<td>AES-128-GCM</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>AES-256-GCM</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>ChaCha20Poly1305</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>Export Only</td>
<td>✅</td>
<td>✅</td>
<td></td>
</tr>
</tbody></table>

<a href="#warnings-and-restrictions" id="warnings-and-restrictions" style="color: inherit; text-decoration: none;">
  <h2>Warnings and Restrictions</h2>
</a>
<ul>
<li>Although this library has been passed the following test vectors, it has not been formally audited.<ul>
<li><a href="https://github.com/cfrg/draft-irtf-cfrg-hpke/blob/5f503c564da00b0687b3de75f1dfbdfc4079ad31/test-vectors.json">RFC9180 official test vectors provided on github.com/cfrg/draft-irtf-cfrg-hpke</a></li>
<li><a href="https://github.com/google/wycheproof">ECDH/X25519/X449 test vectors provided on Project Wycheproof</a></li>
</ul>
</li>
<li>The upper limit of the AEAD sequence number is further rounded to JavaScript Number.MAX_SAFE_INTEGER (<code>2^53 - 1</code>).</li>
</ul>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<p>Using npm:</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> </span><span class="hl-0">hpke</span><span class="hl-1">-</span><span class="hl-0">js</span>
</code></pre>
<p>Using unpkg CDN:</p>
<pre><code class="language-html"><span class="hl-2">&lt;!-- use the latest stable version --&gt;</span><br/><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">src</span><span class="hl-5">=</span><span class="hl-7">&quot;https://unpkg.com/hpke-js/dist/hpke.min.js&quot;</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span><br/><br/><span class="hl-2">&lt;!-- use a specific version --&gt;</span><br/><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">src</span><span class="hl-5">=</span><span class="hl-7">&quot;https://unpkg.com/hpke-js@0.9.0/dist/hpke.min.js&quot;</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span>
</code></pre>
<p>Using jsDelivr CDN:</p>
<pre><code class="language-html"><span class="hl-2">&lt;!-- use the latest stable version --&gt;</span><br/><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">src</span><span class="hl-5">=</span><span class="hl-7">&quot;https://cdn.jsdelivr.net/npm/hpke-js/dist/hpke.min.js&quot;</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span><br/><br/><span class="hl-2">&lt;!-- use a specific version --&gt;</span><br/><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">src</span><span class="hl-5">=</span><span class="hl-7">&quot;https://cdn.jsdelivr.net/npm/hpke-js@0.9.0/dist/hpke.min.js&quot;</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span>
</code></pre>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<p>This section shows some typical usage examples.</p>

<a href="#base-mode" id="base-mode" style="color: inherit; text-decoration: none;">
  <h3>Base mode</h3>
</a>
<p>On browser:</p>
<pre><code class="language-html"><span class="hl-3">&lt;</span><span class="hl-4">html</span><span class="hl-3">&gt;</span><br/><span class="hl-1">  </span><span class="hl-3">&lt;</span><span class="hl-4">head</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">head</span><span class="hl-3">&gt;</span><br/><span class="hl-1">  </span><span class="hl-3">&lt;</span><span class="hl-4">body</span><span class="hl-3">&gt;</span><br/><span class="hl-1">    </span><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">src</span><span class="hl-5">=</span><span class="hl-7">&quot;https://unpkg.com/hpke-js/dist/hpke.min.js&quot;</span><span class="hl-3">&gt;&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span><br/><span class="hl-1">    </span><span class="hl-3">&lt;</span><span class="hl-4">script</span><span class="hl-5"> </span><span class="hl-6">type</span><span class="hl-5">=</span><span class="hl-7">&quot;text/javascript&quot;</span><span class="hl-3">&gt;</span><br/><br/><span class="hl-5">      </span><span class="hl-8">async</span><span class="hl-5"> </span><span class="hl-8">function</span><span class="hl-5"> </span><span class="hl-9">doHpke</span><span class="hl-5">() {</span><br/><br/><span class="hl-5">        </span><span class="hl-2">// the global name is &#39;hkpe&#39;</span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">suite</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-8">new</span><span class="hl-5"> </span><span class="hl-0">hpke</span><span class="hl-5">.</span><span class="hl-9">CipherSuite</span><span class="hl-5">({</span><br/><span class="hl-5">          </span><span class="hl-0">kem:</span><span class="hl-5"> </span><span class="hl-0">hpke</span><span class="hl-5">.</span><span class="hl-0">Kem</span><span class="hl-5">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-0">kdf:</span><span class="hl-5"> </span><span class="hl-0">hpke</span><span class="hl-5">.</span><span class="hl-0">Kdf</span><span class="hl-5">.</span><span class="hl-0">HkdfSha256</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-0">aead:</span><span class="hl-5"> </span><span class="hl-0">hpke</span><span class="hl-5">.</span><span class="hl-0">Aead</span><span class="hl-5">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-5">        });</span><br/><span class="hl-5"> </span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">rkp</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-11">await</span><span class="hl-5"> </span><span class="hl-0">suite</span><span class="hl-5">.</span><span class="hl-9">generateKeyPair</span><span class="hl-5">();</span><br/><span class="hl-5">      </span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">sender</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-11">await</span><span class="hl-5"> </span><span class="hl-0">suite</span><span class="hl-5">.</span><span class="hl-9">createSenderContext</span><span class="hl-5">({</span><br/><span class="hl-5">          </span><span class="hl-0">recipientPublicKey:</span><span class="hl-5"> </span><span class="hl-0">rkp</span><span class="hl-5">.</span><span class="hl-0">publicKey</span><br/><span class="hl-5">        });</span><br/><span class="hl-5">      </span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">recipient</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-11">await</span><span class="hl-5"> </span><span class="hl-0">suite</span><span class="hl-5">.</span><span class="hl-9">createRecipientContext</span><span class="hl-5">({</span><br/><span class="hl-5">          </span><span class="hl-0">recipientKey:</span><span class="hl-5"> </span><span class="hl-0">rkp</span><span class="hl-5">,</span><br/><span class="hl-5">          </span><span class="hl-0">enc:</span><span class="hl-5"> </span><span class="hl-0">sender</span><span class="hl-5">.</span><span class="hl-0">enc</span><span class="hl-5">,</span><br/><span class="hl-5">        });</span><br/><span class="hl-5">      </span><br/><span class="hl-5">        </span><span class="hl-2">// encrypt</span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">ct</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-11">await</span><span class="hl-5"> </span><span class="hl-0">sender</span><span class="hl-5">.</span><span class="hl-9">seal</span><span class="hl-5">(</span><span class="hl-8">new</span><span class="hl-5"> </span><span class="hl-9">TextEncoder</span><span class="hl-5">().</span><span class="hl-9">encode</span><span class="hl-5">(</span><span class="hl-12">&#39;hello world!&#39;</span><span class="hl-5">));</span><br/><span class="hl-5">      </span><br/><span class="hl-5">        </span><span class="hl-2">// decrypt</span><br/><span class="hl-5">        </span><span class="hl-8">const</span><span class="hl-5"> </span><span class="hl-10">pt</span><span class="hl-5"> </span><span class="hl-1">=</span><span class="hl-5"> </span><span class="hl-11">await</span><span class="hl-5"> </span><span class="hl-0">recipient</span><span class="hl-5">.</span><span class="hl-9">open</span><span class="hl-5">(</span><span class="hl-0">ct</span><span class="hl-5">);</span><br/><br/><span class="hl-5">        </span><span class="hl-2">// hello world!</span><br/><span class="hl-5">        </span><span class="hl-9">alert</span><span class="hl-5">(</span><span class="hl-8">new</span><span class="hl-5"> </span><span class="hl-9">TextDecoder</span><span class="hl-5">().</span><span class="hl-9">decode</span><span class="hl-5">(</span><span class="hl-0">pt</span><span class="hl-5">));</span><br/><span class="hl-5">      }</span><br/><span class="hl-5">      </span><br/><span class="hl-5">    </span><span class="hl-3">&lt;/</span><span class="hl-4">script</span><span class="hl-3">&gt;</span><br/><span class="hl-1">    </span><span class="hl-3">&lt;</span><span class="hl-4">button</span><span class="hl-1"> </span><span class="hl-6">type</span><span class="hl-1">=</span><span class="hl-7">&quot;button&quot;</span><span class="hl-1"> </span><span class="hl-6">onclick</span><span class="hl-1">=</span><span class="hl-7">&quot;</span><span class="hl-9">doHpke</span><span class="hl-7">()&quot;</span><span class="hl-3">&gt;</span><span class="hl-1">do HPKE</span><span class="hl-3">&lt;/</span><span class="hl-4">button</span><span class="hl-3">&gt;</span><br/><span class="hl-1">  </span><span class="hl-3">&lt;/</span><span class="hl-4">body</span><span class="hl-3">&gt;</span><br/><span class="hl-3">&lt;/</span><span class="hl-4">html</span><span class="hl-3">&gt;</span>
</code></pre>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">ct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">().</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#base-mode-with-single-shot-apis" id="base-mode-with-single-shot-apis" style="color: inherit; text-decoration: none;">
  <h3>Base mode with Single-Shot APIs</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message&#39;</span><span class="hl-1">),</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-10">const</span><span class="hl-1"> { ct, </span><span class="hl-10">enc</span><span class="hl-1"> } = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">({ </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1"> }, </span><span class="hl-0">pt</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">({ </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">, </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">enc</span><span class="hl-1"> }, </span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">().</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#base-mode-with-bidirectional-encryption" id="base-mode-with-bidirectional-encryption" style="color: inherit; text-decoration: none;">
  <h3>Base mode with bidirectional encryption</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">te</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">();</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">td</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">();</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// setup bidirectional encryption</span><br/><span class="hl-1">  </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">setupBidirectional</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;seed-for-key&#39;</span><span class="hl-1">), </span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;seed-for-nonce&#39;</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">setupBidirectional</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;seed-for-key&#39;</span><span class="hl-1">), </span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;seed-for-nonce&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">ct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message-s&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;recipient decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-0">td</span><span class="hl-1">.</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message-s</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt reversely</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message-r&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt reversely</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rpt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">rct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;sender decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-0">td</span><span class="hl-1">.</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">rpt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message-r</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#base-mode-with-export-only-aead" id="base-mode-with-export-only-aead" style="color: inherit; text-decoration: none;">
  <h3>Base mode with export-only AEAD</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">ExportOnly</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">te</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// export</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pskS</span><span class="hl-1"> = </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">export</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemu&#39;</span><span class="hl-1">), </span><span class="hl-13">32</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pskR</span><span class="hl-1"> = </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">export</span><span class="hl-1">(</span><span class="hl-0">te</span><span class="hl-1">.</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemu&#39;</span><span class="hl-1">), </span><span class="hl-13">32</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">// pskR === pskS</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#psk-mode" id="psk-mode" style="color: inherit; text-decoration: none;">
  <h3>PSK mode</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">psk:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;our-pre-shared-key-id&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-2">// a PSK MUST have at least 32 bytes.</span><br/><span class="hl-1">      </span><span class="hl-0">key:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemugokounosurikirekaija&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">psk:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;our-pre-shared-key-id&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-2">// a PSK MUST have at least 32 bytes.</span><br/><span class="hl-1">      </span><span class="hl-0">key:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemugokounosurikirekaija&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">ct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">().</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#auth-mode" id="auth-mode" style="color: inherit; text-decoration: none;">
  <h3>Auth mode</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">skp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">senderKey:</span><span class="hl-1"> </span><span class="hl-0">skp</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">senderPublicKey:</span><span class="hl-1"> </span><span class="hl-0">skp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">ct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">().</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#authpsk-mode" id="authpsk-mode" style="color: inherit; text-decoration: none;">
  <h3>AuthPSK mode</h3>
</a>
<p>On Node.js:</p>
<pre><code class="language-js"><span class="hl-8">const</span><span class="hl-1"> { </span><span class="hl-10">Kem</span><span class="hl-1">, </span><span class="hl-10">Kdf</span><span class="hl-1">, </span><span class="hl-10">Aead</span><span class="hl-1">, </span><span class="hl-10">CipherSuite</span><span class="hl-1"> } = </span><span class="hl-9">require</span><span class="hl-1">(</span><span class="hl-12">&#39;hpke-js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-8">async</span><span class="hl-1"> </span><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-9">doHpke</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-2">// setup</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">suite</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">CipherSuite</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">kem:</span><span class="hl-1"> </span><span class="hl-0">Kem</span><span class="hl-1">.</span><span class="hl-0">DhkemP256HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">kdf:</span><span class="hl-1"> </span><span class="hl-0">Kdf</span><span class="hl-1">.</span><span class="hl-0">HkdfSha256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">aead:</span><span class="hl-1"> </span><span class="hl-0">Aead</span><span class="hl-1">.</span><span class="hl-0">Aes128Gcm</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">rkp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">skp</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">sender</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createSenderContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientPublicKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">senderKey:</span><span class="hl-1"> </span><span class="hl-0">skp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">psk:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;our-pre-shared-key-id&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-2">// a PSK MUST have at least 32 bytes.</span><br/><span class="hl-1">      </span><span class="hl-0">key:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemugokounosurikirekaija&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">recipient</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">suite</span><span class="hl-1">.</span><span class="hl-9">createRecipientContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">recipientKey:</span><span class="hl-1"> </span><span class="hl-0">rkp</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">enc:</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-0">enc</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">senderPublicKey:</span><span class="hl-1"> </span><span class="hl-0">skp</span><span class="hl-1">.</span><span class="hl-0">publicKey</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">psk:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;our-pre-shared-key-id&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-2">// a PSK MUST have at least 32 bytes.</span><br/><span class="hl-1">      </span><span class="hl-0">key:</span><span class="hl-1"> </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;jugemujugemugokounosurikirekaija&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// encrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">ct</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">sender</span><span class="hl-1">.</span><span class="hl-9">seal</span><span class="hl-1">(</span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextEncoder</span><span class="hl-1">().</span><span class="hl-9">encode</span><span class="hl-1">(</span><span class="hl-12">&#39;my-secret-message&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">// decrypt</span><br/><span class="hl-1">  </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-10">pt</span><span class="hl-1"> = </span><span class="hl-11">await</span><span class="hl-1"> </span><span class="hl-0">recipient</span><span class="hl-1">.</span><span class="hl-9">open</span><span class="hl-1">(</span><span class="hl-0">ct</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-12">&#39;decrypted: &#39;</span><span class="hl-1">, </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-9">TextDecoder</span><span class="hl-1">().</span><span class="hl-9">decode</span><span class="hl-1">(</span><span class="hl-0">pt</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">// decrypted: my-secret-message</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">doHpke</span><span class="hl-1">();</span>
</code></pre>

<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
  <h2>Contributing</h2>
</a>
<p>We welcome all kind of contributions, filing issues, suggesting new features or sending PRs.</p>

<a href="#references" id="references" style="color: inherit; text-decoration: none;">
  <h2>References</h2>
</a>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc9180">RFC9180: Hybrid Public Key Encryption</a></li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/Aead.html" class="tsd-kind-icon">Aead</a></li><li class="tsd-kind-enum"><a href="enums/Kdf.html" class="tsd-kind-icon">Kdf</a></li><li class="tsd-kind-enum"><a href="enums/Kem.html" class="tsd-kind-icon">Kem</a></li><li class="tsd-kind-class"><a href="classes/CipherSuite.html" class="tsd-kind-icon">Cipher<wbr/>Suite</a></li><li class="tsd-kind-class"><a href="classes/DecapError.html" class="tsd-kind-icon">Decap<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/DeriveKeyPairError.html" class="tsd-kind-icon">Derive<wbr/>Key<wbr/>Pair<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/DeserializeError.html" class="tsd-kind-icon">Deserialize<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/EncapError.html" class="tsd-kind-icon">Encap<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ExportError.html" class="tsd-kind-icon">Export<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/InvalidParamError.html" class="tsd-kind-icon">Invalid<wbr/>Param<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/MessageLimitReachedError.html" class="tsd-kind-icon">Message<wbr/>Limit<wbr/>Reached<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/NotSupportedError.html" class="tsd-kind-icon">Not<wbr/>Supported<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/OpenError.html" class="tsd-kind-icon">Open<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/SealError.html" class="tsd-kind-icon">Seal<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/SerializeError.html" class="tsd-kind-icon">Serialize<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ValidationError.html" class="tsd-kind-icon">Validation<wbr/>Error</a></li><li class="tsd-kind-interface"><a href="interfaces/CipherSuiteParams.html" class="tsd-kind-icon">Cipher<wbr/>Suite<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/CipherSuiteSealResponse.html" class="tsd-kind-icon">Cipher<wbr/>Suite<wbr/>Seal<wbr/>Response</a></li><li class="tsd-kind-interface"><a href="interfaces/EncryptionContextInterface.html" class="tsd-kind-icon">Encryption<wbr/>Context<wbr/>Interface</a></li><li class="tsd-kind-interface"><a href="interfaces/PreSharedKey.html" class="tsd-kind-icon">Pre<wbr/>Shared<wbr/>Key</a></li><li class="tsd-kind-interface"><a href="interfaces/RecipientContextParams.html" class="tsd-kind-icon">Recipient<wbr/>Context<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/SenderContextInterface.html" class="tsd-kind-icon">Sender<wbr/>Context<wbr/>Interface</a></li><li class="tsd-kind-interface"><a href="interfaces/SenderContextParams.html" class="tsd-kind-icon">Sender<wbr/>Context<wbr/>Params</a></li><li class="tsd-kind-type-alias"><a href="modules.html#RecipientContextInterface" class="tsd-kind-icon">Recipient<wbr/>Context<wbr/>Interface</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>