var ue={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48},gt=ue,fe={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},bt=fe;function Nt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function le(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function $(e,...t){if(!le(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Mt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Nt(e.outputLen),Nt(e.blockLen)}function O(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function qt(e,t){$(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Z=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Q=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),x=(e,t)=>e<<32-t|e>>>t;var Me=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Dt(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function V(e){return typeof e=="string"&&(e=Dt(e)),$(e),e}var C=class{clone(){return this._cloneInto()}},qe={}.toString;function Rt(e){let t=r=>e().update(V(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function zt(e=32){if(Z&&typeof Z.getRandomValues=="function")return Z.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}var Y=class extends C{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Mt(t);let r=V(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,o=new Uint8Array(i);o.set(r.length>i?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(t){return O(this),this.iHash.update(t),this}digestInto(t){O(this),$(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:i,destroyed:o,blockLen:s,outputLen:c}=this;return t=t,t.finished=i,t.destroyed=o,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},wt=(e,t,n)=>new Y(e,t).update(n).digest();wt.create=(e,t)=>new Y(e,t);function he(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),c=Number(n&o),a=r?4:0,f=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+f,c,r)}var jt=(e,t,n)=>e&t^~e&n,$t=(e,t,n)=>e&t^e&n^t&n,J=class extends C{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Q(this.buffer)}update(t){O(this);let{view:n,buffer:r,blockLen:i}=this;t=V(t);let o=t.length;for(let s=0;s<o;){let c=Math.min(i-this.pos,o-s);if(c===i){let a=Q(t);for(;i<=o-s;s+=i)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){O(this),qt(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:i,isLE:o}=this,{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let u=s;u<i;u++)n[u]=0;he(r,i-8,BigInt(this.length*8),o),this.process(r,0);let c=Q(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,h=this.get();if(f>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,h[u],o)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:i,finished:o,destroyed:s,pos:c}=this;return t.length=i,t.pos=c,t.finished=o,t.destroyed=s,i%n&&t.buffer.set(r),t}};var de=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),S=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),P=new Uint32Array(64),xt=class extends J{constructor(){super(64,32,8,!1),this.A=S[0]|0,this.B=S[1]|0,this.C=S[2]|0,this.D=S[3]|0,this.E=S[4]|0,this.F=S[5]|0,this.G=S[6]|0,this.H=S[7]|0}get(){let{A:t,B:n,C:r,D:i,E:o,F:s,G:c,H:a}=this;return[t,n,r,i,o,s,c,a]}set(t,n,r,i,o,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let u=0;u<16;u++,n+=4)P[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){let d=P[u-15],y=P[u-2],k=x(d,7)^x(d,18)^d>>>3,I=x(y,17)^x(y,19)^y>>>10;P[u]=I+P[u-7]+k+P[u-16]|0}let{A:r,B:i,C:o,D:s,E:c,F:a,G:f,H:h}=this;for(let u=0;u<64;u++){let d=x(c,6)^x(c,11)^x(c,25),y=h+d+jt(c,a,f)+de[u]+P[u]|0,I=(x(r,2)^x(r,13)^x(r,22))+$t(r,i,o)|0;h=f,f=a,a=c,c=s+y|0,s=o,o=i,i=r,r=y+I|0}r=r+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,h=h+this.H|0,this.set(r,i,o,s,c,a,f,h)}roundClean(){P.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Vt=Rt(()=>new xt);var pe={},Gt=ye(globalThis,pe);function ye(e,t){return new Proxy(e,{get(n,r,i){return r in t?t[r]:e[r]},set(n,r,i){return r in t&&delete t[r],e[r]=i,!0},deleteProperty(n,r){let i=!1;return r in t&&(delete t[r],i=!0),r in e&&(delete e[r],i=!0),i},ownKeys(n){let r=Reflect.ownKeys(e),i=Reflect.ownKeys(t),o=new Set(i);return[...r.filter(s=>!o.has(s)),...i]},defineProperty(n,r,i){return r in t&&delete t[r],Reflect.defineProperty(e,r,i),!0},getOwnPropertyDescriptor(n,r){return r in t?Reflect.getOwnPropertyDescriptor(t,r):Reflect.getOwnPropertyDescriptor(e,r)},has(n,r){return r in t||r in e}})}var mt=class extends Error{constructor(t){let n;t instanceof Error?n=t.message:typeof t=="string"?n=t:n="",super(n),this.name=this.constructor.name}},m=class extends mt{},N=class extends m{};var M=class extends m{},U=class extends m{},tt=class extends m{},et=class extends m{};var nt=class extends m{},q=class extends m{};async function be(){if(Gt!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:e}=await import("crypto");return e.subtle}catch(e){throw new q(e)}}var rt=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await be())}};var _=new Uint8Array(0);var Xt=new Uint8Array([72,80,75,69,45,118,49]),_t=class extends rt{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:bt.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(t){this._suiteId=t}buildLabeledIkm(t,n){this._checkInit();let r=new Uint8Array(7+this._suiteId.byteLength+t.byteLength+n.byteLength);return r.set(Xt,0),r.set(this._suiteId,7),r.set(t,7+this._suiteId.byteLength),r.set(n,7+this._suiteId.byteLength+t.byteLength),r}buildLabeledInfo(t,n,r){this._checkInit();let i=new Uint8Array(9+this._suiteId.byteLength+t.byteLength+n.byteLength);return i.set(new Uint8Array([0,r]),0),i.set(Xt,2),i.set(this._suiteId,9),i.set(t,9+this._suiteId.byteLength),i.set(n,9+this._suiteId.byteLength+t.byteLength),i}async extract(t,n){if(await this._setup(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)throw new N("The salt length must be the same as the hashSize");let r=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",r,n)}async expand(t,n,r){await this._setup();let i=await this._api.importKey("raw",t,this.algHash,!1,["sign"]),o=new ArrayBuffer(r),s=new Uint8Array(o),c=_,a=new Uint8Array(n),f=new Uint8Array(1);if(r>255*this.hashSize)throw new Error("Entropy limit reached");let h=new Uint8Array(this.hashSize+a.length+1);for(let u=1,d=0;d<s.length;u++)f[0]=u,h.set(c,0),h.set(a,c.length),h.set(f,c.length+a.length),c=new Uint8Array(await this._api.sign("HMAC",i,h.slice(0,c.length+a.length+1))),s.length-d>=c.length?(s.set(c,d),d+=c.length):(s.set(c.slice(0,s.length-d),d),d+=s.length-d);return o}async extractAndExpand(t,n,r,i){await this._setup();let o=await this._api.importKey("raw",n,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:t,info:r},o,i*8)}async labeledExtract(t,n,r){return await this.extract(t,this.buildLabeledIkm(n,r))}async labeledExpand(t,n,r,i){return await this.expand(t,this.buildLabeledInfo(n,r,i),i)}_checkInit(){if(this._suiteId===_)throw new Error("Not initialized. Call init()")}},it=class extends _t{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:bt.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}};var ot=class extends it{async extract(t,n){if(await this._setup(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)return wt(Vt,new Uint8Array(t),new Uint8Array(n));let r=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",r,n)}};var Ft=new Uint8Array([75,69,77,0,0]);var D=e=>typeof e=="object"&&e!==null&&typeof e.privateKey=="object"&&typeof e.publicKey=="object";function Wt(e,t){if(t<=0)throw new Error("i2Osp: too small size");if(e>=256**t)throw new Error("i2Osp: too large integer");let n=new Uint8Array(t);for(let r=0;r<t&&e;r++)n[t-(r+1)]=e%256,e=e>>8;return n}function G(e,t){let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n}function Et(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}var xe=new Uint8Array([101,97,101,95,112,114,107]),me=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);function _e(e,t,n){let r=new Uint8Array(e.length+t.length+n.length);return r.set(e,0),r.set(t,e.length),r.set(n,e.length+t.length),r}var st=class{constructor(t,n,r){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=t,this._prim=n,this._kdf=r;let i=new Uint8Array(Ft);i.set(Wt(this.id,2),3),this._kdf.init(i)}async serializePublicKey(t){return await this._prim.serializePublicKey(t)}async deserializePublicKey(t){return await this._prim.deserializePublicKey(t)}async serializePrivateKey(t){return await this._prim.serializePrivateKey(t)}async deserializePrivateKey(t){return await this._prim.deserializePrivateKey(t)}async importKey(t,n,r=!0){return await this._prim.importKey(t,n,r)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(t){if(t.byteLength>8192)throw new N("Too long ikm");return await this._prim.deriveKeyPair(t)}async encap(t){let n;t.ekm===void 0?n=await this.generateKeyPair():D(t.ekm)?n=t.ekm:n=await this.deriveKeyPair(t.ekm);let r=await this._prim.serializePublicKey(n.publicKey),i=await this._prim.serializePublicKey(t.recipientPublicKey);try{let o;if(t.senderKey===void 0)o=new Uint8Array(await this._prim.dh(n.privateKey,t.recipientPublicKey));else{let a=D(t.senderKey)?t.senderKey.privateKey:t.senderKey,f=new Uint8Array(await this._prim.dh(n.privateKey,t.recipientPublicKey)),h=new Uint8Array(await this._prim.dh(a,t.recipientPublicKey));o=G(f,h)}let s;if(t.senderKey===void 0)s=G(new Uint8Array(r),new Uint8Array(i));else{let a=D(t.senderKey)?t.senderKey.publicKey:await this._prim.derivePublicKey(t.senderKey),f=await this._prim.serializePublicKey(a);s=_e(new Uint8Array(r),new Uint8Array(i),new Uint8Array(f))}let c=await this._generateSharedSecret(o,s);return{enc:r,sharedSecret:c}}catch(o){throw new tt(o)}}async decap(t){let n=await this._prim.deserializePublicKey(t.enc),r=D(t.recipientKey)?t.recipientKey.privateKey:t.recipientKey,i=D(t.recipientKey)?t.recipientKey.publicKey:await this._prim.derivePublicKey(t.recipientKey),o=await this._prim.serializePublicKey(i);try{let s;if(t.senderPublicKey===void 0)s=new Uint8Array(await this._prim.dh(r,n));else{let a=new Uint8Array(await this._prim.dh(r,n)),f=new Uint8Array(await this._prim.dh(r,t.senderPublicKey));s=G(a,f)}let c;if(t.senderPublicKey===void 0)c=G(new Uint8Array(t.enc),new Uint8Array(o));else{let a=await this._prim.serializePublicKey(t.senderPublicKey);c=new Uint8Array(t.enc.byteLength+o.byteLength+a.byteLength),c.set(new Uint8Array(t.enc),0),c.set(new Uint8Array(o),t.enc.byteLength),c.set(new Uint8Array(a),t.enc.byteLength+o.byteLength)}return await this._generateSharedSecret(s,c)}catch(s){throw new et(s)}}async _generateSharedSecret(t,n){let r=this._kdf.buildLabeledIkm(xe,t),i=this._kdf.buildLabeledInfo(me,n,this.secretSize);return await this._kdf.extractAndExpand(_,r,i,this.secretSize)}};function vt(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Qt(e){if(!vt(e))throw new Error("Uint8Array expected")}var Ee=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ve(e){Qt(e);let t="";for(let n=0;n<e.length;n++)t+=Ee[e[n]];return t}function Be(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}var E={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Zt(e){if(e>=E._0&&e<=E._9)return e-E._0;if(e>=E._A&&e<=E._F)return e-(E._A-10);if(e>=E._a&&e<=E._f)return e-(E._a-10)}function Yt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let i=0,o=0;i<n;i++,o+=2){let s=Zt(e.charCodeAt(o)),c=Zt(e.charCodeAt(o+1));if(s===void 0||c===void 0){let a=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+o)}r[i]=s*16+c}return r}function Bt(e){return Qt(e),Be(ve(Uint8Array.from(e).reverse()))}function Ae(e,t){return Yt(e.toString(16).padStart(t*2,"0"))}function Jt(e,t){return Ae(e,t).reverse()}function At(e,t,n){let r;if(typeof t=="string")try{r=Yt(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(vt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}var Se={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||vt(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function te(e,t,n={}){let r=(i,o,s)=>{let c=Se[o];if(typeof c!="function")throw new Error(`Invalid validator "${o}", expected function`);let a=e[i];if(!(s&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(i)}=${a} (${typeof a}), expected ${o}`)};for(let[i,o]of Object.entries(t))r(i,o,!1);for(let[i,o]of Object.entries(n))r(i,o,!0);return e}var R=BigInt(0),ct=BigInt(1),wn=BigInt(2),xn=BigInt(3),mn=BigInt(4),_n=BigInt(5),En=BigInt(8),vn=BigInt(9),Bn=BigInt(16);function at(e,t){let n=e%t;return n>=R?n:t+n}function ee(e,t,n){if(n<=R||t<R)throw new Error("Expected power/modulo > 0");if(n===ct)return R;let r=ct;for(;t>R;)t&ct&&(r=r*e%n),e=e*e%n,t>>=ct;return r}function w(e,t,n){let r=e;for(;t-- >R;)r*=r,r%=n;return r}var X=BigInt(0),St=BigInt(1);function Pe(e){return te(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function ne(e){let t=Pe(e),{P:n}=t,r=l=>at(l,n),i=t.montgomeryBits,o=Math.ceil(i/8),s=t.nByteLength,c=t.adjustScalarBytes||(l=>l),a=t.powPminus2||(l=>ee(l,n-BigInt(2),n));function f(l,p,g){let H=r(l*(p-g));return p=r(p-H),g=r(g+H),[p,g]}function h(l){if(typeof l=="bigint"&&X<=l&&l<n)return l;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}let u=(t.a-BigInt(2))/BigInt(4);function d(l,p){let g=h(l),H=h(p),W=g,B=St,A=X,L=g,K=St,T=X,b;for(let ht=BigInt(i-1);ht>=X;ht--){let Kt=H>>ht&St;T^=Kt,b=f(T,B,L),B=b[0],L=b[1],b=f(T,A,K),A=b[0],K=b[1],T=Kt;let dt=B+A,pt=r(dt*dt),yt=B-A,Ut=r(yt*yt),kt=pt-Ut,ce=L+K,ae=L-K,Ht=r(ae*dt),Tt=r(ce*yt),Ot=Ht+Tt,Ct=Ht-Tt;L=r(Ot*Ot),K=r(W*r(Ct*Ct)),B=r(pt*Ut),A=r(kt*(pt+r(u*kt)))}b=f(T,B,L),B=b[0],L=b[1],b=f(T,A,K),A=b[0],K=b[1];let se=a(A);return r(B*se)}function y(l){return Jt(r(l),o)}function k(l){let p=At("u coordinate",l,o);return s===32&&(p[31]&=127),Bt(p)}function I(l){let p=At("scalar",l),g=p.length;if(g!==o&&g!==s)throw new Error(`Expected ${o} or ${s} bytes, got ${g}`);return Bt(c(p))}function j(l,p){let g=k(p),H=I(l),W=d(g,H);if(W===X)throw new Error("Invalid private or public key received");return y(W)}let lt=y(t.Gu);function Lt(l){return j(l,lt)}return{scalarMult:j,scalarMultBase:Lt,getSharedSecret:(l,p)=>j(l,p),getPublicKey:l=>Lt(l),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:lt}}var Pt=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");var Cn=BigInt(0),Ie=BigInt(1),re=BigInt(2),Le=BigInt(3),Ke=BigInt(5),Nn=BigInt(8);function Ue(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),o=Pt,c=e*e%o*e%o,a=w(c,re,o)*c%o,f=w(a,Ie,o)*e%o,h=w(f,Ke,o)*f%o,u=w(h,t,o)*h%o,d=w(u,n,o)*u%o,y=w(d,r,o)*d%o,k=w(y,i,o)*y%o,I=w(k,i,o)*y%o,j=w(I,t,o)*h%o;return{pow_p_5_8:w(j,re,o)*e%o,b2:c}}function ke(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var ut=ne({P:Pt,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{let t=Pt,{pow_p_5_8:n,b2:r}=Ue(e);return at(w(n,Le,t)*r,t)},adjustScalarBytes:ke,randomBytes:zt});var F=["deriveBits"],ie=new Uint8Array([100,107,112,95,112,114,107]),oe=new Uint8Array([115,107]);var v=class{constructor(t,n,r,i=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=n,this.type=r,this.algorithm={name:t},this.usages=i,r==="public"&&(this.usages=[])}};var z="X25519",ft=class{constructor(t){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,this._nPk=32,this._nSk=32}async serializePublicKey(t){try{return await this._serializePublicKey(t)}catch(n){throw new M(n)}}async deserializePublicKey(t){try{return await this._importRawKey(t,!0)}catch(n){throw new U(n)}}async serializePrivateKey(t){try{return await this._serializePrivateKey(t)}catch(n){throw new M(n)}}async deserializePrivateKey(t){try{return await this._importRawKey(t,!1)}catch(n){throw new U(n)}}async importKey(t,n,r){try{if(t==="raw")return await this._importRawKey(n,r);if(n instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(n,r)}catch(i){throw new U(i)}}async generateKeyPair(){try{let t=ut.utils.randomPrivateKey(),n=new v(z,t,"private",F);return{publicKey:await this.derivePublicKey(n),privateKey:n}}catch(t){throw new q(t)}}async deriveKeyPair(t){try{let n=await this._hkdf.labeledExtract(_,ie,new Uint8Array(t)),r=await this._hkdf.labeledExpand(n,oe,_,this._nSk),i=new v(z,new Uint8Array(r),"private",F);return{privateKey:i,publicKey:await this.derivePublicKey(i)}}catch(n){throw new nt(n)}}async derivePublicKey(t){try{return await this._derivePublicKey(t)}catch(n){throw new U(n)}}async dh(t,n){try{return await this._dh(t,n)}catch(r){throw new M(r)}}_serializePublicKey(t){return new Promise(n=>{n(t.key.buffer)})}_serializePrivateKey(t){return new Promise(n=>{n(t.key.buffer)})}_importRawKey(t,n){return new Promise((r,i)=>{n&&t.byteLength!==this._nPk&&i(new Error("Invalid length of the key")),!n&&t.byteLength!==this._nSk&&i(new Error("Invalid length of the key")),r(new v(z,new Uint8Array(t),n?"public":"private",n?[]:F))})}_importJWK(t,n){return new Promise((r,i)=>{(typeof t.kty>"u"||t.kty!=="OKP")&&i(new Error(`Invalid kty: ${t.kty}`)),(typeof t.crv>"u"||t.crv!=="X25519")&&i(new Error(`Invalid crv: ${t.crv}`)),n?(typeof t.d<"u"&&i(new Error("Invalid key: `d` should not be set")),typeof t.x>"u"&&i(new Error("Invalid key: `x` not found")),r(new v(z,Et(t.x),"public"))):(typeof t.d!="string"&&i(new Error("Invalid key: `d` not found")),r(new v(z,Et(t.d),"private",F)))})}_derivePublicKey(t){return new Promise((n,r)=>{try{let i=ut.getPublicKey(t.key);n(new v(z,i,"public"))}catch(i){r(i)}})}_dh(t,n){return new Promise((r,i)=>{try{r(ut.getSharedSecret(t.key,n.key).buffer)}catch(o){i(o)}})}};var It=class extends st{constructor(){let t=new ot;super(gt.DhkemX25519HkdfSha256,new ft(t),t),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:gt.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};export{It as DhkemX25519HkdfSha256};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
