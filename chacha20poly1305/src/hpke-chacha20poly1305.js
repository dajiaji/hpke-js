var wt=e=>e instanceof Uint8Array;var R=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),it=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),dt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dt)throw new Error("Non little-endian hardware is not supported");function J(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Q(e){if(typeof e=="string"&&(e=J(e)),!wt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var bt=e=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function ct(e,t){if(t!==void 0&&(typeof t!="object"||!bt(t)))throw new Error("options must be object or undefined");return Object.assign(e,t)}function M(e,t){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof t=="number"&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}function ht(e,t){if(e.length!==t.length)throw new Error("equalBytes: Different size of Uint8Arrays");let n=!0;for(let r=0;r<e.length;r++)n&&(n=e[r]===t[r]);return n}function tt(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let c=BigInt(32),s=BigInt(4294967295),f=Number(n>>c&s),o=Number(n&s),y=r?4:0,a=r?0:4;e.setUint32(t+y,f,r),e.setUint32(t+a,o,r)}function et(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function mt(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function at(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ut(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");et(e.outputLen),et(e.blockLen)}function At(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Et(e,t){at(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Lt={number:et,bool:mt,bytes:at,hash:Ut,exists:At,output:Et},H=Lt;var v=(e,t)=>e[t++]&255|(e[t++]&255)<<8,rt=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Q(t),M(t,32);let n=v(t,0),r=v(t,2),c=v(t,4),s=v(t,6),f=v(t,8),o=v(t,10),y=v(t,12),a=v(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|c<<6)&7939,this.r[3]=(c>>>7|s<<9)&8191,this.r[4]=(s>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|o<<2)&8191,this.r[7]=(o>>>11|y<<5)&8065,this.r[8]=(y>>>8|a<<8)&8191,this.r[9]=a>>>5&127;for(let u=0;u<8;u++)this.pad[u]=v(t,16+2*u)}process(t,n,r=!1){let c=r?0:2048,{h:s,r:f}=this,o=f[0],y=f[1],a=f[2],u=f[3],d=f[4],L=f[5],I=f[6],k=f[7],B=f[8],$=f[9],N=v(t,n+0),z=v(t,n+2),T=v(t,n+4),F=v(t,n+6),D=v(t,n+8),O=v(t,n+10),j=v(t,n+12),P=v(t,n+14),h=s[0]+(N&8191),g=s[1]+((N>>>13|z<<3)&8191),w=s[2]+((z>>>10|T<<6)&8191),l=s[3]+((T>>>7|F<<9)&8191),p=s[4]+((F>>>4|D<<12)&8191),b=s[5]+(D>>>1&8191),m=s[6]+((D>>>14|O<<2)&8191),U=s[7]+((O>>>11|j<<5)&8191),A=s[8]+((j>>>8|P<<8)&8191),E=s[9]+(P>>>5|c),i=0,_=i+h*o+g*(5*$)+w*(5*B)+l*(5*k)+p*(5*I);i=_>>>13,_&=8191,_+=b*(5*L)+m*(5*d)+U*(5*u)+A*(5*a)+E*(5*y),i+=_>>>13,_&=8191;let C=i+h*y+g*o+w*(5*$)+l*(5*B)+p*(5*k);i=C>>>13,C&=8191,C+=b*(5*I)+m*(5*L)+U*(5*d)+A*(5*u)+E*(5*a),i+=C>>>13,C&=8191;let S=i+h*a+g*y+w*o+l*(5*$)+p*(5*B);i=S>>>13,S&=8191,S+=b*(5*k)+m*(5*I)+U*(5*L)+A*(5*d)+E*(5*u),i+=S>>>13,S&=8191;let K=i+h*u+g*a+w*y+l*o+p*(5*$);i=K>>>13,K&=8191,K+=b*(5*B)+m*(5*k)+U*(5*I)+A*(5*L)+E*(5*d),i+=K>>>13,K&=8191;let q=i+h*d+g*u+w*a+l*y+p*o;i=q>>>13,q&=8191,q+=b*(5*$)+m*(5*B)+U*(5*k)+A*(5*I)+E*(5*L),i+=q>>>13,q&=8191;let V=i+h*L+g*d+w*u+l*a+p*y;i=V>>>13,V&=8191,V+=b*o+m*(5*$)+U*(5*B)+A*(5*k)+E*(5*I),i+=V>>>13,V&=8191;let G=i+h*I+g*L+w*d+l*u+p*a;i=G>>>13,G&=8191,G+=b*y+m*o+U*(5*$)+A*(5*B)+E*(5*k),i+=G>>>13,G&=8191;let W=i+h*k+g*I+w*L+l*d+p*u;i=W>>>13,W&=8191,W+=b*a+m*y+U*o+A*(5*$)+E*(5*B),i+=W>>>13,W&=8191;let X=i+h*B+g*k+w*I+l*L+p*d;i=X>>>13,X&=8191,X+=b*u+m*a+U*y+A*o+E*(5*$),i+=X>>>13,X&=8191;let Z=i+h*$+g*B+w*k+l*I+p*L;i=Z>>>13,Z&=8191,Z+=b*d+m*u+U*a+A*y+E*o,i+=Z>>>13,Z&=8191,i=(i<<2)+i|0,i=i+_|0,_=i&8191,i=i>>>13,C+=i,s[0]=_,s[1]=C,s[2]=S,s[3]=K,s[4]=q,s[5]=V,s[6]=G,s[7]=W,s[8]=X,s[9]=Z}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),c=t[1]>>>13;t[1]&=8191;for(let o=2;o<10;o++)t[o]+=c,c=t[o]>>>13,t[o]&=8191;t[0]+=c*5,c=t[0]>>>13,t[0]&=8191,t[1]+=c,c=t[1]>>>13,t[1]&=8191,t[2]+=c,r[0]=t[0]+5,c=r[0]>>>13,r[0]&=8191;for(let o=1;o<10;o++)r[o]=t[o]+c,c=r[o]>>>13,r[o]&=8191;r[9]-=8192;let s=(c^1)-1;for(let o=0;o<10;o++)r[o]&=s;s=~s;for(let o=0;o<10;o++)t[o]=t[o]&s|r[o];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let f=t[0]+n[0];t[0]=f&65535;for(let o=1;o<8;o++)f=(t[o]+n[o]|0)+(f>>>16)|0,t[o]=f&65535}update(t){H.exists(this);let{buffer:n,blockLen:r}=this;t=Q(t);let c=t.length;for(let s=0;s<c;){let f=Math.min(r-this.pos,c-s);if(f===r){for(;r<=c-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+f),this.pos),this.pos+=f,s+=f,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){H.exists(this),H.output(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:c}=this;if(c){for(n[c++]=1;c<16;c++)n[c]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let f=0;f<8;f++)t[s++]=r[f]>>>0,t[s++]=r[f]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function Bt(e){let t=(r,c)=>e(c).update(Q(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var lt=Bt(e=>new rt(e));var St=J("expand 16-byte k"),_t=J("expand 32-byte k"),Ct=R(St),kt=R(_t),xt=e=>!(e.byteOffset%4),ut=e=>{let{core:t,rounds:n,counterRight:r,counterLen:c,allow128bitKeys:s,extendNonceFn:f,blockLen:o}=ct({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},e);H.number(c),H.number(n),H.number(o),H.bool(r),H.bool(s);let y=o/4;if(o%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(a,u,d,L,I=0)=>{if(H.bytes(a),H.bytes(u),H.bytes(d),L||(L=new Uint8Array(d.length)),H.bytes(L),H.number(I),I<0||I>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(L.length<d.length)throw new Error(`Salsa/ChaCha: output (${L.length}) is shorter than data (${d.length})`);let k=[],B,$;if(a.length===32)B=a,$=kt;else if(a.length===16&&s)B=new Uint8Array(32),B.set(a),B.set(a,16),$=Ct,k.push(B);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${a.length}`);if(f){if(u.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");B=f($,B,u.subarray(0,16),new Uint8Array(32)),k.push(B),u=u.subarray(16)}let N=16-c;if(u.length!==N)throw new Error(`Salsa/ChaCha: nonce must be ${N} or 16 bytes`);if(N!==12){let h=new Uint8Array(12);h.set(u,r?0:12-u.length),k.push(u=h)}let z=new Uint8Array(o),T=R(z),F=R(B),D=R(u),O=xt(d)&&R(d),j=xt(L)&&R(L);k.push(T);let P=d.length;for(let h=0,g=I;h<P;g++){if(t($,F,D,T,g,n),g>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let w=Math.min(o,P-h);if(w===o&&j&&O){let l=h/4;if(h%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let p=0;p<y;p++)j[l+p]=O[l+p]^T[p];h+=o;continue}for(let l=0;l<w;l++)L[h+l]=d[h+l]^z[l];h+=w}for(let h=0;h<k.length;h++)k[h].fill(0);return L}};var x=(e,t)=>e<<t|e>>>32-t;function Ot(e,t,n,r,c,s=20){let f=e[0],o=e[1],y=e[2],a=e[3],u=t[0],d=t[1],L=t[2],I=t[3],k=t[4],B=t[5],$=t[6],N=t[7],z=c,T=n[0],F=n[1],D=n[2],O=f,j=o,P=y,h=a,g=u,w=d,l=L,p=I,b=k,m=B,U=$,A=N,E=z,i=T,_=F,C=D;for(let K=0;K<s;K+=2)O=O+g|0,E=x(E^O,16),b=b+E|0,g=x(g^b,12),O=O+g|0,E=x(E^O,8),b=b+E|0,g=x(g^b,7),j=j+w|0,i=x(i^j,16),m=m+i|0,w=x(w^m,12),j=j+w|0,i=x(i^j,8),m=m+i|0,w=x(w^m,7),P=P+l|0,_=x(_^P,16),U=U+_|0,l=x(l^U,12),P=P+l|0,_=x(_^P,8),U=U+_|0,l=x(l^U,7),h=h+p|0,C=x(C^h,16),A=A+C|0,p=x(p^A,12),h=h+p|0,C=x(C^h,8),A=A+C|0,p=x(p^A,7),O=O+w|0,C=x(C^O,16),U=U+C|0,w=x(w^U,12),O=O+w|0,C=x(C^O,8),U=U+C|0,w=x(w^U,7),j=j+l|0,E=x(E^j,16),A=A+E|0,l=x(l^A,12),j=j+l|0,E=x(E^j,8),A=A+E|0,l=x(l^A,7),P=P+p|0,i=x(i^P,16),b=b+i|0,p=x(p^b,12),P=P+p|0,i=x(i^P,8),b=b+i|0,p=x(p^b,7),h=h+g|0,_=x(_^h,16),m=m+_|0,g=x(g^m,12),h=h+g|0,_=x(_^h,8),m=m+_|0,g=x(g^m,7);let S=0;r[S++]=f+O|0,r[S++]=o+j|0,r[S++]=y+P|0,r[S++]=a+h|0,r[S++]=u+g|0,r[S++]=d+w|0,r[S++]=L+l|0,r[S++]=I+p|0,r[S++]=k+b|0,r[S++]=B+m|0,r[S++]=$+U|0,r[S++]=N+A|0,r[S++]=z+E|0,r[S++]=T+i|0,r[S++]=F+_|0,r[S++]=D+C|0}var jt=ut({core:Ot,counterRight:!1,counterLen:4,allow128bitKeys:!1});var Pt=new Uint8Array(16),pt=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(Pt.subarray(n))},yt=(e,t,n,r,c)=>{let s=e(t,n,new Uint8Array(32)),f=lt.create(s);c&&pt(f,c),pt(f,r);let o=new Uint8Array(16),y=it(o);tt(y,0,BigInt(c?c.length:0),!0),tt(y,8,BigInt(r.length),!0),f.update(o);let a=f.digest();return s.fill(0),a},It=e=>(t,n,r)=>(M(t,32),M(n),{tagLength:16,encrypt:(s,f)=>{let o=s.length,y=o+16;f?M(f,y):f=new Uint8Array(y),e(t,n,s,f,1);let a=yt(e,t,n,f.subarray(0,-16),r);return f.set(a,o),f},decrypt:(s,f)=>{let o=s.length,y=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");f?M(f,y):f=new Uint8Array(y);let a=s.subarray(0,-16),u=s.subarray(-16),d=yt(e,t,n,a,r);if(!ht(u,d))throw new Error("invalid tag");return e(t,n,a,f,1),f}}),nt=It(jt);var ot=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}},Y=class extends ot{constructor(){super()}init(t){this._api=t}checkInit(){if(this._api===void 0)throw new Error("Not initialized. Call init()")}};var $t={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},gt=$t;var st=class{constructor(t,n){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=t,this._key=new Uint8Array(n)}async seal(t,n,r){return await this._seal(t,n,r)}async open(t,n,r){return await this._open(t,n,r)}_seal(t,n,r){return new Promise(c=>{let s=nt(this._key,new Uint8Array(t),new Uint8Array(r)).encrypt(new Uint8Array(n));c(s.buffer)})}_open(t,n,r){return new Promise(c=>{let s=nt(this._key,new Uint8Array(t),new Uint8Array(r)).decrypt(new Uint8Array(n));c(s.buffer)})}},ft=class extends Y{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:gt.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(t){return new st(this._api,t)}};export{ft as Chacha20Poly1305};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
