function Oe(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Q(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function ee(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function T(r,e,i=""){let t=Oe(r),n=r?.length,s=e!==void 0;if(!t||s&&n!==e){let o=i&&`"${i}" `,a=s?` of length ${e}`:"",c=t?`length=${n}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function re(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function de(r,e){T(r,void 0,"output");let i=e.outputLen;if(r.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function j(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function M(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Be(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var He=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function be(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function pe(r,e){if(r.length!==e.length)return!1;let i=0;for(let t=0;t<r.length;t++)i|=r[t]^e[t];return i===0}var we=(r,e)=>{function i(t,...n){if(T(t,void 0,"key"),!He)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let u=n[0];T(u,r.varSizeNonce?void 0:r.nonceLength,"nonce")}let s=r.tagLength;s&&n[1]!==void 0&&T(n[1],void 0,"AAD");let o=e(t,...n),a=(u,h)=>{if(h!==void 0){if(u!==2)throw new Error("cipher output not supported");T(h,void 0,"output")}},c=!1;return{encrypt(u,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,T(u),a(o.encrypt.length,h),o.encrypt(u,h)},decrypt(u,h){if(T(u),s&&u.length<s)throw new Error('"ciphertext" expected length bigger than tagLength='+s);return a(o.decrypt.length,h),o.decrypt(u,h)}}}return Object.assign(i,r),i};function ie(r,e,i=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error('"output" expected Uint8Array of length '+r+", got: "+e.length);if(i&&!Ce(e))throw new Error("invalid output, must be aligned");return e}function xe(r,e,i){Q(i);let t=new Uint8Array(16),n=Be(t);return n.setBigUint64(0,BigInt(e),i),n.setBigUint64(8,BigInt(r),i),t}function Ce(r){return r.byteOffset%4===0}function q(r){return Uint8Array.from(r)}var De={},Re=je(globalThis,De);function je(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),s=new Set(n);return[...t.filter(o=>!s.has(o)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}var me=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),Ne=me("expand 16-byte k"),Ge=me("expand 32-byte k"),Fe=j(Ne),$e=j(Ge);function l(r,e){return r<<e|r>>>32-e}function ne(r){return r.byteOffset%4===0}var te=64,Ve=16,_e=2**32-1,ge=Uint32Array.of();function Ye(r,e,i,t,n,s,o,a){let c=n.length,y=new Uint8Array(te),u=j(y),h=ne(n)&&ne(s),I=h?j(n):ge,L=h?j(s):ge;for(let b=0;b<c;o++){if(r(e,i,t,u,o,a),o>=_e)throw new Error("arx: counter overflow");let p=Math.min(te,c-b);if(h&&p===te){let d=b/4;if(b%4!==0)throw new Error("arx: invalid block position");for(let z=0,D;z<Ve;z++)D=d+z,L[D]=I[D]^u[z];b+=te;continue}for(let d=0,z;d<p;d++)z=b+d,s[z]=n[z]^y[d];b+=p}}function Pe(r,e){let{allowShortKeys:i,extendNonceFn:t,counterLength:n,counterRight:s,rounds:o}=be({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return ee(n),ee(o),Q(s),Q(i),(a,c,y,u,h=0)=>{T(a,void 0,"key"),T(c,void 0,"nonce"),T(y,void 0,"data");let I=y.length;if(u===void 0&&(u=new Uint8Array(I)),T(u,void 0,"output"),ee(h),h<0||h>=_e)throw new Error("arx: counter overflow");if(u.length<I)throw new Error(`arx: output (${u.length}) is shorter than data (${I})`);let L=[],b=a.length,p,d;if(b===32)L.push(p=q(a)),d=$e;else if(b===16&&i)p=new Uint8Array(32),p.set(a),p.set(a,16),d=Fe,L.push(p);else throw T(a,32,"arx key"),new Error("invalid key size");ne(c)||L.push(c=q(c));let z=j(p);if(t){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(d,z,j(c.subarray(0,16)),z),c=c.subarray(16)}let D=16-n;if(D!==c.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){let N=new Uint8Array(12);N.set(c,s?0:12-c.length),c=N,L.push(c)}let G=j(c);return Ye(r,d,z,G,y,u,h,o),M(...L),u}}function O(r,e){return r[e++]&255|(r[e++]&255)<<8}var se=class{constructor(e){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:new Uint8Array(16)}),Object.defineProperty(this,"r",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"h",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"pad",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(8)}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e=q(T(e,32,"key"));let i=O(e,0),t=O(e,2),n=O(e,4),s=O(e,6),o=O(e,8),a=O(e,10),c=O(e,12),y=O(e,14);this.r[0]=i&8191,this.r[1]=(i>>>13|t<<3)&8191,this.r[2]=(t>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|y<<8)&8191,this.r[9]=y>>>5&127;for(let u=0;u<8;u++)this.pad[u]=O(e,16+2*u)}process(e,i,t=!1){let n=t?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],y=o[2],u=o[3],h=o[4],I=o[5],L=o[6],b=o[7],p=o[8],d=o[9],z=O(e,i+0),D=O(e,i+2),G=O(e,i+4),N=O(e,i+6),F=O(e,i+8),B=O(e,i+10),H=O(e,i+12),C=O(e,i+14),w=s[0]+(z&8191),x=s[1]+((z>>>13|D<<3)&8191),g=s[2]+((D>>>10|G<<6)&8191),m=s[3]+((G>>>7|N<<9)&8191),_=s[4]+((N>>>4|F<<12)&8191),P=s[5]+(F>>>1&8191),K=s[6]+((F>>>14|B<<2)&8191),v=s[7]+((B>>>11|H<<5)&8191),A=s[8]+((H>>>8|C<<8)&8191),k=s[9]+(C>>>5|n),f=0,U=f+w*a+x*(5*d)+g*(5*p)+m*(5*b)+_*(5*L);f=U>>>13,U&=8191,U+=P*(5*I)+K*(5*h)+v*(5*u)+A*(5*y)+k*(5*c),f+=U>>>13,U&=8191;let S=f+w*c+x*a+g*(5*d)+m*(5*p)+_*(5*b);f=S>>>13,S&=8191,S+=P*(5*L)+K*(5*I)+v*(5*h)+A*(5*u)+k*(5*y),f+=S>>>13,S&=8191;let E=f+w*y+x*c+g*a+m*(5*d)+_*(5*p);f=E>>>13,E&=8191,E+=P*(5*b)+K*(5*L)+v*(5*I)+A*(5*h)+k*(5*u),f+=E>>>13,E&=8191;let R=f+w*u+x*y+g*c+m*a+_*(5*d);f=R>>>13,R&=8191,R+=P*(5*p)+K*(5*b)+v*(5*L)+A*(5*I)+k*(5*h),f+=R>>>13,R&=8191;let $=f+w*h+x*u+g*y+m*c+_*a;f=$>>>13,$&=8191,$+=P*(5*d)+K*(5*p)+v*(5*b)+A*(5*L)+k*(5*I),f+=$>>>13,$&=8191;let V=f+w*I+x*h+g*u+m*y+_*c;f=V>>>13,V&=8191,V+=P*a+K*(5*d)+v*(5*p)+A*(5*b)+k*(5*L),f+=V>>>13,V&=8191;let Y=f+w*L+x*I+g*h+m*u+_*y;f=Y>>>13,Y&=8191,Y+=P*c+K*a+v*(5*d)+A*(5*p)+k*(5*b),f+=Y>>>13,Y&=8191;let X=f+w*b+x*L+g*I+m*h+_*u;f=X>>>13,X&=8191,X+=P*y+K*c+v*a+A*(5*d)+k*(5*p),f+=X>>>13,X&=8191;let W=f+w*p+x*b+g*L+m*I+_*h;f=W>>>13,W&=8191,W+=P*u+K*y+v*c+A*a+k*(5*d),f+=W>>>13,W&=8191;let Z=f+w*d+x*p+g*b+m*L+_*I;f=Z>>>13,Z&=8191,Z+=P*h+K*u+v*y+A*c+k*a,f+=Z>>>13,Z&=8191,f=(f<<2)+f|0,f=f+U|0,U=f&8191,f=f>>>13,S+=f,s[0]=U,s[1]=S,s[2]=E,s[3]=R,s[4]=$,s[5]=V,s[6]=Y,s[7]=X,s[8]=W,s[9]=Z}finalize(){let{h:e,pad:i}=this,t=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,t[0]=e[0]+5,n=t[0]>>>13,t[0]&=8191;for(let a=1;a<10;a++)t[a]=e[a]+n,n=t[a]>>>13,t[a]&=8191;t[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)t[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|t[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+i[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+i[a]|0)+(o>>>16)|0,e[a]=o&65535;M(t)}update(e){re(this),T(e),e=q(e);let{buffer:i,blockLen:t}=this,n=e.length;for(let s=0;s<n;){let o=Math.min(t-this.pos,n-s);if(o===t){for(;t<=n-s;s+=t)this.process(e,s);continue}i.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===t&&(this.process(i,0,!1),this.pos=0)}return this}destroy(){M(this.h,this.r,this.buffer,this.pad)}digestInto(e){re(this),de(e,this),this.finished=!0;let{buffer:i,h:t}=this,{pos:n}=this;if(n){for(i[n++]=1;n<16;n++)i[n]=0;this.process(i,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=t[o]>>>0,e[s++]=t[o]>>>8;return e}digest(){let{buffer:e,outputLen:i}=this;this.digestInto(e);let t=e.slice(0,i);return this.destroy(),t}};function Xe(r){let e=(t,n)=>r(n).update(t).digest(),i=r(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=t=>r(t),e}var Ke=Xe(r=>new se(r));function We(r,e,i,t,n,s=20){let o=r[0],a=r[1],c=r[2],y=r[3],u=e[0],h=e[1],I=e[2],L=e[3],b=e[4],p=e[5],d=e[6],z=e[7],D=n,G=i[0],N=i[1],F=i[2],B=o,H=a,C=c,w=y,x=u,g=h,m=I,_=L,P=b,K=p,v=d,A=z,k=D,f=G,U=N,S=F;for(let R=0;R<s;R+=2)B=B+x|0,k=l(k^B,16),P=P+k|0,x=l(x^P,12),B=B+x|0,k=l(k^B,8),P=P+k|0,x=l(x^P,7),H=H+g|0,f=l(f^H,16),K=K+f|0,g=l(g^K,12),H=H+g|0,f=l(f^H,8),K=K+f|0,g=l(g^K,7),C=C+m|0,U=l(U^C,16),v=v+U|0,m=l(m^v,12),C=C+m|0,U=l(U^C,8),v=v+U|0,m=l(m^v,7),w=w+_|0,S=l(S^w,16),A=A+S|0,_=l(_^A,12),w=w+_|0,S=l(S^w,8),A=A+S|0,_=l(_^A,7),B=B+g|0,S=l(S^B,16),v=v+S|0,g=l(g^v,12),B=B+g|0,S=l(S^B,8),v=v+S|0,g=l(g^v,7),H=H+m|0,k=l(k^H,16),A=A+k|0,m=l(m^A,12),H=H+m|0,k=l(k^H,8),A=A+k|0,m=l(m^A,7),C=C+_|0,f=l(f^C,16),P=P+f|0,_=l(_^P,12),C=C+_|0,f=l(f^C,8),P=P+f|0,_=l(_^P,7),w=w+x|0,U=l(U^w,16),K=K+U|0,x=l(x^K,12),w=w+x|0,U=l(U^w,8),K=K+U|0,x=l(x^K,7);let E=0;t[E++]=o+B|0,t[E++]=a+H|0,t[E++]=c+C|0,t[E++]=y+w|0,t[E++]=u+x|0,t[E++]=h+g|0,t[E++]=I+m|0,t[E++]=L+_|0,t[E++]=b+P|0,t[E++]=p+K|0,t[E++]=d+v|0,t[E++]=z+A|0,t[E++]=D+k|0,t[E++]=G+f|0,t[E++]=N+U|0,t[E++]=F+S|0}var Ze=Pe(We,{counterRight:!1,counterLength:4,allowShortKeys:!1});var qe=new Uint8Array(16),ve=(r,e)=>{r.update(e);let i=e.length%16;i&&r.update(qe.subarray(i))},Je=new Uint8Array(32);function Ae(r,e,i,t,n){n!==void 0&&T(n,void 0,"AAD");let s=r(e,i,Je),o=xe(t.length,n?n.length:0,!0),a=Ke.create(s);n&&ve(a,n),ve(a,t),a.update(o);let c=a.digest();return M(s,o),c}var Qe=r=>(e,i,t)=>({encrypt(s,o){let a=s.length;o=ie(a+16,o,!1),o.set(s);let c=o.subarray(0,-16);r(e,i,c,c,1);let y=Ae(r,e,i,c,t);return o.set(y,a),M(y),o},decrypt(s,o){o=ie(s.length-16,o,!1);let a=s.subarray(0,-16),c=s.subarray(-16),y=Ae(r,e,i,a,t);if(!pe(c,y))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,i,o,o,1),M(y),o}}),ae=we({blockSize:64,nonceLength:12,tagLength:16},Qe(Ze));var et={},ke=tt(globalThis,et);function tt(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),s=new Set(n);return[...t.filter(o=>!s.has(o)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}var oe={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};var J=new Uint8Array(0);var fe=new Uint8Array([75,69,77,0,0]);var Ht=new Uint8Array([101,97,101,95,112,114,107]),Ct=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);var le=new Uint8Array([100,107,112,95,112,114,107]),ze=new Uint8Array([115,107]);var Zt=new Uint8Array([99,97,110,100,105,100,97,116,101]),qt=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),Jt=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),Qt=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),er=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),tr=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),rr=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]);var wr=new Uint8Array([72,80,75,69,45,118,49]);var he=class{constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(e)}async seal(e,i,t){return await this._seal(e,i,t)}async open(e,i,t){return await this._open(e,i,t)}_seal(e,i,t){return new Promise(n=>{let s=ae(this._key,new Uint8Array(e),new Uint8Array(t)).encrypt(new Uint8Array(i));n(s.buffer)})}_open(e,i,t){return new Promise(n=>{let s=ae(this._key,new Uint8Array(e),new Uint8Array(t)).decrypt(new Uint8Array(i));n(s.buffer)})}},ye=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:oe.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new he(e)}};export{ye as Chacha20Poly1305};
