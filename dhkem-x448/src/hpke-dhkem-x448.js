var Ar={DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33},Ht=Ar,Lr={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},ee=Lr;function re(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Sr(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Ke(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ir(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");re(e.outputLen),re(e.blockLen)}function vr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function kr(e,t){Ke(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Hr={number:re,bool:Sr,bytes:Ke,hash:Ir,exists:vr,output:kr},R=Hr;var Pt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Oe=e=>e instanceof Uint8Array;var Te=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Ut=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);var Pr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Pr)throw new Error("Non little-endian hardware is not supported");var qn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ne(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ft(e){if(typeof e=="string"&&(e=ne(e)),!Oe(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Ne(...e){let t=new Uint8Array(e.reduce((n,o)=>n+o.length,0)),r=0;return e.forEach(n=>{if(!Oe(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}var at=class{clone(){return this._cloneInto()}};function Q(e){let t=n=>e().update(ft(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Ce(e){let t=(n,o)=>e(o).update(ft(n)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}function oe(e=32){if(Pt&&typeof Pt.getRandomValues=="function")return Pt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}var Kt=class extends at{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,R.hash(t);let n=ft(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return R.exists(this),this.iHash.update(t),this}digestInto(t){R.exists(this),R.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ie=(e,t,r)=>new Kt(e,t).update(r).digest();ie.create=(e,t)=>new Kt(e,t);function Ur(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),c=Number(r&s),a=n?4:0,u=n?0:4;e.setUint32(t+a,i,n),e.setUint32(t+u,c,n)}var Ot=class extends at{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ut(this.buffer)}update(t){R.exists(this);let{view:r,buffer:n,blockLen:o}=this;t=ft(t);let s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Ut(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){R.exists(this),R.output(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let x=i;x<o;x++)r[x]=0;Ur(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=Ut(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let x=0;x<u;x++)c.setUint32(4*x,f[x],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%r&&t.buffer.set(n),t}};var Tt=BigInt(4294967295),se=BigInt(32);function De(e,t=!1){return t?{h:Number(e&Tt),l:Number(e>>se&Tt)}:{h:Number(e>>se&Tt)|0,l:Number(e&Tt)|0}}function Kr(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++){let{h:s,l:i}=De(e[o],t);[r[o],n[o]]=[s,i]}return[r,n]}var Or=(e,t)=>BigInt(e>>>0)<<se|BigInt(t>>>0),Tr=(e,t,r)=>e>>>r,Nr=(e,t,r)=>e<<32-r|t>>>r,Cr=(e,t,r)=>e>>>r|t<<32-r,Dr=(e,t,r)=>e<<32-r|t>>>r,zr=(e,t,r)=>e<<64-r|t>>>r-32,qr=(e,t,r)=>e>>>r-32|t<<64-r,Rr=(e,t)=>t,Mr=(e,t)=>e,jr=(e,t,r)=>e<<r|t>>>32-r,Gr=(e,t,r)=>t<<r|e>>>32-r,Zr=(e,t,r)=>t<<r-32|e>>>64-r,$r=(e,t,r)=>e<<r-32|t>>>64-r;function Fr(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var Xr=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Vr=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Yr=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Wr=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Jr=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),Qr=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0,tn={fromBig:De,split:Kr,toBig:Or,shrSH:Tr,shrSL:Nr,rotrSH:Cr,rotrSL:Dr,rotrBH:zr,rotrBL:qr,rotr32H:Rr,rotr32L:Mr,rotlSH:jr,rotlSL:Gr,rotlBH:Zr,rotlBL:$r,add:Fr,add3L:Xr,add3H:Vr,add4L:Yr,add4H:Wr,add5H:Qr,add5L:Jr},b=tn;var[en,rn]=b.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ut=new Uint32Array(80),ht=new Uint32Array(80),yt=class extends Ot{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:u,El:f,Fh:x,Fl:y,Gh:L,Gl:I,Hh:k,Hl:_}=this;return[t,r,n,o,s,i,c,a,u,f,x,y,L,I,k,_]}set(t,r,n,o,s,i,c,a,u,f,x,y,L,I,k,_){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=f|0,this.Fh=x|0,this.Fl=y|0,this.Gh=L|0,this.Gl=I|0,this.Hh=k|0,this.Hl=_|0}process(t,r){for(let l=0;l<16;l++,r+=4)ut[l]=t.getUint32(r),ht[l]=t.getUint32(r+=4);for(let l=16;l<80;l++){let m=ut[l-15]|0,w=ht[l-15]|0,D=b.rotrSH(m,w,1)^b.rotrSH(m,w,8)^b.shrSH(m,w,7),Y=b.rotrSL(m,w,1)^b.rotrSL(m,w,8)^b.shrSL(m,w,7),P=ut[l-2]|0,K=ht[l-2]|0,j=b.rotrSH(P,K,19)^b.rotrBH(P,K,61)^b.shrSH(P,K,6),z=b.rotrSL(P,K,19)^b.rotrBL(P,K,61)^b.shrSL(P,K,6),$=b.add4L(Y,z,ht[l-7],ht[l-16]),O=b.add4H($,D,j,ut[l-7],ut[l-16]);ut[l]=O|0,ht[l]=$|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:u,Dl:f,Eh:x,El:y,Fh:L,Fl:I,Gh:k,Gl:_,Hh:C,Hl:M}=this;for(let l=0;l<80;l++){let m=b.rotrSH(x,y,14)^b.rotrSH(x,y,18)^b.rotrBH(x,y,41),w=b.rotrSL(x,y,14)^b.rotrSL(x,y,18)^b.rotrBL(x,y,41),D=x&L^~x&k,Y=y&I^~y&_,P=b.add5L(M,w,Y,rn[l],ht[l]),K=b.add5H(P,C,m,D,en[l],ut[l]),j=P|0,z=b.rotrSH(n,o,28)^b.rotrBH(n,o,34)^b.rotrBH(n,o,39),$=b.rotrSL(n,o,28)^b.rotrBL(n,o,34)^b.rotrBL(n,o,39),O=n&s^n&c^s&c,gt=o&i^o&a^i&a;C=k|0,M=_|0,k=L|0,_=I|0,L=x|0,I=y|0,{h:x,l:y}=b.add(u|0,f|0,K|0,j|0),u=c|0,f=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let st=b.add3L(j,$,gt);n=b.add3H(st,K,z,O),o=st|0}({h:n,l:o}=b.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=b.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=b.add(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l:f}=b.add(this.Dh|0,this.Dl|0,u|0,f|0),{h:x,l:y}=b.add(this.Eh|0,this.El|0,x|0,y|0),{h:L,l:I}=b.add(this.Fh|0,this.Fl|0,L|0,I|0),{h:k,l:_}=b.add(this.Gh|0,this.Gl|0,k|0,_|0),{h:C,l:M}=b.add(this.Hh|0,this.Hl|0,C|0,M|0),this.set(n,o,s,i,c,a,u,f,x,y,L,I,k,_,C,M)}roundClean(){ut.fill(0),ht.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},ce=class extends yt{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}},ae=class extends yt{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}},fe=class extends yt{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}},ze=Q(()=>new yt),Jn=Q(()=>new ce),Qn=Q(()=>new ae),to=Q(()=>new fe);var Nt=["deriveBits"];var rt=new Uint8Array(0),ue=new Uint8Array([72,80,75,69,45,118,49]),ro=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),qe=new Uint8Array([75,69,77,0,0]),Re=new Uint8Array([100,107,112,95,112,114,107]),Me=new Uint8Array([101,97,101,95,112,114,107]),no=new Uint8Array([105,110,102,111,95,104,97,115,104]),oo=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),io=new Uint8Array([115,101,99,114,101,116]),je=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]),so=new Uint8Array([107,101,121]),co=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),ao=new Uint8Array([101,120,112]),fo=new Uint8Array([115,101,99]),uo=new Uint8Array([99,97,110,100,105,100,97,116,101]),Ge=new Uint8Array([115,107]),ho=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),lo=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),xo=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]);var Ct=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}checkInit(){if(typeof this._api>"u")throw new Error("Not initialized. Call init()")}},bt=class extends Ct{constructor(){super()}init(t){this._api=t}},Dt=class extends Ct{constructor(){super(),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:rt})}init(t,r){this._api=t,this._suiteId=r}};var nt=class extends Error{constructor(t){let r;t instanceof Error?r=t.message:typeof t=="string"?r=t:r="",super(r),this.name=this.constructor.name}},zt=class extends nt{};var qt=class extends nt{},wt=class extends nt{},Rt=class extends nt{},Mt=class extends nt{};var jt=class extends nt{},Gt=class extends nt{};var he=class extends Dt{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}buildLabeledIkm(t,r){let n=new Uint8Array(7+this._suiteId.byteLength+t.byteLength+r.byteLength);return n.set(ue,0),n.set(this._suiteId,7),n.set(t,7+this._suiteId.byteLength),n.set(r,7+this._suiteId.byteLength+t.byteLength),n}buildLabeledInfo(t,r,n){let o=new Uint8Array(9+this._suiteId.byteLength+t.byteLength+r.byteLength);return o.set(new Uint8Array([0,n]),0),o.set(ue,2),o.set(this._suiteId,9),o.set(t,9+this._suiteId.byteLength),o.set(r,9+this._suiteId.byteLength+t.byteLength),o}async extract(t,r){if(this.checkInit(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)throw new zt("The salt length must be the same as the hashSize");let n=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,r)}async expand(t,r,n){this.checkInit();let o=await this._api.importKey("raw",t,this.algHash,!1,["sign"]),s=new ArrayBuffer(n),i=new Uint8Array(s),c=rt,a=new Uint8Array(r),u=new Uint8Array(1);if(n>255*this.hashSize)throw new Error("Entropy limit reached");let f=new Uint8Array(this.hashSize+a.length+1);for(let x=1,y=0;y<i.length;x++)u[0]=x,f.set(c,0),f.set(a,c.length),f.set(u,c.length+a.length),c=new Uint8Array(await this._api.sign("HMAC",o,f.slice(0,c.length+a.length+1))),i.length-y>=c.length?(i.set(c,y),y+=c.length):(i.set(c.slice(0,i.length-y),y),y+=i.length-y);return s}async extractAndExpand(t,r,n,o){this.checkInit();let s=await this._api.importKey("raw",r,"HKDF",!1,Nt);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:t,info:n},s,o*8)}async labeledExtract(t,r,n){return await this.extract(t,this.buildLabeledIkm(r,n))}async labeledExpand(t,r,n,o){return await this.expand(t,this.buildLabeledInfo(r,n,o),o)}};var Zt=class extends he{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var $t=class extends Zt{async extract(t,r){if(this.checkInit(),t.byteLength===0&&(t=new ArrayBuffer(this.hashSize)),t.byteLength!==this.hashSize)return ie(ze,new Uint8Array(t),new Uint8Array(r));let n=await this._api.importKey("raw",t,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,r)}};var nn={},on=sn(globalThis,nn);function sn(e,t){return new Proxy(e,{get(r,n,o){return n in t?t[n]:e[n]},set(r,n,o){return n in t&&delete t[n],e[n]=o,!0},deleteProperty(r,n){let o=!1;return n in t&&(delete t[n],o=!0),n in e&&(delete e[n],o=!0),o},ownKeys(r){let n=Reflect.ownKeys(e),o=Reflect.ownKeys(t),s=new Set(o);return[...n.filter(i=>!s.has(i)),...o]},defineProperty(r,n,o){return n in t&&delete t[n],Reflect.defineProperty(e,n,o),!0},getOwnPropertyDescriptor(r,n){return n in t?Reflect.getOwnPropertyDescriptor(t,n):Reflect.getOwnPropertyDescriptor(e,n)},has(r,n){return n in t||n in e}})}var Et=e=>typeof e=="object"&&e!==null&&typeof e.privateKey=="object"&&typeof e.publicKey=="object";function $e(e,t){if(t<=0)throw new Error("i2Osp: too small size");if(e>=256**t)throw new Error("i2Osp: too large integer");let r=new Uint8Array(t);for(let n=0;n<t&&e;n++)r[t-(n+1)]=e%256,e=e>>8;return r}function _t(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r}function Fe(e,t,r){let n=new Uint8Array(e.length+t.length+r.length);return n.set(e,0),n.set(t,e.length),n.set(r,e.length+t.length),n}function le(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return n}var Ft=class extends bt{constructor(t,r){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Ht.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=t,this._kdf=r}init(t){super.init(t);let r=new Uint8Array(qe);r.set($e(this.id,2),3),this._prim.init(t),this._kdf.init(t,r),super.init(t)}async generateKeyPair(){try{return await this._prim.generateKeyPair()}catch(t){throw new Gt(t)}}async deriveKeyPair(t){try{return await this._prim.deriveKeyPair(t)}catch(r){throw new jt(r)}}async serializePublicKey(t){try{return await this._prim.serializePublicKey(t)}catch(r){throw new qt(r)}}async deserializePublicKey(t){try{return await this._prim.deserializePublicKey(t)}catch(r){throw new wt(r)}}async importKey(t,r,n){try{return await this._prim.importKey(t,r,n)}catch(o){throw new wt(o)}}async encap(t){try{let r=t.nonEphemeralKeyPair===void 0?await this.generateKeyPair():t.nonEphemeralKeyPair,n=await this._prim.serializePublicKey(r.publicKey),o=await this._prim.serializePublicKey(t.recipientPublicKey),s;if(t.senderKey===void 0)s=new Uint8Array(await this._prim.dh(r.privateKey,t.recipientPublicKey));else{let a=Et(t.senderKey)?t.senderKey.privateKey:t.senderKey,u=new Uint8Array(await this._prim.dh(r.privateKey,t.recipientPublicKey)),f=new Uint8Array(await this._prim.dh(a,t.recipientPublicKey));s=_t(u,f)}let i;if(t.senderKey===void 0)i=_t(new Uint8Array(n),new Uint8Array(o));else{let a=Et(t.senderKey)?t.senderKey.publicKey:await this._prim.derivePublicKey(t.senderKey),u=await this._prim.serializePublicKey(a);i=Fe(new Uint8Array(n),new Uint8Array(o),new Uint8Array(u))}let c=await this.generateSharedSecret(s,i);return{enc:n,sharedSecret:c}}catch(r){throw new Rt(r)}}async decap(t){let r;try{r=await this._prim.deserializePublicKey(t.enc)}catch(n){throw new wt(n)}try{let n=Et(t.recipientKey)?t.recipientKey.privateKey:t.recipientKey,o=Et(t.recipientKey)?t.recipientKey.publicKey:await this._prim.derivePublicKey(t.recipientKey),s=await this._prim.serializePublicKey(o),i;if(t.senderPublicKey===void 0)i=new Uint8Array(await this._prim.dh(n,r));else{let a=new Uint8Array(await this._prim.dh(n,r)),u=new Uint8Array(await this._prim.dh(n,t.senderPublicKey));i=_t(a,u)}let c;if(t.senderPublicKey===void 0)c=_t(new Uint8Array(t.enc),new Uint8Array(s));else{let a=await this._prim.serializePublicKey(t.senderPublicKey);c=new Uint8Array(t.enc.byteLength+s.byteLength+a.byteLength),c.set(new Uint8Array(t.enc),0),c.set(new Uint8Array(s),t.enc.byteLength),c.set(new Uint8Array(a),t.enc.byteLength+s.byteLength)}return await this.generateSharedSecret(i,c)}catch(n){throw new Mt(n)}}async generateSharedSecret(t,r){let n=this._kdf.buildLabeledIkm(Me,t),o=this._kdf.buildLabeledInfo(je,r,this.secretSize);return await this._kdf.extractAndExpand(rt,n,o,this.secretSize)}};var[Ye,We,Je]=[[],[],[]],an=BigInt(0),Bt=BigInt(1),fn=BigInt(2),un=BigInt(7),hn=BigInt(256),ln=BigInt(113);for(let e=0,t=Bt,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],Ye.push(2*(5*n+r)),We.push((e+1)*(e+2)/2%64);let o=an;for(let s=0;s<7;s++)t=(t<<Bt^(t>>un)*ln)%hn,t&fn&&(o^=Bt<<(Bt<<BigInt(s))-Bt);Je.push(o)}var[dn,xn]=b.split(Je,!0),Xe=(e,t,r)=>r>32?b.rotlBH(e,t,r):b.rotlSH(e,t,r),Ve=(e,t,r)=>r>32?b.rotlBL(e,t,r):b.rotlSL(e,t,r);function pn(e,t=24){let r=new Uint32Array(10);for(let n=24-t;n<24;n++){for(let i=0;i<10;i++)r[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){let c=(i+8)%10,a=(i+2)%10,u=r[a],f=r[a+1],x=Xe(u,f,1)^r[c],y=Ve(u,f,1)^r[c+1];for(let L=0;L<50;L+=10)e[i+L]^=x,e[i+L+1]^=y}let o=e[2],s=e[3];for(let i=0;i<24;i++){let c=We[i],a=Xe(o,s,c),u=Ve(o,s,c),f=Ye[i];o=e[f],s=e[f+1],e[f]=a,e[f+1]=u}for(let i=0;i<50;i+=10){for(let c=0;c<10;c++)r[c]=e[i+c];for(let c=0;c<10;c++)e[i+c]^=~r[(c+2)%10]&r[(c+4)%10]}e[0]^=dn[n],e[1]^=xn[n]}r.fill(0)}var Xt=class e extends at{constructor(t,r,n,o=!1,s=24){if(super(),this.blockLen=t,this.suffix=r,this.outputLen=n,this.enableXOF=o,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,R.number(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Te(this.state)}keccak(){pn(this.state32,this.rounds),this.posOut=0,this.pos=0}update(t){R.exists(this);let{blockLen:r,state:n}=this;t=ft(t);let o=t.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);for(let c=0;c<i;c++)n[this.pos++]^=t[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:t,suffix:r,pos:n,blockLen:o}=this;t[n]^=r,r&128&&n===o-1&&this.keccak(),t[o-1]^=128,this.keccak()}writeInto(t){R.exists(this,!1),R.bytes(t),this.finish();let r=this.state,{blockLen:n}=this;for(let o=0,s=t.length;o<s;){this.posOut>=n&&this.keccak();let i=Math.min(n-this.posOut,s-o);t.set(r.subarray(this.posOut,this.posOut+i),o),this.posOut+=i,o+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return R.number(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(R.output(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){let{blockLen:r,suffix:n,outputLen:o,rounds:s,enableXOF:i}=this;return t||(t=new e(r,n,o,i,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=n,t.outputLen=o,t.enableXOF=i,t.destroyed=this.destroyed,t}},lt=(e,t,r)=>Q(()=>new Xt(t,e,r)),Po=lt(6,144,224/8),Uo=lt(6,136,256/8),Ko=lt(6,104,384/8),Oo=lt(6,72,512/8),To=lt(1,144,224/8),No=lt(1,136,256/8),Co=lt(1,104,384/8),Do=lt(1,72,512/8),Qe=(e,t,r)=>Ce((n={})=>new Xt(t,e,n.dkLen===void 0?r:n.dkLen,!0)),zo=Qe(31,168,128/8),de=Qe(31,136,256/8);var Ro=BigInt(0),yn=BigInt(1),bn=BigInt(2),Vt=e=>e instanceof Uint8Array,wn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Yt(e){if(!Vt(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=wn[e[r]];return t}function tr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function er(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){let o=n*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");r[n]=i}return r}function xe(e){return tr(Yt(e))}function ot(e){if(!Vt(e))throw new Error("Uint8Array expected");return tr(Yt(Uint8Array.from(e).reverse()))}function pe(e,t){return er(e.toString(16).padStart(t*2,"0"))}function dt(e,t){return pe(e,t).reverse()}function F(e,t,r){let n;if(typeof t=="string")try{n=er(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Vt(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(`${e} expected ${r} bytes, got ${o}`);return n}function Wt(...e){let t=new Uint8Array(e.reduce((n,o)=>n+o.length,0)),r=0;return e.forEach(n=>{if(!Vt(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}var rr=e=>(bn<<BigInt(e-1))-yn;var gn={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function it(e,t,r={}){let n=(o,s,i)=>{let c=gn[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);let a=e[o];if(!(i&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(let[o,s]of Object.entries(t))n(o,s,!1);for(let[o,s]of Object.entries(r))n(o,s,!0);return e}var N=BigInt(0),T=BigInt(1),xt=BigInt(2),En=BigInt(3),ye=BigInt(4),nr=BigInt(5),or=BigInt(8),_n=BigInt(9),Bn=BigInt(16);function U(e,t){let r=e%t;return r>=N?r:t+r}function be(e,t,r){if(r<=N||t<N)throw new Error("Expected power/modulo > 0");if(r===T)return N;let n=T;for(;t>N;)t&T&&(n=n*e%r),e=e*e%r,t>>=T;return n}function X(e,t,r){let n=e;for(;t-- >N;)n*=n,n%=r;return n}function ir(e,t){if(e===N||t<=N)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=U(e,t),n=t,o=N,s=T,i=T,c=N;for(;r!==N;){let u=n/r,f=n%r,x=o-i*u,y=s-c*u;n=r,r=f,o=i,s=c,i=x,c=y}if(n!==T)throw new Error("invert: does not exist");return U(o,t)}function An(e){let t=(e-T)/xt,r,n,o;for(r=e-T,n=0;r%xt===N;r/=xt,n++);for(o=xt;o<e&&be(o,t,e)!==e-T;o++);if(n===1){let i=(e+T)/ye;return function(a,u){let f=a.pow(u,i);if(!a.eql(a.sqr(f),u))throw new Error("Cannot find square root");return f}}let s=(r+T)/xt;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=n,f=c.pow(c.mul(c.ONE,o),r),x=c.pow(a,s),y=c.pow(a,r);for(;!c.eql(y,c.ONE);){if(c.eql(y,c.ZERO))return c.ZERO;let L=1;for(let k=c.sqr(y);L<u&&!c.eql(k,c.ONE);L++)k=c.sqr(k);let I=c.pow(f,T<<BigInt(u-L-1));f=c.sqr(I),x=c.mul(x,I),y=c.mul(y,f),u=L}return x}}function Ln(e){if(e%ye===En){let t=(e+T)/ye;return function(n,o){let s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%or===nr){let t=(e-nr)/or;return function(n,o){let s=n.mul(o,xt),i=n.pow(s,t),c=n.mul(o,i),a=n.mul(n.mul(c,xt),i),u=n.mul(c,n.sub(a,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return e%Bn,An(e)}var Sn=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sr(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Sn.reduce((n,o)=>(n[o]="function",n),t);return it(e,r)}function In(e,t,r){if(r<N)throw new Error("Expected power > 0");if(r===N)return e.ONE;if(r===T)return t;let n=e.ONE,o=t;for(;r>N;)r&T&&(n=e.mul(n,o)),o=e.sqr(o),r>>=T;return n}function vn(e,t){let r=new Array(t.length),n=t.reduce((s,i,c)=>e.is0(i)?s:(r[c]=s,e.mul(s,i)),e.ONE),o=e.inv(n);return t.reduceRight((s,i,c)=>e.is0(i)?s:(r[c]=e.mul(s,r[c]),e.mul(s,i)),o),r}function we(e,t){let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function cr(e,t,r=!1,n={}){if(e<=N)throw new Error(`Expected Fp ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:s}=we(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=Ln(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:rr(o),ZERO:N,ONE:T,create:a=>U(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return N<=a&&a<e},is0:a=>a===N,isOdd:a=>(a&T)===T,neg:a=>U(-a,e),eql:(a,u)=>a===u,sqr:a=>U(a*a,e),add:(a,u)=>U(a+u,e),sub:(a,u)=>U(a-u,e),mul:(a,u)=>U(a*u,e),pow:(a,u)=>In(c,a,u),div:(a,u)=>U(a*ir(u,e),e),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>ir(a,e),sqrt:n.sqrt||(a=>i(c,a)),invertBatch:a=>vn(c,a),cmov:(a,u,f)=>f?u:a,toBytes:a=>r?dt(a,s):pe(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return r?ot(a):xe(a)}});return Object.freeze(c)}var kn=BigInt(0),ge=BigInt(1);function ar(e,t){let r=(o,s)=>{let i=s.negate();return o?i:s},n=o=>{let s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:r,unsafeLadder(o,s){let i=e.ZERO,c=o;for(;s>kn;)s&ge&&(i=i.add(c)),c=c.double(),s>>=ge;return i},precomputeWindow(o,s){let{windows:i,windowSize:c}=n(s),a=[],u=o,f=u;for(let x=0;x<i;x++){f=u,a.push(f);for(let y=1;y<c;y++)f=f.add(u),a.push(f);u=f.double()}return a},wNAF(o,s,i){let{windows:c,windowSize:a}=n(o),u=e.ZERO,f=e.BASE,x=BigInt(2**o-1),y=2**o,L=BigInt(o);for(let I=0;I<c;I++){let k=I*a,_=Number(i&x);i>>=L,_>a&&(_-=y,i+=ge);let C=k,M=k+Math.abs(_)-1,l=I%2!==0,m=_<0;_===0?f=f.add(r(l,s[C])):u=u.add(r(m,s[M]))}return{p:u,f}},wNAFCached(o,s,i,c){let a=o._WINDOW_SIZE||1,u=s.get(o);return u||(u=this.precomputeWindow(o,a),a!==1&&s.set(o,c(u))),this.wNAF(a,u,i)}}}function fr(e){return sr(e.Fp),it(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...we(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}var W=BigInt(0),V=BigInt(1),Jt=BigInt(2),Hn=BigInt(8),Pn={zip215:!0};function Un(e){let t=fr(e);return it(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function me(e){let t=Un(e),{Fp:r,n,prehash:o,hash:s,randomBytes:i,nByteLength:c,h:a}=t,u=Jt<<BigInt(c*8)-V,f=r.create,x=t.uvRatio||((d,h)=>{try{return{isValid:!0,value:r.sqrt(d*r.inv(h))}}catch{return{isValid:!1,value:W}}}),y=t.adjustScalarBytes||(d=>d),L=t.domain||((d,h,p)=>{if(h.length||p)throw new Error("Contexts/pre-hash are not supported");return d}),I=d=>typeof d=="bigint"&&W<d,k=(d,h)=>I(d)&&I(h)&&d<h,_=d=>d===W||k(d,u);function C(d,h){if(k(d,h))return d;throw new Error(`Expected valid scalar < ${h}, got ${typeof d} ${d}`)}function M(d){return d===W?d:C(d,n)}let l=new Map;function m(d){if(!(d instanceof w))throw new Error("ExtendedPoint expected")}class w{constructor(h,p,g,E){if(this.ex=h,this.ey=p,this.ez=g,this.et=E,!_(h))throw new Error("x required");if(!_(p))throw new Error("y required");if(!_(g))throw new Error("z required");if(!_(E))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(h){if(h instanceof w)throw new Error("extended point not allowed");let{x:p,y:g}=h||{};if(!_(p)||!_(g))throw new Error("invalid affine point");return new w(p,g,V,f(p*g))}static normalizeZ(h){let p=r.invertBatch(h.map(g=>g.ez));return h.map((g,E)=>g.toAffine(p[E])).map(w.fromAffine)}_setWindowSize(h){this._WINDOW_SIZE=h,l.delete(this)}assertValidity(){let{a:h,d:p}=t;if(this.is0())throw new Error("bad point: ZERO");let{ex:g,ey:E,ez:B,et:S}=this,H=f(g*g),A=f(E*E),v=f(B*B),q=f(v*v),G=f(H*h),J=f(v*f(G+A)),Z=f(q+f(p*f(H*A)));if(J!==Z)throw new Error("bad point: equation left != right (1)");let ct=f(g*E),et=f(B*S);if(ct!==et)throw new Error("bad point: equation left != right (2)")}equals(h){m(h);let{ex:p,ey:g,ez:E}=this,{ex:B,ey:S,ez:H}=h,A=f(p*H),v=f(B*E),q=f(g*H),G=f(S*E);return A===v&&q===G}is0(){return this.equals(w.ZERO)}negate(){return new w(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){let{a:h}=t,{ex:p,ey:g,ez:E}=this,B=f(p*p),S=f(g*g),H=f(Jt*f(E*E)),A=f(h*B),v=p+g,q=f(f(v*v)-B-S),G=A+S,J=G-H,Z=A-S,ct=f(q*J),et=f(G*Z),vt=f(q*Z),kt=f(J*G);return new w(ct,et,kt,vt)}add(h){m(h);let{a:p,d:g}=t,{ex:E,ey:B,ez:S,et:H}=this,{ex:A,ey:v,ez:q,et:G}=h;if(p===BigInt(-1)){let Se=f((B-E)*(v+A)),Ie=f((B+E)*(v-A)),te=f(Ie-Se);if(te===W)return this.double();let ve=f(S*Jt*G),ke=f(H*Jt*q),He=ke+ve,Pe=Ie+Se,Ue=ke-ve,mr=f(He*te),Er=f(Pe*Ue),_r=f(He*Ue),Br=f(te*Pe);return new w(mr,Er,Br,_r)}let J=f(E*A),Z=f(B*v),ct=f(H*g*G),et=f(S*q),vt=f((E+B)*(A+v)-J-Z),kt=et-ct,Ae=et+ct,Le=f(Z-p*J),yr=f(vt*kt),br=f(Ae*Le),wr=f(vt*Le),gr=f(kt*Ae);return new w(yr,br,gr,wr)}subtract(h){return this.add(h.negate())}wNAF(h){return P.wNAFCached(this,l,h,w.normalizeZ)}multiply(h){let{p,f:g}=this.wNAF(C(h,n));return w.normalizeZ([p,g])[0]}multiplyUnsafe(h){let p=M(h);return p===W?Y:this.equals(Y)||p===V?this:this.equals(D)?this.wNAF(p).p:P.unsafeLadder(this,p)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return P.unsafeLadder(this,n).is0()}toAffine(h){let{ex:p,ey:g,ez:E}=this,B=this.is0();h==null&&(h=B?Hn:r.inv(E));let S=f(p*h),H=f(g*h),A=f(E*h);if(B)return{x:W,y:V};if(A!==V)throw new Error("invZ was invalid");return{x:S,y:H}}clearCofactor(){let{h}=t;return h===V?this:this.multiplyUnsafe(h)}static fromHex(h,p=!1){let{d:g,a:E}=t,B=r.BYTES;h=F("pointHex",h,B);let S=h.slice(),H=h[B-1];S[B-1]=H&-129;let A=ot(S);A===W||(p?C(A,u):C(A,r.ORDER));let v=f(A*A),q=f(v-V),G=f(g*v-E),{isValid:J,value:Z}=x(q,G);if(!J)throw new Error("Point.fromHex: invalid y coordinate");let ct=(Z&V)===V,et=(H&128)!==0;if(!p&&Z===W&&et)throw new Error("Point.fromHex: x=0 and x_0=1");return et!==ct&&(Z=f(-Z)),w.fromAffine({x:Z,y:A})}static fromPrivateKey(h){return z(h).point}toRawBytes(){let{x:h,y:p}=this.toAffine(),g=dt(p,r.BYTES);return g[g.length-1]|=h&V?128:0,g}toHex(){return Yt(this.toRawBytes())}}w.BASE=new w(t.Gx,t.Gy,V,f(t.Gx*t.Gy)),w.ZERO=new w(W,V,V,W);let{BASE:D,ZERO:Y}=w,P=ar(w,c*8);function K(d){return U(d,n)}function j(d){return K(ot(d))}function z(d){let h=c;d=F("private key",d,h);let p=F("hashed private key",s(d),2*h),g=y(p.slice(0,h)),E=p.slice(h,2*h),B=j(g),S=D.multiply(B),H=S.toRawBytes();return{head:g,prefix:E,scalar:B,point:S,pointBytes:H}}function $(d){return z(d).pointBytes}function O(d=new Uint8Array,...h){let p=Wt(...h);return j(s(L(p,F("context",d),!!o)))}function gt(d,h,p={}){d=F("message",d),o&&(d=o(d));let{prefix:g,scalar:E,pointBytes:B}=z(h),S=O(p.context,g,d),H=D.multiply(S).toRawBytes(),A=O(p.context,H,B,d),v=K(S+A*E);M(v);let q=Wt(H,dt(v,r.BYTES));return F("result",q,c*2)}let st=Pn;function St(d,h,p,g=st){let{context:E,zip215:B}=g,S=r.BYTES;d=F("signature",d,2*S),h=F("message",h),o&&(h=o(h));let H=ot(d.slice(S,2*S)),A,v,q;try{A=w.fromHex(p,B),v=w.fromHex(d.slice(0,S),B),q=D.multiplyUnsafe(H)}catch{return!1}if(!B&&A.isSmallOrder())return!1;let G=O(E,v.toRawBytes(),A.toRawBytes(),h);return v.add(A.multiplyUnsafe(G)).subtract(q).clearCofactor().equals(w.ZERO)}return D._setWindowSize(8),{CURVE:t,getPublicKey:$,sign:gt,verify:St,ExtendedPoint:w,utils:{getExtendedPublicKey:z,randomPrivateKey:()=>i(r.BYTES),precompute(d=8,h=w.BASE){return h._setWindowSize(d),h.multiply(BigInt(3)),h}}}}var At=BigInt(0),Ee=BigInt(1);function Kn(e){return it(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function ur(e){let t=Kn(e),{P:r}=t,n=l=>U(l,r),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,c=t.adjustScalarBytes||(l=>l),a=t.powPminus2||(l=>be(l,r-BigInt(2),r));function u(l,m,w){let D=n(l*(m-w));return m=n(m-D),w=n(w+D),[m,w]}function f(l){if(typeof l=="bigint"&&At<=l&&l<r)return l;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}let x=(t.a-BigInt(2))/BigInt(4);function y(l,m){let w=f(l),D=f(m),Y=w,P=Ee,K=At,j=w,z=Ee,$=At,O;for(let st=BigInt(o-1);st>=At;st--){let St=D>>st&Ee;$^=St,O=u($,P,j),P=O[0],j=O[1],O=u($,K,z),K=O[0],z=O[1],$=St;let It=P+K,d=n(It*It),h=P-K,p=n(h*h),g=d-p,E=j+z,B=j-z,S=n(B*It),H=n(E*h),A=S+H,v=S-H;j=n(A*A),z=n(Y*n(v*v)),P=n(d*p),K=n(g*(d+n(x*g)))}O=u($,P,j),P=O[0],j=O[1],O=u($,K,z),K=O[0],z=O[1];let gt=a(K);return n(P*gt)}function L(l){return dt(n(l),s)}function I(l){let m=F("u coordinate",l,s);return i===s&&(m[i-1]&=127),ot(m)}function k(l){let m=F("scalar",l);if(m.length!==s&&m.length!==i)throw new Error(`Expected ${s} or ${i} bytes, got ${m.length}`);return ot(c(m))}function _(l,m){let w=I(m),D=k(l),Y=y(w,D);if(Y===At)throw new Error("Invalid private or public key received");return L(Y)}let C=L(t.Gu);function M(l){return _(l,C)}return{scalarMult:_,scalarMultBase:M,getSharedSecret:(l,m)=>_(l,m),getPublicKey:l=>M(l),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:C}}var On=Q(()=>de.create({dkLen:114})),Tn=Q(()=>de.create({dkLen:64})),Lt=BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018365439");function hr(e){let t=Lt,r=BigInt(1),n=BigInt(2),o=BigInt(3),s=BigInt(11),i=BigInt(22),c=BigInt(44),a=BigInt(88),u=BigInt(223),f=e*e*e%t,x=f*f*e%t,y=X(x,o,t)*x%t,L=X(y,o,t)*x%t,I=X(L,n,t)*f%t,k=X(I,s,t)*I%t,_=X(k,i,t)*k%t,C=X(_,c,t)*_%t,M=X(C,a,t)*C%t,l=X(M,c,t)*_%t,m=X(l,n,t)*f%t,w=X(m,r,t)*e%t;return X(w,u,t)*m%t}function lr(e){return e[0]&=252,e[55]|=128,e[56]=0,e}var dr=cr(Lt,456,!0),hi=BigInt(4),xr={a:BigInt(1),d:BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018326358"),Fp:dr,n:BigInt("181709681073901722637330951972001133588410340171829515070372549795146003961539585716195755291692375963310293709091662304773755859649779"),nBitLength:456,h:BigInt(4),Gx:BigInt("224580040295924300187604334099896036246789641632564134246125461686950415467406032909029192869357953282578032075146446173674602635247710"),Gy:BigInt("298819210078481492676017930443930673437544040154080242095928241372331506189835876003536878655418784733982303233503462500531545062832660"),hash:On,randomBytes:oe,adjustScalarBytes:lr,domain:(e,t,r)=>{if(t.length>255)throw new Error(`Context is too big: ${t.length}`);return Ne(ne("SigEd448"),new Uint8Array([r?1:0,t.length]),t,e)},uvRatio:(e,t)=>{let r=Lt,n=U(e*e*t,r),o=U(n*e,r),s=U(o*n*t,r),i=hr(s),c=U(o*i,r),a=U(c*c,r);return{isValid:U(a*t,r)===e,value:c}}},pr=me(xr),li=me({...xr,prehash:Tn}),_e=(()=>ur({a:BigInt(156326),montgomeryBits:448,nByteLength:57,P:Lt,Gu:BigInt(5),powPminus2:e=>{let t=Lt,r=hr(e),n=X(r,BigInt(2),t);return U(n*e,t)},adjustScalarBytes:lr,randomBytes:oe}))();var di=(dr.ORDER-BigInt(3))/BigInt(4),xi=BigInt(156326);var tt=class{constructor(t,r,n){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:Nt}),this.key=r,this.type=n,this.algorithm={name:t},n==="public"&&(this.usages=[])}};var pt="X448",Qt=class extends bt{constructor(t){super(),Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,this._nPk=56,this._nSk=56}async serializePublicKey(t){return await this._serializePublicKey(t)}async deserializePublicKey(t){return await this._deserializePublicKey(t)}async importKey(t,r,n){if(t==="raw")return await this._importRawKey(r,n);if(r instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(r,n)}async derivePublicKey(t){return await this._derivePublicKey(t)}async generateKeyPair(){let t=pr.utils.randomPrivateKey(),r=new tt(pt,t,"private");return{publicKey:await this.derivePublicKey(r),privateKey:r}}async deriveKeyPair(t){let r=await this._hkdf.labeledExtract(rt,Re,new Uint8Array(t)),n=await this._hkdf.labeledExpand(r,Ge,rt,this._nSk),o=new tt(pt,new Uint8Array(n),"private");return{privateKey:o,publicKey:await this.derivePublicKey(o)}}async dh(t,r){return await this._dh(t,r)}_serializePublicKey(t){return new Promise(r=>{r(t.key.buffer)})}_deserializePublicKey(t){return new Promise((r,n)=>{t.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):r(new tt(pt,new Uint8Array(t),"public"))})}_importRawKey(t,r){return new Promise((n,o)=>{r&&t.byteLength!==this._nPk&&o(new Error("Invalid public key for the ciphersuite")),!r&&t.byteLength!==this._nSk&&o(new Error("Invalid private key for the ciphersuite")),n(new tt(pt,new Uint8Array(t),r?"public":"private"))})}_importJWK(t,r){return new Promise((n,o)=>{t.kty!=="OKP"&&o(new Error(`Invalid kty: ${t.kty}`)),t.crv!=="X448"&&o(new Error(`Invalid crv: ${t.crv}`)),r?(typeof t.d<"u"&&o(new Error("Invalid key: `d` should not be set")),typeof t.x!="string"&&o(new Error("Invalid key: `x` not found")),n(new tt(pt,le(t.x),"public"))):(typeof t.d!="string"&&o(new Error("Invalid key: `d` not found")),n(new tt(pt,le(t.d),"private")))})}_derivePublicKey(t){return new Promise(r=>{let n=_e.getPublicKey(t.key);r(new tt(pt,n,"public"))})}_dh(t,r){return new Promise((n,o)=>{try{n(_e.getSharedSecret(t.key,r.key).buffer)}catch(s){o(s)}})}};var Be=class extends Ft{constructor(){let t=new $t,r=new Qt(t);super(r,t),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:Ht.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}};export{Be as DhkemX448HkdfSha512};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed448.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
