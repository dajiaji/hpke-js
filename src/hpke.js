var us=Object.create;var Mr=Object.defineProperty;var cs=Object.getOwnPropertyDescriptor;var ls=Object.getOwnPropertyNames;var ds=Object.getPrototypeOf,ps=Object.prototype.hasOwnProperty;var Dr=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+i+'" is not supported')});var pt=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var bs=(i,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ls(e))!ps.call(i,s)&&s!==r&&Mr(i,s,{get:()=>e[s],enumerable:!(t=cs(e,s))||t.enumerable});return i};var Qt=(i,e,r)=>(r=i!=null?us(ds(i)):{},bs(e||!i||!i.__esModule?Mr(r,"default",{value:i,enumerable:!0}):r,i));var ai=pt(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});function vs(i,e){var r=i>>>16&65535,t=i&65535,s=e>>>16&65535,f=e&65535;return t*f+(r*f+t*s<<16>>>0)|0}At.mul=Math.imul||vs;function xs(i,e){return i+e|0}At.add=xs;function ms(i,e){return i-e|0}At.sub=ms;function gs(i,e){return i<<e|i>>>32-e}At.rotl=gs;function Es(i,e){return i<<32-e|i>>>e}At.rotr=Es;function Ss(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i}At.isInteger=Number.isInteger||Ss;At.MAX_SAFE_INTEGER=9007199254740991;At.isSafeInteger=function(i){return At.isInteger(i)&&i>=-At.MAX_SAFE_INTEGER&&i<=At.MAX_SAFE_INTEGER}});var re=pt(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});var oi=ai();function As(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])<<16>>16}F.readInt16BE=As;function Ps(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])>>>0}F.readUint16BE=Ps;function ks(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])<<16>>16}F.readInt16LE=ks;function Ls(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])>>>0}F.readUint16LE=Ls;function fi(i,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=i>>>8,e[r+1]=i>>>0,e}F.writeUint16BE=fi;F.writeInt16BE=fi;function hi(i,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=i>>>0,e[r+1]=i>>>8,e}F.writeUint16LE=hi;F.writeInt16LE=hi;function cr(i,e){return e===void 0&&(e=0),i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}F.readInt32BE=cr;function lr(i,e){return e===void 0&&(e=0),(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}F.readUint32BE=lr;function dr(i,e){return e===void 0&&(e=0),i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e]}F.readInt32LE=dr;function pr(i,e){return e===void 0&&(e=0),(i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e])>>>0}F.readUint32LE=pr;function Ue(i,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=i>>>24,e[r+1]=i>>>16,e[r+2]=i>>>8,e[r+3]=i>>>0,e}F.writeUint32BE=Ue;F.writeInt32BE=Ue;function Ie(i,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=i>>>0,e[r+1]=i>>>8,e[r+2]=i>>>16,e[r+3]=i>>>24,e}F.writeUint32LE=Ie;F.writeInt32LE=Ie;function Ts(i,e){e===void 0&&(e=0);var r=cr(i,e),t=cr(i,e+4);return r*4294967296+t-(t>>31)*4294967296}F.readInt64BE=Ts;function Ks(i,e){e===void 0&&(e=0);var r=lr(i,e),t=lr(i,e+4);return r*4294967296+t}F.readUint64BE=Ks;function Us(i,e){e===void 0&&(e=0);var r=dr(i,e),t=dr(i,e+4);return t*4294967296+r-(r>>31)*4294967296}F.readInt64LE=Us;function Is(i,e){e===void 0&&(e=0);var r=pr(i,e),t=pr(i,e+4);return t*4294967296+r}F.readUint64LE=Is;function ui(i,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Ue(i/4294967296>>>0,e,r),Ue(i>>>0,e,r+4),e}F.writeUint64BE=ui;F.writeInt64BE=ui;function ci(i,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Ie(i>>>0,e,r),Ie(i/4294967296>>>0,e,r+4),e}F.writeUint64LE=ci;F.writeInt64LE=ci;function Bs(i,e,r){if(r===void 0&&(r=0),i%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(i/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var t=0,s=1,f=i/8+r-1;f>=r;f--)t+=e[f]*s,s*=256;return t}F.readUintBE=Bs;function Hs(i,e,r){if(r===void 0&&(r=0),i%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(i/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var t=0,s=1,f=r;f<r+i/8;f++)t+=e[f]*s,s*=256;return t}F.readUintLE=Hs;function Ms(i,e,r,t){if(r===void 0&&(r=new Uint8Array(i/8)),t===void 0&&(t=0),i%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!oi.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,f=i/8+t-1;f>=t;f--)r[f]=e/s&255,s*=256;return r}F.writeUintBE=Ms;function Ds(i,e,r,t){if(r===void 0&&(r=new Uint8Array(i/8)),t===void 0&&(t=0),i%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!oi.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,f=t;f<t+i/8;f++)r[f]=e/s&255,s*=256;return r}F.writeUintLE=Ds;function Ns(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat32(e)}F.readFloat32BE=Ns;function Os(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat32(e,!0)}F.readFloat32LE=Os;function zs(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat64(e)}F.readFloat64BE=zs;function Rs(i,e){e===void 0&&(e=0);var r=new DataView(i.buffer,i.byteOffset,i.byteLength);return r.getFloat64(e,!0)}F.readFloat64LE=Rs;function Cs(i,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat32(r,i),e}F.writeFloat32BE=Cs;function js(i,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat32(r,i,!0),e}F.writeFloat32LE=js;function Gs(i,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat64(r,i),e}F.writeFloat64BE=Gs;function qs(i,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.setFloat64(r,i,!0),e}F.writeFloat64LE=qs});var Ht=pt(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});function Fs(i){for(var e=0;e<i.length;e++)i[e]=0;return i}br.wipe=Fs});var di=pt(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});var yt=re(),_r=Ht(),Vs=20;function Ys(i,e,r){for(var t=1634760805,s=857760878,f=2036477234,d=1797285236,u=r[3]<<24|r[2]<<16|r[1]<<8|r[0],_=r[7]<<24|r[6]<<16|r[5]<<8|r[4],x=r[11]<<24|r[10]<<16|r[9]<<8|r[8],U=r[15]<<24|r[14]<<16|r[13]<<8|r[12],P=r[19]<<24|r[18]<<16|r[17]<<8|r[16],k=r[23]<<24|r[22]<<16|r[21]<<8|r[20],b=r[27]<<24|r[26]<<16|r[25]<<8|r[24],H=r[31]<<24|r[30]<<16|r[29]<<8|r[28],T=e[3]<<24|e[2]<<16|e[1]<<8|e[0],D=e[7]<<24|e[6]<<16|e[5]<<8|e[4],M=e[11]<<24|e[10]<<16|e[9]<<8|e[8],N=e[15]<<24|e[14]<<16|e[13]<<8|e[12],L=t,I=s,O=f,z=d,c=u,l=_,K=x,B=U,m=P,w=k,v=b,g=H,C=T,R=D,S=M,j=N,J=0;J<Vs;J+=2)L=L+c|0,C^=L,C=C>>>32-16|C<<16,m=m+C|0,c^=m,c=c>>>32-12|c<<12,I=I+l|0,R^=I,R=R>>>32-16|R<<16,w=w+R|0,l^=w,l=l>>>32-12|l<<12,O=O+K|0,S^=O,S=S>>>32-16|S<<16,v=v+S|0,K^=v,K=K>>>32-12|K<<12,z=z+B|0,j^=z,j=j>>>32-16|j<<16,g=g+j|0,B^=g,B=B>>>32-12|B<<12,O=O+K|0,S^=O,S=S>>>32-8|S<<8,v=v+S|0,K^=v,K=K>>>32-7|K<<7,z=z+B|0,j^=z,j=j>>>32-8|j<<8,g=g+j|0,B^=g,B=B>>>32-7|B<<7,I=I+l|0,R^=I,R=R>>>32-8|R<<8,w=w+R|0,l^=w,l=l>>>32-7|l<<7,L=L+c|0,C^=L,C=C>>>32-8|C<<8,m=m+C|0,c^=m,c=c>>>32-7|c<<7,L=L+l|0,j^=L,j=j>>>32-16|j<<16,v=v+j|0,l^=v,l=l>>>32-12|l<<12,I=I+K|0,C^=I,C=C>>>32-16|C<<16,g=g+C|0,K^=g,K=K>>>32-12|K<<12,O=O+B|0,R^=O,R=R>>>32-16|R<<16,m=m+R|0,B^=m,B=B>>>32-12|B<<12,z=z+c|0,S^=z,S=S>>>32-16|S<<16,w=w+S|0,c^=w,c=c>>>32-12|c<<12,O=O+B|0,R^=O,R=R>>>32-8|R<<8,m=m+R|0,B^=m,B=B>>>32-7|B<<7,z=z+c|0,S^=z,S=S>>>32-8|S<<8,w=w+S|0,c^=w,c=c>>>32-7|c<<7,I=I+K|0,C^=I,C=C>>>32-8|C<<8,g=g+C|0,K^=g,K=K>>>32-7|K<<7,L=L+l|0,j^=L,j=j>>>32-8|j<<8,v=v+j|0,l^=v,l=l>>>32-7|l<<7;yt.writeUint32LE(L+t|0,i,0),yt.writeUint32LE(I+s|0,i,4),yt.writeUint32LE(O+f|0,i,8),yt.writeUint32LE(z+d|0,i,12),yt.writeUint32LE(c+u|0,i,16),yt.writeUint32LE(l+_|0,i,20),yt.writeUint32LE(K+x|0,i,24),yt.writeUint32LE(B+U|0,i,28),yt.writeUint32LE(m+P|0,i,32),yt.writeUint32LE(w+k|0,i,36),yt.writeUint32LE(v+b|0,i,40),yt.writeUint32LE(g+H|0,i,44),yt.writeUint32LE(C+T|0,i,48),yt.writeUint32LE(R+D|0,i,52),yt.writeUint32LE(S+M|0,i,56),yt.writeUint32LE(j+N|0,i,60)}function li(i,e,r,t,s){if(s===void 0&&(s=0),i.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(t.length<r.length)throw new Error("ChaCha: destination is shorter than source");var f,d;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");f=new Uint8Array(16),d=f.length-e.length,f.set(e,d)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");f=e,d=s}for(var u=new Uint8Array(64),_=0;_<r.length;_+=64){Ys(u,f,i);for(var x=_;x<_+64&&x<r.length;x++)t[x]=r[x]^u[x-_];Zs(f,0,d)}return _r.wipe(u),s===0&&_r.wipe(f),t}Be.streamXOR=li;function Xs(i,e,r,t){return t===void 0&&(t=0),_r.wipe(r),li(i,e,r,r,t)}Be.stream=Xs;function Zs(i,e,r){for(var t=1;r--;)t=t+(i[e]&255)|0,i[e]=t&255,t>>>=8,e++;if(t>0)throw new Error("ChaCha: counter overflow")}});var He=pt(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});function Ws(i,e,r){return~(i-1)&e|i-1&r}ie.select=Ws;function $s(i,e){return(i|0)-(e|0)-1>>>31&1}ie.lessOrEqual=$s;function pi(i,e){if(i.length!==e.length)return 0;for(var r=0,t=0;t<i.length;t++)r|=i[t]^e[t];return 1&r-1>>>8}ie.compare=pi;function Qs(i,e){return i.length===0||e.length===0?!1:pi(i,e)!==0}ie.equal=Qs});var _i=pt(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});var Js=He(),Me=Ht();Ot.DIGEST_LENGTH=16;var bi=function(){function i(e){this.digestLength=Ot.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var r=e[0]|e[1]<<8;this._r[0]=r&8191;var t=e[2]|e[3]<<8;this._r[1]=(r>>>13|t<<3)&8191;var s=e[4]|e[5]<<8;this._r[2]=(t>>>10|s<<6)&7939;var f=e[6]|e[7]<<8;this._r[3]=(s>>>7|f<<9)&8191;var d=e[8]|e[9]<<8;this._r[4]=(f>>>4|d<<12)&255,this._r[5]=d>>>1&8190;var u=e[10]|e[11]<<8;this._r[6]=(d>>>14|u<<2)&8191;var _=e[12]|e[13]<<8;this._r[7]=(u>>>11|_<<5)&8065;var x=e[14]|e[15]<<8;this._r[8]=(_>>>8|x<<8)&8191,this._r[9]=x>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return i.prototype._blocks=function(e,r,t){for(var s=this._fin?0:2048,f=this._h[0],d=this._h[1],u=this._h[2],_=this._h[3],x=this._h[4],U=this._h[5],P=this._h[6],k=this._h[7],b=this._h[8],H=this._h[9],T=this._r[0],D=this._r[1],M=this._r[2],N=this._r[3],L=this._r[4],I=this._r[5],O=this._r[6],z=this._r[7],c=this._r[8],l=this._r[9];t>=16;){var K=e[r+0]|e[r+1]<<8;f+=K&8191;var B=e[r+2]|e[r+3]<<8;d+=(K>>>13|B<<3)&8191;var m=e[r+4]|e[r+5]<<8;u+=(B>>>10|m<<6)&8191;var w=e[r+6]|e[r+7]<<8;_+=(m>>>7|w<<9)&8191;var v=e[r+8]|e[r+9]<<8;x+=(w>>>4|v<<12)&8191,U+=v>>>1&8191;var g=e[r+10]|e[r+11]<<8;P+=(v>>>14|g<<2)&8191;var C=e[r+12]|e[r+13]<<8;k+=(g>>>11|C<<5)&8191;var R=e[r+14]|e[r+15]<<8;b+=(C>>>8|R<<8)&8191,H+=R>>>5|s;var S=0,j=S;j+=f*T,j+=d*(5*l),j+=u*(5*c),j+=_*(5*z),j+=x*(5*O),S=j>>>13,j&=8191,j+=U*(5*I),j+=P*(5*L),j+=k*(5*N),j+=b*(5*M),j+=H*(5*D),S+=j>>>13,j&=8191;var J=S;J+=f*D,J+=d*T,J+=u*(5*l),J+=_*(5*c),J+=x*(5*z),S=J>>>13,J&=8191,J+=U*(5*O),J+=P*(5*I),J+=k*(5*L),J+=b*(5*N),J+=H*(5*M),S+=J>>>13,J&=8191;var G=S;G+=f*M,G+=d*D,G+=u*T,G+=_*(5*l),G+=x*(5*c),S=G>>>13,G&=8191,G+=U*(5*z),G+=P*(5*O),G+=k*(5*I),G+=b*(5*L),G+=H*(5*N),S+=G>>>13,G&=8191;var Y=S;Y+=f*N,Y+=d*M,Y+=u*D,Y+=_*T,Y+=x*(5*l),S=Y>>>13,Y&=8191,Y+=U*(5*c),Y+=P*(5*z),Y+=k*(5*O),Y+=b*(5*I),Y+=H*(5*L),S+=Y>>>13,Y&=8191;var X=S;X+=f*L,X+=d*N,X+=u*M,X+=_*D,X+=x*T,S=X>>>13,X&=8191,X+=U*(5*l),X+=P*(5*c),X+=k*(5*z),X+=b*(5*O),X+=H*(5*I),S+=X>>>13,X&=8191;var Z=S;Z+=f*I,Z+=d*L,Z+=u*N,Z+=_*M,Z+=x*D,S=Z>>>13,Z&=8191,Z+=U*T,Z+=P*(5*l),Z+=k*(5*c),Z+=b*(5*z),Z+=H*(5*O),S+=Z>>>13,Z&=8191;var V=S;V+=f*O,V+=d*I,V+=u*L,V+=_*N,V+=x*M,S=V>>>13,V&=8191,V+=U*D,V+=P*T,V+=k*(5*l),V+=b*(5*c),V+=H*(5*z),S+=V>>>13,V&=8191;var W=S;W+=f*z,W+=d*O,W+=u*I,W+=_*L,W+=x*N,S=W>>>13,W&=8191,W+=U*M,W+=P*D,W+=k*T,W+=b*(5*l),W+=H*(5*c),S+=W>>>13,W&=8191;var $=S;$+=f*c,$+=d*z,$+=u*O,$+=_*I,$+=x*L,S=$>>>13,$&=8191,$+=U*N,$+=P*M,$+=k*D,$+=b*T,$+=H*(5*l),S+=$>>>13,$&=8191;var q=S;q+=f*l,q+=d*c,q+=u*z,q+=_*O,q+=x*I,S=q>>>13,q&=8191,q+=U*L,q+=P*N,q+=k*M,q+=b*D,q+=H*T,S+=q>>>13,q&=8191,S=(S<<2)+S|0,S=S+j|0,j=S&8191,S=S>>>13,J+=S,f=j,d=J,u=G,_=Y,x=X,U=Z,P=V,k=W,b=$,H=q,r+=16,t-=16}this._h[0]=f,this._h[1]=d,this._h[2]=u,this._h[3]=_,this._h[4]=x,this._h[5]=U,this._h[6]=P,this._h[7]=k,this._h[8]=b,this._h[9]=H},i.prototype.finish=function(e,r){r===void 0&&(r=0);var t=new Uint16Array(10),s,f,d,u;if(this._leftover){for(u=this._leftover,this._buffer[u++]=1;u<16;u++)this._buffer[u]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(s=this._h[1]>>>13,this._h[1]&=8191,u=2;u<10;u++)this._h[u]+=s,s=this._h[u]>>>13,this._h[u]&=8191;for(this._h[0]+=s*5,s=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=s,s=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=s,t[0]=this._h[0]+5,s=t[0]>>>13,t[0]&=8191,u=1;u<10;u++)t[u]=this._h[u]+s,s=t[u]>>>13,t[u]&=8191;for(t[9]-=1<<13,f=(s^1)-1,u=0;u<10;u++)t[u]&=f;for(f=~f,u=0;u<10;u++)this._h[u]=this._h[u]&f|t[u];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,d=this._h[0]+this._pad[0],this._h[0]=d&65535,u=1;u<8;u++)d=(this._h[u]+this._pad[u]|0)+(d>>>16)|0,this._h[u]=d&65535;return e[r+0]=this._h[0]>>>0,e[r+1]=this._h[0]>>>8,e[r+2]=this._h[1]>>>0,e[r+3]=this._h[1]>>>8,e[r+4]=this._h[2]>>>0,e[r+5]=this._h[2]>>>8,e[r+6]=this._h[3]>>>0,e[r+7]=this._h[3]>>>8,e[r+8]=this._h[4]>>>0,e[r+9]=this._h[4]>>>8,e[r+10]=this._h[5]>>>0,e[r+11]=this._h[5]>>>8,e[r+12]=this._h[6]>>>0,e[r+13]=this._h[6]>>>8,e[r+14]=this._h[7]>>>0,e[r+15]=this._h[7]>>>8,this._finished=!0,this},i.prototype.update=function(e){var r=0,t=e.length,s;if(this._leftover){s=16-this._leftover,s>t&&(s=t);for(var f=0;f<s;f++)this._buffer[this._leftover+f]=e[r+f];if(t-=s,r+=s,this._leftover+=s,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(t>=16&&(s=t-t%16,this._blocks(e,r,s),r+=s,t-=s),t){for(var f=0;f<t;f++)this._buffer[this._leftover+f]=e[r+f];this._leftover+=t}return this},i.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},i.prototype.clean=function(){return Me.wipe(this._buffer),Me.wipe(this._r),Me.wipe(this._h),Me.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},i}();Ot.Poly1305=bi;function ta(i,e){var r=new bi(i);r.update(e);var t=r.digest();return r.clean(),t}Ot.oneTimeAuth=ta;function ea(i,e){return i.length!==Ot.DIGEST_LENGTH||e.length!==Ot.DIGEST_LENGTH?!1:Js.equal(i,e)}Ot.equal=ea});var vi=pt(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});var De=di(),ra=_i(),_e=Ht(),yi=re(),ia=He();zt.KEY_LENGTH=32;zt.NONCE_LENGTH=12;zt.TAG_LENGTH=16;var wi=new Uint8Array(16),na=function(){function i(e){if(this.nonceLength=zt.NONCE_LENGTH,this.tagLength=zt.TAG_LENGTH,e.length!==zt.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return i.prototype.seal=function(e,r,t,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var f=new Uint8Array(16);f.set(e,f.length-e.length);var d=new Uint8Array(32);De.stream(this._key,f,d,4);var u=r.length+this.tagLength,_;if(s){if(s.length!==u)throw new Error("ChaCha20Poly1305: incorrect destination length");_=s}else _=new Uint8Array(u);return De.streamXOR(this._key,f,r,_,4),this._authenticate(_.subarray(_.length-this.tagLength,_.length),d,_.subarray(0,_.length-this.tagLength),t),_e.wipe(f),_},i.prototype.open=function(e,r,t,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(r.length<this.tagLength)return null;var f=new Uint8Array(16);f.set(e,f.length-e.length);var d=new Uint8Array(32);De.stream(this._key,f,d,4);var u=new Uint8Array(this.tagLength);if(this._authenticate(u,d,r.subarray(0,r.length-this.tagLength),t),!ia.equal(u,r.subarray(r.length-this.tagLength,r.length)))return null;var _=r.length-this.tagLength,x;if(s){if(s.length!==_)throw new Error("ChaCha20Poly1305: incorrect destination length");x=s}else x=new Uint8Array(_);return De.streamXOR(this._key,f,r.subarray(0,r.length-this.tagLength),x,4),_e.wipe(f),x},i.prototype.clean=function(){return _e.wipe(this._key),this},i.prototype._authenticate=function(e,r,t,s){var f=new ra.Poly1305(r);s&&(f.update(s),s.length%16>0&&f.update(wi.subarray(s.length%16))),f.update(t),t.length%16>0&&f.update(wi.subarray(t.length%16));var d=new Uint8Array(8);s&&yi.writeUint64LE(s.length,d),f.update(d),yi.writeUint64LE(t.length,d),f.update(d);for(var u=f.digest(),_=0;_<u.length;_++)e[_]=u[_];f.clean(),_e.wipe(u),_e.wipe(d)},i}();zt.ChaCha20Poly1305=na});var mi=pt(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});function sa(i){return typeof i.saveState<"u"&&typeof i.restoreState<"u"&&typeof i.cleanSavedState<"u"}yr.isSerializableHash=sa});var Ei=pt(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});var Mt=mi(),aa=He(),oa=Ht(),gi=function(){function i(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var t=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(t).clean():t.set(r);for(var s=0;s<t.length;s++)t[s]^=54;this._inner.update(t);for(var s=0;s<t.length;s++)t[s]^=106;this._outer.update(t),Mt.isSerializableHash(this._inner)&&Mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),oa.wipe(t)}return i.prototype.reset=function(){if(!Mt.isSerializableHash(this._inner)||!Mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.clean=function(){Mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},i.prototype.update=function(e){return this._inner.update(e),this},i.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(!Mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},i.prototype.restoreState=function(e){if(!Mt.isSerializableHash(this._inner)||!Mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.cleanSavedState=function(e){if(!Mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},i}();ye.HMAC=gi;function fa(i,e,r){var t=new gi(i,e);t.update(r);var s=t.digest();return t.clean(),s}ye.hmac=fa;ye.equal=aa.equal});var Ai=pt(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});var Re=re(),ze=Ht();Vt.DIGEST_LENGTH=32;Vt.BLOCK_SIZE=64;var Si=function(){function i(){this.digestLength=Vt.DIGEST_LENGTH,this.blockSize=Vt.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return i.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},i.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},i.prototype.clean=function(){ze.wipe(this._buffer),ze.wipe(this._temp),this.reset()},i.prototype.update=function(e,r){if(r===void 0&&(r=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var t=0;if(this._bytesHashed+=r,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&r>0;)this._buffer[this._bufferLength++]=e[t++],r--;this._bufferLength===this.blockSize&&(wr(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(r>=this.blockSize&&(t=wr(this._temp,this._state,e,t,r),r%=this.blockSize);r>0;)this._buffer[this._bufferLength++]=e[t++],r--;return this},i.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,t=this._bufferLength,s=r/536870912|0,f=r<<3,d=r%64<56?64:128;this._buffer[t]=128;for(var u=t+1;u<d-8;u++)this._buffer[u]=0;Re.writeUint32BE(s,this._buffer,d-8),Re.writeUint32BE(f,this._buffer,d-4),wr(this._temp,this._state,this._buffer,0,d),this._finished=!0}for(var u=0;u<this.digestLength/4;u++)Re.writeUint32BE(this._state[u],e,u*4);return this},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},i.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},i.prototype.cleanSavedState=function(e){ze.wipe(e.state),e.buffer&&ze.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},i}();Vt.SHA256=Si;var ha=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function wr(i,e,r,t,s){for(;s>=64;){for(var f=e[0],d=e[1],u=e[2],_=e[3],x=e[4],U=e[5],P=e[6],k=e[7],b=0;b<16;b++){var H=t+b*4;i[b]=Re.readUint32BE(r,H)}for(var b=16;b<64;b++){var T=i[b-2],D=(T>>>17|T<<32-17)^(T>>>19|T<<32-19)^T>>>10;T=i[b-15];var M=(T>>>7|T<<32-7)^(T>>>18|T<<32-18)^T>>>3;i[b]=(D+i[b-7]|0)+(M+i[b-16]|0)}for(var b=0;b<64;b++){var D=(((x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7))+(x&U^~x&P)|0)+(k+(ha[b]+i[b]|0)|0)|0,M=((f>>>2|f<<32-2)^(f>>>13|f<<32-13)^(f>>>22|f<<32-22))+(f&d^f&u^d&u)|0;k=P,P=U,U=x,x=_+D|0,_=u,u=d,d=f,f=D+M|0}e[0]+=f,e[1]+=d,e[2]+=u,e[3]+=_,e[4]+=x,e[5]+=U,e[6]+=P,e[7]+=k,t+=64,s-=64}return t}function ua(i){var e=new Si;e.update(i);var r=e.digest();return e.clean(),r}Vt.hash=ua});var Li=pt(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});var ae=re(),se=Ht();Rt.DIGEST_LENGTH=64;Rt.BLOCK_SIZE=128;var ki=function(){function i(){this.digestLength=Rt.DIGEST_LENGTH,this.blockSize=Rt.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return i.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},i.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},i.prototype.clean=function(){se.wipe(this._buffer),se.wipe(this._tempHi),se.wipe(this._tempLo),this.reset()},i.prototype.update=function(e,r){if(r===void 0&&(r=e.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var t=0;if(this._bytesHashed+=r,this._bufferLength>0){for(;this._bufferLength<Rt.BLOCK_SIZE&&r>0;)this._buffer[this._bufferLength++]=e[t++],r--;this._bufferLength===this.blockSize&&(vr(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(r>=this.blockSize&&(t=vr(this._tempHi,this._tempLo,this._stateHi,this._stateLo,e,t,r),r%=this.blockSize);r>0;)this._buffer[this._bufferLength++]=e[t++],r--;return this},i.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,t=this._bufferLength,s=r/536870912|0,f=r<<3,d=r%128<112?128:256;this._buffer[t]=128;for(var u=t+1;u<d-8;u++)this._buffer[u]=0;ae.writeUint32BE(s,this._buffer,d-8),ae.writeUint32BE(f,this._buffer,d-4),vr(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,d),this._finished=!0}for(var u=0;u<this.digestLength/8;u++)ae.writeUint32BE(this._stateHi[u],e,u*8),ae.writeUint32BE(this._stateLo[u],e,u*8+4);return this},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},i.prototype.restoreState=function(e){return this._stateHi.set(e.stateHi),this._stateLo.set(e.stateLo),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},i.prototype.cleanSavedState=function(e){se.wipe(e.stateHi),se.wipe(e.stateLo),e.buffer&&se.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},i}();Rt.SHA512=ki;var Pi=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function vr(i,e,r,t,s,f,d){for(var u=r[0],_=r[1],x=r[2],U=r[3],P=r[4],k=r[5],b=r[6],H=r[7],T=t[0],D=t[1],M=t[2],N=t[3],L=t[4],I=t[5],O=t[6],z=t[7],c,l,K,B,m,w,v,g;d>=128;){for(var C=0;C<16;C++){var R=8*C+f;i[C]=ae.readUint32BE(s,R),e[C]=ae.readUint32BE(s,R+4)}for(var C=0;C<80;C++){var S=u,j=_,J=x,G=U,Y=P,X=k,Z=b,V=H,W=T,$=D,q=M,rt=N,at=L,ot=I,ft=O,nt=z;if(c=H,l=z,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=(P>>>14|L<<32-14)^(P>>>18|L<<32-18)^(L>>>41-32|P<<32-(41-32)),l=(L>>>14|P<<32-14)^(L>>>18|P<<32-18)^(P>>>41-32|L<<32-(41-32)),m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,c=P&k^~P&b,l=L&I^~L&O,m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,c=Pi[C*2],l=Pi[C*2+1],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,c=i[C%16],l=e[C%16],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,K=v&65535|g<<16,B=m&65535|w<<16,c=K,l=B,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=(u>>>28|T<<32-28)^(T>>>34-32|u<<32-(34-32))^(T>>>39-32|u<<32-(39-32)),l=(T>>>28|u<<32-28)^(u>>>34-32|T<<32-(34-32))^(u>>>39-32|T<<32-(39-32)),m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,c=u&_^u&x^_&x,l=T&D^T&M^D&M,m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,V=v&65535|g<<16,nt=m&65535|w<<16,c=G,l=rt,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=K,l=B,m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,G=v&65535|g<<16,rt=m&65535|w<<16,_=S,x=j,U=J,P=G,k=Y,b=X,H=Z,u=V,D=W,M=$,N=q,L=rt,I=at,O=ot,z=ft,T=nt,C%16===15)for(var R=0;R<16;R++)c=i[R],l=e[R],m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=i[(R+9)%16],l=e[(R+9)%16],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,K=i[(R+1)%16],B=e[(R+1)%16],c=(K>>>1|B<<32-1)^(K>>>8|B<<32-8)^K>>>7,l=(B>>>1|K<<32-1)^(B>>>8|K<<32-8)^(B>>>7|K<<32-7),m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,K=i[(R+14)%16],B=e[(R+14)%16],c=(K>>>19|B<<32-19)^(B>>>61-32|K<<32-(61-32))^K>>>6,l=(B>>>19|K<<32-19)^(K>>>61-32|B<<32-(61-32))^(B>>>6|K<<32-6),m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,i[R]=v&65535|g<<16,e[R]=m&65535|w<<16}c=u,l=T,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[0],l=t[0],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[0]=u=v&65535|g<<16,t[0]=T=m&65535|w<<16,c=_,l=D,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[1],l=t[1],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[1]=_=v&65535|g<<16,t[1]=D=m&65535|w<<16,c=x,l=M,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[2],l=t[2],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[2]=x=v&65535|g<<16,t[2]=M=m&65535|w<<16,c=U,l=N,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[3],l=t[3],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[3]=U=v&65535|g<<16,t[3]=N=m&65535|w<<16,c=P,l=L,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[4],l=t[4],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[4]=P=v&65535|g<<16,t[4]=L=m&65535|w<<16,c=k,l=I,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[5],l=t[5],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[5]=k=v&65535|g<<16,t[5]=I=m&65535|w<<16,c=b,l=O,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[6],l=t[6],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[6]=b=v&65535|g<<16,t[6]=O=m&65535|w<<16,c=H,l=z,m=l&65535,w=l>>>16,v=c&65535,g=c>>>16,c=r[7],l=t[7],m+=l&65535,w+=l>>>16,v+=c&65535,g+=c>>>16,w+=m>>>16,v+=w>>>16,g+=v>>>16,r[7]=H=v&65535|g<<16,t[7]=z=m&65535|w<<16,f+=128,d-=128}return f}function ca(i){var e=new ki;e.update(i);var r=e.digest();return e.clean(),r}Rt.hash=ca});var Ii=pt(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.BrowserRandomSource=void 0;var Ui=65536,mr=class{constructor(){this.isAvailable=!1,this.isInstantiated=!1;let e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");let r=new Uint8Array(e);for(let t=0;t<r.length;t+=Ui)this._crypto.getRandomValues(r.subarray(t,t+Math.min(r.length-t,Ui)));return r}};je.BrowserRandomSource=mr});var Bi=pt(()=>{});var Hi=pt(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.NodeRandomSource=void 0;var ba=Ht(),gr=class{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Dr<"u"){let e=Bi();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");let t=new Uint8Array(e);for(let s=0;s<t.length;s++)t[s]=r[s];return(0,ba.wipe)(r),t}};Ge.NodeRandomSource=gr});var Mi=pt(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.SystemRandomSource=void 0;var _a=Ii(),ya=Hi(),Er=class{constructor(){if(this.isAvailable=!1,this.name="",this._source=new _a.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new ya.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}};qe.SystemRandomSource=Er});var zi=pt(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.randomStringForEntropy=wt.randomString=wt.randomUint32=wt.randomBytes=wt.defaultRandomSource=void 0;var wa=Mi(),va=re(),Di=Ht();wt.defaultRandomSource=new wa.SystemRandomSource;function Sr(i,e=wt.defaultRandomSource){return e.randomBytes(i)}wt.randomBytes=Sr;function xa(i=wt.defaultRandomSource){let e=Sr(4,i),r=(0,va.readUint32LE)(e);return(0,Di.wipe)(e),r}wt.randomUint32=xa;var Ni="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Oi(i,e=Ni,r=wt.defaultRandomSource){if(e.length<2)throw new Error("randomString charset is too short");if(e.length>256)throw new Error("randomString charset is too long");let t="",s=e.length,f=256-256%s;for(;i>0;){let d=Sr(Math.ceil(i*256/f),r);for(let u=0;u<d.length&&i>0;u++){let _=d[u];_<f&&(t+=e.charAt(_%s),i--)}(0,Di.wipe)(d)}return t}wt.randomString=Oi;function ma(i,e=Ni,r=wt.defaultRandomSource){let t=Math.ceil(i/(Math.log(e.length)/Math.LN2));return Oi(t,e,r)}wt.randomStringForEntropy=ma});var Gi=pt(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.sharedKey=it.generateKeyPair=it.generateKeyPairFromSeed=it.scalarMultBase=it.scalarMult=it.SHARED_KEY_LENGTH=it.SECRET_KEY_LENGTH=it.PUBLIC_KEY_LENGTH=void 0;var ga=zi(),Ea=Ht();it.PUBLIC_KEY_LENGTH=32;it.SECRET_KEY_LENGTH=32;it.SHARED_KEY_LENGTH=32;function Dt(i){let e=new Float64Array(16);if(i)for(let r=0;r<i.length;r++)e[r]=i[r];return e}var Ri=new Uint8Array(32);Ri[0]=9;var Sa=Dt([56129,1]);function Ar(i){let e=1;for(let r=0;r<16;r++){let t=i[r]+e+65535;e=Math.floor(t/65536),i[r]=t-e*65536}i[0]+=e-1+37*(e-1)}function we(i,e,r){let t=~(r-1);for(let s=0;s<16;s++){let f=t&(i[s]^e[s]);i[s]^=f,e[s]^=f}}function Aa(i,e){let r=Dt(),t=Dt();for(let s=0;s<16;s++)t[s]=e[s];Ar(t),Ar(t),Ar(t);for(let s=0;s<2;s++){r[0]=t[0]-65517;for(let d=1;d<15;d++)r[d]=t[d]-65535-(r[d-1]>>16&1),r[d-1]&=65535;r[15]=t[15]-32767-(r[14]>>16&1);let f=r[15]>>16&1;r[14]&=65535,we(t,r,1-f)}for(let s=0;s<16;s++)i[2*s]=t[s]&255,i[2*s+1]=t[s]>>8}function Pa(i,e){for(let r=0;r<16;r++)i[r]=e[2*r]+(e[2*r+1]<<8);i[15]&=32767}function Fe(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]+r[t]}function Ve(i,e,r){for(let t=0;t<16;t++)i[t]=e[t]-r[t]}function Ct(i,e,r){let t,s,f=0,d=0,u=0,_=0,x=0,U=0,P=0,k=0,b=0,H=0,T=0,D=0,M=0,N=0,L=0,I=0,O=0,z=0,c=0,l=0,K=0,B=0,m=0,w=0,v=0,g=0,C=0,R=0,S=0,j=0,J=0,G=r[0],Y=r[1],X=r[2],Z=r[3],V=r[4],W=r[5],$=r[6],q=r[7],rt=r[8],at=r[9],ot=r[10],ft=r[11],nt=r[12],ht=r[13],ut=r[14],ct=r[15];t=e[0],f+=t*G,d+=t*Y,u+=t*X,_+=t*Z,x+=t*V,U+=t*W,P+=t*$,k+=t*q,b+=t*rt,H+=t*at,T+=t*ot,D+=t*ft,M+=t*nt,N+=t*ht,L+=t*ut,I+=t*ct,t=e[1],d+=t*G,u+=t*Y,_+=t*X,x+=t*Z,U+=t*V,P+=t*W,k+=t*$,b+=t*q,H+=t*rt,T+=t*at,D+=t*ot,M+=t*ft,N+=t*nt,L+=t*ht,I+=t*ut,O+=t*ct,t=e[2],u+=t*G,_+=t*Y,x+=t*X,U+=t*Z,P+=t*V,k+=t*W,b+=t*$,H+=t*q,T+=t*rt,D+=t*at,M+=t*ot,N+=t*ft,L+=t*nt,I+=t*ht,O+=t*ut,z+=t*ct,t=e[3],_+=t*G,x+=t*Y,U+=t*X,P+=t*Z,k+=t*V,b+=t*W,H+=t*$,T+=t*q,D+=t*rt,M+=t*at,N+=t*ot,L+=t*ft,I+=t*nt,O+=t*ht,z+=t*ut,c+=t*ct,t=e[4],x+=t*G,U+=t*Y,P+=t*X,k+=t*Z,b+=t*V,H+=t*W,T+=t*$,D+=t*q,M+=t*rt,N+=t*at,L+=t*ot,I+=t*ft,O+=t*nt,z+=t*ht,c+=t*ut,l+=t*ct,t=e[5],U+=t*G,P+=t*Y,k+=t*X,b+=t*Z,H+=t*V,T+=t*W,D+=t*$,M+=t*q,N+=t*rt,L+=t*at,I+=t*ot,O+=t*ft,z+=t*nt,c+=t*ht,l+=t*ut,K+=t*ct,t=e[6],P+=t*G,k+=t*Y,b+=t*X,H+=t*Z,T+=t*V,D+=t*W,M+=t*$,N+=t*q,L+=t*rt,I+=t*at,O+=t*ot,z+=t*ft,c+=t*nt,l+=t*ht,K+=t*ut,B+=t*ct,t=e[7],k+=t*G,b+=t*Y,H+=t*X,T+=t*Z,D+=t*V,M+=t*W,N+=t*$,L+=t*q,I+=t*rt,O+=t*at,z+=t*ot,c+=t*ft,l+=t*nt,K+=t*ht,B+=t*ut,m+=t*ct,t=e[8],b+=t*G,H+=t*Y,T+=t*X,D+=t*Z,M+=t*V,N+=t*W,L+=t*$,I+=t*q,O+=t*rt,z+=t*at,c+=t*ot,l+=t*ft,K+=t*nt,B+=t*ht,m+=t*ut,w+=t*ct,t=e[9],H+=t*G,T+=t*Y,D+=t*X,M+=t*Z,N+=t*V,L+=t*W,I+=t*$,O+=t*q,z+=t*rt,c+=t*at,l+=t*ot,K+=t*ft,B+=t*nt,m+=t*ht,w+=t*ut,v+=t*ct,t=e[10],T+=t*G,D+=t*Y,M+=t*X,N+=t*Z,L+=t*V,I+=t*W,O+=t*$,z+=t*q,c+=t*rt,l+=t*at,K+=t*ot,B+=t*ft,m+=t*nt,w+=t*ht,v+=t*ut,g+=t*ct,t=e[11],D+=t*G,M+=t*Y,N+=t*X,L+=t*Z,I+=t*V,O+=t*W,z+=t*$,c+=t*q,l+=t*rt,K+=t*at,B+=t*ot,m+=t*ft,w+=t*nt,v+=t*ht,g+=t*ut,C+=t*ct,t=e[12],M+=t*G,N+=t*Y,L+=t*X,I+=t*Z,O+=t*V,z+=t*W,c+=t*$,l+=t*q,K+=t*rt,B+=t*at,m+=t*ot,w+=t*ft,v+=t*nt,g+=t*ht,C+=t*ut,R+=t*ct,t=e[13],N+=t*G,L+=t*Y,I+=t*X,O+=t*Z,z+=t*V,c+=t*W,l+=t*$,K+=t*q,B+=t*rt,m+=t*at,w+=t*ot,v+=t*ft,g+=t*nt,C+=t*ht,R+=t*ut,S+=t*ct,t=e[14],L+=t*G,I+=t*Y,O+=t*X,z+=t*Z,c+=t*V,l+=t*W,K+=t*$,B+=t*q,m+=t*rt,w+=t*at,v+=t*ot,g+=t*ft,C+=t*nt,R+=t*ht,S+=t*ut,j+=t*ct,t=e[15],I+=t*G,O+=t*Y,z+=t*X,c+=t*Z,l+=t*V,K+=t*W,B+=t*$,m+=t*q,w+=t*rt,v+=t*at,g+=t*ot,C+=t*ft,R+=t*nt,S+=t*ht,j+=t*ut,J+=t*ct,f+=38*O,d+=38*z,u+=38*c,_+=38*l,x+=38*K,U+=38*B,P+=38*m,k+=38*w,b+=38*v,H+=38*g,T+=38*C,D+=38*R,M+=38*S,N+=38*j,L+=38*J,s=1,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=u+s+65535,s=Math.floor(t/65536),u=t-s*65536,t=_+s+65535,s=Math.floor(t/65536),_=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=U+s+65535,s=Math.floor(t/65536),U=t-s*65536,t=P+s+65535,s=Math.floor(t/65536),P=t-s*65536,t=k+s+65535,s=Math.floor(t/65536),k=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=H+s+65535,s=Math.floor(t/65536),H=t-s*65536,t=T+s+65535,s=Math.floor(t/65536),T=t-s*65536,t=D+s+65535,s=Math.floor(t/65536),D=t-s*65536,t=M+s+65535,s=Math.floor(t/65536),M=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,f+=s-1+37*(s-1),s=1,t=f+s+65535,s=Math.floor(t/65536),f=t-s*65536,t=d+s+65535,s=Math.floor(t/65536),d=t-s*65536,t=u+s+65535,s=Math.floor(t/65536),u=t-s*65536,t=_+s+65535,s=Math.floor(t/65536),_=t-s*65536,t=x+s+65535,s=Math.floor(t/65536),x=t-s*65536,t=U+s+65535,s=Math.floor(t/65536),U=t-s*65536,t=P+s+65535,s=Math.floor(t/65536),P=t-s*65536,t=k+s+65535,s=Math.floor(t/65536),k=t-s*65536,t=b+s+65535,s=Math.floor(t/65536),b=t-s*65536,t=H+s+65535,s=Math.floor(t/65536),H=t-s*65536,t=T+s+65535,s=Math.floor(t/65536),T=t-s*65536,t=D+s+65535,s=Math.floor(t/65536),D=t-s*65536,t=M+s+65535,s=Math.floor(t/65536),M=t-s*65536,t=N+s+65535,s=Math.floor(t/65536),N=t-s*65536,t=L+s+65535,s=Math.floor(t/65536),L=t-s*65536,t=I+s+65535,s=Math.floor(t/65536),I=t-s*65536,f+=s-1+37*(s-1),i[0]=f,i[1]=d,i[2]=u,i[3]=_,i[4]=x,i[5]=U,i[6]=P,i[7]=k,i[8]=b,i[9]=H,i[10]=T,i[11]=D,i[12]=M,i[13]=N,i[14]=L,i[15]=I}function ve(i,e){Ct(i,e,e)}function ka(i,e){let r=Dt();for(let t=0;t<16;t++)r[t]=e[t];for(let t=253;t>=0;t--)ve(r,r),t!==2&&t!==4&&Ct(r,r,e);for(let t=0;t<16;t++)i[t]=r[t]}function Pr(i,e){let r=new Uint8Array(32),t=new Float64Array(80),s=Dt(),f=Dt(),d=Dt(),u=Dt(),_=Dt(),x=Dt();for(let b=0;b<31;b++)r[b]=i[b];r[31]=i[31]&127|64,r[0]&=248,Pa(t,e);for(let b=0;b<16;b++)f[b]=t[b];s[0]=u[0]=1;for(let b=254;b>=0;--b){let H=r[b>>>3]>>>(b&7)&1;we(s,f,H),we(d,u,H),Fe(_,s,d),Ve(s,s,d),Fe(d,f,u),Ve(f,f,u),ve(u,_),ve(x,s),Ct(s,d,s),Ct(d,f,_),Fe(_,s,d),Ve(s,s,d),ve(f,s),Ve(d,u,x),Ct(s,d,Sa),Fe(s,s,u),Ct(d,d,s),Ct(s,u,x),Ct(u,f,t),ve(f,_),we(s,f,H),we(d,u,H)}for(let b=0;b<16;b++)t[b+16]=s[b],t[b+32]=d[b],t[b+48]=f[b],t[b+64]=u[b];let U=t.subarray(32),P=t.subarray(16);ka(U,U),Ct(P,P,U);let k=new Uint8Array(32);return Aa(k,P),k}it.scalarMult=Pr;function Ci(i){return Pr(i,Ri)}it.scalarMultBase=Ci;function ji(i){if(i.length!==it.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${it.SECRET_KEY_LENGTH} bytes`);let e=new Uint8Array(i);return{publicKey:Ci(e),secretKey:e}}it.generateKeyPairFromSeed=ji;function La(i){let e=(0,ga.randomBytes)(32,i),r=ji(e);return(0,Ea.wipe)(e),r}it.generateKeyPair=La;function Ta(i,e,r=!1){if(i.length!==it.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(e.length!==it.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");let t=Pr(i,e);if(r){let s=0;for(let f=0;f<t.length;f++)s|=t[f];if(s===0)throw new Error("X25519: invalid shared key")}return t}it.sharedKey=Ta});var Fi=pt((Xe,qi)=>{(function(){var i,e=0xdeadbeefcafe,r=(e&16777215)==15715070;function t(n,a,o){n!=null&&(typeof n=="number"?this.fromNumber(n,a,o):a==null&&typeof n!="string"?this.fromString(n,256):this.fromString(n,a))}function s(){return new t(null)}function f(n,a,o,h,p,y){for(;--y>=0;){var E=a*this[n++]+o[h]+p;p=Math.floor(E/67108864),o[h++]=E&67108863}return p}function d(n,a,o,h,p,y){for(var E=a&32767,A=a>>15;--y>=0;){var tt=this[n]&32767,dt=this[n++]>>15,Pt=A*tt+dt*E;tt=E*tt+((Pt&32767)<<15)+o[h]+(p&1073741823),p=(tt>>>30)+(Pt>>>15)+A*dt+(p>>>30),o[h++]=tt&1073741823}return p}function u(n,a,o,h,p,y){for(var E=a&16383,A=a>>14;--y>=0;){var tt=this[n]&16383,dt=this[n++]>>14,Pt=A*tt+dt*E;tt=E*tt+((Pt&16383)<<14)+o[h]+p,p=(tt>>28)+(Pt>>14)+A*dt,o[h++]=tt&268435455}return p}var _=typeof navigator<"u";_&&r&&navigator.appName=="Microsoft Internet Explorer"?(t.prototype.am=d,i=30):_&&r&&navigator.appName!="Netscape"?(t.prototype.am=f,i=26):(t.prototype.am=u,i=28),t.prototype.DB=i,t.prototype.DM=(1<<i)-1,t.prototype.DV=1<<i;var x=52;t.prototype.FV=Math.pow(2,x),t.prototype.F1=x-i,t.prototype.F2=2*i-x;var U="0123456789abcdefghijklmnopqrstuvwxyz",P=new Array,k,b;for(k="0".charCodeAt(0),b=0;b<=9;++b)P[k++]=b;for(k="a".charCodeAt(0),b=10;b<36;++b)P[k++]=b;for(k="A".charCodeAt(0),b=10;b<36;++b)P[k++]=b;function H(n){return U.charAt(n)}function T(n,a){var o=P[n.charCodeAt(a)];return o??-1}function D(n){for(var a=this.t-1;a>=0;--a)n[a]=this[a];n.t=this.t,n.s=this.s}function M(n){this.t=1,this.s=n<0?-1:0,n>0?this[0]=n:n<-1?this[0]=n+this.DV:this.t=0}function N(n){var a=s();return a.fromInt(n),a}function L(n,a){var o;if(a==16)o=4;else if(a==8)o=3;else if(a==256)o=8;else if(a==2)o=1;else if(a==32)o=5;else if(a==4)o=2;else{this.fromRadix(n,a);return}this.t=0,this.s=0;for(var h=n.length,p=!1,y=0;--h>=0;){var E=o==8?n[h]&255:T(n,h);if(E<0){n.charAt(h)=="-"&&(p=!0);continue}p=!1,y==0?this[this.t++]=E:y+o>this.DB?(this[this.t-1]|=(E&(1<<this.DB-y)-1)<<y,this[this.t++]=E>>this.DB-y):this[this.t-1]|=E<<y,y+=o,y>=this.DB&&(y-=this.DB)}o==8&&n[0]&128&&(this.s=-1,y>0&&(this[this.t-1]|=(1<<this.DB-y)-1<<y)),this.clamp(),p&&t.ZERO.subTo(this,this)}function I(){for(var n=this.s&this.DM;this.t>0&&this[this.t-1]==n;)--this.t}function O(n){if(this.s<0)return"-"+this.negate().toString(n);var a;if(n==16)a=4;else if(n==8)a=3;else if(n==2)a=1;else if(n==32)a=5;else if(n==4)a=2;else return this.toRadix(n);var o=(1<<a)-1,h,p=!1,y="",E=this.t,A=this.DB-E*this.DB%a;if(E-- >0)for(A<this.DB&&(h=this[E]>>A)>0&&(p=!0,y=H(h));E>=0;)A<a?(h=(this[E]&(1<<A)-1)<<a-A,h|=this[--E]>>(A+=this.DB-a)):(h=this[E]>>(A-=a)&o,A<=0&&(A+=this.DB,--E)),h>0&&(p=!0),p&&(y+=H(h));return p?y:"0"}function z(){var n=s();return t.ZERO.subTo(this,n),n}function c(){return this.s<0?this.negate():this}function l(n){var a=this.s-n.s;if(a!=0)return a;var o=this.t;if(a=o-n.t,a!=0)return this.s<0?-a:a;for(;--o>=0;)if((a=this[o]-n[o])!=0)return a;return 0}function K(n){var a=1,o;return(o=n>>>16)!=0&&(n=o,a+=16),(o=n>>8)!=0&&(n=o,a+=8),(o=n>>4)!=0&&(n=o,a+=4),(o=n>>2)!=0&&(n=o,a+=2),(o=n>>1)!=0&&(n=o,a+=1),a}function B(){return this.t<=0?0:this.DB*(this.t-1)+K(this[this.t-1]^this.s&this.DM)}function m(n,a){var o;for(o=this.t-1;o>=0;--o)a[o+n]=this[o];for(o=n-1;o>=0;--o)a[o]=0;a.t=this.t+n,a.s=this.s}function w(n,a){for(var o=n;o<this.t;++o)a[o-n]=this[o];a.t=Math.max(this.t-n,0),a.s=this.s}function v(n,a){var o=n%this.DB,h=this.DB-o,p=(1<<h)-1,y=Math.floor(n/this.DB),E=this.s<<o&this.DM,A;for(A=this.t-1;A>=0;--A)a[A+y+1]=this[A]>>h|E,E=(this[A]&p)<<o;for(A=y-1;A>=0;--A)a[A]=0;a[y]=E,a.t=this.t+y+1,a.s=this.s,a.clamp()}function g(n,a){a.s=this.s;var o=Math.floor(n/this.DB);if(o>=this.t){a.t=0;return}var h=n%this.DB,p=this.DB-h,y=(1<<h)-1;a[0]=this[o]>>h;for(var E=o+1;E<this.t;++E)a[E-o-1]|=(this[E]&y)<<p,a[E-o]=this[E]>>h;h>0&&(a[this.t-o-1]|=(this.s&y)<<p),a.t=this.t-o,a.clamp()}function C(n,a){for(var o=0,h=0,p=Math.min(n.t,this.t);o<p;)h+=this[o]-n[o],a[o++]=h&this.DM,h>>=this.DB;if(n.t<this.t){for(h-=n.s;o<this.t;)h+=this[o],a[o++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;o<n.t;)h-=n[o],a[o++]=h&this.DM,h>>=this.DB;h-=n.s}a.s=h<0?-1:0,h<-1?a[o++]=this.DV+h:h>0&&(a[o++]=h),a.t=o,a.clamp()}function R(n,a){var o=this.abs(),h=n.abs(),p=o.t;for(a.t=p+h.t;--p>=0;)a[p]=0;for(p=0;p<h.t;++p)a[p+o.t]=o.am(0,h[p],a,p,0,o.t);a.s=0,a.clamp(),this.s!=n.s&&t.ZERO.subTo(a,a)}function S(n){for(var a=this.abs(),o=n.t=2*a.t;--o>=0;)n[o]=0;for(o=0;o<a.t-1;++o){var h=a.am(o,a[o],n,2*o,0,1);(n[o+a.t]+=a.am(o+1,2*a[o],n,2*o+1,h,a.t-o-1))>=a.DV&&(n[o+a.t]-=a.DV,n[o+a.t+1]=1)}n.t>0&&(n[n.t-1]+=a.am(o,a[o],n,2*o,0,1)),n.s=0,n.clamp()}function j(n,a,o){var h=n.abs();if(!(h.t<=0)){var p=this.abs();if(p.t<h.t){a?.fromInt(0),o!=null&&this.copyTo(o);return}o==null&&(o=s());var y=s(),E=this.s,A=n.s,tt=this.DB-K(h[h.t-1]);tt>0?(h.lShiftTo(tt,y),p.lShiftTo(tt,o)):(h.copyTo(y),p.copyTo(o));var dt=y.t,Pt=y[dt-1];if(Pt!=0){var Et=Pt*(1<<this.F1)+(dt>1?y[dt-2]>>this.F2:0),Nt=this.FV/Et,me=(1<<this.F1)/Et,Lt=1<<this.F2,Tt=o.t,ge=Tt-dt,jt=a??s();for(y.dlShiftTo(ge,jt),o.compareTo(jt)>=0&&(o[o.t++]=1,o.subTo(jt,o)),t.ONE.dlShiftTo(dt,jt),jt.subTo(y,y);y.t<dt;)y[y.t++]=0;for(;--ge>=0;){var or=o[--Tt]==Pt?this.DM:Math.floor(o[Tt]*Nt+(o[Tt-1]+Lt)*me);if((o[Tt]+=y.am(0,or,o,ge,0,dt))<or)for(y.dlShiftTo(ge,jt),o.subTo(jt,o);o[Tt]<--or;)o.subTo(jt,o)}a!=null&&(o.drShiftTo(dt,a),E!=A&&t.ZERO.subTo(a,a)),o.t=dt,o.clamp(),tt>0&&o.rShiftTo(tt,o),E<0&&t.ZERO.subTo(o,o)}}}function J(n){var a=s();return this.abs().divRemTo(n,null,a),this.s<0&&a.compareTo(t.ZERO)>0&&n.subTo(a,a),a}function G(n){this.m=n}function Y(n){return n.s<0||n.compareTo(this.m)>=0?n.mod(this.m):n}function X(n){return n}function Z(n){n.divRemTo(this.m,null,n)}function V(n,a,o){n.multiplyTo(a,o),this.reduce(o)}function W(n,a){n.squareTo(a),this.reduce(a)}G.prototype.convert=Y,G.prototype.revert=X,G.prototype.reduce=Z,G.prototype.mulTo=V,G.prototype.sqrTo=W;function $(){if(this.t<1)return 0;var n=this[0];if(!(n&1))return 0;var a=n&3;return a=a*(2-(n&15)*a)&15,a=a*(2-(n&255)*a)&255,a=a*(2-((n&65535)*a&65535))&65535,a=a*(2-n*a%this.DV)%this.DV,a>0?this.DV-a:-a}function q(n){this.m=n,this.mp=n.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<n.DB-15)-1,this.mt2=2*n.t}function rt(n){var a=s();return n.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),n.s<0&&a.compareTo(t.ZERO)>0&&this.m.subTo(a,a),a}function at(n){var a=s();return n.copyTo(a),this.reduce(a),a}function ot(n){for(;n.t<=this.mt2;)n[n.t++]=0;for(var a=0;a<this.m.t;++a){var o=n[a]&32767,h=o*this.mpl+((o*this.mph+(n[a]>>15)*this.mpl&this.um)<<15)&n.DM;for(o=a+this.m.t,n[o]+=this.m.am(0,h,n,a,0,this.m.t);n[o]>=n.DV;)n[o]-=n.DV,n[++o]++}n.clamp(),n.drShiftTo(this.m.t,n),n.compareTo(this.m)>=0&&n.subTo(this.m,n)}function ft(n,a){n.squareTo(a),this.reduce(a)}function nt(n,a,o){n.multiplyTo(a,o),this.reduce(o)}q.prototype.convert=rt,q.prototype.revert=at,q.prototype.reduce=ot,q.prototype.mulTo=nt,q.prototype.sqrTo=ft;function ht(){return(this.t>0?this[0]&1:this.s)==0}function ut(n,a){if(n>4294967295||n<1)return t.ONE;var o=s(),h=s(),p=a.convert(this),y=K(n)-1;for(p.copyTo(o);--y>=0;)if(a.sqrTo(o,h),(n&1<<y)>0)a.mulTo(h,p,o);else{var E=o;o=h,h=E}return a.revert(o)}function ct(n,a){var o;return n<256||a.isEven()?o=new G(a):o=new q(a),this.exp(n,o)}t.prototype.copyTo=D,t.prototype.fromInt=M,t.prototype.fromString=L,t.prototype.clamp=I,t.prototype.dlShiftTo=m,t.prototype.drShiftTo=w,t.prototype.lShiftTo=v,t.prototype.rShiftTo=g,t.prototype.subTo=C,t.prototype.multiplyTo=R,t.prototype.squareTo=S,t.prototype.divRemTo=j,t.prototype.invDigit=$,t.prototype.isEven=ht,t.prototype.exp=ut,t.prototype.toString=O,t.prototype.negate=z,t.prototype.abs=c,t.prototype.compareTo=l,t.prototype.bitLength=B,t.prototype.mod=J,t.prototype.modPowInt=ct,t.ZERO=N(0),t.ONE=N(1);function Ji(){var n=s();return this.copyTo(n),n}function tn(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function en(){return this.t==0?this.s:this[0]<<24>>24}function rn(){return this.t==0?this.s:this[0]<<16>>16}function nn(n){return Math.floor(Math.LN2*this.DB/Math.log(n))}function sn(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function an(n){if(n==null&&(n=10),this.signum()==0||n<2||n>36)return"0";var a=this.chunkSize(n),o=Math.pow(n,a),h=N(o),p=s(),y=s(),E="";for(this.divRemTo(h,p,y);p.signum()>0;)E=(o+y.intValue()).toString(n).substr(1)+E,p.divRemTo(h,p,y);return y.intValue().toString(n)+E}function on(n,a){this.fromInt(0),a==null&&(a=10);for(var o=this.chunkSize(a),h=Math.pow(a,o),p=!1,y=0,E=0,A=0;A<n.length;++A){var tt=T(n,A);if(tt<0){n.charAt(A)=="-"&&this.signum()==0&&(p=!0);continue}E=a*E+tt,++y>=o&&(this.dMultiply(h),this.dAddOffset(E,0),y=0,E=0)}y>0&&(this.dMultiply(Math.pow(a,y)),this.dAddOffset(E,0)),p&&t.ZERO.subTo(this,this)}function fn(n,a,o){if(typeof a=="number")if(n<2)this.fromInt(1);else for(this.fromNumber(n,o),this.testBit(n-1)||this.bitwiseTo(t.ONE.shiftLeft(n-1),ir,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(a);)this.dAddOffset(2,0),this.bitLength()>n&&this.subTo(t.ONE.shiftLeft(n-1),this);else{var h=new Array,p=n&7;h.length=(n>>3)+1,a.nextBytes(h),p>0?h[0]&=(1<<p)-1:h[0]=0,this.fromString(h,256)}}function hn(){var n=this.t,a=new Array;a[0]=this.s;var o=this.DB-n*this.DB%8,h,p=0;if(n-- >0)for(o<this.DB&&(h=this[n]>>o)!=(this.s&this.DM)>>o&&(a[p++]=h|this.s<<this.DB-o);n>=0;)o<8?(h=(this[n]&(1<<o)-1)<<8-o,h|=this[--n]>>(o+=this.DB-8)):(h=this[n]>>(o-=8)&255,o<=0&&(o+=this.DB,--n)),h&128&&(h|=-256),p==0&&(this.s&128)!=(h&128)&&++p,(p>0||h!=this.s)&&(a[p++]=h);return a}function un(n){return this.compareTo(n)==0}function cn(n){return this.compareTo(n)<0?this:n}function ln(n){return this.compareTo(n)>0?this:n}function dn(n,a,o){var h,p,y=Math.min(n.t,this.t);for(h=0;h<y;++h)o[h]=a(this[h],n[h]);if(n.t<this.t){for(p=n.s&this.DM,h=y;h<this.t;++h)o[h]=a(this[h],p);o.t=this.t}else{for(p=this.s&this.DM,h=y;h<n.t;++h)o[h]=a(p,n[h]);o.t=n.t}o.s=a(this.s,n.s),o.clamp()}function pn(n,a){return n&a}function bn(n){var a=s();return this.bitwiseTo(n,pn,a),a}function ir(n,a){return n|a}function _n(n){var a=s();return this.bitwiseTo(n,ir,a),a}function Tr(n,a){return n^a}function yn(n){var a=s();return this.bitwiseTo(n,Tr,a),a}function Kr(n,a){return n&~a}function wn(n){var a=s();return this.bitwiseTo(n,Kr,a),a}function vn(){for(var n=s(),a=0;a<this.t;++a)n[a]=this.DM&~this[a];return n.t=this.t,n.s=~this.s,n}function xn(n){var a=s();return n<0?this.rShiftTo(-n,a):this.lShiftTo(n,a),a}function mn(n){var a=s();return n<0?this.lShiftTo(-n,a):this.rShiftTo(n,a),a}function gn(n){if(n==0)return-1;var a=0;return n&65535||(n>>=16,a+=16),n&255||(n>>=8,a+=8),n&15||(n>>=4,a+=4),n&3||(n>>=2,a+=2),n&1||++a,a}function En(){for(var n=0;n<this.t;++n)if(this[n]!=0)return n*this.DB+gn(this[n]);return this.s<0?this.t*this.DB:-1}function Sn(n){for(var a=0;n!=0;)n&=n-1,++a;return a}function An(){for(var n=0,a=this.s&this.DM,o=0;o<this.t;++o)n+=Sn(this[o]^a);return n}function Pn(n){var a=Math.floor(n/this.DB);return a>=this.t?this.s!=0:(this[a]&1<<n%this.DB)!=0}function kn(n,a){var o=t.ONE.shiftLeft(n);return this.bitwiseTo(o,a,o),o}function Ln(n){return this.changeBit(n,ir)}function Tn(n){return this.changeBit(n,Kr)}function Kn(n){return this.changeBit(n,Tr)}function Un(n,a){for(var o=0,h=0,p=Math.min(n.t,this.t);o<p;)h+=this[o]+n[o],a[o++]=h&this.DM,h>>=this.DB;if(n.t<this.t){for(h+=n.s;o<this.t;)h+=this[o],a[o++]=h&this.DM,h>>=this.DB;h+=this.s}else{for(h+=this.s;o<n.t;)h+=n[o],a[o++]=h&this.DM,h>>=this.DB;h+=n.s}a.s=h<0?-1:0,h>0?a[o++]=h:h<-1&&(a[o++]=this.DV+h),a.t=o,a.clamp()}function In(n){var a=s();return this.addTo(n,a),a}function Bn(n){var a=s();return this.subTo(n,a),a}function Hn(n){var a=s();return this.multiplyTo(n,a),a}function Mn(){var n=s();return this.squareTo(n),n}function Dn(n){var a=s();return this.divRemTo(n,a,null),a}function Nn(n){var a=s();return this.divRemTo(n,null,a),a}function On(n){var a=s(),o=s();return this.divRemTo(n,a,o),new Array(a,o)}function zn(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()}function Rn(n,a){if(n!=0){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=n;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}}function ce(){}function Ur(n){return n}function Cn(n,a,o){n.multiplyTo(a,o)}function jn(n,a){n.squareTo(a)}ce.prototype.convert=Ur,ce.prototype.revert=Ur,ce.prototype.mulTo=Cn,ce.prototype.sqrTo=jn;function Gn(n){return this.exp(n,new ce)}function qn(n,a,o){var h=Math.min(this.t+n.t,a);for(o.s=0,o.t=h;h>0;)o[--h]=0;var p;for(p=o.t-this.t;h<p;++h)o[h+this.t]=this.am(0,n[h],o,h,0,this.t);for(p=Math.min(n.t,a);h<p;++h)this.am(0,n[h],o,h,0,a-h);o.clamp()}function Fn(n,a,o){--a;var h=o.t=this.t+n.t-a;for(o.s=0;--h>=0;)o[h]=0;for(h=Math.max(a-this.t,0);h<n.t;++h)o[this.t+h-a]=this.am(a-h,n[h],o,0,0,this.t+h-a);o.clamp(),o.drShiftTo(1,o)}function Yt(n){this.r2=s(),this.q3=s(),t.ONE.dlShiftTo(2*n.t,this.r2),this.mu=this.r2.divide(n),this.m=n}function Vn(n){if(n.s<0||n.t>2*this.m.t)return n.mod(this.m);if(n.compareTo(this.m)<0)return n;var a=s();return n.copyTo(a),this.reduce(a),a}function Yn(n){return n}function Xn(n){for(n.drShiftTo(this.m.t-1,this.r2),n.t>this.m.t+1&&(n.t=this.m.t+1,n.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);n.compareTo(this.r2)<0;)n.dAddOffset(1,this.m.t+1);for(n.subTo(this.r2,n);n.compareTo(this.m)>=0;)n.subTo(this.m,n)}function Zn(n,a){n.squareTo(a),this.reduce(a)}function Wn(n,a,o){n.multiplyTo(a,o),this.reduce(o)}Yt.prototype.convert=Vn,Yt.prototype.revert=Yn,Yt.prototype.reduce=Xn,Yt.prototype.mulTo=Wn,Yt.prototype.sqrTo=Zn;function $n(n,a){var o=n.bitLength(),h,p=N(1),y;if(o<=0)return p;o<18?h=1:o<48?h=3:o<144?h=4:o<768?h=5:h=6,o<8?y=new G(a):a.isEven()?y=new Yt(a):y=new q(a);var E=new Array,A=3,tt=h-1,dt=(1<<h)-1;if(E[1]=y.convert(this),h>1){var Pt=s();for(y.sqrTo(E[1],Pt);A<=dt;)E[A]=s(),y.mulTo(Pt,E[A-2],E[A]),A+=2}var Et=n.t-1,Nt,me=!0,Lt=s(),Tt;for(o=K(n[Et])-1;Et>=0;){for(o>=tt?Nt=n[Et]>>o-tt&dt:(Nt=(n[Et]&(1<<o+1)-1)<<tt-o,Et>0&&(Nt|=n[Et-1]>>this.DB+o-tt)),A=h;!(Nt&1);)Nt>>=1,--A;if((o-=A)<0&&(o+=this.DB,--Et),me)E[Nt].copyTo(p),me=!1;else{for(;A>1;)y.sqrTo(p,Lt),y.sqrTo(Lt,p),A-=2;A>0?y.sqrTo(p,Lt):(Tt=p,p=Lt,Lt=Tt),y.mulTo(Lt,E[Nt],p)}for(;Et>=0&&!(n[Et]&1<<o);)y.sqrTo(p,Lt),Tt=p,p=Lt,Lt=Tt,--o<0&&(o=this.DB-1,--Et)}return y.revert(p)}function Qn(n){var a=this.s<0?this.negate():this.clone(),o=n.s<0?n.negate():n.clone();if(a.compareTo(o)<0){var h=a;a=o,o=h}var p=a.getLowestSetBit(),y=o.getLowestSetBit();if(y<0)return a;for(p<y&&(y=p),y>0&&(a.rShiftTo(y,a),o.rShiftTo(y,o));a.signum()>0;)(p=a.getLowestSetBit())>0&&a.rShiftTo(p,a),(p=o.getLowestSetBit())>0&&o.rShiftTo(p,o),a.compareTo(o)>=0?(a.subTo(o,a),a.rShiftTo(1,a)):(o.subTo(a,o),o.rShiftTo(1,o));return y>0&&o.lShiftTo(y,o),o}function Jn(n){if(n<=0)return 0;var a=this.DV%n,o=this.s<0?n-1:0;if(this.t>0)if(a==0)o=this[0]%n;else for(var h=this.t-1;h>=0;--h)o=(a*o+this[h])%n;return o}function ts(n){var a=n.isEven();if(this.isEven()&&a||n.signum()==0)return t.ZERO;for(var o=n.clone(),h=this.clone(),p=N(1),y=N(0),E=N(0),A=N(1);o.signum()!=0;){for(;o.isEven();)o.rShiftTo(1,o),a?((!p.isEven()||!y.isEven())&&(p.addTo(this,p),y.subTo(n,y)),p.rShiftTo(1,p)):y.isEven()||y.subTo(n,y),y.rShiftTo(1,y);for(;h.isEven();)h.rShiftTo(1,h),a?((!E.isEven()||!A.isEven())&&(E.addTo(this,E),A.subTo(n,A)),E.rShiftTo(1,E)):A.isEven()||A.subTo(n,A),A.rShiftTo(1,A);o.compareTo(h)>=0?(o.subTo(h,o),a&&p.subTo(E,p),y.subTo(A,y)):(h.subTo(o,h),a&&E.subTo(p,E),A.subTo(y,A))}if(h.compareTo(t.ONE)!=0)return t.ZERO;if(A.compareTo(n)>=0)return A.subtract(n);if(A.signum()<0)A.addTo(n,A);else return A;return A.signum()<0?A.add(n):A}var vt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],es=(1<<26)/vt[vt.length-1];function rs(n){var a,o=this.abs();if(o.t==1&&o[0]<=vt[vt.length-1]){for(a=0;a<vt.length;++a)if(o[0]==vt[a])return!0;return!1}if(o.isEven())return!1;for(a=1;a<vt.length;){for(var h=vt[a],p=a+1;p<vt.length&&h<es;)h*=vt[p++];for(h=o.modInt(h);a<p;)if(h%vt[a++]==0)return!1}return o.millerRabin(n)}function is(n){var a=this.subtract(t.ONE),o=a.getLowestSetBit();if(o<=0)return!1;var h=a.shiftRight(o);n=n+1>>1,n>vt.length&&(n=vt.length);for(var p=s(),y=0;y<n;++y){p.fromInt(vt[Math.floor(Math.random()*vt.length)]);var E=p.modPow(h,this);if(E.compareTo(t.ONE)!=0&&E.compareTo(a)!=0){for(var A=1;A++<o&&E.compareTo(a)!=0;)if(E=E.modPowInt(2,this),E.compareTo(t.ONE)==0)return!1;if(E.compareTo(a)!=0)return!1}}return!0}t.prototype.chunkSize=nn,t.prototype.toRadix=an,t.prototype.fromRadix=on,t.prototype.fromNumber=fn,t.prototype.bitwiseTo=dn,t.prototype.changeBit=kn,t.prototype.addTo=Un,t.prototype.dMultiply=zn,t.prototype.dAddOffset=Rn,t.prototype.multiplyLowerTo=qn,t.prototype.multiplyUpperTo=Fn,t.prototype.modInt=Jn,t.prototype.millerRabin=is,t.prototype.clone=Ji,t.prototype.intValue=tn,t.prototype.byteValue=en,t.prototype.shortValue=rn,t.prototype.signum=sn,t.prototype.toByteArray=hn,t.prototype.equals=un,t.prototype.min=cn,t.prototype.max=ln,t.prototype.and=bn,t.prototype.or=_n,t.prototype.xor=yn,t.prototype.andNot=wn,t.prototype.not=vn,t.prototype.shiftLeft=xn,t.prototype.shiftRight=mn,t.prototype.getLowestSetBit=En,t.prototype.bitCount=An,t.prototype.testBit=Pn,t.prototype.setBit=Ln,t.prototype.clearBit=Tn,t.prototype.flipBit=Kn,t.prototype.add=In,t.prototype.subtract=Bn,t.prototype.multiply=Hn,t.prototype.divide=Dn,t.prototype.remainder=Nn,t.prototype.divideAndRemainder=On,t.prototype.modPow=$n,t.prototype.modInverse=ts,t.prototype.pow=Gn,t.prototype.gcd=Qn,t.prototype.isProbablePrime=rs,t.prototype.square=Mn,t.prototype.Barrett=Yt;var xe,gt,lt;function ns(n){gt[lt++]^=n&255,gt[lt++]^=n>>8&255,gt[lt++]^=n>>16&255,gt[lt++]^=n>>24&255,lt>=ar&&(lt-=ar)}function Ir(){ns(new Date().getTime())}if(gt==null){gt=new Array,lt=0;var kt;if(typeof window<"u"&&window.crypto){if(window.crypto.getRandomValues){var Br=new Uint8Array(32);for(window.crypto.getRandomValues(Br),kt=0;kt<32;++kt)gt[lt++]=Br[kt]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Hr=window.crypto.random(32);for(kt=0;kt<Hr.length;++kt)gt[lt++]=Hr.charCodeAt(kt)&255}}for(;lt<ar;)kt=Math.floor(65536*Math.random()),gt[lt++]=kt>>>8,gt[lt++]=kt&255;lt=0,Ir()}function ss(){if(xe==null){for(Ir(),xe=hs(),xe.init(gt),lt=0;lt<gt.length;++lt)gt[lt]=0;lt=0}return xe.next()}function as(n){var a;for(a=0;a<n.length;++a)n[a]=ss()}function nr(){}nr.prototype.nextBytes=as;function sr(){this.i=0,this.j=0,this.S=new Array}function os(n){var a,o,h;for(a=0;a<256;++a)this.S[a]=a;for(o=0,a=0;a<256;++a)o=o+this.S[a]+n[a%n.length]&255,h=this.S[a],this.S[a]=this.S[o],this.S[o]=h;this.i=0,this.j=0}function fs(){var n;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,n=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=n,this.S[n+this.S[this.i]&255]}sr.prototype.init=os,sr.prototype.next=fs;function hs(){return new sr}var ar=256;typeof Xe<"u"?Xe=qi.exports={default:t,BigInteger:t,SecureRandom:nr}:this.jsbn={BigInteger:t,SecureRandom:nr}}).call(Xe)});var xt=class extends Error{constructor(e){let r;e instanceof Error?r=e.message:typeof e=="string"?r=e:r="",super(r),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message===""?this.message=this.name:this.message=this.name+": "+this.message}},St=class extends xt{},Nr=class extends xt{},Or=class extends xt{},le=class extends xt{},Ee=class extends xt{},Se=class extends xt{},Ae=class extends xt{},Xt=class extends xt{},Zt=class extends xt{},Pe=class extends xt{},ke=class extends xt{},Ut=class extends xt{};var Kt;(function(i){i[i.Base=0]="Base",i[i.Psk=1]="Psk",i[i.Auth=2]="Auth",i[i.AuthPsk=3]="AuthPsk"})(Kt||(Kt={}));var st;(function(i){i[i.DhkemP256HkdfSha256=16]="DhkemP256HkdfSha256",i[i.DhkemP384HkdfSha384=17]="DhkemP384HkdfSha384",i[i.DhkemP521HkdfSha512=18]="DhkemP521HkdfSha512",i[i.DhkemX25519HkdfSha256=32]="DhkemX25519HkdfSha256",i[i.DhkemX448HkdfSha512=33]="DhkemX448HkdfSha512"})(st||(st={}));var bt;(function(i){i[i.HkdfSha256=1]="HkdfSha256",i[i.HkdfSha384=2]="HkdfSha384",i[i.HkdfSha512=3]="HkdfSha512"})(bt||(bt={}));var _t;(function(i){i[i.Aes128Gcm=1]="Aes128Gcm",i[i.Aes256Gcm=2]="Aes256Gcm",i[i.Chacha20Poly1305=3]="Chacha20Poly1305",i[i.ExportOnly=65535]="ExportOnly"})(_t||(_t={}));var _s={},zr=ys(globalThis,_s);function ys(i,e){return new Proxy(i,{get(r,t,s){return t in e?e[t]:i[t]},set(r,t,s){return t in e&&delete e[t],i[t]=s,!0},deleteProperty(r,t){let s=!1;return t in e&&(delete e[t],s=!0),t in i&&(delete i[t],s=!0),s},ownKeys(r){let t=Reflect.ownKeys(i),s=Reflect.ownKeys(e),f=new Set(s);return[...t.filter(d=>!f.has(d)),...s]},defineProperty(r,t,s){return t in e&&delete e[t],Reflect.defineProperty(i,t,s),!0},getOwnPropertyDescriptor(r,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(i,t)},has(r,t){return t in e||t in i}})}var fr=()=>typeof zr<"u",hr=()=>typeof caches<"u";var de=i=>typeof i=="object"&&i!==null&&typeof i.privateKey=="object"&&typeof i.publicKey=="object";function It(i,e){if(e<=0)throw new Error("i2Osp: too small size");if(i>=256**e)throw new Error("i2Osp: too large integer");let r=new Uint8Array(e);for(let t=0;t<e&&i;t++)r[e-(t+1)]=i%256,i=i>>8;return r}function Rr(i,e){if(i.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let r=new Uint8Array(i.byteLength);for(let t=0;t<i.byteLength;t++)r[t]=i[t]^e[t];return r}function pe(i,e){let r=new Uint8Array(i.length+e.length);return r.set(i,0),r.set(e,i.length),r}function Cr(i,e,r){let t=new Uint8Array(i.length+e.length+r.length);return t.set(i,0),t.set(e,i.length),t.set(r,i.length+e.length),t}var qt=class{constructor(e){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e}};async function jr(){if((fr()||hr())&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:i}=await import("crypto");return i}catch{throw new Ut("Web Cryptograph API not supported")}}async function Gr(){if((fr()||hr())&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:i}=await import("crypto");return i.subtle}catch{throw new Ut("Web Cryptograph API not supported")}}var Ft=["deriveBits"],qr=["encrypt","decrypt"];var Q=new Uint8Array(0),ur=new Uint8Array([72,80,75,69,45,118,49]),Fr=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),Vr=new Uint8Array([75,69,77,0,0]),Jt=new Uint8Array([100,107,112,95,112,114,107]),Yr=new Uint8Array([101,97,101,95,112,114,107]),Xr=new Uint8Array([105,110,102,111,95,104,97,115,104]),Zr=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),Wr=new Uint8Array([115,101,99,114,101,116]),$r=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]),Qr=new Uint8Array([107,101,121]),Jr=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),ti=new Uint8Array([101,120,112]),ei=new Uint8Array([115,101,99]),ri=new Uint8Array([99,97,110,100,105,100,97,116,101]),Le=new Uint8Array([115,107]),ii=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),ni=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),si=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]);var te=class extends qt{constructor(e,r,t){super(e),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._kdf=r,this.exporterSecret=t}async seal(e,r){return await this._emitError1()}async open(e,r){return await this._emitError1()}async setupBidirectional(e,r){return await this._emitError2()}async export(e,r){if(e.byteLength>128)throw new St("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,ei,new Uint8Array(e),r)}catch(t){throw new Ae(t)}}_emitError1(){return new Promise((e,r)=>{r(new Ut("Not available on export-only mode"))})}_emitError2(){return new Promise((e,r)=>{r(new Ut("Not available on export-only mode"))})}},Te=class extends te{},Ke=class extends te{constructor(e,r,t,s){super(e,r,t),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=s}};var be=class{constructor(e,r){Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e,this._api=r}async seal(e,r,t){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let s={name:"AES-GCM",iv:e,additionalData:t};return await this._api.encrypt(s,this._key,r)}async open(e,r,t){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let s={name:"AES-GCM",iv:e,additionalData:t};return await this._api.decrypt(s,this._key,r)}async importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,qr)}};var xi=Qt(vi(),1),Ne=class{constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new xi.ChaCha20Poly1305(new Uint8Array(e))}async seal(e,r,t){return await this._seal(e,r,t)}async open(e,r,t){return await this._open(e,r,t)}_seal(e,r,t){return new Promise(s=>{let f=this._key.seal(new Uint8Array(e),new Uint8Array(r),new Uint8Array(t));s(f.buffer)})}_open(e,r,t){return new Promise((s,f)=>{let d=this._key.open(new Uint8Array(e),new Uint8Array(r),new Uint8Array(t));d instanceof Uint8Array?s(d.buffer):f(new Error("failed to open."))})}};var ne=class extends te{constructor(e,r,t){if(super(e,r,t.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_f",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_r",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t.key===void 0||t.baseNonce===void 0||t.seq===void 0)throw new Error("Required parameters are missing");switch(this._aead=t.aead,this._aead){case _t.Aes128Gcm:this._nK=16,this._nN=12,this._nT=16;break;case _t.Aes256Gcm:this._nK=32,this._nN=12,this._nT=16;break;case _t.Chacha20Poly1305:this._nK=32,this._nN=12,this._nT=16;break;default:this._nK=0,this._nN=0,this._nT=0;break}let s=Oe(this._aead,t.key,this._api);this._f={key:s,baseNonce:t.baseNonce,seq:t.seq},this._r={key:s,baseNonce:Q,seq:0}}computeNonce(e){let r=It(e.seq,e.baseNonce.byteLength);return Rr(e.baseNonce,r)}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new Pe("Message limit reached");e.seq+=1}async setupBidirectional(e,r){try{this._r.baseNonce=new Uint8Array(await this.export(r,this._nN));let t=await this.export(e,this._nK);this._r.key=Oe(this._aead,t,this._api),this._r.seq=0}catch(t){throw this._r.baseNonce=Q,t}}};function Oe(i,e,r){switch(i){case _t.Aes128Gcm:return new be(e,r);case _t.Aes256Gcm:return new be(e,r);case _t.Chacha20Poly1305:return new Ne(e);default:throw new Error("Invalid or unsupported AEAD id")}}var xr=Qt(Ei(),1),Ti=Qt(Ai(),1),Ki=Qt(Li(),1);var Wt=class extends qt{constructor(e,r,t){switch(super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nH",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=r,this.suiteId=t,r){case bt.HkdfSha256:this.hashSize=32,this.algHash={name:"HMAC",hash:"SHA-256",length:256};break;case bt.HkdfSha384:this.hashSize=48,this.algHash={name:"HMAC",hash:"SHA-384",length:384};break;default:this.hashSize=64,this.algHash={name:"HMAC",hash:"SHA-512",length:512};break}if(this.algHash.length===void 0)throw new Error("Unknown hash size.");this._nH=this.algHash.length/8}buildLabeledIkm(e,r){let t=new Uint8Array(7+this.suiteId.byteLength+e.byteLength+r.byteLength);return t.set(ur,0),t.set(this.suiteId,7),t.set(e,7+this.suiteId.byteLength),t.set(r,7+this.suiteId.byteLength+e.byteLength),t}buildLabeledInfo(e,r,t){let s=new Uint8Array(9+this.suiteId.byteLength+e.byteLength+r.byteLength);return s.set(new Uint8Array([0,t]),0),s.set(ur,2),s.set(this.suiteId,9),s.set(e,9+this.suiteId.byteLength),s.set(r,9+this.suiteId.byteLength+e.byteLength),s}async extract(e,r){if(e.byteLength===0&&(e=new ArrayBuffer(this._nH)),e.byteLength!==this._nH)switch(this.algHash.hash){case"SHA-256":return(0,xr.hmac)(Ti.SHA256,new Uint8Array(e),new Uint8Array(r));case"SHA-512":return(0,xr.hmac)(Ki.SHA512,new Uint8Array(e),new Uint8Array(r));default:throw new Ut(`${this.algHash.hash} key length should be ${this._nH}.`)}let t=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",t,r)}async expand(e,r,t){let s=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),f=new ArrayBuffer(t),d=new Uint8Array(f),u=Q,_=new Uint8Array(r),x=new Uint8Array(1);if(t>255*this._nH)throw new Error("Entropy limit reached");let U=new Uint8Array(this._nH+_.length+1);for(let P=1,k=0;k<d.length;P++)x[0]=P,U.set(u,0),U.set(_,u.length),U.set(x,u.length+_.length),u=new Uint8Array(await this._api.sign("HMAC",s,U.slice(0,u.length+_.length+1))),d.length-k>=u.length?(d.set(u,k),k+=u.length):(d.set(u.slice(0,d.length-k),k),k+=d.length-k);return f}async extractAndExpand(e,r,t,s){let f=await this._api.importKey("raw",r,"HKDF",!1,Ft);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:t},f,s*8)}async labeledExtract(e,r,t){return await this.extract(e,this.buildLabeledIkm(r,t))}async labeledExpand(e,r,t,s){return await this.expand(e,this.buildLabeledInfo(r,t,s),s)}};var Ce=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let r=0;r<this._num.length;r++){if(this._num[r]<e[r])return!0;if(this._num[r]>e[r])return!1}return!1}};var la=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),da=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),pa=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),oe=class{constructor(e,r,t){switch(Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=r,this._api=t,e){case st.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=ii,this._bitmask=255,this._pkcs8AlgId=la;break;case st.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=ni,this._bitmask=255,this._pkcs8AlgId=da;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=si,this._bitmask=1,this._pkcs8AlgId=pa;break}}async serializePublicKey(e){let r=await this._api.exportKey("raw",e);if(r.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");return r}async deserializePublicKey(e){if(e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");try{return await this._api.importKey("raw",e,this._alg,!0,[])}catch{throw new Error("Invalid public key for the ciphersuite")}}async importKey(e,r,t){if(e!=="raw")throw new Error("Unsupported format");if(t&&r.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!t&&r.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");try{if(t)return await this._api.importKey(e,r,this._alg,!0,[]);let s=new Uint8Array(r),f=new Uint8Array(this._pkcs8AlgId.length+s.length);return f.set(this._pkcs8AlgId,0),f.set(s,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",f,this._alg,!0,Ft)}catch{throw new Error("Invalid key for the ciphersuite")}}async derivePublicKey(e){let r=await this._api.exportKey("jwk",e);return delete r.d,delete r.key_ops,await this._api.importKey("jwk",r,this._alg,!0,[])}async generateKeyPair(){return await this._api.generateKey(this._alg,!0,Ft)}async deriveKeyPair(e){let r=await this._hkdf.labeledExtract(Q,Jt,new Uint8Array(e)),t=new Ce(this._nSk);for(let d=0;t.isZero()||!t.lessThan(this._order);d++){if(d>255)throw new Error("Faild to derive a key pair");let u=new Uint8Array(await this._hkdf.labeledExpand(r,ri,It(d,1),this._nSk));u[0]=u[0]&this._bitmask,t.set(u)}let s=new Uint8Array(this._pkcs8AlgId.length+t.val().length);s.set(this._pkcs8AlgId,0),s.set(t.val(),this._pkcs8AlgId.length);let f=await this._api.importKey("pkcs8",s,this._alg,!0,Ft);return t.reset(),{privateKey:f,publicKey:await this.derivePublicKey(f)}}async dh(e,r){return await this._api.deriveBits({name:"ECDH",public:r},e,this._nDh*8)}};var he=Qt(Gi(),1);var mt=class{constructor(e,r,t){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:Ft}),this.key=r,this.type=t,this.algorithm={name:e}}};var fe="X25519",Ye=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=32,this._nSk=32}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,r,t){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(r,t)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=await(0,he.generateKeyPair)();return{publicKey:new mt(fe,e.publicKey,"public"),privateKey:new mt(fe,e.secretKey,"private")}}async deriveKeyPair(e){let r=await this._hkdf.labeledExtract(Q,Jt,new Uint8Array(e)),t=await this._hkdf.labeledExpand(r,Le,Q,this._nSk),s=new mt(fe,new Uint8Array(t),"private");return{privateKey:s,publicKey:await this.derivePublicKey(s)}}async dh(e,r){return await this._dh(e,r)}_serializePublicKey(e){return new Promise(r=>{r(e.key.buffer)})}_deserializePublicKey(e){return new Promise((r,t)=>{e.byteLength!==this._nPk?t(new Error("Invalid public key for the ciphersuite")):r(new mt(fe,new Uint8Array(e),"public"))})}_importKey(e,r){return new Promise((t,s)=>{r&&e.byteLength!==this._nPk&&s(new Error("Invalid public key for the ciphersuite")),!r&&e.byteLength!==this._nSk&&s(new Error("Invalid private key for the ciphersuite")),t(new mt(fe,new Uint8Array(e),r?"public":"private"))})}_derivePublicKey(e){return new Promise(r=>{r(new mt(fe,(0,he.scalarMultBase)(e.key),"public"))})}_dh(e,r){return new Promise((t,s)=>{try{t((0,he.sharedKey)(e.key,r.key,!0))}catch(f){s(f)}})}};var ue=Qt(Fi());function $t(i){return new ue.BigInteger(i.toString(10))}var $e=ue.BigInteger.ZERO,kr=ue.BigInteger.ONE,Ka=$t(2),Ua=$t(3),Ia=$t(5),Ba=$t(128),Ha=$t(255);function Ze(i){return i.multiply(i)}var et=new ue.BigInteger("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018365439"),Ma=new ue.BigInteger("39081");function We(i,e,r){var t=i.multiply(e.subtract(r)).mod(et);return[e.subtract(t).mod(et),r.add(t).mod(et)]}function Vi(i,e){for(var r=e,t=kr,s=$e,f=e,d=kr,u=$e,_=448-1;_>=0;--_){var x=i.shiftRight(_).and(kr);u=u.xor(x);{var U=We(u,t,f),P=U[0],k=U[1];t=P,f=k}{var b=We(u,s,d),H=b[0],T=b[1];s=H,d=T}u=x;var D=t.add(s).mod(et),M=Ze(D).mod(et),N=t.subtract(s).mod(et),L=Ze(N).mod(et),I=M.subtract(L).mod(et),O=f.add(d).mod(et),z=f.subtract(d).mod(et),c=z.multiply(D).mod(et),l=O.multiply(N).mod(et);f=Ze(c.add(l).mod(et)).mod(et),d=r.multiply(Ze(c.subtract(l).mod(et))).mod(et),t=M.multiply(L).mod(et),s=I.multiply(M.add(Ma.multiply(I).mod(et)).mod(et)).mod(et)}var K=We(u,t,f),B=K[0],m=We(u,s,d),w=m[0];return B.multiply(w.modPow(et.subtract(Ka),et)).mod(et)}function Da(i){return i.map(function(e,r){return $t(e).shiftLeft(8*r)}).reduce(function(e,r){return e.add(r)},$e)}function Yi(i){var e=[].concat(i);return e[0]&=252,e[55]|=128,Da(e)}function Na(i){if(i.length!==56)throw new Error("Invalid Curve448 scalar (len="+i.length+")");return i.map(function(e,r){return $t(e).shiftLeft(8*r)}).reduce(function(e,r){return e.add(r)},$e)}function Xi(i){return Array.from({length:56},function(e,r){return i.shiftRight(8*r).and(Ha).intValue()})}function Zi(i){return i.andNot(Ua).or(Ba.shiftLeft(8*55))}function Oa(i,e){var r=Zi(Yi(i)),t=Na(e);return Xi(Vi(r,t))}function za(i){var e=Zi(Yi(i));return Xi(Vi(e,Ia))}function Wi(i){if(!i)throw new Error("Missing private key");if(i.length!==56)throw new Error("Invalid Curve448 private key (len="+i.length+")");return za(Array.from(i))}function $i(i,e){if(!i)throw new Error("Missing private key");if(!e)throw new Error("Missing public key");if(i.length!==56)throw new Error("Invalid Curve448 private key (len="+i.length+")");var r=Oa(Array.from(i),Array.from(e));if(!r.some(function(t){return t}))throw new Error("Invalid Curve448 public key");return r}var Qe="X448",Je=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,r,t){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(r,t)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=new Uint8Array(56);return(await jr()).getRandomValues(e),await this.deriveKeyPair(e)}async deriveKeyPair(e){let r=await this._hkdf.labeledExtract(Q,Jt,new Uint8Array(e)),t=await this._hkdf.labeledExpand(r,Le,Q,this._nSk),s=new mt(Qe,new Uint8Array(t),"private");return{privateKey:s,publicKey:await this.derivePublicKey(s)}}async dh(e,r){return await this._dh(e,r)}_serializePublicKey(e){return new Promise(r=>{r(e.key.buffer)})}_deserializePublicKey(e){return new Promise((r,t)=>{e.byteLength!==this._nPk?t(new Error("Invalid public key for the ciphersuite")):r(new mt(Qe,new Uint8Array(e),"public"))})}_importKey(e,r){return new Promise((t,s)=>{r&&e.byteLength!==this._nPk&&s(new Error("Invalid public key for the ciphersuite")),!r&&e.byteLength!==this._nSk&&s(new Error("Invalid private key for the ciphersuite")),t(new mt(Qe,new Uint8Array(e),r?"public":"private"))})}_derivePublicKey(e){return new Promise(r=>{r(new mt(Qe,Uint8Array.from(Wi(e.key)),"public"))})}_dh(e,r){return new Promise((t,s)=>{try{t(Uint8Array.from($i(e.key,r.key)))}catch(f){s(f)}})}};var tr=class extends qt{constructor(e,r){super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=r;let t=bt.HkdfSha256;switch(r){case st.DhkemP256HkdfSha256:t=bt.HkdfSha256;break;case st.DhkemP384HkdfSha384:t=bt.HkdfSha384;break;case st.DhkemP521HkdfSha512:t=bt.HkdfSha512;break;case st.DhkemX25519HkdfSha256:t=bt.HkdfSha256;break;default:t=bt.HkdfSha512;break}let s=new Uint8Array(Vr);switch(s.set(It(r,2),3),this._kdf=new Wt(this._api,t,s),r){case st.DhkemP256HkdfSha256:this._prim=new oe(r,this._kdf,this._api),this.secretSize=32,this.encSize=65,this.publicKeySize=65,this.privateKeySize=32;break;case st.DhkemP384HkdfSha384:this._prim=new oe(r,this._kdf,this._api),this.secretSize=48,this.encSize=97,this.publicKeySize=97,this.privateKeySize=48;break;case st.DhkemP521HkdfSha512:this._prim=new oe(r,this._kdf,this._api),this.secretSize=64,this.encSize=133,this.publicKeySize=133,this.privateKeySize=66;break;case st.DhkemX25519HkdfSha256:this._prim=new Ye(this._kdf),this.secretSize=32,this.encSize=32,this.publicKeySize=32,this.privateKeySize=32;break;default:this._prim=new Je(this._kdf),this.secretSize=64,this.encSize=56,this.publicKeySize=56,this.privateKeySize=56;break}}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){try{return await this._prim.deriveKeyPair(e)}catch(r){throw new ke(r)}}async importKey(e,r,t){try{return await this._prim.importKey(e,r,t)}catch(s){throw new le(s)}}async encap(e){try{let r=e.nonEphemeralKeyPair===void 0?await this.generateKeyPair():e.nonEphemeralKeyPair,t=await this._prim.serializePublicKey(r.publicKey),s=await this._prim.serializePublicKey(e.recipientPublicKey),f;if(e.senderKey===void 0)f=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey));else{let _=de(e.senderKey)?e.senderKey.privateKey:e.senderKey,x=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey)),U=new Uint8Array(await this._prim.dh(_,e.recipientPublicKey));f=pe(x,U)}let d;if(e.senderKey===void 0)d=pe(new Uint8Array(t),new Uint8Array(s));else{let _=de(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),x=await this._prim.serializePublicKey(_);d=Cr(new Uint8Array(t),new Uint8Array(s),new Uint8Array(x))}let u=await this.generateSharedSecret(f,d);return{enc:t,sharedSecret:u}}catch(r){throw new Ee(r)}}async decap(e){let r;try{r=await this._prim.deserializePublicKey(e.enc)}catch(t){throw new le(t)}try{let t=de(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,s=de(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),f=await this._prim.serializePublicKey(s),d;if(e.senderPublicKey===void 0)d=new Uint8Array(await this._prim.dh(t,r));else{let _=new Uint8Array(await this._prim.dh(t,r)),x=new Uint8Array(await this._prim.dh(t,e.senderPublicKey));d=pe(_,x)}let u;if(e.senderPublicKey===void 0)u=pe(new Uint8Array(e.enc),new Uint8Array(f));else{let _=await this._prim.serializePublicKey(e.senderPublicKey);u=new Uint8Array(e.enc.byteLength+f.byteLength+_.byteLength),u.set(new Uint8Array(e.enc),0),u.set(new Uint8Array(f),e.enc.byteLength),u.set(new Uint8Array(_),e.enc.byteLength+f.byteLength)}return await this.generateSharedSecret(d,u)}catch(t){throw new Se(t)}}async generateSharedSecret(e,r){let t=this._kdf.buildLabeledIkm(Yr,e),s=this._kdf.buildLabeledInfo($r,r,this.secretSize);return await this._kdf.extractAndExpand(Q,t,s,this.secretSize)}};var er=class extends ne{async seal(e,r=Q){if(this._r.baseNonce.length===0)throw new Xt("Bidirectional encryption is not setup");let t;try{t=await this._r.key.seal(this.computeNonce(this._r),e,r)}catch(s){throw new Xt(s)}return this.incrementSeq(this._r),t}async open(e,r=Q){let t;try{t=await this._f.key.open(this.computeNonce(this._f),e,r)}catch(s){throw new Zt(s)}return this.incrementSeq(this._f),t}};var rr=class extends ne{constructor(e,r,t,s){super(e,r,t),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=s}async seal(e,r=Q){let t;try{t=await this._f.key.seal(this.computeNonce(this._f),e,r)}catch(s){throw new Xt(s)}return this.incrementSeq(this._f),t}async open(e,r=Q){if(this._r.baseNonce.length===0)throw new Zt("Bidirectional encryption is not setup");let t;try{t=await this._r.key.open(this.computeNonce(this._r),e,r)}catch(s){throw new Zt(s)}return this.incrementSeq(this._r),t}};var Lr=class{constructor(e){switch(Object.defineProperty(this,"kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kemSecretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemEncSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPublicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPrivateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadNonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadTagSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.kem){case st.DhkemP256HkdfSha256:this.kemSecretSize=32,this.kemEncSize=65,this.kemPublicKeySize=65,this.kemPrivateKeySize=32;break;case st.DhkemP384HkdfSha384:this.kemSecretSize=48,this.kemEncSize=97,this.kemPublicKeySize=97,this.kemPrivateKeySize=48;break;case st.DhkemP521HkdfSha512:this.kemSecretSize=64,this.kemEncSize=133,this.kemPublicKeySize=133,this.kemPrivateKeySize=66;break;case st.DhkemX25519HkdfSha256:this.kemSecretSize=32,this.kemEncSize=32,this.kemPublicKeySize=32,this.kemPrivateKeySize=32;break;case st.DhkemX448HkdfSha512:this.kemSecretSize=64,this.kemEncSize=56,this.kemPublicKeySize=56,this.kemPrivateKeySize=56;break;default:throw new St("Invalid KEM id")}switch(this.kem=e.kem,e.kdf){case bt.HkdfSha256:case bt.HkdfSha384:case bt.HkdfSha512:break;default:throw new St("Invalid KDF id")}switch(this.kdf=e.kdf,e.aead){case _t.Aes128Gcm:this.aeadKeySize=16,this.aeadNonceSize=12,this.aeadTagSize=16;break;case _t.Aes256Gcm:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case _t.Chacha20Poly1305:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case _t.ExportOnly:break;default:throw new St("Invalid AEAD id")}this.aead=e.aead,this._suiteId=new Uint8Array(Fr),this._suiteId.set(It(this.kem,2),4),this._suiteId.set(It(this.kdf,2),6),this._suiteId.set(It(this.aead,2),8)}async kemContext(){return await this.setup(),this._kem}async kdfContext(){return await this.setup(),this._kdf}async createAeadKey(e){return await this.setup(),Oe(this.aead,e,this._api)}async generateKeyPair(){return await this.setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>128)throw new St("Too long ikm");return await this.setup(),await this._kem.deriveKeyPair(e)}async importKey(e,r,t=!0){return await this.setup(),await this._kem.importKey(e,r,t)}async createSenderContext(e){this.validateInputLength(e),await this.setup();let r=await this._kem.encap(e),t;return e.psk!==void 0?t=e.senderKey!==void 0?Kt.AuthPsk:Kt.Psk:t=e.senderKey!==void 0?Kt.Auth:Kt.Base,await this.keyScheduleS(t,r.sharedSecret,r.enc,e)}async createRecipientContext(e){this.validateInputLength(e),await this.setup();let r=await this._kem.decap(e),t;return e.psk!==void 0?t=e.senderPublicKey!==void 0?Kt.AuthPsk:Kt.Psk:t=e.senderPublicKey!==void 0?Kt.Auth:Kt.Base,await this.keyScheduleR(t,r,e)}async seal(e,r,t=Q){let s=await this.createSenderContext(e);return{ct:await s.seal(r,t),enc:s.enc}}async open(e,r,t=Q){return await(await this.createRecipientContext(e)).open(r,t)}async setup(){this._api=await Gr(),(this._kem===void 0||this._kdf===void 0)&&(this._kem=new tr(this._api,this.kem),this._kdf=new Wt(this._api,this.kdf,this._suiteId))}async keySchedule(e,r,t){let s=new Wt(this._api,this.kdf,this._suiteId),f=t.psk===void 0?Q:new Uint8Array(t.psk.id),d=await s.labeledExtract(Q,Zr,f),u=t.info===void 0?Q:new Uint8Array(t.info),_=await s.labeledExtract(Q,Xr,u),x=new Uint8Array(1+d.byteLength+_.byteLength);x.set(new Uint8Array([e]),0),x.set(new Uint8Array(d),1),x.set(new Uint8Array(_),1+d.byteLength);let U=t.psk===void 0?Q:new Uint8Array(t.psk.key),P=s.buildLabeledIkm(Wr,U),k=s.buildLabeledInfo(ti,x,s.hashSize),b=await s.extractAndExpand(r,P,k,s.hashSize);if(this.aead===_t.ExportOnly)return{params:{aead:this.aead,exporterSecret:b},kdf:s};let H=s.buildLabeledInfo(Qr,x,this.aeadKeySize),T=await s.extractAndExpand(r,P,H,this.aeadKeySize),D=s.buildLabeledInfo(Jr,x,this.aeadNonceSize),M=await s.extractAndExpand(r,P,D,this.aeadNonceSize);return{params:{aead:this.aead,exporterSecret:b,key:T,baseNonce:new Uint8Array(M),seq:0},kdf:s}}async keyScheduleS(e,r,t,s){let f=await this.keySchedule(e,r,s);return f.params.key===void 0?new Ke(this._api,f.kdf,f.params.exporterSecret,t):new rr(this._api,f.kdf,f.params,t)}async keyScheduleR(e,r,t){let s=await this.keySchedule(e,r,t);return s.params.key===void 0?new Te(this._api,s.kdf,s.params.exporterSecret):new er(this._api,s.kdf,s.params)}validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>128)throw new St("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new St(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>128)throw new St("Too long psk.key");if(e.psk.id.byteLength>128)throw new St("Too long psk.id")}}};export{_t as Aead,Lr as CipherSuite,Se as DecapError,ke as DeriveKeyPairError,le as DeserializeError,Ee as EncapError,Ae as ExportError,St as InvalidParamError,bt as Kdf,st as Kem,Pe as MessageLimitReachedError,Ut as NotSupportedError,Zt as OpenError,Xt as SealError,Or as SerializeError,Nr as ValidationError};
