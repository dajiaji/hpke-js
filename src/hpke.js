var Q=class extends Error{constructor(e){let t;e instanceof Error?t=e.message:typeof e=="string"?t=e:t="",super(t),this.name=this.constructor.name}},G=class extends Q{},vt=class extends Q{},R=class extends Q{},M=class extends Q{},Xe=class extends Q{},$e=class extends Q{},We=class extends Q{},Ve=class extends Q{},Ye=class extends Q{},qe=class extends Q{},oe=class extends Q{},$=class extends Q{};var wi={},Pt=xi(globalThis,wi);function xi(r,e){return new Proxy(r,{get(t,i,n){return i in e?e[i]:r[i]},set(t,i,n){return i in e&&delete e[i],r[i]=n,!0},deleteProperty(t,i){let n=!1;return i in e&&(delete e[i],n=!0),i in r&&(delete r[i],n=!0),n},ownKeys(t){let i=Reflect.ownKeys(r),n=Reflect.ownKeys(e),a=new Set(n);return[...i.filter(s=>!a.has(s)),...n]},defineProperty(t,i,n){return i in e&&delete e[i],Reflect.defineProperty(r,i,n),!0},getOwnPropertyDescriptor(t,i){return i in e?Reflect.getOwnPropertyDescriptor(e,i):Reflect.getOwnPropertyDescriptor(r,i)},has(t,i){return i in e||i in r}})}async function mi(){if(Pt!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:r}=await import("crypto");return r.subtle}catch(r){throw new $(r)}}var ie=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await mi())}};var ye={Base:0,Psk:1,Auth:2,AuthPsk:3},_={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48,MlKem512:64,MlKem768:65,MlKem1024:66,XWing:25722},ce={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3,Sha3256:4,Sha3384:5,Sha3512:6,Shake128:16,Shake256:17,TurboShake128:18,TurboShake256:19},ee={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};var j=new Uint8Array(0),re=BigInt(0),ne=BigInt(1),De=BigInt(2),Ar=BigInt(7),Vt=BigInt(32),Er=BigInt(256),Ir=BigInt(113);var kt=new Uint8Array([75,69,77,0,0]);var Ie=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function se(r,e){if(e<=0)throw new Error("i2Osp: too small size");if(r>=256**e)throw new Error("i2Osp: too large integer");let t=new Uint8Array(e);for(let i=0;i<e&&r;i++)t[e-(i+1)]=r%256,r=r>>8;return t}function Te(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r,0),t.set(e,r.length),t}function fe(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i}async function Yt(){if(Pt!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("Web Cryptograph API not supported")}}function qt(r,e){if(r.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let t=new Uint8Array(r.byteLength);for(let i=0;i<r.byteLength;i++)t[i]=r[i]^e[i];return t}var gi=new Uint8Array([101,97,101,95,112,114,107]),_i=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);function vi(r,e,t){let i=new Uint8Array(r.length+e.length+t.length);return i.set(r,0),i.set(e,r.length),i.set(t,r.length+e.length),i}var te=class{constructor(e,t,i){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e,this._prim=t,this._kdf=i;let n=new Uint8Array(kt);n.set(se(this.id,2),3),this._kdf.init(n)}async serializePublicKey(e){return await this._prim.serializePublicKey(e)}async deserializePublicKey(e){return await this._prim.deserializePublicKey(e)}async serializePrivateKey(e){return await this._prim.serializePrivateKey(e)}async deserializePrivateKey(e){return await this._prim.deserializePrivateKey(e)}async importKey(e,t,i=!0){return await this._prim.importKey(e,t,i)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>8192)throw new G("Too long ikm");return await this._prim.deriveKeyPair(e)}async encap(e){let t;e.ekm===void 0?t=await this.generateKeyPair():Ie(e.ekm)?t=e.ekm:t=await this.deriveKeyPair(e.ekm);let i=await this._prim.serializePublicKey(t.publicKey),n=await this._prim.serializePublicKey(e.recipientPublicKey);try{let a;if(e.senderKey===void 0)a=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey));else{let u=Ie(e.senderKey)?e.senderKey.privateKey:e.senderKey,l=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey)),f=new Uint8Array(await this._prim.dh(u,e.recipientPublicKey));a=Te(l,f)}let s;if(e.senderKey===void 0)s=Te(new Uint8Array(i),new Uint8Array(n));else{let u=Ie(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),l=await this._prim.serializePublicKey(u);s=vi(new Uint8Array(i),new Uint8Array(n),new Uint8Array(l))}let o=await this._generateSharedSecret(a,s);return{enc:i,sharedSecret:o}}catch(a){throw new Xe(a)}}async decap(e){let t=await this._prim.deserializePublicKey(e.enc),i=Ie(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,n=Ie(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),a=await this._prim.serializePublicKey(n);try{let s;if(e.senderPublicKey===void 0)s=new Uint8Array(await this._prim.dh(i,t));else{let u=new Uint8Array(await this._prim.dh(i,t)),l=new Uint8Array(await this._prim.dh(i,e.senderPublicKey));s=Te(u,l)}let o;if(e.senderPublicKey===void 0)o=Te(new Uint8Array(e.enc),new Uint8Array(a));else{let u=await this._prim.serializePublicKey(e.senderPublicKey);o=new Uint8Array(e.enc.byteLength+a.byteLength+u.byteLength),o.set(new Uint8Array(e.enc),0),o.set(new Uint8Array(a),e.enc.byteLength),o.set(new Uint8Array(u),e.enc.byteLength+a.byteLength)}return await this._generateSharedSecret(s,o)}catch(s){throw new $e(s)}}async _generateSharedSecret(e,t){let i=this._kdf.buildLabeledIkm(gi,e),n=this._kdf.buildLabeledInfo(_i,t,this.secretSize);return await this._kdf.extractAndExpand(j.buffer,i.buffer,n.buffer,this.secretSize)}};var Y=["deriveBits"],we=new Uint8Array([100,107,112,95,112,114,107]),Oe=new Uint8Array([115,107]);var Kt=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let t=0;t<this._num.length;t++){if(this._num[t]<e[t])return!0;if(this._num[t]>e[t])return!1}return!1}};var Pi=new Uint8Array([99,97,110,100,105,100,97,116,101]),ki=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),Ki=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),Si=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),Ai=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),Ei=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),Ii=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),xe=class extends ie{constructor(e,t){switch(super(),Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,e){case _.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=ki,this._bitmask=255,this._pkcs8AlgId=Ai;break;case _.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=Ki,this._bitmask=255,this._pkcs8AlgId=Ei;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=Si,this._bitmask=1,this._pkcs8AlgId=Ii;break}}async serializePublicKey(e){await this._setup();try{return await this._api.exportKey("raw",e)}catch(t){throw new R(t)}}async deserializePublicKey(e){await this._setup();try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){await this._setup();try{let t=await this._api.exportKey("jwk",e);if(!("d"in t))throw new Error("Not private key");return fe(t.d).buffer}catch(t){throw new R(t)}}async deserializePrivateKey(e){await this._setup();try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){await this._setup();try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){await this._setup();try{return await this._api.generateKey(this._alg,!0,Y)}catch(e){throw new $(e)}}async deriveKeyPair(e){await this._setup();try{let t=await this._hkdf.labeledExtract(j.buffer,we,new Uint8Array(e)),i=new Kt(this._nSk);for(let a=0;i.isZero()||!i.lessThan(this._order);a++){if(a>255)throw new Error("Faild to derive a key pair");let s=new Uint8Array(await this._hkdf.labeledExpand(t,Pi,se(a,1),this._nSk));s[0]=s[0]&this._bitmask,i.set(s)}let n=await this._deserializePkcs8Key(i.val());return i.reset(),{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new oe(t)}}async derivePublicKey(e){await this._setup();try{let t=await this._api.exportKey("jwk",e);return delete t.d,delete t.key_ops,await this._api.importKey("jwk",t,this._alg,!0,[])}catch(t){throw new M(t)}}async dh(e,t){try{return await this._setup(),await this._api.deriveBits({name:"ECDH",public:t},e,this._nDh*8)}catch(i){throw new R(i)}}async _importRawKey(e,t){if(t&&e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!t&&e.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");return t?await this._api.importKey("raw",e,this._alg,!0,[]):await this._deserializePkcs8Key(new Uint8Array(e))}async _importJWK(e,t){if(typeof e.crv>"u"||e.crv!==this._alg.namedCurve)throw new Error(`Invalid crv: ${e.crv}`);if(t){if(typeof e.d<"u")throw new Error("Invalid key: `d` should not be set");return await this._api.importKey("jwk",e,this._alg,!0,[])}if(typeof e.d>"u")throw new Error("Invalid key: `d` not found");return await this._api.importKey("jwk",e,this._alg,!0,Y)}async _deserializePkcs8Key(e){let t=new Uint8Array(this._pkcs8AlgId.length+e.length);return t.set(this._pkcs8AlgId,0),t.set(e,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",t,this._alg,!0,Y)}};var W=class{constructor(e,t,i,n=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=t,this.type=i,this.algorithm={name:e},this.usages=n,i==="public"&&(this.usages=[])}};var Or=new Uint8Array([72,80,75,69,45,118,49]),ot=class extends ie{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ce.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:j}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(e){this._suiteId=e}buildLabeledIkm(e,t){this._checkInit();let i=new Uint8Array(7+this._suiteId.byteLength+e.byteLength+t.byteLength);return i.set(Or,0),i.set(this._suiteId,7),i.set(e,7+this._suiteId.byteLength),i.set(t,7+this._suiteId.byteLength+e.byteLength),i}buildLabeledInfo(e,t,i){this._checkInit();let n=new Uint8Array(9+this._suiteId.byteLength+e.byteLength+t.byteLength);return n.set(new Uint8Array([0,i]),0),n.set(Or,2),n.set(this._suiteId,9),n.set(e,9+this._suiteId.byteLength),n.set(t,9+this._suiteId.byteLength+e.byteLength),n}async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)throw new G("The salt length must be the same as the hashSize");let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}async expand(e,t,i){await this._setup();let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),a=new ArrayBuffer(i),s=new Uint8Array(a),o=j,u=new Uint8Array(t),l=new Uint8Array(1);if(i>255*this.hashSize)throw new Error("Entropy limit reached");let f=new Uint8Array(this.hashSize+u.length+1);for(let c=1,h=0;h<s.length;c++)l[0]=c,f.set(o,0),f.set(u,o.length),f.set(l,o.length+u.length),o=new Uint8Array(await this._api.sign("HMAC",n,f.slice(0,o.length+u.length+1))),s.length-h>=o.length?(s.set(o,h),h+=o.length):(s.set(o.slice(0,s.length-h),h),h+=s.length-h);return a}async extractAndExpand(e,t,i,n){await this._setup();let a=await this._api.importKey("raw",t,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:i},a,n*8)}async labeledExtract(e,t,i){return await this.extract(e,this.buildLabeledIkm(t,i).buffer)}async labeledExpand(e,t,i,n){return await this.expand(e,this.buildLabeledInfo(t,i,n).buffer,n)}_checkInit(){if(this._suiteId===j)throw new Error("Not initialized. Call init()")}},Le=class extends ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ce.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}},Ne=class extends ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ce.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}},je=class extends ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ce.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var Jt=["encrypt","decrypt"];function Oi(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Je(r,e=""){if(!Number.isSafeInteger(r)||r<0){let t=e&&`"${e}" `;throw new Error(`${t}expected integer >0, got ${r}`)}}function ae(r,e,t=""){let i=Oi(r),n=r?.length,a=e!==void 0;if(!i||a&&n!==e){let s=t&&`"${t}" `,o=a?` of length ${e}`:"",u=i?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+u)}return r}function Me(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Zt(r,e){ae(r,void 0,"digestInto() output");let t=e.outputLen;if(r.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function Li(r){if(typeof r=="bigint"){if(!St(r))throw new Error("positive bigint expected, got "+r)}else Je(r);return r}function me(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}var ji=new Uint32Array([287454020]),Hi=new Uint8Array(ji.buffer),ka=Hi[0]===68;function At(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function le(r,e){return r<<32-e|r>>>e}var jr=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Ui=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Bi(r){if(ae(r),jr)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=Ui[r[t]];return e}var Pe={_0:48,_9:57,A:65,F:70,a:97,f:102};function Lr(r){if(r>=Pe._0&&r<=Pe._9)return r-Pe._0;if(r>=Pe.A&&r<=Pe.F)return r-(Pe.A-10);if(r>=Pe.a&&r<=Pe.f)return r-(Pe.a-10)}function zi(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(jr)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let i=new Uint8Array(t);for(let n=0,a=0;n<t;n++,a+=2){let s=Lr(r.charCodeAt(a)),o=Lr(r.charCodeAt(a+1));if(s===void 0||o===void 0){let u=r[a]+r[a+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+a)}i[n]=s*16+o}return i}function Di(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?re:BigInt("0x"+r)}function Qt(r){return Di(Bi(Et(ae(r)).reverse()))}function Ti(r,e){Je(e),r=Li(r);let t=zi(r.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function Hr(r,e){return Ti(r,e).reverse()}function Et(r){return Uint8Array.from(r)}function St(r){return typeof r=="bigint"&&re<=r}function Ci(r,e,t){return St(r)&&St(e)&&St(t)&&e<=r&&r<t}function er(r,e,t,i){if(!Ci(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Ur(r,e={},t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function i(a,s,o){let u=r[a];if(o&&u===void 0)return;let l=typeof u;if(l!==s||u===null)throw new Error(`param "${a}" is invalid: expected ${s}, got ${l}`)}let n=(a,s)=>Object.entries(a).forEach(([o,u])=>i(o,u,s));n(e,!1),n(t,!0)}async function Br(r=32){let e=await Yt(),t=new Uint8Array(r);return e.getRandomValues(t),t}function st(r){return{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,r])}}function zr(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Je(r.outputLen),Je(r.blockLen)}function ut(r,e={}){let t=(a,s)=>r(s).update(a).digest(),i=r(void 0),n=Object.assign(t,{outputLen:i.outputLen,blockLen:i.blockLen,create:a=>r(a),...e});return Object.freeze(n)}var It=class{constructor(e,t){if(Object.defineProperty(this,"oHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),zr(e),ae(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,n=new Uint8Array(i);n.set(t.length>i?e.create().update(t).digest():t);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),me(n)}update(e){return Me(this),this.iHash.update(e),this}digestInto(e){Me(this),ae(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:i,finished:n,destroyed:a,blockLen:s,outputLen:o}=this;return e=e,e.finished=n,e.destroyed=a,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},He=(r,e,t)=>new It(r,e).update(t).digest();He.create=(r,e)=>new It(r,e);function Dr(r,e,t){return r&e^~r&t}function Tr(r,e,t){return r&e^r&t^e&t}var ct=class{constructor(e,t,i,n){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"padOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isLE",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"view",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=At(this.buffer)}update(e){Me(this),ae(e);let{view:t,buffer:i,blockLen:n}=this,a=e.length;for(let s=0;s<a;){let o=Math.min(n-this.pos,a-s);if(o===n){let u=At(e);for(;n<=a-s;s+=n)this.process(u,s);continue}i.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Me(this),Zt(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:n,isLE:a}=this,{pos:s}=this;t[s++]=128,me(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(i,0),s=0);for(let c=s;c<n;c++)t[c]=0;i.setBigUint64(n-8,BigInt(this.length*8),a),this.process(i,0);let o=At(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let l=u/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<l;c++)o.setUint32(4*c,f[c],a)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:i,length:n,finished:a,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=a,e.length=n,e.pos=o,n%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}},ke=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),q=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var Ot=BigInt(2**32-1);function Ni(r,e=!1){return e?{h:Number(r&Ot),l:Number(r>>Vt&Ot)}:{h:Number(r>>Vt&Ot)|0,l:Number(r&Ot)|0}}function Lt(r,e=!1){let t=r.length,i=new Uint32Array(t),n=new Uint32Array(t);for(let a=0;a<t;a++){let{h:s,l:o}=Ni(r[a],e);[i[a],n[a]]=[s,o]}return[i,n]}var tr=(r,e,t)=>r>>>t,rr=(r,e,t)=>r<<32-t|e>>>t,Ge=(r,e,t)=>r>>>t|e<<32-t,Re=(r,e,t)=>r<<32-t|e>>>t,ft=(r,e,t)=>r<<64-t|e>>>t-32,lt=(r,e,t)=>r>>>t-32|e<<64-t;function ge(r,e,t,i){let n=(e>>>0)+(i>>>0);return{h:r+t+(n/2**32|0)|0,l:n|0}}var Cr=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Nr=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,Mr=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),Gr=(r,e,t,i,n)=>e+t+i+n+(r/2**32|0)|0,Rr=(r,e,t,i,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(n>>>0),Fr=(r,e,t,i,n,a)=>e+t+i+n+a+(r/2**32|0)|0;var Gi=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ue=new Uint32Array(64),ir=class extends ct{constructor(e){super(64,e,8,!1)}get(){let{A:e,B:t,C:i,D:n,E:a,F:s,G:o,H:u}=this;return[e,t,i,n,a,s,o,u]}set(e,t,i,n,a,s,o,u){this.A=e|0,this.B=t|0,this.C=i|0,this.D=n|0,this.E=a|0,this.F=s|0,this.G=o|0,this.H=u|0}process(e,t){for(let c=0;c<16;c++,t+=4)Ue[c]=e.getUint32(t,!1);for(let c=16;c<64;c++){let h=Ue[c-15],p=Ue[c-2],x=le(h,7)^le(h,18)^h>>>3,w=le(p,17)^le(p,19)^p>>>10;Ue[c]=w+Ue[c-7]+x+Ue[c-16]|0}let{A:i,B:n,C:a,D:s,E:o,F:u,G:l,H:f}=this;for(let c=0;c<64;c++){let h=le(o,6)^le(o,11)^le(o,25),p=f+h+Dr(o,u,l)+Gi[c]+Ue[c]|0,w=(le(i,2)^le(i,13)^le(i,22))+Tr(i,n,a)|0;f=l,l=u,u=o,o=s+p|0,s=a,a=n,n=i,i=p+w|0}i=i+this.A|0,n=n+this.B|0,a=a+this.C|0,s=s+this.D|0,o=o+this.E|0,u=u+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,n,a,s,o,u,l,f)}roundClean(){me(Ue)}destroy(){this.set(0,0,0,0,0,0,0,0),me(this.buffer)}},nr=class extends ir{constructor(){super(32),Object.defineProperty(this,"A",{enumerable:!0,configurable:!0,writable:!0,value:ke[0]|0}),Object.defineProperty(this,"B",{enumerable:!0,configurable:!0,writable:!0,value:ke[1]|0}),Object.defineProperty(this,"C",{enumerable:!0,configurable:!0,writable:!0,value:ke[2]|0}),Object.defineProperty(this,"D",{enumerable:!0,configurable:!0,writable:!0,value:ke[3]|0}),Object.defineProperty(this,"E",{enumerable:!0,configurable:!0,writable:!0,value:ke[4]|0}),Object.defineProperty(this,"F",{enumerable:!0,configurable:!0,writable:!0,value:ke[5]|0}),Object.defineProperty(this,"G",{enumerable:!0,configurable:!0,writable:!0,value:ke[6]|0}),Object.defineProperty(this,"H",{enumerable:!0,configurable:!0,writable:!0,value:ke[7]|0})}},Xr=Lt(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Ri=Xr[0],Fi=Xr[1],Be=new Uint32Array(80),ze=new Uint32Array(80),jt=class extends ct{constructor(e){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:i,Bl:n,Ch:a,Cl:s,Dh:o,Dl:u,Eh:l,El:f,Fh:c,Fl:h,Gh:p,Gl:x,Hh:w,Hl:b}=this;return[e,t,i,n,a,s,o,u,l,f,c,h,p,x,w,b]}set(e,t,i,n,a,s,o,u,l,f,c,h,p,x,w,b){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=n|0,this.Ch=a|0,this.Cl=s|0,this.Dh=o|0,this.Dl=u|0,this.Eh=l|0,this.El=f|0,this.Fh=c|0,this.Fl=h|0,this.Gh=p|0,this.Gl=x|0,this.Hh=w|0,this.Hl=b|0}process(e,t){for(let v=0;v<16;v++,t+=4)Be[v]=e.getUint32(t),ze[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){let F=Be[v-15]|0,X=ze[v-15]|0,T=Ge(F,X,1)^Ge(F,X,8)^tr(F,X,7),C=Re(F,X,1)^Re(F,X,8)^rr(F,X,7),z=Be[v-2]|0,g=ze[v-2]|0,A=Ge(z,g,19)^ft(z,g,61)^tr(z,g,6),E=Re(z,g,19)^lt(z,g,61)^rr(z,g,6),S=Mr(C,E,ze[v-7],ze[v-16]),I=Gr(S,T,A,Be[v-7],Be[v-16]);Be[v]=I|0,ze[v]=S|0}let{Ah:i,Al:n,Bh:a,Bl:s,Ch:o,Cl:u,Dh:l,Dl:f,Eh:c,El:h,Fh:p,Fl:x,Gh:w,Gl:b,Hh:B,Hl:N}=this;for(let v=0;v<80;v++){let F=Ge(c,h,14)^Ge(c,h,18)^ft(c,h,41),X=Re(c,h,14)^Re(c,h,18)^lt(c,h,41),T=c&p^~c&w,C=h&x^~h&b,z=Rr(N,X,C,Fi[v],ze[v]),g=Fr(z,B,F,T,Ri[v],Be[v]),A=z|0,E=Ge(i,n,28)^ft(i,n,34)^ft(i,n,39),S=Re(i,n,28)^lt(i,n,34)^lt(i,n,39),I=i&a^i&o^a&o,y=n&s^n&u^s&u;B=w|0,N=b|0,w=p|0,b=x|0,p=c|0,x=h|0,{h:c,l:h}=ge(l|0,f|0,g|0,A|0),l=o|0,f=u|0,o=a|0,u=s|0,a=i|0,s=n|0;let m=Cr(A,S,y);i=Nr(m,g,E,I),n=m|0}({h:i,l:n}=ge(this.Ah|0,this.Al|0,i|0,n|0)),{h:a,l:s}=ge(this.Bh|0,this.Bl|0,a|0,s|0),{h:o,l:u}=ge(this.Ch|0,this.Cl|0,o|0,u|0),{h:l,l:f}=ge(this.Dh|0,this.Dl|0,l|0,f|0),{h:c,l:h}=ge(this.Eh|0,this.El|0,c|0,h|0),{h:p,l:x}=ge(this.Fh|0,this.Fl|0,p|0,x|0),{h:w,l:b}=ge(this.Gh|0,this.Gl|0,w|0,b|0),{h:B,l:N}=ge(this.Hh|0,this.Hl|0,B|0,N|0),this.set(i,n,a,s,o,u,l,f,c,h,p,x,w,b,B,N)}roundClean(){me(Be,ze)}destroy(){me(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},ar=class extends jt{constructor(){super(64),Object.defineProperty(this,"Ah",{enumerable:!0,configurable:!0,writable:!0,value:J[0]|0}),Object.defineProperty(this,"Al",{enumerable:!0,configurable:!0,writable:!0,value:J[1]|0}),Object.defineProperty(this,"Bh",{enumerable:!0,configurable:!0,writable:!0,value:J[2]|0}),Object.defineProperty(this,"Bl",{enumerable:!0,configurable:!0,writable:!0,value:J[3]|0}),Object.defineProperty(this,"Ch",{enumerable:!0,configurable:!0,writable:!0,value:J[4]|0}),Object.defineProperty(this,"Cl",{enumerable:!0,configurable:!0,writable:!0,value:J[5]|0}),Object.defineProperty(this,"Dh",{enumerable:!0,configurable:!0,writable:!0,value:J[6]|0}),Object.defineProperty(this,"Dl",{enumerable:!0,configurable:!0,writable:!0,value:J[7]|0}),Object.defineProperty(this,"Eh",{enumerable:!0,configurable:!0,writable:!0,value:J[8]|0}),Object.defineProperty(this,"El",{enumerable:!0,configurable:!0,writable:!0,value:J[9]|0}),Object.defineProperty(this,"Fh",{enumerable:!0,configurable:!0,writable:!0,value:J[10]|0}),Object.defineProperty(this,"Fl",{enumerable:!0,configurable:!0,writable:!0,value:J[11]|0}),Object.defineProperty(this,"Gh",{enumerable:!0,configurable:!0,writable:!0,value:J[12]|0}),Object.defineProperty(this,"Gl",{enumerable:!0,configurable:!0,writable:!0,value:J[13]|0}),Object.defineProperty(this,"Hh",{enumerable:!0,configurable:!0,writable:!0,value:J[14]|0}),Object.defineProperty(this,"Hl",{enumerable:!0,configurable:!0,writable:!0,value:J[15]|0})}},or=class extends jt{constructor(){super(48),Object.defineProperty(this,"Ah",{enumerable:!0,configurable:!0,writable:!0,value:q[0]|0}),Object.defineProperty(this,"Al",{enumerable:!0,configurable:!0,writable:!0,value:q[1]|0}),Object.defineProperty(this,"Bh",{enumerable:!0,configurable:!0,writable:!0,value:q[2]|0}),Object.defineProperty(this,"Bl",{enumerable:!0,configurable:!0,writable:!0,value:q[3]|0}),Object.defineProperty(this,"Ch",{enumerable:!0,configurable:!0,writable:!0,value:q[4]|0}),Object.defineProperty(this,"Cl",{enumerable:!0,configurable:!0,writable:!0,value:q[5]|0}),Object.defineProperty(this,"Dh",{enumerable:!0,configurable:!0,writable:!0,value:q[6]|0}),Object.defineProperty(this,"Dl",{enumerable:!0,configurable:!0,writable:!0,value:q[7]|0}),Object.defineProperty(this,"Eh",{enumerable:!0,configurable:!0,writable:!0,value:q[8]|0}),Object.defineProperty(this,"El",{enumerable:!0,configurable:!0,writable:!0,value:q[9]|0}),Object.defineProperty(this,"Fh",{enumerable:!0,configurable:!0,writable:!0,value:q[10]|0}),Object.defineProperty(this,"Fl",{enumerable:!0,configurable:!0,writable:!0,value:q[11]|0}),Object.defineProperty(this,"Gh",{enumerable:!0,configurable:!0,writable:!0,value:q[12]|0}),Object.defineProperty(this,"Gl",{enumerable:!0,configurable:!0,writable:!0,value:q[13]|0}),Object.defineProperty(this,"Hh",{enumerable:!0,configurable:!0,writable:!0,value:q[14]|0}),Object.defineProperty(this,"Hl",{enumerable:!0,configurable:!0,writable:!0,value:q[15]|0})}},sr=ut(()=>new nr,st(1)),ur=ut(()=>new ar,st(3)),cr=ut(()=>new or,st(2));var Xi=[],$i=[],$r=[];for(let r=0,e=ne,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Xi.push(2*(5*i+t)),$i.push((r+1)*(r+2)/2%64);let n=re;for(let a=0;a<7;a++)e=(e<<ne^(e>>Ar)*Ir)%Er,e&De&&(n^=ne<<(ne<<BigInt(a))-ne);$r.push(n)}var Wr=Lt($r,!0),Va=Wr[0],Ya=Wr[1];function Fe(r,e){let t=r%e;return t>=re?t:e+t}function D(r,e,t){let i=r;for(;e-- >re;)i*=i,i%=t;return i}function Vr(r,e){return function(i){let n=r(i);return{secretKey:n,publicKey:e(n)}}}function Wi(r){return Ur(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function ht(r){let e=Wi(r),{P:t,type:i,adjustScalarBytes:n,powPminus2:a,randomBytes:s}=e,o=i==="x25519";if(!o&&i!=="x448")throw new Error("invalid type");let u=s||Br,l=o?255:448,f=o?32:56,c=BigInt(o?9:5),h=BigInt(o?121665:39081),p=o?De**BigInt(254):De**BigInt(447),x=o?BigInt(8)*De**BigInt(251)-ne:BigInt(4)*De**BigInt(445)-ne,w=p+x+ne,b=y=>Fe(y,t),B=N(c);function N(y){return Hr(b(y),f)}function v(y){let m=Et(ae(y,f,"uCoordinate"));return o&&(m[31]&=127),b(Qt(m))}function F(y){return Qt(n(Et(ae(y,f,"scalar"))))}function X(y,m){let P=A(v(m),F(y));if(P===re)throw new Error("invalid private or public key received");return N(P)}function T(y){return X(y,B)}let C=T,z=X;function g(y,m,P){let H=b(y*(m-P));return m=b(m-H),P=b(P+H),{x_2:m,x_3:P}}function A(y,m){er("u",y,re,t),er("scalar",m,p,w);let P=m,H=y,k=ne,d=re,O=y,U=ne,L=re;for(let he=BigInt(l-1);he>=re;he--){let _e=P>>he&ne;L^=_e,{x_2:k,x_3:O}=g(L,k,O),{x_2:d,x_3:U}=g(L,d,U),L=_e;let de=k+d,be=b(de*de),pe=k-d,ve=b(pe*pe),_r=be-ve,pi=O+U,yi=O-U,vr=b(yi*de),Pr=b(pi*pe),kr=vr+Pr,Kr=vr-Pr;O=b(kr*kr),U=b(H*b(Kr*Kr)),k=b(be*ve),d=b(_r*(be+b(h*_r)))}({x_2:k,x_3:O}=g(L,k,O)),{x_2:d,x_3:U}=g(L,d,U);let ue=a(d);return b(k*ue)}let E={secretKey:f,publicKey:f,seed:f},S=async y=>(y===void 0&&(y=await u(f)),ae(y,E.seed,"seed"),y),I={randomSecretKey:S};return Object.freeze({keygen:Vr(S,C),getSharedSecret:z,getPublicKey:C,scalarMult:X,scalarMultBase:T,utils:I,GuBytes:B.slice(),lengths:E})}var lr=class extends ie{constructor(e){super(),Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e}async seal(e,t,i){await this._setupKey();let n={name:"AES-GCM",iv:e,additionalData:i};return await this._api.encrypt(n,this._key,t)}async open(e,t,i){await this._setupKey();let n={name:"AES-GCM",iv:e,additionalData:i};return await this._api.decrypt(n,this._key,t)}async _setupKey(){if(this._key!==void 0)return;await this._setup();let e=await this._importKey(this._rawKey);new Uint8Array(this._rawKey).fill(0),this._key=e}async _importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,Jt)}},Ze=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new lr(e)}},dt=class extends Ze{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}};var bt=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.ExportOnly}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}createEncryptionContext(e){throw new $("Export only")}};function hr(){return new Promise((r,e)=>{e(new $("Not supported"))})}var Vi=new Uint8Array([115,101,99]),Qe=class{constructor(e,t,i){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e,this._kdf=t,this.exporterSecret=i}async seal(e,t){return await hr()}async open(e,t){return await hr()}async export(e,t){if(e.byteLength>8192)throw new G("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,Vi,new Uint8Array(e),t)}catch(i){throw new We(i)}}},Ht=class extends Qe{},Ut=class extends Qe{constructor(e,t,i,n){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=n}};var et=class extends Qe{constructor(e,t,i){if(super(e,t,i.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),i.key===void 0||i.baseNonce===void 0||i.seq===void 0)throw new Error("Required parameters are missing");this._aead=i.aead,this._nK=this._aead.keySize,this._nN=this._aead.nonceSize,this._nT=this._aead.tagSize;let n=this._aead.createEncryptionContext(i.key);this._ctx={key:n,baseNonce:i.baseNonce,seq:i.seq}}computeNonce(e){let t=se(e.seq,e.baseNonce.byteLength);return qt(e.baseNonce,t).buffer}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new qe("Message limit reached");e.seq+=1}};var Yi=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},qi=function(r,e,t,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},Bt,tt=class{constructor(){Bt.set(this,Promise.resolve())}async lock(){let e,t=new Promise(n=>{e=n}),i=Yi(this,Bt,"f");return qi(this,Bt,t,"f"),await i,e}};Bt=new WeakMap;var qr=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},Ji=function(r,e,t,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},pt,zt=class extends et{constructor(){super(...arguments),pt.set(this,void 0)}async open(e,t=j.buffer){Ji(this,pt,qr(this,pt,"f")??new tt,"f");let i=await qr(this,pt,"f").lock(),n;try{n=await this._ctx.key.open(this.computeNonce(this._ctx),e,t)}catch(a){throw new Ye(a)}finally{i()}return this.incrementSeq(this._ctx),n}};pt=new WeakMap;var Jr=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},Zi=function(r,e,t,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},yt,Dt=class extends et{constructor(e,t,i,n){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),yt.set(this,void 0),this.enc=n}async seal(e,t=j.buffer){Zi(this,yt,Jr(this,yt,"f")??new tt,"f");let i=await Jr(this,yt,"f").lock(),n;try{n=await this._ctx.key.seal(this.computeNonce(this._ctx),e,t)}catch(a){throw new Ve(a)}finally{i()}return this.incrementSeq(this._ctx),n}};yt=new WeakMap;var Qi=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),en=new Uint8Array([101,120,112]),tn=new Uint8Array([105,110,102,111,95,104,97,115,104]),rn=new Uint8Array([107,101,121]),nn=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),an=new Uint8Array([115,101,99,114,101,116]),on=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),Tt=class extends ie{constructor(e){if(super(),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e.kem=="number")throw new G("KemId cannot be used");if(this._kem=e.kem,typeof e.kdf=="number")throw new G("KdfId cannot be used");if(this._kdf=e.kdf,typeof e.aead=="number")throw new G("AeadId cannot be used");this._aead=e.aead,this._suiteId=new Uint8Array(on),this._suiteId.set(se(this._kem.id,2),4),this._suiteId.set(se(this._kdf.id,2),6),this._suiteId.set(se(this._aead.id,2),8),this._kdf.init(this._suiteId)}get kem(){return this._kem}get kdf(){return this._kdf}get aead(){return this._aead}async createSenderContext(e){this._validateInputLength(e),await this._setup();let t=await this._kem.encap(e),i;return e.psk!==void 0?i=e.senderKey!==void 0?ye.AuthPsk:ye.Psk:i=e.senderKey!==void 0?ye.Auth:ye.Base,await this._keyScheduleS(i,t.sharedSecret,t.enc,e)}async createRecipientContext(e){this._validateInputLength(e),await this._setup();let t=await this._kem.decap(e),i;return e.psk!==void 0?i=e.senderPublicKey!==void 0?ye.AuthPsk:ye.Psk:i=e.senderPublicKey!==void 0?ye.Auth:ye.Base,await this._keyScheduleR(i,t,e)}async seal(e,t,i=j.buffer){let n=await this.createSenderContext(e);return{ct:await n.seal(t,i),enc:n.enc}}async open(e,t,i=j.buffer){return await(await this.createRecipientContext(e)).open(t,i)}async _keySchedule(e,t,i){let n=i.psk===void 0?j:new Uint8Array(i.psk.id),a=await this._kdf.labeledExtract(j.buffer,nn,n),s=i.info===void 0?j:new Uint8Array(i.info),o=await this._kdf.labeledExtract(j.buffer,tn,s),u=new Uint8Array(1+a.byteLength+o.byteLength);u.set(new Uint8Array([e]),0),u.set(new Uint8Array(a),1),u.set(new Uint8Array(o),1+a.byteLength);let l=i.psk===void 0?j:new Uint8Array(i.psk.key),f=this._kdf.buildLabeledIkm(an,l).buffer,c=this._kdf.buildLabeledInfo(en,u,this._kdf.hashSize).buffer,h=await this._kdf.extractAndExpand(t,f,c,this._kdf.hashSize);if(this._aead.id===ee.ExportOnly)return{aead:this._aead,exporterSecret:h};let p=this._kdf.buildLabeledInfo(rn,u,this._aead.keySize).buffer,x=await this._kdf.extractAndExpand(t,f,p,this._aead.keySize),w=this._kdf.buildLabeledInfo(Qi,u,this._aead.nonceSize).buffer,b=await this._kdf.extractAndExpand(t,f,w,this._aead.nonceSize);return{aead:this._aead,exporterSecret:h,key:x,baseNonce:new Uint8Array(b),seq:0}}async _keyScheduleS(e,t,i,n){let a=await this._keySchedule(e,t,n);return a.key===void 0?new Ut(this._api,this._kdf,a.exporterSecret,i):new Dt(this._api,this._kdf,a,i)}async _keyScheduleR(e,t,i){let n=await this._keySchedule(e,t,i);return n.key===void 0?new Ht(this._api,this._kdf,n.exporterSecret):new zt(this._api,this._kdf,n)}_validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>65536)throw new G("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new G(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>8192)throw new G("Too long psk.key");if(e.psk.id.byteLength>8192)throw new G("Too long psk.id")}}};var wt=class extends Tt{};var ms=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,110,4,34,4,32]);var Ss=new Uint8Array([48,70,2,1,0,48,5,6,3,43,101,111,4,58,4,56]);var sn={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48},un={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},cn={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};function fn(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ct(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Nt(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function V(r,e,t=""){let i=fn(r),n=r?.length,a=e!==void 0;if(!i||a&&n!==e){let s=t&&`"${t}" `,o=a?` of length ${e}`:"",u=i?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+u)}return r}function dr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Zr(r,e){V(r,void 0,"output");let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Ke(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Se(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function ln(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var hn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Qr(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function ei(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}var ti=(r,e)=>{function t(i,...n){if(V(i,void 0,"key"),!hn)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let f=n[0];V(f,r.varSizeNonce?void 0:r.nonceLength,"nonce")}let a=r.tagLength;a&&n[1]!==void 0&&V(n[1],void 0,"AAD");let s=e(i,...n),o=(f,c)=>{if(c!==void 0){if(f!==2)throw new Error("cipher output not supported");V(c,void 0,"output")}},u=!1;return{encrypt(f,c){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,V(f),o(s.encrypt.length,c),s.encrypt(f,c)},decrypt(f,c){if(V(f),a&&f.length<a)throw new Error('"ciphertext" expected length bigger than tagLength='+a);return o(s.decrypt.length,c),s.decrypt(f,c)}}}return Object.assign(t,r),t};function br(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error('"output" expected Uint8Array of length '+r+", got: "+e.length);if(t&&!dn(e))throw new Error("invalid output, must be aligned");return e}function ri(r,e,t){Ct(t);let i=new Uint8Array(16),n=ln(i);return n.setBigUint64(0,BigInt(e),t),n.setBigUint64(8,BigInt(r),t),i}function dn(r){return r.byteOffset%4===0}function rt(r){return Uint8Array.from(r)}var ni=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),bn=ni("expand 16-byte k"),pn=ni("expand 32-byte k"),yn=Ke(bn),wn=Ke(pn);function K(r,e){return r<<e|r>>>32-e}function pr(r){return r.byteOffset%4===0}var Mt=64,xn=16,ai=2**32-1,ii=Uint32Array.of();function mn(r,e,t,i,n,a,s,o){let u=n.length,l=new Uint8Array(Mt),f=Ke(l),c=pr(n)&&pr(a),h=c?Ke(n):ii,p=c?Ke(a):ii;for(let x=0;x<u;s++){if(r(e,t,i,f,s,o),s>=ai)throw new Error("arx: counter overflow");let w=Math.min(Mt,u-x);if(c&&w===Mt){let b=x/4;if(x%4!==0)throw new Error("arx: invalid block position");for(let B=0,N;B<xn;B++)N=b+B,p[N]=h[N]^f[B];x+=Mt;continue}for(let b=0,B;b<w;b++)B=x+b,a[B]=n[B]^l[b];x+=w}}function oi(r,e){let{allowShortKeys:t,extendNonceFn:i,counterLength:n,counterRight:a,rounds:s}=Qr({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Nt(n),Nt(s),Ct(a),Ct(t),(o,u,l,f,c=0)=>{V(o,void 0,"key"),V(u,void 0,"nonce"),V(l,void 0,"data");let h=l.length;if(f===void 0&&(f=new Uint8Array(h)),V(f,void 0,"output"),Nt(c),c<0||c>=ai)throw new Error("arx: counter overflow");if(f.length<h)throw new Error(`arx: output (${f.length}) is shorter than data (${h})`);let p=[],x=o.length,w,b;if(x===32)p.push(w=rt(o)),b=wn;else if(x===16&&t)w=new Uint8Array(32),w.set(o),w.set(o,16),b=yn,p.push(w);else throw V(o,32,"arx key"),new Error("invalid key size");pr(u)||p.push(u=rt(u));let B=Ke(w);if(i){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(b,B,Ke(u.subarray(0,16)),B),u=u.subarray(16)}let N=16-n;if(N!==u.length)throw new Error(`arx: nonce must be ${N} or 16 bytes`);if(N!==12){let F=new Uint8Array(12);F.set(u,a?0:12-u.length),u=F,p.push(u)}let v=Ke(u);return mn(r,b,B,v,l,f,c,s),Se(...p),f}}function Z(r,e){return r[e++]&255|(r[e++]&255)<<8}var yr=class{constructor(e){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:new Uint8Array(16)}),Object.defineProperty(this,"r",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"h",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"pad",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(8)}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e=rt(V(e,32,"key"));let t=Z(e,0),i=Z(e,2),n=Z(e,4),a=Z(e,6),s=Z(e,8),o=Z(e,10),u=Z(e,12),l=Z(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|a<<9)&8191,this.r[4]=(a>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|o<<2)&8191,this.r[7]=(o>>>11|u<<5)&8065,this.r[8]=(u>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Z(e,16+2*f)}process(e,t,i=!1){let n=i?0:2048,{h:a,r:s}=this,o=s[0],u=s[1],l=s[2],f=s[3],c=s[4],h=s[5],p=s[6],x=s[7],w=s[8],b=s[9],B=Z(e,t+0),N=Z(e,t+2),v=Z(e,t+4),F=Z(e,t+6),X=Z(e,t+8),T=Z(e,t+10),C=Z(e,t+12),z=Z(e,t+14),g=a[0]+(B&8191),A=a[1]+((B>>>13|N<<3)&8191),E=a[2]+((N>>>10|v<<6)&8191),S=a[3]+((v>>>7|F<<9)&8191),I=a[4]+((F>>>4|X<<12)&8191),y=a[5]+(X>>>1&8191),m=a[6]+((X>>>14|T<<2)&8191),P=a[7]+((T>>>11|C<<5)&8191),H=a[8]+((C>>>8|z<<8)&8191),k=a[9]+(z>>>5|n),d=0,O=d+g*o+A*(5*b)+E*(5*w)+S*(5*x)+I*(5*p);d=O>>>13,O&=8191,O+=y*(5*h)+m*(5*c)+P*(5*f)+H*(5*l)+k*(5*u),d+=O>>>13,O&=8191;let U=d+g*u+A*o+E*(5*b)+S*(5*w)+I*(5*x);d=U>>>13,U&=8191,U+=y*(5*p)+m*(5*h)+P*(5*c)+H*(5*f)+k*(5*l),d+=U>>>13,U&=8191;let L=d+g*l+A*u+E*o+S*(5*b)+I*(5*w);d=L>>>13,L&=8191,L+=y*(5*x)+m*(5*p)+P*(5*h)+H*(5*c)+k*(5*f),d+=L>>>13,L&=8191;let ue=d+g*f+A*l+E*u+S*o+I*(5*b);d=ue>>>13,ue&=8191,ue+=y*(5*w)+m*(5*x)+P*(5*p)+H*(5*h)+k*(5*c),d+=ue>>>13,ue&=8191;let he=d+g*c+A*f+E*l+S*u+I*o;d=he>>>13,he&=8191,he+=y*(5*b)+m*(5*w)+P*(5*x)+H*(5*p)+k*(5*h),d+=he>>>13,he&=8191;let _e=d+g*h+A*c+E*f+S*l+I*u;d=_e>>>13,_e&=8191,_e+=y*o+m*(5*b)+P*(5*w)+H*(5*x)+k*(5*p),d+=_e>>>13,_e&=8191;let de=d+g*p+A*h+E*c+S*f+I*l;d=de>>>13,de&=8191,de+=y*u+m*o+P*(5*b)+H*(5*w)+k*(5*x),d+=de>>>13,de&=8191;let be=d+g*x+A*p+E*h+S*c+I*f;d=be>>>13,be&=8191,be+=y*l+m*u+P*o+H*(5*b)+k*(5*w),d+=be>>>13,be&=8191;let pe=d+g*w+A*x+E*p+S*h+I*c;d=pe>>>13,pe&=8191,pe+=y*f+m*l+P*u+H*o+k*(5*b),d+=pe>>>13,pe&=8191;let ve=d+g*b+A*w+E*x+S*p+I*h;d=ve>>>13,ve&=8191,ve+=y*c+m*f+P*l+H*u+k*o,d+=ve>>>13,ve&=8191,d=(d<<2)+d|0,d=d+O|0,O=d&8191,d=d>>>13,U+=d,a[0]=O,a[1]=U,a[2]=L,a[3]=ue,a[4]=he,a[5]=_e,a[6]=de,a[7]=be,a[8]=pe,a[9]=ve}finalize(){let{h:e,pad:t}=this,i=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=n,n=e[o]>>>13,e[o]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+n,n=i[o]>>>13,i[o]&=8191;i[9]-=8192;let a=(n^1)-1;for(let o=0;o<10;o++)i[o]&=a;a=~a;for(let o=0;o<10;o++)e[o]=e[o]&a|i[o];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let o=1;o<8;o++)s=(e[o]+t[o]|0)+(s>>>16)|0,e[o]=s&65535;Se(i)}update(e){dr(this),V(e),e=rt(e);let{buffer:t,blockLen:i}=this,n=e.length;for(let a=0;a<n;){let s=Math.min(i-this.pos,n-a);if(s===i){for(;i<=n-a;a+=i)this.process(e,a);continue}t.set(e.subarray(a,a+s),this.pos),this.pos+=s,a+=s,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Se(this.h,this.r,this.buffer,this.pad)}digestInto(e){dr(this),Zr(e,this),this.finished=!0;let{buffer:t,h:i}=this,{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let a=0;for(let s=0;s<8;s++)e[a++]=i[s]>>>0,e[a++]=i[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}};function gn(r){let e=(i,n)=>r(n).update(i).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}var si=gn(r=>new yr(r));function _n(r,e,t,i,n,a=20){let s=r[0],o=r[1],u=r[2],l=r[3],f=e[0],c=e[1],h=e[2],p=e[3],x=e[4],w=e[5],b=e[6],B=e[7],N=n,v=t[0],F=t[1],X=t[2],T=s,C=o,z=u,g=l,A=f,E=c,S=h,I=p,y=x,m=w,P=b,H=B,k=N,d=v,O=F,U=X;for(let ue=0;ue<a;ue+=2)T=T+A|0,k=K(k^T,16),y=y+k|0,A=K(A^y,12),T=T+A|0,k=K(k^T,8),y=y+k|0,A=K(A^y,7),C=C+E|0,d=K(d^C,16),m=m+d|0,E=K(E^m,12),C=C+E|0,d=K(d^C,8),m=m+d|0,E=K(E^m,7),z=z+S|0,O=K(O^z,16),P=P+O|0,S=K(S^P,12),z=z+S|0,O=K(O^z,8),P=P+O|0,S=K(S^P,7),g=g+I|0,U=K(U^g,16),H=H+U|0,I=K(I^H,12),g=g+I|0,U=K(U^g,8),H=H+U|0,I=K(I^H,7),T=T+E|0,U=K(U^T,16),P=P+U|0,E=K(E^P,12),T=T+E|0,U=K(U^T,8),P=P+U|0,E=K(E^P,7),C=C+S|0,k=K(k^C,16),H=H+k|0,S=K(S^H,12),C=C+S|0,k=K(k^C,8),H=H+k|0,S=K(S^H,7),z=z+I|0,d=K(d^z,16),y=y+d|0,I=K(I^y,12),z=z+I|0,d=K(d^z,8),y=y+d|0,I=K(I^y,7),g=g+A|0,O=K(O^g,16),m=m+O|0,A=K(A^m,12),g=g+A|0,O=K(O^g,8),m=m+O|0,A=K(A^m,7);let L=0;i[L++]=s+T|0,i[L++]=o+C|0,i[L++]=u+z|0,i[L++]=l+g|0,i[L++]=f+A|0,i[L++]=c+E|0,i[L++]=h+S|0,i[L++]=p+I|0,i[L++]=x+y|0,i[L++]=w+m|0,i[L++]=b+P|0,i[L++]=B+H|0,i[L++]=N+k|0,i[L++]=v+d|0,i[L++]=F+O|0,i[L++]=X+U|0}var vn=oi(_n,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Pn=new Uint8Array(16),ui=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(Pn.subarray(t))},kn=new Uint8Array(32);function ci(r,e,t,i,n){n!==void 0&&V(n,void 0,"AAD");let a=r(e,t,kn),s=ri(i.length,n?n.length:0,!0),o=si.create(a);n&&ui(o,n),ui(o,i),o.update(s);let u=o.digest();return Se(a,s),u}var Kn=r=>(e,t,i)=>({encrypt(a,s){let o=a.length;s=br(o+16,s,!1),s.set(a);let u=s.subarray(0,-16);r(e,t,u,u,1);let l=ci(r,e,t,u,i);return s.set(l,o),Se(l),s},decrypt(a,s){s=br(a.length-16,s,!1);let o=a.subarray(0,-16),u=a.subarray(-16),l=ci(r,e,t,o,i);if(!ei(u,l))throw new Error("invalid tag");return s.set(a.subarray(0,-16)),r(e,t,s,s,1),Se(l),s}}),wr=ti({blockSize:64,nonceLength:12,tagLength:16},Kn(vn));var xr=class{constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(e)}async seal(e,t,i){return await this._seal(e,t,i)}async open(e,t,i){return await this._open(e,t,i)}_seal(e,t,i){return new Promise(n=>{let a=wr(this._key,new Uint8Array(e),new Uint8Array(i)).encrypt(new Uint8Array(t));n(a.buffer)})}_open(e,t,i){return new Promise(n=>{let a=wr(this._key,new Uint8Array(e),new Uint8Array(i)).decrypt(new Uint8Array(t));n(a.buffer)})}},xt=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new xr(e)}};var Sn=BigInt(1),fi=BigInt(2),An=BigInt(3),En=BigInt(5),li=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed");function In(r){let e=BigInt(10),t=BigInt(20),i=BigInt(40),n=BigInt(80),a=li,o=r*r%a*r%a,u=D(o,fi,a)*o%a,l=D(u,Sn,a)*r%a,f=D(l,En,a)*l%a,c=D(f,e,a)*f%a,h=D(c,t,a)*c%a,p=D(h,i,a)*h%a,x=D(p,n,a)*p%a,w=D(x,n,a)*p%a,b=D(w,e,a)*f%a;return{pow_p_5_8:D(b,fi,a)*r%a,b2:o}}function On(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var mt=(()=>{let r=li;return ht({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:i}=In(e);return Fe(D(t,An,r)*i,r)},adjustScalarBytes:On})})();var Ae=class extends Le{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return He(sr,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var it="X25519",Gt=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=32,this._nSk=32}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(t){throw new R(t)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(t){throw new R(t)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){try{let e=await mt.utils.randomSecretKey(),t=new W(it,e,"private",Y);return{publicKey:await this.derivePublicKey(t),privateKey:t}}catch(e){throw new $(e)}}async deriveKeyPair(e){try{let t=await this._hkdf.labeledExtract(j.buffer,we,new Uint8Array(e)),i=await this._hkdf.labeledExpand(t,Oe,j,this._nSk),n=new W(it,new Uint8Array(i),"private",Y);return{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new oe(t)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(t){throw new M(t)}}async dh(e,t){try{return await this._dh(e,t)}catch(i){throw new R(i)}}async derive(e,t){try{return await this._derive(e,t)}catch(i){throw new R(i)}}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_serializePrivateKey(e){return new Promise(t=>{t(e.key.buffer)})}_importRawKey(e,t){return new Promise((i,n)=>{t&&e.byteLength!==this._nPk&&n(new Error("Invalid length of the key")),!t&&e.byteLength!==this._nSk&&n(new Error("Invalid length of the key")),i(new W(it,new Uint8Array(e),t?"public":"private",t?[]:Y))})}_importJWK(e,t){return new Promise((i,n)=>{(typeof e.kty>"u"||e.kty!=="OKP")&&n(new Error(`Invalid kty: ${e.kty}`)),(typeof e.crv>"u"||e.crv!=="X25519")&&n(new Error(`Invalid crv: ${e.crv}`)),t?(typeof e.d<"u"&&n(new Error("Invalid key: `d` should not be set")),typeof e.x>"u"&&n(new Error("Invalid key: `x` not found")),i(new W(it,fe(e.x),"public"))):(typeof e.d!="string"&&n(new Error("Invalid key: `d` not found")),i(new W(it,fe(e.d),"private",Y)))})}_derivePublicKey(e){return new Promise((t,i)=>{try{let n=mt.getPublicKey(e.key);t(new W(it,n,"public"))}catch(n){i(n)}})}_dh(e,t){return new Promise((i,n)=>{try{i(mt.getSharedSecret(e.key,t.key).buffer)}catch(a){n(a)}})}_derive(e,t){return new Promise((i,n)=>{try{i(mt.getSharedSecret(e,t))}catch(a){n(a)}})}},gt=class extends te{constructor(){let e=new Ae;super(_.DhkemX25519HkdfSha256,new Gt(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};var bi=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Ln=BigInt(1),mr=BigInt(2),hi=BigInt(3),jn=BigInt(11),Hn=BigInt(22),di=BigInt(44),Un=BigInt(88),Bn=BigInt(223);function zn(r){let e=bi,t=r*r*r%e,i=t*t*r%e,n=D(i,hi,e)*i%e,a=D(n,hi,e)*i%e,s=D(a,mr,e)*t%e,o=D(s,jn,e)*s%e,u=D(o,Hn,e)*o%e,l=D(u,di,e)*u%e,f=D(l,Un,e)*l%e,c=D(f,di,e)*u%e,h=D(c,mr,e)*t%e,p=D(h,Ln,e)*r%e;return D(p,Bn,e)*h%e}function Dn(r){return r[0]&=252,r[55]|=128,r[56]=0,r}var Rt=(()=>{let r=bi;return ht({P:r,type:"x448",powPminus2:e=>{let t=zn(e),i=D(t,mr,r);return Fe(i*e,r)},adjustScalarBytes:Dn})})();var Ee=class extends je{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return He(ur,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var nt="X448",Ft=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(t){throw new R(t)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(t){throw new R(t)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){try{let e=await Rt.utils.randomSecretKey(),t=new W(nt,e,"private",Y);return{publicKey:await this.derivePublicKey(t),privateKey:t}}catch(e){throw new $(e)}}async deriveKeyPair(e){try{let t=await this._hkdf.labeledExtract(j.buffer,we,new Uint8Array(e)),i=await this._hkdf.labeledExpand(t,Oe,j,this._nSk),n=new W(nt,new Uint8Array(i),"private",Y);return{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new oe(t)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(t){throw new M(t)}}async dh(e,t){try{return await this._dh(e,t)}catch(i){throw new R(i)}}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_serializePrivateKey(e){return new Promise(t=>{t(e.key.buffer)})}_importRawKey(e,t){return new Promise((i,n)=>{t&&e.byteLength!==this._nPk&&n(new Error("Invalid length of the key")),!t&&e.byteLength!==this._nSk&&n(new Error("Invalid length of the key")),i(new W(nt,new Uint8Array(e),t?"public":"private",t?[]:Y))})}_importJWK(e,t){return new Promise((i,n)=>{e.kty!=="OKP"&&n(new Error(`Invalid kty: ${e.kty}`)),e.crv!=="X448"&&n(new Error(`Invalid crv: ${e.crv}`)),t?(typeof e.d<"u"&&n(new Error("Invalid key: `d` should not be set")),typeof e.x!="string"&&n(new Error("Invalid key: `x` not found")),i(new W(nt,fe(e.x),"public"))):(typeof e.d!="string"&&n(new Error("Invalid key: `d` not found")),i(new W(nt,fe(e.d),"private",Y)))})}_derivePublicKey(e){return new Promise((t,i)=>{try{let n=Rt.getPublicKey(e.key);t(new W(nt,n,"public"))}catch(n){i(n)}})}_dh(e,t){return new Promise((i,n)=>{try{i(Rt.getSharedSecret(e.key,t.key).buffer)}catch(a){n(a)}})}},_t=class extends te{constructor(){let e=new Ee;super(_.DhkemX448HkdfSha512,new Ft(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}};var at=class extends Ne{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return He(cr,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var Xt=class extends te{constructor(){let e=new Ae,t=new xe(_.DhkemP256HkdfSha256,e);super(_.DhkemP256HkdfSha256,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};var $t=class extends te{constructor(){let e=new at,t=new xe(_.DhkemP384HkdfSha384,e);super(_.DhkemP384HkdfSha384,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}};var Wt=class extends te{constructor(){let e=new Ee,t=new xe(_.DhkemP521HkdfSha512,e);super(_.DhkemP521HkdfSha512,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}};var gr=class extends wt{constructor(e){if(typeof e.kem=="number")switch(e.kem){case _.DhkemP256HkdfSha256:e.kem=new Xt;break;case _.DhkemP384HkdfSha384:e.kem=new $t;break;case _.DhkemP521HkdfSha512:e.kem=new Wt;break;case _.DhkemX25519HkdfSha256:e.kem=new gt;break;case _.DhkemX448HkdfSha512:e.kem=new _t;break;default:throw new G(`The KEM (${e.kem}) cannot be specified by KemId. Use submodule for the KEM`)}if(typeof e.kdf=="number")switch(e.kdf){case ce.HkdfSha256:e.kdf=new Ae;break;case ce.HkdfSha384:e.kdf=new at;break;default:e.kdf=new Ee;break}if(typeof e.aead=="number")switch(e.aead){case ee.Aes128Gcm:e.aead=new Ze;break;case ee.Aes256Gcm:e.aead=new dt;break;case ee.Chacha20Poly1305:e.aead=new xt;break;default:e.aead=new bt;break}super(e)}async generateKeyPair(){return await this._setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){return await this._setup(),await this._kem.deriveKeyPair(e)}async importKey(e,t,i=!0){return await this._setup(),await this._kem.importKey(e,t,i)}};export{cn as Aead,ee as AeadId,gr as CipherSuite,$e as DecapError,oe as DeriveKeyPairError,M as DeserializeError,Xe as EncapError,We as ExportError,Q as HpkeError,G as InvalidParamError,un as Kdf,ce as KdfId,sn as Kem,_ as KemId,qe as MessageLimitReachedError,$ as NotSupportedError,Ye as OpenError,Ve as SealError,R as SerializeError,vt as ValidationError};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
