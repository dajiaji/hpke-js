var yt=e=>e instanceof Uint8Array;var R=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),st=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),gt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!gt)throw new Error("Non little-endian hardware is not supported");function J(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Q(e){if(typeof e=="string"&&(e=J(e)),!yt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var wt=e=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function it(e,t){if(t!==void 0&&(typeof t!="object"||!wt(t)))throw new Error("options must be object or undefined");return Object.assign(e,t)}function M(e,t){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof t=="number"&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}function ct(e,t){if(e.length!==t.length)throw new Error("equalBytes: Different size of Uint8Arrays");let n=!0;for(let r=0;r<e.length;r++)n&&(n=e[r]===t[r]);return n}function tt(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let c=BigInt(32),f=BigInt(4294967295),s=Number(n>>c&f),o=Number(n&f),y=r?4:0,l=r?0:4;e.setUint32(t+y,s,r),e.setUint32(t+l,o,r)}function et(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function dt(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function ht(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function bt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");et(e.outputLen),et(e.blockLen)}function mt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ut(e,t){ht(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var At={number:et,bool:dt,bytes:ht,hash:bt,exists:mt,output:Ut},K=At;var H=(e,t)=>e[t++]&255|(e[t++]&255)<<8,rt=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Q(t),M(t,32);let n=H(t,0),r=H(t,2),c=H(t,4),f=H(t,6),s=H(t,8),o=H(t,10),y=H(t,12),l=H(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|c<<6)&7939,this.r[3]=(c>>>7|f<<9)&8191,this.r[4]=(f>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|o<<2)&8191,this.r[7]=(o>>>11|y<<5)&8065,this.r[8]=(y>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let a=0;a<8;a++)this.pad[a]=H(t,16+2*a)}process(t,n,r=!1){let c=r?0:2048,{h:f,r:s}=this,o=s[0],y=s[1],l=s[2],a=s[3],b=s[4],B=s[5],P=s[6],C=s[7],d=s[8],$=s[9],N=H(t,n+0),D=H(t,n+2),T=H(t,n+4),F=H(t,n+6),z=H(t,n+8),_=H(t,n+10),j=H(t,n+12),I=H(t,n+14),h=f[0]+(N&8191),g=f[1]+((N>>>13|D<<3)&8191),w=f[2]+((D>>>10|T<<6)&8191),x=f[3]+((T>>>7|F<<9)&8191),p=f[4]+((F>>>4|z<<12)&8191),m=f[5]+(z>>>1&8191),U=f[6]+((z>>>14|_<<2)&8191),A=f[7]+((_>>>11|j<<5)&8191),E=f[8]+((j>>>8|I<<8)&8191),L=f[9]+(I>>>5|c),i=0,k=i+h*o+g*(5*$)+w*(5*d)+x*(5*C)+p*(5*P);i=k>>>13,k&=8191,k+=m*(5*B)+U*(5*b)+A*(5*a)+E*(5*l)+L*(5*y),i+=k>>>13,k&=8191;let O=i+h*y+g*o+w*(5*$)+x*(5*d)+p*(5*C);i=O>>>13,O&=8191,O+=m*(5*P)+U*(5*B)+A*(5*b)+E*(5*a)+L*(5*l),i+=O>>>13,O&=8191;let S=i+h*l+g*y+w*o+x*(5*$)+p*(5*d);i=S>>>13,S&=8191,S+=m*(5*C)+U*(5*P)+A*(5*B)+E*(5*b)+L*(5*a),i+=S>>>13,S&=8191;let v=i+h*a+g*l+w*y+x*o+p*(5*$);i=v>>>13,v&=8191,v+=m*(5*d)+U*(5*C)+A*(5*P)+E*(5*B)+L*(5*b),i+=v>>>13,v&=8191;let q=i+h*b+g*a+w*l+x*y+p*o;i=q>>>13,q&=8191,q+=m*(5*$)+U*(5*d)+A*(5*C)+E*(5*P)+L*(5*B),i+=q>>>13,q&=8191;let V=i+h*B+g*b+w*a+x*l+p*y;i=V>>>13,V&=8191,V+=m*o+U*(5*$)+A*(5*d)+E*(5*C)+L*(5*P),i+=V>>>13,V&=8191;let X=i+h*P+g*B+w*b+x*a+p*l;i=X>>>13,X&=8191,X+=m*y+U*o+A*(5*$)+E*(5*d)+L*(5*C),i+=X>>>13,X&=8191;let G=i+h*C+g*P+w*B+x*b+p*a;i=G>>>13,G&=8191,G+=m*l+U*y+A*o+E*(5*$)+L*(5*d),i+=G>>>13,G&=8191;let W=i+h*d+g*C+w*P+x*B+p*b;i=W>>>13,W&=8191,W+=m*a+U*l+A*y+E*o+L*(5*$),i+=W>>>13,W&=8191;let Z=i+h*$+g*d+w*C+x*P+p*B;i=Z>>>13,Z&=8191,Z+=m*b+U*a+A*l+E*y+L*o,i+=Z>>>13,Z&=8191,i=(i<<2)+i|0,i=i+k|0,k=i&8191,i=i>>>13,O+=i,f[0]=k,f[1]=O,f[2]=S,f[3]=v,f[4]=q,f[5]=V,f[6]=X,f[7]=G,f[8]=W,f[9]=Z}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),c=t[1]>>>13;t[1]&=8191;for(let o=2;o<10;o++)t[o]+=c,c=t[o]>>>13,t[o]&=8191;t[0]+=c*5,c=t[0]>>>13,t[0]&=8191,t[1]+=c,c=t[1]>>>13,t[1]&=8191,t[2]+=c,r[0]=t[0]+5,c=r[0]>>>13,r[0]&=8191;for(let o=1;o<10;o++)r[o]=t[o]+c,c=r[o]>>>13,r[o]&=8191;r[9]-=8192;let f=(c^1)-1;for(let o=0;o<10;o++)r[o]&=f;f=~f;for(let o=0;o<10;o++)t[o]=t[o]&f|r[o];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let s=t[0]+n[0];t[0]=s&65535;for(let o=1;o<8;o++)s=(t[o]+n[o]|0)+(s>>>16)|0,t[o]=s&65535}update(t){K.exists(this);let{buffer:n,blockLen:r}=this;t=Q(t);let c=t.length;for(let f=0;f<c;){let s=Math.min(r-this.pos,c-f);if(s===r){for(;r<=c-f;f+=r)this.process(t,f);continue}n.set(t.subarray(f,f+s),this.pos),this.pos+=s,f+=s,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){K.exists(this),K.output(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:c}=this;if(c){for(n[c++]=1;c<16;c++)n[c]=0;this.process(n,0,!0)}this.finalize();let f=0;for(let s=0;s<8;s++)t[f++]=r[s]>>>0,t[f++]=r[s]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function Et(e){let t=(r,c)=>e(c).update(Q(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var lt=Et(e=>new rt(e));var Lt=J("expand 16-byte k"),Bt=J("expand 32-byte k"),St=R(Lt),Ct=R(Bt),Y=e=>!(e.byteOffset%4),at=e=>{let{core:t,rounds:n,counterRight:r,counterLen:c,allow128bitKeys:f,extendNonceFn:s,blockLen:o}=it({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},e);K.number(c),K.number(n),K.number(o),K.bool(r),K.bool(f);let y=o/4;if(o%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(l,a,b,B,P=0)=>{if(K.bytes(l),K.bytes(a),K.bytes(b),B||(B=new Uint8Array(b.length)),K.bytes(B),K.number(P),P<0||P>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(B.length<b.length)throw new Error(`Salsa/ChaCha: output (${B.length}) is shorter than data (${b.length})`);let C=[],d,$;if(l.length===32)Y(l)?d=l:(d=l.slice(),C.push(d)),$=Ct;else if(l.length===16&&f)d=new Uint8Array(32),d.set(l),d.set(l,16),$=St,C.push(d);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${l.length}`);if(Y(a)||(a=a.slice(),C.push(a)),s){if(a.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");d=s($,d,a.subarray(0,16),new Uint8Array(32)),C.push(d),a=a.subarray(16)}let N=16-c;if(a.length!==N)throw new Error(`Salsa/ChaCha: nonce must be ${N} or 16 bytes`);if(N!==12){let h=new Uint8Array(12);h.set(a,r?0:12-a.length),C.push(a=h)}let D=new Uint8Array(o),T=R(D),F=R(d),z=R(a),_=Y(b)&&R(b),j=Y(B)&&R(B);C.push(T);let I=b.length;for(let h=0,g=P;h<I;g++){if(t($,F,z,T,g,n),g>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let w=Math.min(o,I-h);if(w===o&&j&&_){let x=h/4;if(h%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let p=0;p<y;p++)j[x+p]=_[x+p]^T[p];h+=o;continue}for(let x=0;x<w;x++)B[h+x]=b[h+x]^D[x];h+=w}for(let h=0;h<C.length;h++)C[h].fill(0);return B}};var u=(e,t)=>e<<t|e>>>32-t;function kt(e,t,n,r,c,f=20){let s=e[0],o=e[1],y=e[2],l=e[3],a=t[0],b=t[1],B=t[2],P=t[3],C=t[4],d=t[5],$=t[6],N=t[7],D=c,T=n[0],F=n[1],z=n[2],_=s,j=o,I=y,h=l,g=a,w=b,x=B,p=P,m=C,U=d,A=$,E=N,L=D,i=T,k=F,O=z;for(let v=0;v<f;v+=2)_=_+g|0,L=u(L^_,16),m=m+L|0,g=u(g^m,12),_=_+g|0,L=u(L^_,8),m=m+L|0,g=u(g^m,7),j=j+w|0,i=u(i^j,16),U=U+i|0,w=u(w^U,12),j=j+w|0,i=u(i^j,8),U=U+i|0,w=u(w^U,7),I=I+x|0,k=u(k^I,16),A=A+k|0,x=u(x^A,12),I=I+x|0,k=u(k^I,8),A=A+k|0,x=u(x^A,7),h=h+p|0,O=u(O^h,16),E=E+O|0,p=u(p^E,12),h=h+p|0,O=u(O^h,8),E=E+O|0,p=u(p^E,7),_=_+w|0,O=u(O^_,16),A=A+O|0,w=u(w^A,12),_=_+w|0,O=u(O^_,8),A=A+O|0,w=u(w^A,7),j=j+x|0,L=u(L^j,16),E=E+L|0,x=u(x^E,12),j=j+x|0,L=u(L^j,8),E=E+L|0,x=u(x^E,7),I=I+p|0,i=u(i^I,16),m=m+i|0,p=u(p^m,12),I=I+p|0,i=u(i^I,8),m=m+i|0,p=u(p^m,7),h=h+g|0,k=u(k^h,16),U=U+k|0,g=u(g^U,12),h=h+g|0,k=u(k^h,8),U=U+k|0,g=u(g^U,7);let S=0;r[S++]=s+_|0,r[S++]=o+j|0,r[S++]=y+I|0,r[S++]=l+h|0,r[S++]=a+g|0,r[S++]=b+w|0,r[S++]=B+x|0,r[S++]=P+p|0,r[S++]=C+m|0,r[S++]=d+U|0,r[S++]=$+A|0,r[S++]=N+E|0,r[S++]=D+L|0,r[S++]=T+i|0,r[S++]=F+k|0,r[S++]=z+O|0}var Ot=at({core:kt,counterRight:!1,counterLen:4,allow128bitKeys:!1});var _t=new Uint8Array(16),xt=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(_t.subarray(n))},ut=(e,t,n,r,c)=>{let f=e(t,n,new Uint8Array(32)),s=lt.create(f);c&&xt(s,c),xt(s,r);let o=new Uint8Array(16),y=st(o);tt(y,0,BigInt(c?c.length:0),!0),tt(y,8,BigInt(r.length),!0),s.update(o);let l=s.digest();return f.fill(0),l},jt=e=>(t,n,r)=>(M(t,32),M(n),{tagLength:16,encrypt:(f,s)=>{let o=f.length,y=o+16;s?M(s,y):s=new Uint8Array(y),e(t,n,f,s,1);let l=ut(e,t,n,s.subarray(0,-16),r);return s.set(l,o),s},decrypt:(f,s)=>{let o=f.length,y=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");s?M(s,y):s=new Uint8Array(y);let l=f.subarray(0,-16),a=f.subarray(-16),b=ut(e,t,n,l,r);if(!ct(a,b))throw new Error("invalid tag");return e(t,n,l,s,1),s}}),nt=jt(Ot);var It={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},pt=It;var ot=class{constructor(t){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(t)}async seal(t,n,r){return await this._seal(t,n,r)}async open(t,n,r){return await this._open(t,n,r)}_seal(t,n,r){return new Promise(c=>{let f=nt(this._key,new Uint8Array(t),new Uint8Array(r)).encrypt(new Uint8Array(n));c(f.buffer)})}_open(t,n,r){return new Promise(c=>{let f=nt(this._key,new Uint8Array(t),new Uint8Array(r)).decrypt(new Uint8Array(n));c(f.buffer)})}},ft=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:pt.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(t){return new ot(t)}};export{ft as Chacha20Poly1305};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
