function Ze(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ne(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function ie(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function H(t,e,n=""){let r=Ze(t),o=t?.length,i=e!==void 0;if(!r||i&&o!==e){let a=n&&`"${n}" `,s=i?` of length ${e}`:"",c=r?`length=${o}`:`type=${typeof t}`;throw new Error(a+"expected Uint8Array"+s+", got "+c)}return t}function fe(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ae(t,e){H(t,void 0,"output");let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function N(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function M(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function qe(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var Qe=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ve(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Ke(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var ke=(t,e)=>{function n(r,...o){if(H(r,void 0,"key"),!Qe)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let f=o[0];H(f,t.varSizeNonce?void 0:t.nonceLength,"nonce")}let i=t.tagLength;i&&o[1]!==void 0&&H(o[1],void 0,"AAD");let a=e(r,...o),s=(f,h)=>{if(h!==void 0){if(f!==2)throw new Error("cipher output not supported");H(h,void 0,"output")}},c=!1;return{encrypt(f,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,H(f),s(a.encrypt.length,h),a.encrypt(f,h)},decrypt(f,h){if(H(f),i&&f.length<i)throw new Error('"ciphertext" expected length bigger than tagLength='+i);return s(a.decrypt.length,h),a.decrypt(f,h)}}}return Object.assign(n,t),n};function le(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error('"output" expected Uint8Array of length '+t+", got: "+e.length);if(n&&!et(e))throw new Error("invalid output, must be aligned");return e}function Ee(t,e,n){ne(n);let r=new Uint8Array(16),o=qe(r);return o.setBigUint64(0,BigInt(e),n),o.setBigUint64(8,BigInt(t),n),r}function et(t){return t.byteOffset%4===0}function q(t){return Uint8Array.from(t)}var Se=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),tt=Se("expand 16-byte k"),rt=Se("expand 32-byte k"),nt=N(tt),it=N(rt);function l(t,e){return t<<e|t>>>32-e}function he(t){return t.byteOffset%4===0}var oe=64,ot=16,Oe=2**32-1,Le=Uint32Array.of();function st(t,e,n,r,o,i,a,s){let c=o.length,b=new Uint8Array(oe),f=N(b),h=he(o)&&he(i),U=h?N(o):Le,S=h?N(i):Le;for(let p=0;p<c;a++){if(t(e,n,r,f,a,s),a>=Oe)throw new Error("arx: counter overflow");let y=Math.min(oe,c-p);if(h&&y===oe){let d=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let I=0,C;I<ot;I++)C=d+I,S[C]=U[C]^f[I];p+=oe;continue}for(let d=0,I;d<y;d++)I=p+d,i[I]=o[I]^b[d];p+=y}}function Ue(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:a}=ve({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return ie(o),ie(a),ne(i),ne(n),(s,c,b,f,h=0)=>{H(s,void 0,"key"),H(c,void 0,"nonce"),H(b,void 0,"data");let U=b.length;if(f===void 0&&(f=new Uint8Array(U)),H(f,void 0,"output"),ie(h),h<0||h>=Oe)throw new Error("arx: counter overflow");if(f.length<U)throw new Error(`arx: output (${f.length}) is shorter than data (${U})`);let S=[],p=s.length,y,d;if(p===32)S.push(y=q(s)),d=it;else if(p===16&&n)y=new Uint8Array(32),y.set(s),y.set(s,16),d=nt,S.push(y);else throw H(s,32,"arx key"),new Error("invalid key size");he(c)||S.push(c=q(c));let I=N(y);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,I,N(c.subarray(0,16)),I),c=c.subarray(16)}let C=16-o;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){let G=new Uint8Array(12);G.set(c,i?0:12-c.length),c=G,S.push(c)}let R=N(c);return st(t,d,I,R,b,f,h,a),M(...S),f}}function B(t,e){return t[e++]&255|(t[e++]&255)<<8}var be=class{constructor(e){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:new Uint8Array(16)}),Object.defineProperty(this,"r",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"h",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"pad",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(8)}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e=q(H(e,32,"key"));let n=B(e,0),r=B(e,2),o=B(e,4),i=B(e,6),a=B(e,8),s=B(e,10),c=B(e,12),b=B(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|s<<2)&8191,this.r[7]=(s>>>11|c<<5)&8065,this.r[8]=(c>>>8|b<<8)&8191,this.r[9]=b>>>5&127;for(let f=0;f<8;f++)this.pad[f]=B(e,16+2*f)}process(e,n,r=!1){let o=r?0:2048,{h:i,r:a}=this,s=a[0],c=a[1],b=a[2],f=a[3],h=a[4],U=a[5],S=a[6],p=a[7],y=a[8],d=a[9],I=B(e,n+0),C=B(e,n+2),R=B(e,n+4),G=B(e,n+6),$=B(e,n+8),j=B(e,n+10),T=B(e,n+12),z=B(e,n+14),x=i[0]+(I&8191),w=i[1]+((I>>>13|C<<3)&8191),g=i[2]+((C>>>10|R<<6)&8191),m=i[3]+((R>>>7|G<<9)&8191),_=i[4]+((G>>>4|$<<12)&8191),P=i[5]+($>>>1&8191),A=i[6]+(($>>>14|j<<2)&8191),v=i[7]+((j>>>11|T<<5)&8191),K=i[8]+((T>>>8|z<<8)&8191),k=i[9]+(z>>>5|o),u=0,L=u+x*s+w*(5*d)+g*(5*y)+m*(5*p)+_*(5*S);u=L>>>13,L&=8191,L+=P*(5*U)+A*(5*h)+v*(5*f)+K*(5*b)+k*(5*c),u+=L>>>13,L&=8191;let O=u+x*c+w*s+g*(5*d)+m*(5*y)+_*(5*p);u=O>>>13,O&=8191,O+=P*(5*S)+A*(5*U)+v*(5*h)+K*(5*f)+k*(5*b),u+=O>>>13,O&=8191;let E=u+x*b+w*c+g*s+m*(5*d)+_*(5*y);u=E>>>13,E&=8191,E+=P*(5*p)+A*(5*S)+v*(5*U)+K*(5*h)+k*(5*f),u+=E>>>13,E&=8191;let D=u+x*f+w*b+g*c+m*s+_*(5*d);u=D>>>13,D&=8191,D+=P*(5*y)+A*(5*p)+v*(5*S)+K*(5*U)+k*(5*h),u+=D>>>13,D&=8191;let V=u+x*h+w*f+g*b+m*c+_*s;u=V>>>13,V&=8191,V+=P*(5*d)+A*(5*y)+v*(5*p)+K*(5*S)+k*(5*U),u+=V>>>13,V&=8191;let W=u+x*U+w*h+g*f+m*b+_*c;u=W>>>13,W&=8191,W+=P*s+A*(5*d)+v*(5*y)+K*(5*p)+k*(5*S),u+=W>>>13,W&=8191;let X=u+x*S+w*U+g*h+m*f+_*b;u=X>>>13,X&=8191,X+=P*c+A*s+v*(5*d)+K*(5*y)+k*(5*p),u+=X>>>13,X&=8191;let Y=u+x*p+w*S+g*U+m*h+_*f;u=Y>>>13,Y&=8191,Y+=P*b+A*c+v*s+K*(5*d)+k*(5*y),u+=Y>>>13,Y&=8191;let J=u+x*y+w*p+g*S+m*U+_*h;u=J>>>13,J&=8191,J+=P*f+A*b+v*c+K*s+k*(5*d),u+=J>>>13,J&=8191;let Z=u+x*d+w*y+g*p+m*S+_*U;u=Z>>>13,Z&=8191,Z+=P*h+A*f+v*b+K*c+k*s,u+=Z>>>13,Z&=8191,u=(u<<2)+u|0,u=u+L|0,L=u&8191,u=u>>>13,O+=u,i[0]=L,i[1]=O,i[2]=E,i[3]=D,i[4]=V,i[5]=W,i[6]=X,i[7]=Y,i[8]=J,i[9]=Z}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let s=2;s<10;s++)e[s]+=o,o=e[s]>>>13,e[s]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let s=1;s<10;s++)r[s]=e[s]+o,o=r[s]>>>13,r[s]&=8191;r[9]-=8192;let i=(o^1)-1;for(let s=0;s<10;s++)r[s]&=i;i=~i;for(let s=0;s<10;s++)e[s]=e[s]&i|r[s];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+n[0];e[0]=a&65535;for(let s=1;s<8;s++)a=(e[s]+n[s]|0)+(a>>>16)|0,e[s]=a&65535;M(r)}update(e){fe(this),H(e),e=q(e);let{buffer:n,blockLen:r}=this,o=e.length;for(let i=0;i<o;){let a=Math.min(r-this.pos,o-i);if(a===r){for(;r<=o-i;i+=r)this.process(e,i);continue}n.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){M(this.h,this.r,this.buffer,this.pad)}digestInto(e){fe(this),Ae(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let i=0;for(let a=0;a<8;a++)e[i++]=r[a]>>>0,e[i++]=r[a]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function at(t){let e=(r,o)=>t(o).update(r).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var Ie=at(t=>new be(t));function ut(t,e,n,r,o,i=20){let a=t[0],s=t[1],c=t[2],b=t[3],f=e[0],h=e[1],U=e[2],S=e[3],p=e[4],y=e[5],d=e[6],I=e[7],C=o,R=n[0],G=n[1],$=n[2],j=a,T=s,z=c,x=b,w=f,g=h,m=U,_=S,P=p,A=y,v=d,K=I,k=C,u=R,L=G,O=$;for(let D=0;D<i;D+=2)j=j+w|0,k=l(k^j,16),P=P+k|0,w=l(w^P,12),j=j+w|0,k=l(k^j,8),P=P+k|0,w=l(w^P,7),T=T+g|0,u=l(u^T,16),A=A+u|0,g=l(g^A,12),T=T+g|0,u=l(u^T,8),A=A+u|0,g=l(g^A,7),z=z+m|0,L=l(L^z,16),v=v+L|0,m=l(m^v,12),z=z+m|0,L=l(L^z,8),v=v+L|0,m=l(m^v,7),x=x+_|0,O=l(O^x,16),K=K+O|0,_=l(_^K,12),x=x+_|0,O=l(O^x,8),K=K+O|0,_=l(_^K,7),j=j+g|0,O=l(O^j,16),v=v+O|0,g=l(g^v,12),j=j+g|0,O=l(O^j,8),v=v+O|0,g=l(g^v,7),T=T+m|0,k=l(k^T,16),K=K+k|0,m=l(m^K,12),T=T+m|0,k=l(k^T,8),K=K+k|0,m=l(m^K,7),z=z+_|0,u=l(u^z,16),P=P+u|0,_=l(_^P,12),z=z+_|0,u=l(u^z,8),P=P+u|0,_=l(_^P,7),x=x+w|0,L=l(L^x,16),A=A+L|0,w=l(w^A,12),x=x+w|0,L=l(L^x,8),A=A+L|0,w=l(w^A,7);let E=0;r[E++]=a+j|0,r[E++]=s+T|0,r[E++]=c+z|0,r[E++]=b+x|0,r[E++]=f+w|0,r[E++]=h+g|0,r[E++]=U+m|0,r[E++]=S+_|0,r[E++]=p+P|0,r[E++]=y+A|0,r[E++]=d+v|0,r[E++]=I+K|0,r[E++]=C+k|0,r[E++]=R+u|0,r[E++]=G+L|0,r[E++]=$+O|0}var ct=Ue(ut,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ft=new Uint8Array(16),He=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(ft.subarray(n))},lt=new Uint8Array(32);function Be(t,e,n,r,o){o!==void 0&&H(o,void 0,"AAD");let i=t(e,n,lt),a=Ee(r.length,o?o.length:0,!0),s=Ie.create(i);o&&He(s,o),He(s,r),s.update(a);let c=s.digest();return M(i,a),c}var ht=t=>(e,n,r)=>({encrypt(i,a){let s=i.length;a=le(s+16,a,!1),a.set(i);let c=a.subarray(0,-16);t(e,n,c,c,1);let b=Be(t,e,n,c,r);return a.set(b,s),M(b),a},decrypt(i,a){a=le(i.length-16,a,!1);let s=i.subarray(0,-16),c=i.subarray(-16),b=Be(t,e,n,s,r);if(!Ke(c,b))throw new Error("invalid tag");return a.set(i.subarray(0,-16)),t(e,n,a,a,1),M(b),a}}),de=ke({blockSize:64,nonceLength:12,tagLength:16},ht(ct));var bt={},je=dt(globalThis,bt);function dt(t,e){return new Proxy(t,{get(n,r,o){return r in e?e[r]:t[r]},set(n,r,o){return r in e&&delete e[r],t[r]=o,!0},deleteProperty(n,r){let o=!1;return r in e&&(delete e[r],o=!0),r in t&&(delete t[r],o=!0),o},ownKeys(n){let r=Reflect.ownKeys(t),o=Reflect.ownKeys(e),i=new Set(o);return[...r.filter(a=>!i.has(a)),...o]},defineProperty(n,r,o){return r in e&&delete e[r],Reflect.defineProperty(t,r,o),!0},getOwnPropertyDescriptor(n,r){return r in e?Reflect.getOwnPropertyDescriptor(e,r):Reflect.getOwnPropertyDescriptor(t,r)},has(n,r){return r in e||r in t}})}var pe={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};var ee=BigInt(0),F=BigInt(1),ye=BigInt(2),Ce=BigInt(7),xe=BigInt(32),De=BigInt(256),Ne=BigInt(113);function vt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ae(t,e=""){if(!Number.isSafeInteger(t)||t<0){let n=e&&`"${e}" `;throw new Error(`${n}expected integer >0, got ${t}`)}}function Q(t,e,n=""){let r=vt(t),o=t?.length,i=e!==void 0;if(!r||i&&o!==e){let a=n&&`"${n}" `,s=i?` of length ${e}`:"",c=r?`length=${o}`:`type=${typeof t}`;throw new Error(a+"expected Uint8Array"+s+", got "+c)}return t}function te(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function re(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}var Kt=new Uint32Array([287454020]),kt=new Uint8Array(Kt.buffer),Br=kt[0]===68;function We(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash must wrapped by utils.createHasher");ae(t.outputLen),ae(t.blockLen)}var ue=class{constructor(e,n){if(Object.defineProperty(this,"oHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),We(e),Q(n,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),re(o)}update(e){return te(this),this.iHash.update(e),this}digestInto(e){te(this),Q(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:a,outputLen:s}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=a,e.outputLen=s,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Xe=(t,e,n)=>new ue(t,e).update(n).digest();Xe.create=(t,e)=>new ue(t,e);var ce=BigInt(2**32-1);function Lt(t,e=!1){return e?{h:Number(t&ce),l:Number(t>>xe&ce)}:{h:Number(t>>xe&ce)|0,l:Number(t&ce)|0}}function me(t,e=!1){let n=t.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let i=0;i<n;i++){let{h:a,l:s}=Lt(t[i],e);[r[i],o[i]]=[a,s]}return[r,o]}var It=[],Ht=[],Ye=[];for(let t=0,e=F,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],It.push(2*(5*r+n)),Ht.push((t+1)*(t+2)/2%64);let o=ee;for(let i=0;i<7;i++)e=(e<<F^(e>>Ce)*Ne)%De,e&ye&&(o^=F<<(F<<BigInt(i))-F);Ye.push(o)}var Je=me(Ye,!0),kn=Je[0],En=Je[1];var _e=class{constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(e)}async seal(e,n,r){return await this._seal(e,n,r)}async open(e,n,r){return await this._open(e,n,r)}_seal(e,n,r){return new Promise(o=>{let i=de(this._key,new Uint8Array(e),new Uint8Array(r)).encrypt(new Uint8Array(n));o(i.buffer)})}_open(e,n,r){return new Promise(o=>{let i=de(this._key,new Uint8Array(e),new Uint8Array(r)).decrypt(new Uint8Array(n));o(i.buffer)})}},Pe=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:pe.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new _e(e)}};export{Pe as Chacha20Poly1305};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
