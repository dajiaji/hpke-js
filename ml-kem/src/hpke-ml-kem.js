var P=class extends Error{constructor(e){let i;e instanceof Error?i=e.message:typeof e=="string"?i=e:i="",super(i),this.name=this.constructor.name}};var Q=[2285,2571,2970,1812,1493,1422,287,202,3158,622,1577,182,962,2127,1855,1468,573,2004,264,383,2500,1458,1727,3199,2648,1017,732,608,1787,411,3124,1758,1223,652,2777,1015,2036,1491,3047,1785,516,3321,3009,2663,1711,2167,126,1469,2476,3239,3058,830,107,1908,3082,2378,2931,961,1821,2604,448,2264,677,2054,2226,430,555,843,2078,871,1550,105,422,587,177,3094,3038,2869,1574,1653,3083,778,1159,3182,2552,1483,2727,1119,1739,644,2457,349,418,329,3173,3254,817,1097,603,610,1322,2044,1864,384,2114,3193,1218,1994,2455,220,2142,1670,2144,1799,2051,794,1819,2475,2459,478,3221,3021,996,991,958,1869,1522,1628],fe=[1701,1807,1460,2371,2338,2333,308,108,2851,870,854,1510,2535,1278,1530,1185,1659,1187,3109,874,1335,2111,136,1215,2945,1465,1285,2007,2719,2726,2232,2512,75,156,3e3,2911,2980,872,2685,1590,2210,602,1846,777,147,2170,2551,246,1676,1755,460,291,235,3152,2742,2907,3224,1779,2458,1251,2486,2774,2899,1103,1275,2652,1065,2881,725,1508,2368,398,951,247,1421,3222,2499,271,90,853,1860,3203,1162,1618,666,320,8,2813,1544,282,1838,1293,2314,552,2677,2106,1571,205,2918,1542,2721,2597,2312,681,130,1602,1871,829,2946,3065,1325,2756,1861,1474,1202,2367,3147,1752,2707,171,3127,3042,1907,1836,1517,359,758,1441];var Y=BigInt(4294967295),Se=BigInt(32);function lt(r,e=!1){return e?{h:Number(r&Y),l:Number(r>>Se&Y)}:{h:Number(r>>Se&Y)|0,l:Number(r&Y)|0}}function Ee(r,e=!1){let i=r.length,t=new Uint32Array(i),n=new Uint32Array(i);for(let a=0;a<i;a++){let{h:s,l:o}=lt(r[a],e);[t[a],n[a]]=[s,o]}return[t,n]}var Le=(r,e,i)=>r<<i|e>>>32-i,Ie=(r,e,i)=>e<<i|r>>>32-i,Ue=(r,e,i)=>e<<i-32|r>>>64-i,ze=(r,e,i)=>r<<i-32|e>>>64-i;function ft(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function he(r,e=""){if(!Number.isSafeInteger(r)||r<0){let i=e&&`"${e}" `;throw new Error(`${i}expected integer >0, got ${r}`)}}function Z(r,e,i=""){let t=ft(r),n=r?.length,a=e!==void 0;if(!t||a&&n!==e){let s=i&&`"${i}" `,o=a?` of length ${e}`:"",f=t?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+f)}return r}function be(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Oe(r,e){Z(r,void 0,"digestInto() output");let i=e.outputLen;if(r.length<i)throw new Error('"digestInto() output" expected to be of length >='+i)}function Be(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function de(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}var ht=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function bt(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function dt(r){for(let e=0;e<r.length;e++)r[e]=bt(r[e]);return r}var ye=ht?r=>r:dt;function pe(r,e={}){let i=(n,a)=>r(a).update(n).digest(),t=r(void 0);return i.outputLen=t.outputLen,i.blockLen=t.blockLen,i.create=n=>r(n),Object.assign(i,e),Object.freeze(i)}var H=r=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,r])});var yt=BigInt(0),j=BigInt(1),pt=BigInt(2),wt=BigInt(7),xt=BigInt(256),mt=BigInt(113),Te=[],Ce=[],De=[];for(let r=0,e=j,i=1,t=0;r<24;r++){[i,t]=[t,(2*i+3*t)%5],Te.push(2*(5*t+i)),Ce.push((r+1)*(r+2)/2%64);let n=yt;for(let a=0;a<7;a++)e=(e<<j^(e>>wt)*mt)%xt,e&pt&&(n^=j<<(j<<BigInt(a))-j);De.push(n)}var Me=Ee(De,!0),gt=Me[0],_t=Me[1],He=(r,e,i)=>i>32?Ue(r,e,i):Le(r,e,i),je=(r,e,i)=>i>32?ze(r,e,i):Ie(r,e,i);function vt(r,e=24){let i=new Uint32Array(10);for(let t=24-e;t<24;t++){for(let s=0;s<10;s++)i[s]=r[s]^r[s+10]^r[s+20]^r[s+30]^r[s+40];for(let s=0;s<10;s+=2){let o=(s+8)%10,f=(s+2)%10,m=i[f],c=i[f+1],x=He(m,c,1)^i[o],B=je(m,c,1)^i[o+1];for(let w=0;w<50;w+=10)r[s+w]^=x,r[s+w+1]^=B}let n=r[2],a=r[3];for(let s=0;s<24;s++){let o=Ce[s],f=He(n,a,o),m=je(n,a,o),c=Te[s];n=r[c],a=r[c+1],r[c]=f,r[c+1]=m}for(let s=0;s<50;s+=10){for(let o=0;o<10;o++)i[o]=r[s+o];for(let o=0;o<10;o++)r[s+o]^=~i[(o+2)%10]&i[(o+4)%10]}r[0]^=gt[t],r[1]^=_t[t]}de(i)}var q=class r{constructor(e,i,t,n=!1,a=24){if(Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"posOut",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state32",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enableXOF",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"rounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.blockLen=e,this.suffix=i,this.outputLen=t,this.enableXOF=n,this.rounds=a,he(t,"outputLen"),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Be(this.state)}clone(){return this._cloneInto()}keccak(){ye(this.state32),vt(this.state32,this.rounds),ye(this.state32),this.posOut=0,this.pos=0}update(e){be(this),Z(e);let{blockLen:i,state:t}=this,n=e.length;for(let a=0;a<n;){let s=Math.min(i-this.pos,n-a);for(let o=0;o<s;o++)t[this.pos++]^=e[a++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:i,pos:t,blockLen:n}=this;e[t]^=i,(i&128)!==0&&t===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){be(this,!1),Z(e),this.finish();let i=this.state,{blockLen:t}=this;for(let n=0,a=e.length;n<a;){this.posOut>=t&&this.keccak();let s=Math.min(t-this.posOut,a-n);e.set(i.subarray(this.posOut,this.posOut+s),n),this.posOut+=s,n+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return he(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Oe(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,de(this.state)}_cloneInto(e){let{blockLen:i,suffix:t,outputLen:n,rounds:a,enableXOF:s}=this;return e||=new r(i,t,n,s,a),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=a,e.suffix=t,e.outputLen=n,e.enableXOF=s,e.destroyed=this.destroyed,e}},Ne=(r,e,i,t={})=>pe(()=>new q(e,r,i),t),ee=Ne(6,136,32,H(8)),te=Ne(6,72,64,H(10));var Fe=(r,e,i,t={})=>pe((n={})=>new q(e,r,n.dkLen===void 0?i:n.dkLen,!0),t),re=Fe(31,168,16,H(11)),z=Fe(31,136,32,H(12));var Pt={},Ge=kt(globalThis,Pt);function kt(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),a=new Set(n);return[...t.filter(s=>!a.has(s)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}function h(r){return r%256}function p(r){return r>=-32768&&r<=32767?r:r<-32768?(r=r+32769,r=r%65536,32767+r):(r=r-32768,r=r%65536,-32768+r)}function u(r){return r%65536}function ie(r){return r>=-2147483648&&r<=2147483647?r:r<-2147483648?(r=r+2147483649,r=r%4294967296,2147483647+r):(r=r-2147483648,r=r%4294967296,-2147483648+r)}function y(r){return r%4294967296}function Re(r,e){if(r.length!=e.length)return 0;let i=new Uint8Array([0]);for(let n=0;n<r.length;n++)i[0]|=r[n]^e[n];let t=new Uint8Array([0]);return t[0]=~(i[0]^t[0]),t[0]&=t[0]>>4,t[0]&=t[0]>>2,t[0]&=t[0]>>1,t[0]}function Ve(r,e){if(r.length!=e.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}async function $e(){if(typeof Ge<"u"&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("failed to load Crypto")}}function T(r,e,i){return z.create({dkLen:r}).update(e).update(new Uint8Array([i])).digest()}function We(r){let e=y(r[0]);return e|=y(r[1])<<8,e|=y(r[2])<<16,e}function Xe(r){let e=y(r[0]);return e|=y(r[1])<<8,e|=y(r[2])<<16,e|=y(r[3])<<24,y(e)}var A=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_skSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pkSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedUSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedVSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}async generateKeyPair(){await this._setup();try{let e=new Uint8Array(64);return this._api.getRandomValues(e),this._deriveKeyPair(e)}catch(e){throw new P(e)}}async deriveKeyPair(e){await this._setup();try{if(e.byteLength!==64)throw new Error("seed must be 64 bytes in length");return this._deriveKeyPair(e)}catch(i){throw new P(i)}}async encap(e,i){await this._setup();try{if(e.length!==384*this._k+32)throw new Error("invalid encapsulation key");let t=this._getSeed(i),[n,a]=we(t,Je(e));return[this._encap(e,t,a),n]}catch(t){throw new P(t)}}async decap(e,i){await this._setup();try{if(e.byteLength!==this._compressedUSize+this._compressedVSize)throw new Error("Invalid ct size");if(i.length!==768*this._k+96)throw new Error("Invalid decapsulation key");let t=i.subarray(0,this._skSize),n=i.subarray(this._skSize,this._skSize+this._pkSize),a=i.subarray(this._skSize+this._pkSize,this._skSize+this._pkSize+32),s=i.subarray(this._skSize+this._pkSize+32,this._skSize+this._pkSize+64),o=this._decap(e,t),[f,m]=we(o,a),c=St(s,e),x=this._encap(n,o,m);return Re(e,x)===1?f:c}catch(t){throw new P(t)}}async _setup(){this._api===void 0&&(this._api=await $e())}_getSeed(e){if(e==null){let i=new Uint8Array(32);return this._api.getRandomValues(i),i}if(e.byteLength!==32)throw new Error("seed must be 32 bytes in length");return e}_deriveKeyPair(e){let i=e.subarray(0,32),t=e.subarray(32,64),[n,a]=this._deriveCpaKeyPair(i),s=Je(n),o=new Uint8Array(this._skSize+this._pkSize+64);return o.set(a,0),o.set(n,this._skSize),o.set(s,this._skSize+this._pkSize),o.set(t,this._skSize+this._pkSize+32),[n,o]}_deriveCpaKeyPair(e){let[i,t]=we(e,new Uint8Array([this._k])),n=this._sampleMatrix(i,!1),a=this._sampleNoise1(t,0,this._k),s=this._sampleNoise1(t,this._k,this._k);for(let c=0;c<this._k;c++)a[c]=ne(a[c]),a[c]=L(a[c]),s[c]=ne(s[c]);let o=new Array(this._k);for(let c=0;c<this._k;c++)o[c]=Ut(ae(n[c],a)),o[c]=C(o[c],s[c]),o[c]=L(o[c]);let f=new Uint8Array(this._pkSize);for(let c=0;c<this._k;c++)f.set(xe(o[c]),c*384);f.set(i,this._skSize);let m=new Uint8Array(this._skSize);for(let c=0;c<this._k;c++)m.set(xe(a[c]),c*384);return[f,m]}_encap(e,i,t){let n=new Array(this._k),a=new Uint8Array(384*this._k);for(let b=0;b<this._k;b++)n[b]=Qe(e.subarray(b*384,(b+1)*384)),a.set(xe(n[b]),b*384);if(!Ve(e.subarray(0,a.length),a))throw new Error("invalid encapsulation key");let s=e.subarray(this._skSize),o=this._sampleMatrix(s,!0),f=this._sampleNoise1(t,0,this._k),m=this._sampleNoise2(t,this._k,this._k),c=this._sampleNoise2(t,this._k*2,1)[0];for(let b=0;b<this._k;b++)f[b]=ne(f[b]),f[b]=L(f[b]);let x=new Array(this._k);for(let b=0;b<this._k;b++)x[b]=ae(o[b],f),x[b]=me(x[b]),x[b]=C(x[b],m[b]),x[b]=L(x[b]);let B=It(i),w=ae(n,f);w=me(w),w=C(w,c),w=C(w,B),w=L(w);let v=new Uint8Array(this._compressedUSize+this._compressedVSize);return this._compressU(v.subarray(0,this._compressedUSize),x),this._compressV(v.subarray(this._compressedUSize),w),v}_decap(e,i){let t=this._decompressU(e.subarray(0,this._compressedUSize)),n=this._decompressV(e.subarray(this._compressedUSize)),a=this._polyvecFromBytes(i);for(let o=0;o<this._k;o++)t[o]=ne(t[o]);let s=ae(a,t);return s=me(s),s=zt(n,s),s=L(s),Lt(s)}_sampleMatrix(e,i){let t=new Array(this._k),n=new Uint8Array(2);for(let a=0,s=0;s<this._k;s++){t[s]=new Array(this._k);for(let o=0;o<this._k;o++){i?(n[0]=s,n[1]=o):(n[0]=o,n[1]=s);let f=Et(e,n),m=Ye(f.subarray(0,504),504,256);for(t[s][o]=m[0],a=m[1];a<256;){let c=f.subarray(504,672),x=Ye(c,168,256-a),B=x[0],w=x[1];for(let v=a;v<256;v++)t[s][o][v]=B[v-a];a=a+w}}}return t}_sampleNoise1(e,i,t){let n=new Array(t);for(let a=0;a<t;a++)n[a]=Ze(T(this._eta1*256/4,e,i),this._eta1),i++;return n}_sampleNoise2(e,i,t){let n=new Array(t);for(let a=0;a<t;a++)n[a]=Ze(T(this._eta2*256/4,e,i),this._eta2),i++;return n}_polyvecFromBytes(e){let i=new Array(this._k);for(let t=0;t<this._k;t++)i[t]=Qe(e.subarray(t*384,(t+1)*384));return i}_compressU(e,i){let t=new Array(4);for(let n=0,a=0;a<this._k;a++)for(let s=0;s<256/4;s++){for(let o=0;o<4;o++)t[o]=((i[a][4*s+o]<<10)+3329/2)/3329&1023;e[n++]=h(t[0]>>0),e[n++]=h(t[0]>>8|t[1]<<2),e[n++]=h(t[1]>>6|t[2]<<4),e[n++]=h(t[2]>>4|t[3]<<6),e[n++]=h(t[3]>>2)}return e}_compressV(e,i){let t=new Uint8Array(8);for(let n=0,a=0;a<256/8;a++){for(let s=0;s<8;s++)t[s]=h(((i[8*a+s]<<4)+3329/2)/3329)&15;e[n++]=t[0]|t[1]<<4,e[n++]=t[2]|t[3]<<4,e[n++]=t[4]|t[5]<<4,e[n++]=t[6]|t[7]<<4}return e}_decompressU(e){let i=new Array(this._k);for(let n=0;n<this._k;n++)i[n]=new Array(384);let t=new Array(4);for(let n=0,a=0;a<this._k;a++)for(let s=0;s<256/4;s++){t[0]=u(e[n+0])>>0|u(e[n+1])<<8,t[1]=u(e[n+1])>>2|u(e[n+2])<<6,t[2]=u(e[n+2])>>4|u(e[n+3])<<4,t[3]=u(e[n+3])>>6|u(e[n+4])<<2,n=n+5;for(let o=0;o<4;o++)i[a][4*s+o]=p(y(t[o]&1023)*y(3329)+512>>10)}return i}_decompressV(e){let i=new Array(384);for(let t=0,n=0;n<256/2;n++,t++)i[2*n+0]=p(u(e[t]&15)*u(3329)+8>>4),i[2*n+1]=p(u(e[t]>>4)*u(3329)+8>>4);return i}};function we(r,e){let i=te.create().update(r);e!==void 0&&i.update(e);let t=i.digest();return[t.subarray(0,32),t.subarray(32,64)]}function Je(r){return ee.create().update(r).digest()}function St(r,e){let i=z.create({dkLen:32}).update(r);return e!==void 0&&i.update(e),i.digest()}function Et(r,e){return re.create({dkLen:672}).update(r).update(e).digest()}function xe(r){let e=0,i=0,t=new Uint8Array(384),n=it(r);for(let a=0;a<256/2;a++)e=u(n[2*a]),i=u(n[2*a+1]),t[3*a+0]=h(e>>0),t[3*a+1]=h(e>>8)|h(i<<4),t[3*a+2]=h(i>>4);return t}function Qe(r){let e=new Array(384).fill(0);for(let i=0;i<256/2;i++)e[2*i]=p((u(r[3*i+0])>>0|u(r[3*i+1])<<8)&4095),e[2*i+1]=p((u(r[3*i+1])>>4|u(r[3*i+2])<<4)&4095);return e}function Lt(r){let e=new Uint8Array(32),i,t=it(r);for(let n=0;n<256/8;n++){e[n]=0;for(let a=0;a<8;a++)i=((u(t[8*n+a])<<1)+u(3329/2))/u(3329)&1,e[n]|=h(i<<a)}return e}function It(r){let e=new Array(384).fill(0),i;for(let t=0;t<256/8;t++)for(let n=0;n<8;n++)i=-1*p(r[t]>>n&1),e[8*t+n]=i&p(3330/2);return e}function Ye(r,e,i){let t=new Array(384).fill(0),n=0,a,s;for(let o=0;n<i&&o+3<=e;)a=(u(r[o]>>0)|u(r[o+1])<<8)&4095,s=(u(r[o+1]>>4)|u(r[o+2])<<4)&4095,o=o+3,a<3329&&(t[n]=a,n=n+1),n<i&&s<3329&&(t[n]=s,n=n+1);return[t,n]}function Ze(r,e){let i,t,n,a,s=new Array(384).fill(0);for(let o=0;o<256/8;o++){i=Xe(r.subarray(4*o,r.length)),t=i&1431655765,t=t+(i>>1&1431655765);for(let f=0;f<8;f++)n=p(t>>4*f+0&3),a=p(t>>4*f+e&3),s[8*o+f]=n-a}return s}function ne(r){for(let e=0,i=1,t=128;t>=2;t>>=1)for(let n=0;n<256;n=e+t){let a=Q[i];for(i=i+1,e=n;e<n+t;e++){let s=k(a,r[e+t]);r[e+t]=r[e]-s,r[e]=r[e]+s}}return r}function k(r,e){return rt(r*e)}function L(r){for(let e=0;e<256;e++)r[e]=tt(r[e]);return r}function tt(r){let i=(16777216+3329/2)/3329*r>>24;return i=i*3329,r-i}function rt(r){let i=p(ie(r)*62209)*3329;return i=r-i,i>>=16,p(i)}function Ut(r){for(let i=0;i<256;i++)r[i]=rt(ie(r[i])*ie(1353));return r}function ae(r,e){let i=qe(r[0],e[0]),t;for(let n=1;n<r.length;n++)t=qe(r[n],e[n]),i=C(i,t);return L(i)}function qe(r,e){let i,t;for(let n=0;n<256/4;n++)i=et(r[4*n+0],r[4*n+1],e[4*n+0],e[4*n+1],Q[64+n]),t=et(r[4*n+2],r[4*n+3],e[4*n+2],e[4*n+3],-Q[64+n]),r[4*n+0]=i[0],r[4*n+1]=i[1],r[4*n+2]=t[0],r[4*n+3]=t[1];return r}function et(r,e,i,t,n){let a=new Array(2);return a[0]=k(e,t),a[0]=k(a[0],n),a[0]+=k(r,i),a[1]=k(r,t),a[1]+=k(e,i),a}function C(r,e){let i=new Array(384);for(let t=0;t<256;t++)i[t]=r[t]+e[t];return i}function zt(r,e){for(let i=0;i<256;i++)r[i]-=e[i];return r}function me(r){let e=0;for(let i=0,t=2;t<=128;t<<=1)for(let n=0;n<256;n=e+t){let a=fe[i];for(i=i+1,e=n;e<n+t;e++){let s=r[e];r[e]=tt(s+r[e+t]),r[e+t]=s-r[e+t],r[e+t]=k(a,r[e+t])}}for(e=0;e<256;e++)r[e]=k(r[e],fe[127]);return r}function it(r){for(let e=0;e<256;e++)r[e]-=3329,r[e]+=r[e]>>31&3329;return r}var D=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_sampleNoise1(e,i,t){let n=new Array(t);for(let a=0;a<t;a++)n[a]=Ot(T(this._eta1*256/4,e,i),this._eta1),i++;return n}};function Ot(r,e){let i,t,n,a,s=new Array(384).fill(0);for(let o=0;o<256/4;o++){i=We(r.subarray(3*o,r.length)),t=i&2396745,t=t+(i>>1&2396745),t=t+(i>>2&2396745);for(let f=0;f<4;f++)n=p(t>>6*f+0&7),a=p(t>>6*f+e&7),s[4*o+f]=n-a}return s}var M=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}};var N=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_compressU(e,i){let t=new Array(8);for(let n=0,a=0;a<this._k;a++)for(let s=0;s<256/8;s++){for(let o=0;o<8;o++)t[o]=u(((y(i[a][8*s+o])<<11)+y(3329/2))/y(3329)&2047);e[n++]=h(t[0]>>0),e[n++]=h(t[0]>>8|t[1]<<3),e[n++]=h(t[1]>>5|t[2]<<6),e[n++]=h(t[2]>>2),e[n++]=h(t[2]>>10|t[3]<<1),e[n++]=h(t[3]>>7|t[4]<<4),e[n++]=h(t[4]>>4|t[5]<<7),e[n++]=h(t[5]>>1),e[n++]=h(t[5]>>9|t[6]<<2),e[n++]=h(t[6]>>6|t[7]<<5),e[n++]=h(t[7]>>3)}return e}_compressV(e,i){let t=new Uint8Array(8);for(let n=0,a=0;a<256/8;a++){for(let s=0;s<8;s++)t[s]=h(((y(i[8*a+s])<<5)+y(3329/2))/y(3329))&31;e[n++]=h(t[0]>>0|t[1]<<5),e[n++]=h(t[1]>>3|t[2]<<2|t[3]<<7),e[n++]=h(t[3]>>1|t[4]<<4),e[n++]=h(t[4]>>4|t[5]<<1|t[6]<<6),e[n++]=h(t[6]>>2|t[7]<<3)}return e}_decompressU(e){let i=new Array(this._k);for(let n=0;n<this._k;n++)i[n]=new Array(384);let t=new Array(8);for(let n=0,a=0;a<this._k;a++)for(let s=0;s<256/8;s++){t[0]=u(e[n+0])>>0|u(e[n+1])<<8,t[1]=u(e[n+1])>>3|u(e[n+2])<<5,t[2]=u(e[n+2])>>6|u(e[n+3])<<2|u(e[n+4])<<10,t[3]=u(e[n+4])>>1|u(e[n+5])<<7,t[4]=u(e[n+5])>>4|u(e[n+6])<<4,t[5]=u(e[n+6])>>7|u(e[n+7])<<1|u(e[n+8])<<9,t[6]=u(e[n+8])>>2|u(e[n+9])<<6,t[7]=u(e[n+9])>>5|u(e[n+10])<<3,n=n+11;for(let o=0;o<8;o++)i[a][8*s+o]=y(t[o]&2047)*3329+1024>>11}return i}_decompressV(e){let i=new Array(384),t=new Array(8);for(let n=0,a=0;a<256/8;a++){t[0]=e[n+0]>>0,t[1]=e[n+0]>>5|e[n+1]<<3,t[2]=e[n+1]>>2,t[3]=e[n+1]>>7|e[n+2]<<1,t[4]=e[n+2]>>4|e[n+3]<<4,t[5]=e[n+3]>>1,t[6]=e[n+3]>>6|e[n+4]<<2,t[7]=e[n+4]>>3,n=n+5;for(let s=0;s<8;s++)i[8*a+s]=p(y(t[s]&31)*y(3329)+16>>5)}return i}};var _=class extends Error{constructor(e){let i;e instanceof Error?i=e.message:typeof e=="string"?i=e:i="",super(i),this.name=this.constructor.name}},g=class extends _{};var I=class extends _{},K=class extends _{},F=class extends _{},G=class extends _{};var O=class extends _{},U=class extends _{};var Bt={},ge=Ht(globalThis,Bt);function Ht(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),a=new Set(n);return[...t.filter(s=>!a.has(s)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}var S={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48,MlKem512:64,MlKem768:65,MlKem1024:66,XWing:25722};var R=new Uint8Array(0);var _e=new Uint8Array([75,69,77,0,0]);var V=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function $(r,e){let i=new Uint8Array(r.length+e.length);return i.set(r,0),i.set(e,r.length),i}function W(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),i=atob(e),t=new Uint8Array(i.length);for(let n=0;n<i.length;n++)t[n]=i.charCodeAt(n);return t}async function se(){if(ge!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("Web Cryptograph API not supported")}}var zr=new Uint8Array([101,97,101,95,112,114,107]),Or=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);var oe=["deriveBits"],Pe=new Uint8Array([100,107,112,95,112,114,107]),at=new Uint8Array([115,107]);var Vr=new Uint8Array([99,97,110,100,105,100,97,116,101]),$r=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),Wr=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),Xr=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),Jr=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),Qr=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),Yr=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]);var E=class{constructor(e,i,t,n=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=i,this.type=t,this.algorithm={name:e},this.usages=n,t==="public"&&(this.usages=[])}};var hi=new Uint8Array([72,80,75,69,45,118,49]);function Ct(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function X(r,e,i=""){let t=Ct(r),n=r?.length,a=e!==void 0;if(!t||a&&n!==e){let s=i&&`"${i}" `,o=a?` of length ${e}`:"",f=t?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+f)}return r}function ut(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash must wrapped by utils.createHasher");ot(r.outputLen),ot(r.blockLen)}function ue(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ot(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ce(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}var le=class{constructor(e,i){if(Object.defineProperty(this,"oHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),ut(e),X(i,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let t=this.blockLen,n=new Uint8Array(t);n.set(i.length>t?e.create().update(i).digest():i);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),ce(n)}update(e){return ue(this),this.iHash.update(e),this}digestInto(e){ue(this),X(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:i,iHash:t,finished:n,destroyed:a,blockLen:s,outputLen:o}=this;return e=e,e.finished=n,e.destroyed=a,e.blockLen=s,e.outputLen=o,e.oHash=i._cloneInto(e.oHash),e.iHash=t._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ct=(r,e,i)=>new le(r,e).update(i).digest();ct.create=(r,e)=>new le(r,e);var un=BigInt(0),cn=BigInt(1),ln=BigInt(2);var J=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(i){throw new I(i)}}async deserializePublicKey(e){try{return await this._deserializePublicKey(e)}catch(i){throw new K(i)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(i){throw new I(i)}}async deserializePrivateKey(e){try{return await this._deserializePrivateKey(e)}catch(i){throw new K(i)}}async generateKeyPair(){await this._setup();let e=new Uint8Array(32),i=new Uint8Array(32);try{this._api.getRandomValues(e),this._api.getRandomValues(i)}catch(t){throw new U(t)}try{let t=$(e,i),[n,a]=await this._prim.deriveKeyPair(t),s=await this.deserializePrivateKey(t.buffer),o=await this.deserializePublicKey(n.buffer);return{privateKey:s,publicKey:o}}catch(t){throw new O(t)}}async deriveKeyPair(e){try{let[i,t]=await this._prim.deriveKeyPair(new Uint8Array(e)),n=await this.deserializePrivateKey(e),a=await this.deserializePublicKey(i.buffer);return{privateKey:n,publicKey:a}}catch(i){throw new O(i)}}async importKey(e,i,t=!0){await this._setup();try{let n;if(e==="jwk"){if(i instanceof ArrayBuffer||i instanceof Uint8Array)throw new Error("Invalid jwk key format");n=await this._importJWK(i,t)}else if(i instanceof ArrayBuffer)n=new Uint8Array(i);else if(i instanceof Uint8Array)n=i;else throw new Error("Invalid key format");if(t&&n.byteLength!==this.publicKeySize)throw new Error("Invalid length of the key");if(!t&&n.byteLength!==this.privateKeySize)throw new Error("Invalid length of the key");return new E(this.name,n,t?"public":"private",t?[]:oe)}catch(n){throw new K(n)}}async encap(e){let i;if(e.ekm!==void 0)if(e.ekm instanceof ArrayBuffer)i=new Uint8Array(e.ekm);else if(e.ekm instanceof Uint8Array)i=e.ekm;else throw new g("ekm must be 32 bytes in length");let t=new Uint8Array(await this.serializePublicKey(e.recipientPublicKey));if(t.byteLength!==this.publicKeySize)throw new g("Invalid length of recipientKey");try{let[n,a]=await this._prim.encap(t,i);return{sharedSecret:a.buffer,enc:n.buffer}}catch(n){throw new F(n)}}async decap(e){let i=V(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey;if(e.enc.byteLength!==this.encSize)throw new g("Invalid length of enc");let t=new Uint8Array(e.enc),n=new Uint8Array(await this.serializePrivateKey(i));if(n.byteLength!==this.privateKeySize)throw new g("Invalid length of recipientKey");try{let[a,s]=await this._prim.deriveKeyPair(n);return(await this._prim.decap(t,s)).buffer}catch(a){throw new G(a)}}async _setup(){this._api===void 0&&(this._api=await se())}_serializePublicKey(e){return new Promise((i,t)=>{e.type!=="public"&&t(new Error("Not public key")),e.algorithm.name!==this.name&&t(new Error(`Invalid algorithm name: ${e.algorithm.name}`)),e.key.byteLength!==this.publicKeySize&&t(new Error(`Invalid key length: ${e.key.byteLength}`)),i(e.key.buffer)})}_deserializePublicKey(e){return new Promise((i,t)=>{e.byteLength!==this.publicKeySize&&t(new Error(`Invalid key length: ${e.byteLength}`)),i(new E(this.name,new Uint8Array(e),"public"))})}_serializePrivateKey(e){return new Promise((i,t)=>{e.type!=="private"&&t(new Error("Not private key")),e.algorithm.name!==this.name&&t(new Error(`Invalid algorithm name: ${e.algorithm.name}`)),e.key.byteLength!==this.privateKeySize&&t(new Error(`Invalid key length: ${e.key.byteLength}`)),i(e.key.buffer)})}_deserializePrivateKey(e){return new Promise((i,t)=>{e.byteLength!==this.privateKeySize&&t(new Error(`Invalid key length: ${e.byteLength}`)),i(new E(this.name,new Uint8Array(e),"private",["deriveBits"]))})}_importJWK(e,i){return new Promise((t,n)=>{(typeof e.kty>"u"||e.kty!=="AKP")&&n(new Error(`Invalid kty: ${e.kty}`)),(typeof e.alg>"u"||e.alg!==this.name)&&n(new Error(`Invalid alg: ${e.alg}`)),i||(typeof e.priv>"u"&&n(new Error("Invalid key: `priv` not found")),typeof e.key_ops<"u"&&(e.key_ops.length!==1||e.key_ops[0]!=="deriveBits")&&n(new Error("Invalid key: `key_ops` should be ['deriveBits']")),t(W(e.priv))),typeof e.priv<"u"&&n(new Error("Invalid key: `priv` should not be set")),typeof e.pub>"u"&&n(new Error("Invalid key: `pub` not found")),typeof e.key_ops<"u"&&e.key_ops.length>0&&n(new Error("Invalid key: `key_ops` should not be set")),t(W(e.pub))})}},ke=class extends J{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.MlKem512}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-512"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:768}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:800}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new D}},Ae=class extends J{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.MlKem768}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-768"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:1088}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:1184}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new M}},Ke=class extends J{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.MlKem1024}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-1024"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:1568}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:1568}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new N}};export{Ke as MlKem1024,ke as MlKem512,Ae as MlKem768};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
/*! Bundled license information:

mlkem/esm/src/sha3/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
