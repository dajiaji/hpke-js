var v=class extends Error{constructor(e){let i;e instanceof Error?i=e.message:typeof e=="string"?i=e:i="",super(i),this.name=this.constructor.name}};var Y=[2285,2571,2970,1812,1493,1422,287,202,3158,622,1577,182,962,2127,1855,1468,573,2004,264,383,2500,1458,1727,3199,2648,1017,732,608,1787,411,3124,1758,1223,652,2777,1015,2036,1491,3047,1785,516,3321,3009,2663,1711,2167,126,1469,2476,3239,3058,830,107,1908,3082,2378,2931,961,1821,2604,448,2264,677,2054,2226,430,555,843,2078,871,1550,105,422,587,177,3094,3038,2869,1574,1653,3083,778,1159,3182,2552,1483,2727,1119,1739,644,2457,349,418,329,3173,3254,817,1097,603,610,1322,2044,1864,384,2114,3193,1218,1994,2455,220,2142,1670,2144,1799,2051,794,1819,2475,2459,478,3221,3021,996,991,958,1869,1522,1628],se=[1701,1807,1460,2371,2338,2333,308,108,2851,870,854,1510,2535,1278,1530,1185,1659,1187,3109,874,1335,2111,136,1215,2945,1465,1285,2007,2719,2726,2232,2512,75,156,3e3,2911,2980,872,2685,1590,2210,602,1846,777,147,2170,2551,246,1676,1755,460,291,235,3152,2742,2907,3224,1779,2458,1251,2486,2774,2899,1103,1275,2652,1065,2881,725,1508,2368,398,951,247,1421,3222,2499,271,90,853,1860,3203,1162,1618,666,320,8,2813,1544,282,1838,1293,2314,552,2677,2106,1571,205,2918,1542,2721,2597,2312,681,130,1602,1871,829,2946,3065,1325,2756,1861,1474,1202,2367,3147,1752,2707,171,3127,3042,1907,1836,1517,359,758,1441];function ae(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function nt(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function T(r,...e){if(!nt(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function oe(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Pe(r,e){T(r);let i=e.outputLen;if(r.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}var Z=BigInt(4294967295),Ke=BigInt(32);function st(r,e=!1){return e?{h:Number(r&Z),l:Number(r>>Ke&Z)}:{h:Number(r>>Ke&Z)|0,l:Number(r&Z)|0}}function Ae(r,e=!1){let i=new Uint32Array(r.length),t=new Uint32Array(r.length);for(let n=0;n<r.length;n++){let{h:s,l:a}=st(r[n],e);[i[n],t[n]]=[s,a]}return[i,t]}var Se=(r,e,i)=>r<<i|e>>>32-i,ze=(r,e,i)=>e<<i|r>>>32-i,Ee=(r,e,i)=>e<<i-32|r>>>64-i,Ue=(r,e,i)=>r<<i-32|e>>>64-i;function Le(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}var ue=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function at(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function ce(r){for(let e=0;e<r.length;e++)r[e]=at(r[e])}function ot(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function q(r){return typeof r=="string"&&(r=ot(r)),T(r),r}var J=class{clone(){return this._cloneInto()}};function Ie(r){let e=t=>r().update(q(t)).digest(),i=r();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>r(),e}function Oe(r){let e=(t,n)=>r(n).update(q(t)).digest(),i=r({});return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=t=>r(t),e}var je=[],He=[],Me=[],ut=BigInt(0),j=BigInt(1),ct=BigInt(2),lt=BigInt(7),ft=BigInt(256),ht=BigInt(113);for(let r=0,e=j,i=1,t=0;r<24;r++){[i,t]=[t,(2*i+3*t)%5],je.push(2*(5*t+i)),He.push((r+1)*(r+2)/2%64);let n=ut;for(let s=0;s<7;s++)e=(e<<j^(e>>lt)*ht)%ft,e&ct&&(n^=j<<(j<<BigInt(s))-j);Me.push(n)}var[yt,dt]=Ae(Me,!0),Be=(r,e,i)=>i>32?Ee(r,e,i):Se(r,e,i),Te=(r,e,i)=>i>32?Ue(r,e,i):ze(r,e,i);function pt(r,e=24){let i=new Uint32Array(10);for(let t=24-e;t<24;t++){for(let a=0;a<10;a++)i[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){let o=(a+8)%10,f=(a+2)%10,m=i[f],c=i[f+1],_=Be(m,c,1)^i[o],B=Te(m,c,1)^i[o+1];for(let w=0;w<50;w+=10)r[a+w]^=_,r[a+w+1]^=B}let n=r[2],s=r[3];for(let a=0;a<24;a++){let o=He[a],f=Be(n,s,o),m=Te(n,s,o),c=je[a];n=r[c],s=r[c+1],r[c]=f,r[c+1]=m}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)i[o]=r[a+o];for(let o=0;o<10;o++)r[a+o]^=~i[(o+2)%10]&i[(o+4)%10]}r[0]^=yt[t],r[1]^=dt[t]}i.fill(0)}var ee=class r extends J{constructor(e,i,t,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=t,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ae(t),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Le(this.state)}keccak(){ue||ce(this.state32),pt(this.state32,this.rounds),ue||ce(this.state32),this.posOut=0,this.pos=0}update(e){oe(this);let{blockLen:i,state:t}=this;e=q(e);let n=e.length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);for(let o=0;o<a;o++)t[this.pos++]^=e[s++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:i,pos:t,blockLen:n}=this;e[t]^=i,(i&128)!==0&&t===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){oe(this,!1),T(e),this.finish();let i=this.state,{blockLen:t}=this;for(let n=0,s=e.length;n<s;){this.posOut>=t&&this.keccak();let a=Math.min(t-this.posOut,s-n);e.set(i.subarray(this.posOut,this.posOut+a),n),this.posOut+=a,n+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ae(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Pe(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:i,suffix:t,outputLen:n,rounds:s,enableXOF:a}=this;return e||(e=new r(i,t,n,a,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=t,e.outputLen=n,e.enableXOF=a,e.destroyed=this.destroyed,e}},P=(r,e,i)=>Ie(()=>new ee(e,r,i)),Ct=P(6,144,224/8),le=P(6,136,256/8),Nt=P(6,104,384/8),fe=P(6,72,512/8),Rt=P(1,144,224/8),Ft=P(1,136,256/8),Gt=P(1,104,384/8),Vt=P(1,72,512/8),De=(r,e,i)=>Oe((t={})=>new ee(e,r,t.dkLen===void 0?i:t.dkLen,!0)),he=De(31,168,128/8),H=De(31,136,256/8);var bt={},Ce=wt(globalThis,bt);function wt(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),s=new Set(n);return[...t.filter(a=>!s.has(a)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}function h(r){return r%256}function b(r){return r>=-32768&&r<=32767?r:r<-32768?(r=r+32769,r=r%65536,32767+r):(r=r-32768,r=r%65536,-32768+r)}function u(r){return r%65536}function te(r){return r>=-2147483648&&r<=2147483647?r:r<-2147483648?(r=r+2147483649,r=r%4294967296,2147483647+r):(r=r-2147483648,r=r%4294967296,-2147483648+r)}function p(r){return r%4294967296}function Ne(r,e){if(r.length!=e.length)return 0;let i=new Uint8Array([0]);for(let n=0;n<r.length;n++)i[0]|=r[n]^e[n];let t=new Uint8Array([0]);return t[0]=~(i[0]^t[0]),t[0]&=t[0]>>4,t[0]&=t[0]>>2,t[0]&=t[0]>>1,t[0]}function Re(r,e){if(r.length!=e.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}async function Fe(){if(typeof Ce<"u"&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("failed to load Crypto")}}function M(r,e,i){return H.create({dkLen:r}).update(e).update(new Uint8Array([i])).digest()}function Ge(r){let e=p(r[0]);return e|=p(r[1])<<8,e|=p(r[2])<<16,e}function Ve(r){let e=p(r[0]);return e|=p(r[1])<<8,e|=p(r[2])<<16,e|=p(r[3])<<24,p(e)}var A=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_skSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pkSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedUSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedVSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}async generateKeyPair(){await this._setup();try{let e=new Uint8Array(64);return this._api.getRandomValues(e),this._deriveKeyPair(e)}catch(e){throw new v(e)}}async deriveKeyPair(e){await this._setup();try{if(e.byteLength!==64)throw new Error("seed must be 64 bytes in length");return this._deriveKeyPair(e)}catch(i){throw new v(i)}}async encap(e,i){await this._setup();try{if(e.length!==384*this._k+32)throw new Error("invalid encapsulation key");let t=this._getSeed(i),[n,s]=ye(t,$e(e));return[this._encap(e,t,s),n]}catch(t){throw new v(t)}}async decap(e,i){await this._setup();try{if(e.byteLength!==this._compressedUSize+this._compressedVSize)throw new Error("Invalid ct size");if(i.length!==768*this._k+96)throw new Error("Invalid decapsulation key");let t=i.subarray(0,this._skSize),n=i.subarray(this._skSize,this._skSize+this._pkSize),s=i.subarray(this._skSize+this._pkSize,this._skSize+this._pkSize+32),a=i.subarray(this._skSize+this._pkSize+32,this._skSize+this._pkSize+64),o=this._decap(e,t),[f,m]=ye(o,s),c=gt(a,e),_=this._encap(n,o,m);return Ne(e,_)===1?f:c}catch(t){throw new v(t)}}async _setup(){this._api===void 0&&(this._api=await Fe())}_getSeed(e){if(e==null){let i=new Uint8Array(32);return this._api.getRandomValues(i),i}if(e.byteLength!==32)throw new Error("seed must be 32 bytes in length");return e}_deriveKeyPair(e){let i=e.subarray(0,32),t=e.subarray(32,64),[n,s]=this._deriveCpaKeyPair(i),a=$e(n),o=new Uint8Array(this._skSize+this._pkSize+64);return o.set(s,0),o.set(n,this._skSize),o.set(a,this._skSize+this._pkSize),o.set(t,this._skSize+this._pkSize+32),[n,o]}_deriveCpaKeyPair(e){let[i,t]=ye(e,new Uint8Array([this._k])),n=this._sampleMatrix(i,!1),s=this._sampleNoise1(t,0,this._k),a=this._sampleNoise1(t,this._k,this._k);for(let c=0;c<this._k;c++)s[c]=re(s[c]),s[c]=U(s[c]),a[c]=re(a[c]);let o=new Array(this._k);for(let c=0;c<this._k;c++)o[c]=Pt(ie(n[c],s)),o[c]=D(o[c],a[c]),o[c]=U(o[c]);let f=new Uint8Array(this._pkSize);for(let c=0;c<this._k;c++)f.set(de(o[c]),c*384);f.set(i,this._skSize);let m=new Uint8Array(this._skSize);for(let c=0;c<this._k;c++)m.set(de(s[c]),c*384);return[f,m]}_encap(e,i,t){let n=new Array(this._k),s=new Uint8Array(384*this._k);for(let y=0;y<this._k;y++)n[y]=Xe(e.subarray(y*384,(y+1)*384)),s.set(de(n[y]),y*384);if(!Re(e.subarray(0,s.length),s))throw new Error("invalid encapsulation key");let a=e.subarray(this._skSize),o=this._sampleMatrix(a,!0),f=this._sampleNoise1(t,0,this._k),m=this._sampleNoise2(t,this._k,this._k),c=this._sampleNoise2(t,this._k*2,1)[0];for(let y=0;y<this._k;y++)f[y]=re(f[y]),f[y]=U(f[y]);let _=new Array(this._k);for(let y=0;y<this._k;y++)_[y]=ie(o[y],f),_[y]=pe(_[y]),_[y]=D(_[y],m[y]),_[y]=U(_[y]);let B=vt(i),w=ie(n,f);w=pe(w),w=D(w,c),w=D(w,B),w=U(w);let k=new Uint8Array(this._compressedUSize+this._compressedVSize);return this._compressU(k.subarray(0,this._compressedUSize),_),this._compressV(k.subarray(this._compressedUSize),w),k}_decap(e,i){let t=this._decompressU(e.subarray(0,this._compressedUSize)),n=this._decompressV(e.subarray(this._compressedUSize)),s=this._polyvecFromBytes(i);for(let o=0;o<this._k;o++)t[o]=re(t[o]);let a=ie(s,t);return a=pe(a),a=Kt(n,a),a=U(a),kt(a)}_sampleMatrix(e,i){let t=new Array(this._k),n=new Uint8Array(2);for(let s=0,a=0;a<this._k;a++){t[a]=new Array(this._k);for(let o=0;o<this._k;o++){i?(n[0]=a,n[1]=o):(n[0]=o,n[1]=a);let f=xt(e,n),m=We(f.subarray(0,504),504,256);for(t[a][o]=m[0],s=m[1];s<256;){let c=f.subarray(504,672),_=We(c,168,256-s),B=_[0],w=_[1];for(let k=s;k<256;k++)t[a][o][k]=B[k-s];s=s+w}}}return t}_sampleNoise1(e,i,t){let n=new Array(t);for(let s=0;s<t;s++)n[s]=Qe(M(this._eta1*256/4,e,i),this._eta1),i++;return n}_sampleNoise2(e,i,t){let n=new Array(t);for(let s=0;s<t;s++)n[s]=Qe(M(this._eta2*256/4,e,i),this._eta2),i++;return n}_polyvecFromBytes(e){let i=new Array(this._k);for(let t=0;t<this._k;t++)i[t]=Xe(e.subarray(t*384,(t+1)*384));return i}_compressU(e,i){let t=new Array(4);for(let n=0,s=0;s<this._k;s++)for(let a=0;a<256/4;a++){for(let o=0;o<4;o++)t[o]=((i[s][4*a+o]<<10)+3329/2)/3329&1023;e[n++]=h(t[0]>>0),e[n++]=h(t[0]>>8|t[1]<<2),e[n++]=h(t[1]>>6|t[2]<<4),e[n++]=h(t[2]>>4|t[3]<<6),e[n++]=h(t[3]>>2)}return e}_compressV(e,i){let t=new Uint8Array(8);for(let n=0,s=0;s<256/8;s++){for(let a=0;a<8;a++)t[a]=h(((i[8*s+a]<<4)+3329/2)/3329)&15;e[n++]=t[0]|t[1]<<4,e[n++]=t[2]|t[3]<<4,e[n++]=t[4]|t[5]<<4,e[n++]=t[6]|t[7]<<4}return e}_decompressU(e){let i=new Array(this._k);for(let n=0;n<this._k;n++)i[n]=new Array(384);let t=new Array(4);for(let n=0,s=0;s<this._k;s++)for(let a=0;a<256/4;a++){t[0]=u(e[n+0])>>0|u(e[n+1])<<8,t[1]=u(e[n+1])>>2|u(e[n+2])<<6,t[2]=u(e[n+2])>>4|u(e[n+3])<<4,t[3]=u(e[n+3])>>6|u(e[n+4])<<2,n=n+5;for(let o=0;o<4;o++)i[s][4*a+o]=b(p(t[o]&1023)*p(3329)+512>>10)}return i}_decompressV(e){let i=new Array(384);for(let t=0,n=0;n<256/2;n++,t++)i[2*n+0]=b(u(e[t]&15)*u(3329)+8>>4),i[2*n+1]=b(u(e[t]>>4)*u(3329)+8>>4);return i}};function ye(r,e){let i=fe.create().update(r);e!==void 0&&i.update(e);let t=i.digest();return[t.subarray(0,32),t.subarray(32,64)]}function $e(r){return le.create().update(r).digest()}function gt(r,e){let i=H.create({dkLen:32}).update(r);return e!==void 0&&i.update(e),i.digest()}function xt(r,e){return he.create({dkLen:672}).update(r).update(e).digest()}function de(r){let e=0,i=0,t=new Uint8Array(384),n=et(r);for(let s=0;s<256/2;s++)e=u(n[2*s]),i=u(n[2*s+1]),t[3*s+0]=h(e>>0),t[3*s+1]=h(e>>8)|h(i<<4),t[3*s+2]=h(i>>4);return t}function Xe(r){let e=new Array(384).fill(0);for(let i=0;i<256/2;i++)e[2*i]=b((u(r[3*i+0])>>0|u(r[3*i+1])<<8)&4095),e[2*i+1]=b((u(r[3*i+1])>>4|u(r[3*i+2])<<4)&4095);return e}function kt(r){let e=new Uint8Array(32),i,t=et(r);for(let n=0;n<256/8;n++){e[n]=0;for(let s=0;s<8;s++)i=((u(t[8*n+s])<<1)+u(3329/2))/u(3329)&1,e[n]|=h(i<<s)}return e}function vt(r){let e=new Array(384).fill(0),i;for(let t=0;t<256/8;t++)for(let n=0;n<8;n++)i=-1*b(r[t]>>n&1),e[8*t+n]=i&b(3330/2);return e}function We(r,e,i){let t=new Array(384).fill(0),n=0,s,a;for(let o=0;n<i&&o+3<=e;)s=(u(r[o]>>0)|u(r[o+1])<<8)&4095,a=(u(r[o+1]>>4)|u(r[o+2])<<4)&4095,o=o+3,s<3329&&(t[n]=s,n=n+1),n<i&&a<3329&&(t[n]=a,n=n+1);return[t,n]}function Qe(r,e){let i,t,n,s,a=new Array(384).fill(0);for(let o=0;o<256/8;o++){i=Ve(r.subarray(4*o,r.length)),t=i&1431655765,t=t+(i>>1&1431655765);for(let f=0;f<8;f++)n=b(t>>4*f+0&3),s=b(t>>4*f+e&3),a[8*o+f]=n-s}return a}function re(r){for(let e=0,i=1,t=128;t>=2;t>>=1)for(let n=0;n<256;n=e+t){let s=Y[i];for(i=i+1,e=n;e<n+t;e++){let a=K(s,r[e+t]);r[e+t]=r[e]-a,r[e]=r[e]+a}}return r}function K(r,e){return qe(r*e)}function U(r){for(let e=0;e<256;e++)r[e]=Je(r[e]);return r}function Je(r){let i=(16777216+3329/2)/3329*r>>24;return i=i*3329,r-i}function qe(r){let i=b(te(r)*62209)*3329;return i=r-i,i>>=16,b(i)}function Pt(r){for(let i=0;i<256;i++)r[i]=qe(te(r[i])*te(1353));return r}function ie(r,e){let i=Ye(r[0],e[0]),t;for(let n=1;n<r.length;n++)t=Ye(r[n],e[n]),i=D(i,t);return U(i)}function Ye(r,e){let i,t;for(let n=0;n<256/4;n++)i=Ze(r[4*n+0],r[4*n+1],e[4*n+0],e[4*n+1],Y[64+n]),t=Ze(r[4*n+2],r[4*n+3],e[4*n+2],e[4*n+3],-Y[64+n]),r[4*n+0]=i[0],r[4*n+1]=i[1],r[4*n+2]=t[0],r[4*n+3]=t[1];return r}function Ze(r,e,i,t,n){let s=new Array(2);return s[0]=K(e,t),s[0]=K(s[0],n),s[0]+=K(r,i),s[1]=K(r,t),s[1]+=K(e,i),s}function D(r,e){let i=new Array(384);for(let t=0;t<256;t++)i[t]=r[t]+e[t];return i}function Kt(r,e){for(let i=0;i<256;i++)r[i]-=e[i];return r}function pe(r){let e=0;for(let i=0,t=2;t<=128;t<<=1)for(let n=0;n<256;n=e+t){let s=se[i];for(i=i+1,e=n;e<n+t;e++){let a=r[e];r[e]=Je(a+r[e+t]),r[e+t]=a-r[e+t],r[e+t]=K(s,r[e+t])}}for(e=0;e<256;e++)r[e]=K(r[e],se[127]);return r}function et(r){for(let e=0;e<256;e++)r[e]-=3329,r[e]+=r[e]>>31&3329;return r}var C=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_sampleNoise1(e,i,t){let n=new Array(t);for(let s=0;s<t;s++)n[s]=At(M(this._eta1*256/4,e,i),this._eta1),i++;return n}};function At(r,e){let i,t,n,s,a=new Array(384).fill(0);for(let o=0;o<256/4;o++){i=Ge(r.subarray(3*o,r.length)),t=i&2396745,t=t+(i>>1&2396745),t=t+(i>>2&2396745);for(let f=0;f<4;f++)n=b(t>>6*f+0&7),s=b(t>>6*f+e&7),a[4*o+f]=n-s}return a}var N=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}};var R=class extends A{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_compressU(e,i){let t=new Array(8);for(let n=0,s=0;s<this._k;s++)for(let a=0;a<256/8;a++){for(let o=0;o<8;o++)t[o]=u(((p(i[s][8*a+o])<<11)+p(3329/2))/p(3329)&2047);e[n++]=h(t[0]>>0),e[n++]=h(t[0]>>8|t[1]<<3),e[n++]=h(t[1]>>5|t[2]<<6),e[n++]=h(t[2]>>2),e[n++]=h(t[2]>>10|t[3]<<1),e[n++]=h(t[3]>>7|t[4]<<4),e[n++]=h(t[4]>>4|t[5]<<7),e[n++]=h(t[5]>>1),e[n++]=h(t[5]>>9|t[6]<<2),e[n++]=h(t[6]>>6|t[7]<<5),e[n++]=h(t[7]>>3)}return e}_compressV(e,i){let t=new Uint8Array(8);for(let n=0,s=0;s<256/8;s++){for(let a=0;a<8;a++)t[a]=h(((p(i[8*s+a])<<5)+p(3329/2))/p(3329))&31;e[n++]=h(t[0]>>0|t[1]<<5),e[n++]=h(t[1]>>3|t[2]<<2|t[3]<<7),e[n++]=h(t[3]>>1|t[4]<<4),e[n++]=h(t[4]>>4|t[5]<<1|t[6]<<6),e[n++]=h(t[6]>>2|t[7]<<3)}return e}_decompressU(e){let i=new Array(this._k);for(let n=0;n<this._k;n++)i[n]=new Array(384);let t=new Array(8);for(let n=0,s=0;s<this._k;s++)for(let a=0;a<256/8;a++){t[0]=u(e[n+0])>>0|u(e[n+1])<<8,t[1]=u(e[n+1])>>3|u(e[n+2])<<5,t[2]=u(e[n+2])>>6|u(e[n+3])<<2|u(e[n+4])<<10,t[3]=u(e[n+4])>>1|u(e[n+5])<<7,t[4]=u(e[n+5])>>4|u(e[n+6])<<4,t[5]=u(e[n+6])>>7|u(e[n+7])<<1|u(e[n+8])<<9,t[6]=u(e[n+8])>>2|u(e[n+9])<<6,t[7]=u(e[n+9])>>5|u(e[n+10])<<3,n=n+11;for(let o=0;o<8;o++)i[s][8*a+o]=p(t[o]&2047)*3329+1024>>11}return i}_decompressV(e){let i=new Array(384),t=new Array(8);for(let n=0,s=0;s<256/8;s++){t[0]=e[n+0]>>0,t[1]=e[n+0]>>5|e[n+1]<<3,t[2]=e[n+1]>>2,t[3]=e[n+1]>>7|e[n+2]<<1,t[4]=e[n+2]>>4|e[n+3]<<4,t[5]=e[n+3]>>1,t[6]=e[n+3]>>6|e[n+4]<<2,t[7]=e[n+4]>>3,n=n+5;for(let a=0;a<8;a++)i[8*s+a]=b(p(t[a]&31)*p(3329)+16>>5)}return i}};var x=class extends Error{constructor(e){let i;e instanceof Error?i=e.message:typeof e=="string"?i=e:i="",super(i),this.name=this.constructor.name}},g=class extends x{};var L=class extends x{},S=class extends x{},F=class extends x{},G=class extends x{};var O=class extends x{},I=class extends x{};var St={},be=zt(globalThis,St);function zt(r,e){return new Proxy(r,{get(i,t,n){return t in e?e[t]:r[t]},set(i,t,n){return t in e&&delete e[t],r[t]=n,!0},deleteProperty(i,t){let n=!1;return t in e&&(delete e[t],n=!0),t in r&&(delete r[t],n=!0),n},ownKeys(i){let t=Reflect.ownKeys(r),n=Reflect.ownKeys(e),s=new Set(n);return[...t.filter(a=>!s.has(a)),...n]},defineProperty(i,t,n){return t in e&&delete e[t],Reflect.defineProperty(r,t,n),!0},getOwnPropertyDescriptor(i,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(r,t)},has(i,t){return t in e||t in r}})}var z={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48,MlKem512:64,MlKem768:65,MlKem1024:66,XWing:25722};var V=new Uint8Array(0);var we=new Uint8Array([75,69,77,0,0]);var $=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function X(r,e){let i=new Uint8Array(r.length+e.length);return i.set(r,0),i.set(e,r.length),i}function W(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),i=atob(e),t=new Uint8Array(i.length);for(let n=0;n<i.length;n++)t[n]=i.charCodeAt(n);return t}async function _e(){if(be!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("Web Cryptograph API not supported")}}var Ur=new Uint8Array([101,97,101,95,112,114,107]),Lr=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);var ne=["deriveBits"],ge=new Uint8Array([100,107,112,95,112,114,107]),rt=new Uint8Array([115,107]);var Fr=new Uint8Array([99,97,110,100,105,100,97,116,101]),Gr=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),Vr=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),$r=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),Xr=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),Wr=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),Qr=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]);var E=class{constructor(e,i,t,n=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=i,this.type=t,this.algorithm={name:e},this.usages=n,t==="public"&&(this.usages=[])}};var li=new Uint8Array([72,80,75,69,45,118,49]);var Q=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(i){throw new L(i)}}async deserializePublicKey(e){try{return await this._deserializePublicKey(e)}catch(i){throw new S(i)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(i){throw new L(i)}}async deserializePrivateKey(e){try{return await this._deserializePrivateKey(e)}catch(i){throw new S(i)}}async generateKeyPair(){await this._setup();let e=new Uint8Array(32),i=new Uint8Array(32);try{this._api.getRandomValues(e),this._api.getRandomValues(i)}catch(t){throw new I(t)}try{let t=X(e,i),[n,s]=await this._prim.deriveKeyPair(t),a=await this.deserializePrivateKey(t.buffer),o=await this.deserializePublicKey(n.buffer);return{privateKey:a,publicKey:o}}catch(t){throw new O(t)}}async deriveKeyPair(e){try{let[i,t]=await this._prim.deriveKeyPair(new Uint8Array(e)),n=await this.deserializePrivateKey(e),s=await this.deserializePublicKey(i.buffer);return{privateKey:n,publicKey:s}}catch(i){throw new O(i)}}async importKey(e,i,t=!0){await this._setup();try{let n;if(e==="jwk"){if(i instanceof ArrayBuffer||i instanceof Uint8Array)throw new Error("Invalid jwk key format");n=await this._importJWK(i,t)}else if(i instanceof ArrayBuffer)n=new Uint8Array(i);else if(i instanceof Uint8Array)n=i;else throw new Error("Invalid key format");if(t&&n.byteLength!==this.publicKeySize)throw new Error("Invalid length of the key");if(!t&&n.byteLength!==this.privateKeySize)throw new Error("Invalid length of the key");return new E(this.name,n,t?"public":"private",t?[]:ne)}catch(n){throw new S(n)}}async encap(e){let i;if(e.ekm!==void 0)if(e.ekm instanceof ArrayBuffer)i=new Uint8Array(e.ekm);else if(e.ekm instanceof Uint8Array)i=e.ekm;else throw new g("ekm must be 32 bytes in length");let t=new Uint8Array(await this.serializePublicKey(e.recipientPublicKey));if(t.byteLength!==this.publicKeySize)throw new g("Invalid length of recipientKey");try{let[n,s]=await this._prim.encap(t,i);return{sharedSecret:s.buffer,enc:n.buffer}}catch(n){throw new F(n)}}async decap(e){let i=$(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey;if(e.enc.byteLength!==this.encSize)throw new g("Invalid length of enc");let t=new Uint8Array(e.enc),n=new Uint8Array(await this.serializePrivateKey(i));if(n.byteLength!==this.privateKeySize)throw new g("Invalid length of recipientKey");try{let[s,a]=await this._prim.deriveKeyPair(n);return(await this._prim.decap(t,a)).buffer}catch(s){throw new G(s)}}async _setup(){this._api===void 0&&(this._api=await _e())}_serializePublicKey(e){return new Promise((i,t)=>{e.type!=="public"&&t(new Error("Not public key")),e.algorithm.name!==this.name&&t(new Error(`Invalid algorithm name: ${e.algorithm.name}`)),e.key.byteLength!==this.publicKeySize&&t(new Error(`Invalid key length: ${e.key.byteLength}`)),i(e.key.buffer)})}_deserializePublicKey(e){return new Promise((i,t)=>{e.byteLength!==this.publicKeySize&&t(new Error(`Invalid key length: ${e.byteLength}`)),i(new E(this.name,new Uint8Array(e),"public"))})}_serializePrivateKey(e){return new Promise((i,t)=>{e.type!=="private"&&t(new Error("Not private key")),e.algorithm.name!==this.name&&t(new Error(`Invalid algorithm name: ${e.algorithm.name}`)),e.key.byteLength!==this.privateKeySize&&t(new Error(`Invalid key length: ${e.key.byteLength}`)),i(e.key.buffer)})}_deserializePrivateKey(e){return new Promise((i,t)=>{e.byteLength!==this.privateKeySize&&t(new Error(`Invalid key length: ${e.byteLength}`)),i(new E(this.name,new Uint8Array(e),"private",["deriveBits"]))})}_importJWK(e,i){return new Promise((t,n)=>{(typeof e.kty>"u"||e.kty!=="AKP")&&n(new Error(`Invalid kty: ${e.kty}`)),(typeof e.alg>"u"||e.alg!==this.name)&&n(new Error(`Invalid alg: ${e.alg}`)),i||(typeof e.priv>"u"&&n(new Error("Invalid key: `priv` not found")),typeof e.key_ops<"u"&&(e.key_ops.length!==1||e.key_ops[0]!=="deriveBits")&&n(new Error("Invalid key: `key_ops` should be ['deriveBits']")),t(W(e.priv))),typeof e.priv<"u"&&n(new Error("Invalid key: `priv` should not be set")),typeof e.pub>"u"&&n(new Error("Invalid key: `pub` not found")),typeof e.key_ops<"u"&&e.key_ops.length>0&&n(new Error("Invalid key: `key_ops` should not be set")),t(W(e.pub))})}},xe=class extends Q{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:z.MlKem512}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-512"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:768}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:800}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new C}},ke=class extends Q{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:z.MlKem768}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-768"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:1088}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:1184}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new N}},ve=class extends Q{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:z.MlKem1024}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ML-KEM-1024"}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:1568}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:1568}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=new R}};export{ve as MlKem1024,xe as MlKem512,ke as MlKem768};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
