var Fs=Object.create;var $n=Object.defineProperty;var Zs=Object.getOwnPropertyDescriptor;var $s=Object.getOwnPropertyNames;var Vs=Object.getPrototypeOf,Xs=Object.prototype.hasOwnProperty;var _e=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ys=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $s(e))!Xs.call(r,i)&&i!==t&&$n(r,i,{get:()=>e[i],enumerable:!(n=Zs(e,i))||n.enumerable});return r};var Lt=(r,e,t)=>(t=r!=null?Fs(Vs(r)):{},Ys(e||!r||!r.__esModule?$n(t,"default",{value:r,enumerable:!0}):t,r));var pi=_e(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});function eo(r,e){var t=r>>>16&65535,n=r&65535,i=e>>>16&65535,s=e&65535;return n*s+(t*s+n*i<<16>>>0)|0}ye.mul=Math.imul||eo;function to(r,e){return r+e|0}ye.add=to;function ro(r,e){return r-e|0}ye.sub=ro;function no(r,e){return r<<e|r>>>32-e}ye.rotl=no;function io(r,e){return r<<32-e|r>>>e}ye.rotr=io;function so(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r}ye.isInteger=Number.isInteger||so;ye.MAX_SAFE_INTEGER=9007199254740991;ye.isSafeInteger=function(r){return ye.isInteger(r)&&r>=-ye.MAX_SAFE_INTEGER&&r<=ye.MAX_SAFE_INTEGER}});var Ot=_e(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});var yi=pi();function oo(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}F.readInt16BE=oo;function ao(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}F.readUint16BE=ao;function fo(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}F.readInt16LE=fo;function co(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}F.readUint16LE=co;function xi(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}F.writeUint16BE=xi;F.writeInt16BE=xi;function _i(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}F.writeUint16LE=_i;F.writeInt16LE=_i;function tn(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}F.readInt32BE=tn;function rn(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}F.readUint32BE=rn;function nn(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}F.readInt32LE=nn;function sn(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}F.readUint32LE=sn;function cr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}F.writeUint32BE=cr;F.writeInt32BE=cr;function hr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}F.writeUint32LE=hr;F.writeInt32LE=hr;function ho(r,e){e===void 0&&(e=0);var t=tn(r,e),n=tn(r,e+4);return t*4294967296+n-(n>>31)*4294967296}F.readInt64BE=ho;function uo(r,e){e===void 0&&(e=0);var t=rn(r,e),n=rn(r,e+4);return t*4294967296+n}F.readUint64BE=uo;function lo(r,e){e===void 0&&(e=0);var t=nn(r,e),n=nn(r,e+4);return n*4294967296+t-(t>>31)*4294967296}F.readInt64LE=lo;function bo(r,e){e===void 0&&(e=0);var t=sn(r,e),n=sn(r,e+4);return n*4294967296+t}F.readUint64LE=bo;function gi(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),cr(r/4294967296>>>0,e,t),cr(r>>>0,e,t+4),e}F.writeUint64BE=gi;F.writeInt64BE=gi;function mi(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),hr(r>>>0,e,t),hr(r/4294967296>>>0,e,t+4),e}F.writeUint64LE=mi;F.writeInt64LE=mi;function wo(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=r/8+t-1;s>=t;s--)n+=e[s]*i,i*=256;return n}F.readUintBE=wo;function po(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=t;s<t+r/8;s++)n+=e[s]*i,i*=256;return n}F.readUintLE=po;function yo(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!yi.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,s=r/8+n-1;s>=n;s--)t[s]=e/i&255,i*=256;return t}F.writeUintBE=yo;function xo(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!yi.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+r/8;s++)t[s]=e/i&255,i*=256;return t}F.writeUintLE=xo;function _o(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}F.readFloat32BE=_o;function go(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}F.readFloat32LE=go;function mo(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}F.readFloat64BE=mo;function vo(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}F.readFloat64LE=vo;function Eo(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}F.writeFloat32BE=Eo;function So(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}F.writeFloat32LE=So;function Ao(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}F.writeFloat64BE=Ao;function ko(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}F.writeFloat64LE=ko});var rt=_e(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});function Bo(r){for(var e=0;e<r.length;e++)r[e]=0;return r}on.wipe=Bo});var Ei=_e(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});var fe=Ot(),an=rt(),Po=20;function Io(r,e,t){for(var n=1634760805,i=857760878,s=2036477234,a=1797285236,o=t[3]<<24|t[2]<<16|t[1]<<8|t[0],f=t[7]<<24|t[6]<<16|t[5]<<8|t[4],c=t[11]<<24|t[10]<<16|t[9]<<8|t[8],h=t[15]<<24|t[14]<<16|t[13]<<8|t[12],l=t[19]<<24|t[18]<<16|t[17]<<8|t[16],b=t[23]<<24|t[22]<<16|t[21]<<8|t[20],w=t[27]<<24|t[26]<<16|t[25]<<8|t[24],v=t[31]<<24|t[30]<<16|t[29]<<8|t[28],y=e[3]<<24|e[2]<<16|e[1]<<8|e[0],B=e[7]<<24|e[6]<<16|e[5]<<8|e[4],S=e[11]<<24|e[10]<<16|e[9]<<8|e[8],I=e[15]<<24|e[14]<<16|e[13]<<8|e[12],x=n,L=i,z=s,j=a,p=o,d=f,H=c,N=h,A=l,E=b,g=w,P=v,D=y,m=B,u=S,_=I,K=0;K<Po;K+=2)x=x+p|0,D^=x,D=D>>>32-16|D<<16,A=A+D|0,p^=A,p=p>>>32-12|p<<12,L=L+d|0,m^=L,m=m>>>32-16|m<<16,E=E+m|0,d^=E,d=d>>>32-12|d<<12,z=z+H|0,u^=z,u=u>>>32-16|u<<16,g=g+u|0,H^=g,H=H>>>32-12|H<<12,j=j+N|0,_^=j,_=_>>>32-16|_<<16,P=P+_|0,N^=P,N=N>>>32-12|N<<12,z=z+H|0,u^=z,u=u>>>32-8|u<<8,g=g+u|0,H^=g,H=H>>>32-7|H<<7,j=j+N|0,_^=j,_=_>>>32-8|_<<8,P=P+_|0,N^=P,N=N>>>32-7|N<<7,L=L+d|0,m^=L,m=m>>>32-8|m<<8,E=E+m|0,d^=E,d=d>>>32-7|d<<7,x=x+p|0,D^=x,D=D>>>32-8|D<<8,A=A+D|0,p^=A,p=p>>>32-7|p<<7,x=x+d|0,_^=x,_=_>>>32-16|_<<16,g=g+_|0,d^=g,d=d>>>32-12|d<<12,L=L+H|0,D^=L,D=D>>>32-16|D<<16,P=P+D|0,H^=P,H=H>>>32-12|H<<12,z=z+N|0,m^=z,m=m>>>32-16|m<<16,A=A+m|0,N^=A,N=N>>>32-12|N<<12,j=j+p|0,u^=j,u=u>>>32-16|u<<16,E=E+u|0,p^=E,p=p>>>32-12|p<<12,z=z+N|0,m^=z,m=m>>>32-8|m<<8,A=A+m|0,N^=A,N=N>>>32-7|N<<7,j=j+p|0,u^=j,u=u>>>32-8|u<<8,E=E+u|0,p^=E,p=p>>>32-7|p<<7,L=L+H|0,D^=L,D=D>>>32-8|D<<8,P=P+D|0,H^=P,H=H>>>32-7|H<<7,x=x+d|0,_^=x,_=_>>>32-8|_<<8,g=g+_|0,d^=g,d=d>>>32-7|d<<7;fe.writeUint32LE(x+n|0,r,0),fe.writeUint32LE(L+i|0,r,4),fe.writeUint32LE(z+s|0,r,8),fe.writeUint32LE(j+a|0,r,12),fe.writeUint32LE(p+o|0,r,16),fe.writeUint32LE(d+f|0,r,20),fe.writeUint32LE(H+c|0,r,24),fe.writeUint32LE(N+h|0,r,28),fe.writeUint32LE(A+l|0,r,32),fe.writeUint32LE(E+b|0,r,36),fe.writeUint32LE(g+w|0,r,40),fe.writeUint32LE(P+v|0,r,44),fe.writeUint32LE(D+y|0,r,48),fe.writeUint32LE(m+B|0,r,52),fe.writeUint32LE(u+S|0,r,56),fe.writeUint32LE(_+I|0,r,60)}function vi(r,e,t,n,i){if(i===void 0&&(i=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var s,a;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),a=s.length-e.length,s.set(e,a)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,a=i}for(var o=new Uint8Array(64),f=0;f<t.length;f+=64){Io(o,s,r);for(var c=f;c<f+64&&c<t.length;c++)n[c]=t[c]^o[c-f];Uo(s,0,a)}return an.wipe(o),i===0&&an.wipe(s),n}ur.streamXOR=vi;function Lo(r,e,t,n){return n===void 0&&(n=0),an.wipe(t),vi(r,e,t,t,n)}ur.stream=Lo;function Uo(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}});var lr=_e(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});function Ho(r,e,t){return~(r-1)&e|r-1&t}wt.select=Ho;function Oo(r,e){return(r|0)-(e|0)-1>>>31&1}wt.lessOrEqual=Oo;function Si(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}wt.compare=Si;function Ko(r,e){return r.length===0||e.length===0?!1:Si(r,e)!==0}wt.equal=Ko});var ki=_e(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});var To=lr(),dr=rt();He.DIGEST_LENGTH=16;var Ai=function(){function r(e){this.digestLength=He.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var t=e[0]|e[1]<<8;this._r[0]=t&8191;var n=e[2]|e[3]<<8;this._r[1]=(t>>>13|n<<3)&8191;var i=e[4]|e[5]<<8;this._r[2]=(n>>>10|i<<6)&7939;var s=e[6]|e[7]<<8;this._r[3]=(i>>>7|s<<9)&8191;var a=e[8]|e[9]<<8;this._r[4]=(s>>>4|a<<12)&255,this._r[5]=a>>>1&8190;var o=e[10]|e[11]<<8;this._r[6]=(a>>>14|o<<2)&8191;var f=e[12]|e[13]<<8;this._r[7]=(o>>>11|f<<5)&8065;var c=e[14]|e[15]<<8;this._r[8]=(f>>>8|c<<8)&8191,this._r[9]=c>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return r.prototype._blocks=function(e,t,n){for(var i=this._fin?0:2048,s=this._h[0],a=this._h[1],o=this._h[2],f=this._h[3],c=this._h[4],h=this._h[5],l=this._h[6],b=this._h[7],w=this._h[8],v=this._h[9],y=this._r[0],B=this._r[1],S=this._r[2],I=this._r[3],x=this._r[4],L=this._r[5],z=this._r[6],j=this._r[7],p=this._r[8],d=this._r[9];n>=16;){var H=e[t+0]|e[t+1]<<8;s+=H&8191;var N=e[t+2]|e[t+3]<<8;a+=(H>>>13|N<<3)&8191;var A=e[t+4]|e[t+5]<<8;o+=(N>>>10|A<<6)&8191;var E=e[t+6]|e[t+7]<<8;f+=(A>>>7|E<<9)&8191;var g=e[t+8]|e[t+9]<<8;c+=(E>>>4|g<<12)&8191,h+=g>>>1&8191;var P=e[t+10]|e[t+11]<<8;l+=(g>>>14|P<<2)&8191;var D=e[t+12]|e[t+13]<<8;b+=(P>>>11|D<<5)&8191;var m=e[t+14]|e[t+15]<<8;w+=(D>>>8|m<<8)&8191,v+=m>>>5|i;var u=0,_=u;_+=s*y,_+=a*(5*d),_+=o*(5*p),_+=f*(5*j),_+=c*(5*z),u=_>>>13,_&=8191,_+=h*(5*L),_+=l*(5*x),_+=b*(5*I),_+=w*(5*S),_+=v*(5*B),u+=_>>>13,_&=8191;var K=u;K+=s*B,K+=a*y,K+=o*(5*d),K+=f*(5*p),K+=c*(5*j),u=K>>>13,K&=8191,K+=h*(5*z),K+=l*(5*L),K+=b*(5*x),K+=w*(5*I),K+=v*(5*S),u+=K>>>13,K&=8191;var O=u;O+=s*S,O+=a*B,O+=o*y,O+=f*(5*d),O+=c*(5*p),u=O>>>13,O&=8191,O+=h*(5*j),O+=l*(5*z),O+=b*(5*L),O+=w*(5*x),O+=v*(5*I),u+=O>>>13,O&=8191;var C=u;C+=s*I,C+=a*S,C+=o*B,C+=f*y,C+=c*(5*d),u=C>>>13,C&=8191,C+=h*(5*p),C+=l*(5*j),C+=b*(5*z),C+=w*(5*L),C+=v*(5*x),u+=C>>>13,C&=8191;var q=u;q+=s*x,q+=a*I,q+=o*S,q+=f*B,q+=c*y,u=q>>>13,q&=8191,q+=h*(5*d),q+=l*(5*p),q+=b*(5*j),q+=w*(5*z),q+=v*(5*L),u+=q>>>13,q&=8191;var M=u;M+=s*L,M+=a*x,M+=o*I,M+=f*S,M+=c*B,u=M>>>13,M&=8191,M+=h*y,M+=l*(5*d),M+=b*(5*p),M+=w*(5*j),M+=v*(5*z),u+=M>>>13,M&=8191;var G=u;G+=s*z,G+=a*L,G+=o*x,G+=f*I,G+=c*S,u=G>>>13,G&=8191,G+=h*B,G+=l*y,G+=b*(5*d),G+=w*(5*p),G+=v*(5*j),u+=G>>>13,G&=8191;var $=u;$+=s*j,$+=a*z,$+=o*L,$+=f*x,$+=c*I,u=$>>>13,$&=8191,$+=h*S,$+=l*B,$+=b*y,$+=w*(5*d),$+=v*(5*p),u+=$>>>13,$&=8191;var J=u;J+=s*p,J+=a*j,J+=o*z,J+=f*L,J+=c*x,u=J>>>13,J&=8191,J+=h*I,J+=l*S,J+=b*B,J+=w*y,J+=v*(5*d),u+=J>>>13,J&=8191;var W=u;W+=s*d,W+=a*p,W+=o*j,W+=f*z,W+=c*L,u=W>>>13,W&=8191,W+=h*x,W+=l*I,W+=b*S,W+=w*B,W+=v*y,u+=W>>>13,W&=8191,u=(u<<2)+u|0,u=u+_|0,_=u&8191,u=u>>>13,K+=u,s=_,a=K,o=O,f=C,c=q,h=M,l=G,b=$,w=J,v=W,t+=16,n-=16}this._h[0]=s,this._h[1]=a,this._h[2]=o,this._h[3]=f,this._h[4]=c,this._h[5]=h,this._h[6]=l,this._h[7]=b,this._h[8]=w,this._h[9]=v},r.prototype.finish=function(e,t){t===void 0&&(t=0);var n=new Uint16Array(10),i,s,a,o;if(this._leftover){for(o=this._leftover,this._buffer[o++]=1;o<16;o++)this._buffer[o]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(i=this._h[1]>>>13,this._h[1]&=8191,o=2;o<10;o++)this._h[o]+=i,i=this._h[o]>>>13,this._h[o]&=8191;for(this._h[0]+=i*5,i=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=i,i=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=i,n[0]=this._h[0]+5,i=n[0]>>>13,n[0]&=8191,o=1;o<10;o++)n[o]=this._h[o]+i,i=n[o]>>>13,n[o]&=8191;for(n[9]-=1<<13,s=(i^1)-1,o=0;o<10;o++)n[o]&=s;for(s=~s,o=0;o<10;o++)this._h[o]=this._h[o]&s|n[o];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,a=this._h[0]+this._pad[0],this._h[0]=a&65535,o=1;o<8;o++)a=(this._h[o]+this._pad[o]|0)+(a>>>16)|0,this._h[o]=a&65535;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},r.prototype.update=function(e){var t=0,n=e.length,i;if(this._leftover){i=16-this._leftover,i>n&&(i=n);for(var s=0;s<i;s++)this._buffer[this._leftover+s]=e[t+s];if(n-=i,t+=i,this._leftover+=i,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(i=n-n%16,this._blocks(e,t,i),t+=i,n-=i),n){for(var s=0;s<n;s++)this._buffer[this._leftover+s]=e[t+s];this._leftover+=n}return this},r.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},r.prototype.clean=function(){return dr.wipe(this._buffer),dr.wipe(this._r),dr.wipe(this._h),dr.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},r}();He.Poly1305=Ai;function zo(r,e){var t=new Ai(r);t.update(e);var n=t.digest();return t.clean(),n}He.oneTimeAuth=zo;function No(r,e){return r.length!==He.DIGEST_LENGTH||e.length!==He.DIGEST_LENGTH?!1:To.equal(r,e)}He.equal=No});var Ii=_e(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});var br=Ei(),Co=ki(),Kt=rt(),Bi=Ot(),Do=lr();Oe.KEY_LENGTH=32;Oe.NONCE_LENGTH=12;Oe.TAG_LENGTH=16;var Pi=new Uint8Array(16),Ro=function(){function r(e){if(this.nonceLength=Oe.NONCE_LENGTH,this.tagLength=Oe.TAG_LENGTH,e.length!==Oe.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return r.prototype.seal=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var s=new Uint8Array(16);s.set(e,s.length-e.length);var a=new Uint8Array(32);br.stream(this._key,s,a,4);var o=t.length+this.tagLength,f;if(i){if(i.length!==o)throw new Error("ChaCha20Poly1305: incorrect destination length");f=i}else f=new Uint8Array(o);return br.streamXOR(this._key,s,t,f,4),this._authenticate(f.subarray(f.length-this.tagLength,f.length),a,f.subarray(0,f.length-this.tagLength),n),Kt.wipe(s),f},r.prototype.open=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var s=new Uint8Array(16);s.set(e,s.length-e.length);var a=new Uint8Array(32);br.stream(this._key,s,a,4);var o=new Uint8Array(this.tagLength);if(this._authenticate(o,a,t.subarray(0,t.length-this.tagLength),n),!Do.equal(o,t.subarray(t.length-this.tagLength,t.length)))return null;var f=t.length-this.tagLength,c;if(i){if(i.length!==f)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(f);return br.streamXOR(this._key,s,t.subarray(0,t.length-this.tagLength),c,4),Kt.wipe(s),c},r.prototype.clean=function(){return Kt.wipe(this._key),this},r.prototype._authenticate=function(e,t,n,i){var s=new Co.Poly1305(t);i&&(s.update(i),i.length%16>0&&s.update(Pi.subarray(i.length%16))),s.update(n),n.length%16>0&&s.update(Pi.subarray(n.length%16));var a=new Uint8Array(8);i&&Bi.writeUint64LE(i.length,a),s.update(a),Bi.writeUint64LE(n.length,a),s.update(a);for(var o=s.digest(),f=0;f<o.length;f++)e[f]=o[f];s.clean(),Kt.wipe(o),Kt.wipe(a)},r}();Oe.ChaCha20Poly1305=Ro});var Ui=_e(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});function jo(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}fn.isSerializableHash=jo});var Oi=_e(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});var Ie=Ui(),qo=lr(),Mo=rt(),Hi=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(var i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),Ie.isSerializableHash(this._inner)&&Ie.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Mo.wipe(n)}return r.prototype.reset=function(){if(!Ie.isSerializableHash(this._inner)||!Ie.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){Ie.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Ie.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!Ie.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!Ie.isSerializableHash(this._inner)||!Ie.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!Ie.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();Tt.HMAC=Hi;function Go(r,e,t){var n=new Hi(r,e);n.update(t);var i=n.digest();return n.clean(),i}Tt.hmac=Go;Tt.equal=qo.equal});var Ti=_e(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});var xr=Ot(),yr=rt();qe.DIGEST_LENGTH=32;qe.BLOCK_SIZE=64;var Ki=function(){function r(){this.digestLength=qe.DIGEST_LENGTH,this.blockSize=qe.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return r.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},r.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},r.prototype.clean=function(){yr.wipe(this._buffer),yr.wipe(this._temp),this.reset()},r.prototype.update=function(e,t){if(t===void 0&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(cn(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(n=cn(this._temp,this._state,e,n,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[n++],t--;return this},r.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,i=t/536870912|0,s=t<<3,a=t%64<56?64:128;this._buffer[n]=128;for(var o=n+1;o<a-8;o++)this._buffer[o]=0;xr.writeUint32BE(i,this._buffer,a-8),xr.writeUint32BE(s,this._buffer,a-4),cn(this._temp,this._state,this._buffer,0,a),this._finished=!0}for(var o=0;o<this.digestLength/4;o++)xr.writeUint32BE(this._state[o],e,o*4);return this},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},r.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},r.prototype.cleanSavedState=function(e){yr.wipe(e.state),e.buffer&&yr.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},r}();qe.SHA256=Ki;var Fo=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function cn(r,e,t,n,i){for(;i>=64;){for(var s=e[0],a=e[1],o=e[2],f=e[3],c=e[4],h=e[5],l=e[6],b=e[7],w=0;w<16;w++){var v=n+w*4;r[w]=xr.readUint32BE(t,v)}for(var w=16;w<64;w++){var y=r[w-2],B=(y>>>17|y<<32-17)^(y>>>19|y<<32-19)^y>>>10;y=r[w-15];var S=(y>>>7|y<<32-7)^(y>>>18|y<<32-18)^y>>>3;r[w]=(B+r[w-7]|0)+(S+r[w-16]|0)}for(var w=0;w<64;w++){var B=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&h^~c&l)|0)+(b+(Fo[w]+r[w]|0)|0)|0,S=((s>>>2|s<<32-2)^(s>>>13|s<<32-13)^(s>>>22|s<<32-22))+(s&a^s&o^a&o)|0;b=l,l=h,h=c,c=f+B|0,f=o,o=a,a=s,s=B+S|0}e[0]+=s,e[1]+=a,e[2]+=o,e[3]+=f,e[4]+=c,e[5]+=h,e[6]+=l,e[7]+=b,n+=64,i-=64}return n}function Zo(r){var e=new Ki;e.update(r);var t=e.digest();return e.clean(),t}qe.hash=Zo});var Ci=_e(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});var xt=Ot(),yt=rt();Ke.DIGEST_LENGTH=64;Ke.BLOCK_SIZE=128;var Ni=function(){function r(){this.digestLength=Ke.DIGEST_LENGTH,this.blockSize=Ke.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return r.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},r.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},r.prototype.clean=function(){yt.wipe(this._buffer),yt.wipe(this._tempHi),yt.wipe(this._tempLo),this.reset()},r.prototype.update=function(e,t){if(t===void 0&&(t=e.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<Ke.BLOCK_SIZE&&t>0;)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(hn(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(n=hn(this._tempHi,this._tempLo,this._stateHi,this._stateLo,e,n,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[n++],t--;return this},r.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,i=t/536870912|0,s=t<<3,a=t%128<112?128:256;this._buffer[n]=128;for(var o=n+1;o<a-8;o++)this._buffer[o]=0;xt.writeUint32BE(i,this._buffer,a-8),xt.writeUint32BE(s,this._buffer,a-4),hn(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,a),this._finished=!0}for(var o=0;o<this.digestLength/8;o++)xt.writeUint32BE(this._stateHi[o],e,o*8),xt.writeUint32BE(this._stateLo[o],e,o*8+4);return this},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},r.prototype.restoreState=function(e){return this._stateHi.set(e.stateHi),this._stateLo.set(e.stateLo),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},r.prototype.cleanSavedState=function(e){yt.wipe(e.stateHi),yt.wipe(e.stateLo),e.buffer&&yt.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},r}();Ke.SHA512=Ni;var zi=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function hn(r,e,t,n,i,s,a){for(var o=t[0],f=t[1],c=t[2],h=t[3],l=t[4],b=t[5],w=t[6],v=t[7],y=n[0],B=n[1],S=n[2],I=n[3],x=n[4],L=n[5],z=n[6],j=n[7],p,d,H,N,A,E,g,P;a>=128;){for(var D=0;D<16;D++){var m=8*D+s;r[D]=xt.readUint32BE(i,m),e[D]=xt.readUint32BE(i,m+4)}for(var D=0;D<80;D++){var u=o,_=f,K=c,O=h,C=l,q=b,M=w,G=v,$=y,J=B,W=S,le=I,Ue=x,We=L,ht=z,Qe=j;if(p=v,d=j,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=(l>>>14|x<<32-14)^(l>>>18|x<<32-18)^(x>>>41-32|l<<32-(41-32)),d=(x>>>14|l<<32-14)^(x>>>18|l<<32-18)^(l>>>41-32|x<<32-(41-32)),A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,p=l&b^~l&w,d=x&L^~x&z,A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,p=zi[D*2],d=zi[D*2+1],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,p=r[D%16],d=e[D%16],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,H=g&65535|P<<16,N=A&65535|E<<16,p=H,d=N,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=(o>>>28|y<<32-28)^(y>>>34-32|o<<32-(34-32))^(y>>>39-32|o<<32-(39-32)),d=(y>>>28|o<<32-28)^(o>>>34-32|y<<32-(34-32))^(o>>>39-32|y<<32-(39-32)),A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,p=o&f^o&c^f&c,d=y&B^y&S^B&S,A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,G=g&65535|P<<16,Qe=A&65535|E<<16,p=O,d=le,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=H,d=N,A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,O=g&65535|P<<16,le=A&65535|E<<16,f=u,c=_,h=K,l=O,b=C,w=q,v=M,o=G,B=$,S=J,I=W,x=le,L=Ue,z=We,j=ht,y=Qe,D%16===15)for(var m=0;m<16;m++)p=r[m],d=e[m],A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=r[(m+9)%16],d=e[(m+9)%16],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,H=r[(m+1)%16],N=e[(m+1)%16],p=(H>>>1|N<<32-1)^(H>>>8|N<<32-8)^H>>>7,d=(N>>>1|H<<32-1)^(N>>>8|H<<32-8)^(N>>>7|H<<32-7),A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,H=r[(m+14)%16],N=e[(m+14)%16],p=(H>>>19|N<<32-19)^(N>>>61-32|H<<32-(61-32))^H>>>6,d=(N>>>19|H<<32-19)^(H>>>61-32|N<<32-(61-32))^(N>>>6|H<<32-6),A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,r[m]=g&65535|P<<16,e[m]=A&65535|E<<16}p=o,d=y,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[0],d=n[0],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[0]=o=g&65535|P<<16,n[0]=y=A&65535|E<<16,p=f,d=B,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[1],d=n[1],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[1]=f=g&65535|P<<16,n[1]=B=A&65535|E<<16,p=c,d=S,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[2],d=n[2],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[2]=c=g&65535|P<<16,n[2]=S=A&65535|E<<16,p=h,d=I,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[3],d=n[3],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[3]=h=g&65535|P<<16,n[3]=I=A&65535|E<<16,p=l,d=x,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[4],d=n[4],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[4]=l=g&65535|P<<16,n[4]=x=A&65535|E<<16,p=b,d=L,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[5],d=n[5],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[5]=b=g&65535|P<<16,n[5]=L=A&65535|E<<16,p=w,d=z,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[6],d=n[6],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[6]=w=g&65535|P<<16,n[6]=z=A&65535|E<<16,p=v,d=j,A=d&65535,E=d>>>16,g=p&65535,P=p>>>16,p=t[7],d=n[7],A+=d&65535,E+=d>>>16,g+=p&65535,P+=p>>>16,E+=A>>>16,g+=E>>>16,P+=g>>>16,t[7]=v=g&65535|P<<16,n[7]=j=A&65535|E<<16,s+=128,a-=128}return s}function $o(r){var e=new Ni;e.update(r);var t=e.digest();return e.clean(),t}Ke.hash=$o});var ji=_e(()=>{});var de=class extends Error{constructor(e){let t;e instanceof Error?t=e.message:typeof e=="string"?t=e:t="",super(t),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message===""?this.message=this.name:this.message=this.name+": "+this.message}},we=class extends de{},Vn=class extends de{},Qt=class extends de{},ut=class extends de{},Jt=class extends de{},er=class extends de{},tr=class extends de{},Je=class extends de{},et=class extends de{},rr=class extends de{},nr=class extends de{},Se=class extends de{};var Ae;(function(r){r[r.Base=0]="Base",r[r.Psk=1]="Psk",r[r.Auth=2]="Auth",r[r.AuthPsk=3]="AuthPsk"})(Ae||(Ae={}));var V;(function(r){r[r.DhkemP256HkdfSha256=16]="DhkemP256HkdfSha256",r[r.DhkemP384HkdfSha384=17]="DhkemP384HkdfSha384",r[r.DhkemP521HkdfSha512=18]="DhkemP521HkdfSha512",r[r.DhkemSecp256K1HkdfSha256=19]="DhkemSecp256K1HkdfSha256",r[r.DhkemX25519HkdfSha256=32]="DhkemX25519HkdfSha256",r[r.DhkemX448HkdfSha512=33]="DhkemX448HkdfSha512"})(V||(V={}));var pe;(function(r){r[r.HkdfSha256=1]="HkdfSha256",r[r.HkdfSha384=2]="HkdfSha384",r[r.HkdfSha512=3]="HkdfSha512"})(pe||(pe={}));var ne;(function(r){r[r.Aes128Gcm=1]="Aes128Gcm",r[r.Aes256Gcm=2]="Aes256Gcm",r[r.Chacha20Poly1305=3]="Chacha20Poly1305",r[r.ExportOnly=65535]="ExportOnly"})(ne||(ne={}));var Ws={},Xn=Qs(globalThis,Ws);function Qs(r,e){return new Proxy(r,{get(t,n,i){return n in e?e[n]:r[n]},set(t,n,i){return n in e&&delete e[n],r[n]=i,!0},deleteProperty(t,n){let i=!1;return n in e&&(delete e[n],i=!0),n in r&&(delete r[n],i=!0),i},ownKeys(t){let n=Reflect.ownKeys(r),i=Reflect.ownKeys(e),s=new Set(i);return[...n.filter(a=>!s.has(a)),...i]},defineProperty(t,n,i){return n in e&&delete e[n],Reflect.defineProperty(r,n,i),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(r,n)},has(t,n){return n in e||n in r}})}var Yn=()=>typeof Xn<"u",Wn=()=>typeof caches<"u";var Ut=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function ue(r,e){if(e<=0)throw new Error("i2Osp: too small size");if(r>=256**e)throw new Error("i2Osp: too large integer");let t=new Uint8Array(e);for(let n=0;n<e&&r;n++)t[e-(n+1)]=r%256,r=r>>8;return t}function Qn(r,e){if(r.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let t=new Uint8Array(r.byteLength);for(let n=0;n<r.byteLength;n++)t[n]=r[n]^e[n];return t}function Ht(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r,0),t.set(e,r.length),t}function Jn(r,e,t){let n=new Uint8Array(r.length+e.length+t.length);return n.set(r,0),n.set(e,r.length),n.set(t,r.length+e.length),n}var De=class{constructor(e){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e}};async function ei(){if((Yn()||Wn())&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:r}=await import("crypto");return r.subtle}catch{throw new Se("Web Cryptograph API not supported")}}var Re=["deriveBits"],ti=["encrypt","decrypt"];var Y=new Uint8Array(0),en=new Uint8Array([72,80,75,69,45,118,49]),ri=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),tt=new Uint8Array([75,69,77,0,0]),je=new Uint8Array([100,107,112,95,112,114,107]),ni=new Uint8Array([101,97,101,95,112,114,107]),ii=new Uint8Array([105,110,102,111,95,104,97,115,104]),si=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),oi=new Uint8Array([115,101,99,114,101,116]),ai=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]),fi=new Uint8Array([107,101,121]),ci=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),hi=new Uint8Array([101,120,112]),ui=new Uint8Array([115,101,99]),li=new Uint8Array([99,97,110,100,105,100,97,116,101]),lt=new Uint8Array([115,107]),di=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),bi=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),wi=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]);var dt=class extends De{constructor(e,t,n){super(e),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._kdf=t,this.exporterSecret=n}async seal(e,t){return await this._emitError1()}async open(e,t){return await this._emitError1()}async setupBidirectional(e,t){return await this._emitError2()}async export(e,t){if(e.byteLength>128)throw new we("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,ui,new Uint8Array(e),t)}catch(n){throw new tr(n)}}_emitError1(){return new Promise((e,t)=>{t(new Se("Not available on export-only mode"))})}_emitError2(){return new Promise((e,t)=>{t(new Se("Not available on export-only mode"))})}},ir=class extends dt{},sr=class extends dt{constructor(e,t,n,i){super(e,t,n),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=i}};var or=class{constructor(e,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e,this._api=t}async seal(e,t,n){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let i={name:"AES-GCM",iv:e,additionalData:n};return await this._api.encrypt(i,this._key,t)}async open(e,t,n){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let i={name:"AES-GCM",iv:e,additionalData:n};return await this._api.decrypt(i,this._key,t)}async importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,ti)}},ar=class extends or{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}},fr=class extends or{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}};var Li=Lt(Ii(),1);var wr=class{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Li.ChaCha20Poly1305(new Uint8Array(e))}async seal(e,t,n){return await this._seal(e,t,n)}async open(e,t,n){return await this._open(e,t,n)}_seal(e,t,n){return new Promise(i=>{let s=this._key.seal(new Uint8Array(e),new Uint8Array(t),new Uint8Array(n));i(s.buffer)})}_open(e,t,n){return new Promise((i,s)=>{let a=this._key.open(new Uint8Array(e),new Uint8Array(t),new Uint8Array(n));a instanceof Uint8Array?i(a.buffer):s(new Error("failed to open."))})}};var pt=class extends dt{constructor(e,t,n){if(super(e,t,n.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_f",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_r",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.key===void 0||n.baseNonce===void 0||n.seq===void 0)throw new Error("Required parameters are missing");switch(this._aead=n.aead,this._aead){case ne.Aes128Gcm:this._nK=16,this._nN=12,this._nT=16;break;case ne.Aes256Gcm:this._nK=32,this._nN=12,this._nT=16;break;case ne.Chacha20Poly1305:this._nK=32,this._nN=12,this._nT=16;break;default:this._nK=0,this._nN=0,this._nT=0;break}let i=pr(this._aead,n.key,this._api);this._f={key:i,baseNonce:n.baseNonce,seq:n.seq},this._r={key:i,baseNonce:Y,seq:0}}computeNonce(e){let t=ue(e.seq,e.baseNonce.byteLength);return Qn(e.baseNonce,t)}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new rr("Message limit reached");e.seq+=1}async setupBidirectional(e,t){try{this._r.baseNonce=new Uint8Array(await this.export(t,this._nN));let n=await this.export(e,this._nK);this._r.key=pr(this._aead,n,this._api),this._r.seq=0}catch(n){throw this._r.baseNonce=Y,n}}};function pr(r,e,t){switch(r){case ne.Aes128Gcm:return new ar(e,t);case ne.Aes256Gcm:return new fr(e,t);case ne.Chacha20Poly1305:return new wr(e);default:throw new Error("Invalid or unsupported AEAD id")}}var un=Lt(Oi(),1),Di=Lt(Ti(),1),Ri=Lt(Ci(),1);var zt=class extends De{constructor(e,t){super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}}),this.suiteId=t}buildLabeledIkm(e,t){let n=new Uint8Array(7+this.suiteId.byteLength+e.byteLength+t.byteLength);return n.set(en,0),n.set(this.suiteId,7),n.set(e,7+this.suiteId.byteLength),n.set(t,7+this.suiteId.byteLength+e.byteLength),n}buildLabeledInfo(e,t,n){let i=new Uint8Array(9+this.suiteId.byteLength+e.byteLength+t.byteLength);return i.set(new Uint8Array([0,n]),0),i.set(en,2),i.set(this.suiteId,9),i.set(e,9+this.suiteId.byteLength),i.set(t,9+this.suiteId.byteLength+e.byteLength),i}async extract(e,t){if(e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)switch(this.algHash.hash){case"SHA-256":return(0,un.hmac)(Di.SHA256,new Uint8Array(e),new Uint8Array(t));case"SHA-512":return(0,un.hmac)(Ri.SHA512,new Uint8Array(e),new Uint8Array(t));default:throw new Se(`${this.algHash.hash} key length should be ${this.hashSize}.`)}let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,t)}async expand(e,t,n){let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),s=new ArrayBuffer(n),a=new Uint8Array(s),o=Y,f=new Uint8Array(t),c=new Uint8Array(1);if(n>255*this.hashSize)throw new Error("Entropy limit reached");let h=new Uint8Array(this.hashSize+f.length+1);for(let l=1,b=0;b<a.length;l++)c[0]=l,h.set(o,0),h.set(f,o.length),h.set(c,o.length+f.length),o=new Uint8Array(await this._api.sign("HMAC",i,h.slice(0,o.length+f.length+1))),a.length-b>=o.length?(a.set(o,b),b+=o.length):(a.set(o.slice(0,a.length-b),b),b+=a.length-b);return s}async extractAndExpand(e,t,n,i){let s=await this._api.importKey("raw",t,"HKDF",!1,Re);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:n},s,i*8)}async labeledExtract(e,t,n){return await this.extract(e,this.buildLabeledIkm(t,n))}async labeledExpand(e,t,n,i){return await this.expand(e,this.buildLabeledInfo(t,n,i),i)}},Me=class extends zt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:pe.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}},_t=class extends zt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:pe.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}},nt=class extends zt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:pe.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var _r=class extends pt{async seal(e,t=Y){if(this._r.baseNonce.length===0)throw new Je("Bidirectional encryption is not setup");let n;try{n=await this._r.key.seal(this.computeNonce(this._r),e,t)}catch(i){throw new Je(i)}return this.incrementSeq(this._r),n}async open(e,t=Y){let n;try{n=await this._f.key.open(this.computeNonce(this._f),e,t)}catch(i){throw new et(i)}return this.incrementSeq(this._f),n}};var gr=class extends pt{constructor(e,t,n,i){super(e,t,n),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=i}async seal(e,t=Y){let n;try{n=await this._f.key.seal(this.computeNonce(this._f),e,t)}catch(i){throw new Je(i)}return this.incrementSeq(this._f),n}async open(e,t=Y){if(this._r.baseNonce.length===0)throw new et("Bidirectional encryption is not setup");let n;try{n=await this._r.key.open(this.computeNonce(this._r),e,t)}catch(i){throw new et(i)}return this.incrementSeq(this._r),n}};var mr=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let t=0;t<this._num.length;t++){if(this._num[t]<e[t])return!0;if(this._num[t]>e[t])return!1}return!1}};var Vo=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),Xo=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),Yo=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),gt=class{constructor(e,t,n){switch(Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,this._api=n,e){case V.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=di,this._bitmask=255,this._pkcs8AlgId=Vo;break;case V.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=bi,this._bitmask=255,this._pkcs8AlgId=Xo;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=wi,this._bitmask=1,this._pkcs8AlgId=Yo;break}}async serializePublicKey(e){let t=await this._api.exportKey("raw",e);if(t.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");return t}async deserializePublicKey(e){if(e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");try{return await this._api.importKey("raw",e,this._alg,!0,[])}catch{throw new Error("Invalid public key for the ciphersuite")}}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");if(n&&t.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!n&&t.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");try{if(n)return await this._api.importKey(e,t,this._alg,!0,[]);let i=new Uint8Array(t),s=new Uint8Array(this._pkcs8AlgId.length+i.length);return s.set(this._pkcs8AlgId,0),s.set(i,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",s,this._alg,!0,Re)}catch{throw new Error("Invalid key for the ciphersuite")}}async derivePublicKey(e){let t=await this._api.exportKey("jwk",e);return delete t.d,delete t.key_ops,await this._api.importKey("jwk",t,this._alg,!0,[])}async generateKeyPair(){return await this._api.generateKey(this._alg,!0,Re)}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(Y,je,new Uint8Array(e)),n=new mr(this._nSk);for(let a=0;n.isZero()||!n.lessThan(this._order);a++){if(a>255)throw new Error("Faild to derive a key pair");let o=new Uint8Array(await this._hkdf.labeledExpand(t,li,ue(a,1),this._nSk));o[0]=o[0]&this._bitmask,n.set(o)}let i=new Uint8Array(this._pkcs8AlgId.length+n.val().length);i.set(this._pkcs8AlgId,0),i.set(n.val(),this._pkcs8AlgId.length);let s=await this._api.importKey("pkcs8",i,this._alg,!0,Re);return n.reset(),{privateKey:s,publicKey:await this.derivePublicKey(s)}}async dh(e,t){return await this._api.deriveBits({name:"ECDH",public:t},e,this._nDh*8)}};var Wo=Lt(ji(),1);var Q=BigInt(0),re=BigInt(1),Ge=BigInt(2),Dt=BigInt(3),qi=BigInt(8),oe=Object.freeze({a:Q,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:re,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),Mi=(r,e)=>(r+e/Ge)/e,vr={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=oe,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-re*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,a=BigInt("0x100000000000000000000000000000000"),o=Mi(s*r,e),f=Mi(-n*r,e),c=T(r-o*t-f*i,e),h=T(-o*n-f*s,e),l=c>a,b=h>a;if(l&&(c=e-c),b&&(h=e-h),c>a||h>a)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:l,k1:c,k2neg:b,k2:h}}},mt=32,Rt=32;var kr=mt+1,Br=2*mt+1;function Gi(r){let{a:e,b:t}=oe,n=T(r*r),i=T(n*r);return T(i+e*r+t)}var Er=oe.a===Q,bn=class extends Error{constructor(e){super(e)}};function Fi(r){if(!(r instanceof X))throw new TypeError("JacobianPoint expected")}var X=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof ee))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(ee.ZERO)?X.ZERO:new X(e.x,e.y,re)}static toAffineBatch(e){let t=ra(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return X.toAffineBatch(e).map(X.fromAffine)}equals(e){Fi(e);let{x:t,y:n,z:i}=this,{x:s,y:a,z:o}=e,f=T(i*i),c=T(o*o),h=T(t*c),l=T(s*f),b=T(T(n*o)*c),w=T(T(a*i)*f);return h===l&&b===w}negate(){return new X(this.x,T(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,i=T(e*e),s=T(t*t),a=T(s*s),o=e+s,f=T(Ge*(T(o*o)-i-a)),c=T(Dt*i),h=T(c*c),l=T(h-Ge*f),b=T(c*(f-l)-qi*a),w=T(Ge*t*n);return new X(l,b,w)}add(e){Fi(e);let{x:t,y:n,z:i}=this,{x:s,y:a,z:o}=e;if(s===Q||a===Q)return this;if(t===Q||n===Q)return e;let f=T(i*i),c=T(o*o),h=T(t*c),l=T(s*f),b=T(T(n*o)*c),w=T(T(a*i)*f),v=T(l-h),y=T(w-b);if(v===Q)return y===Q?this.double():X.ZERO;let B=T(v*v),S=T(v*B),I=T(h*B),x=T(y*y-S-Ge*I),L=T(y*(I-x)-b*S),z=T(i*o*v);return new X(x,L,z)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=X.ZERO;if(typeof e=="bigint"&&e===Q)return t;let n=Xi(e);if(n===re)return this;if(!Er){let l=t,b=this;for(;n>Q;)n&re&&(l=l.add(b)),b=b.double(),n>>=re;return l}let{k1neg:i,k1:s,k2neg:a,k2:o}=vr.splitScalar(n),f=t,c=t,h=this;for(;s>Q||o>Q;)s&re&&(f=f.add(h)),o&re&&(c=c.add(h)),h=h.double(),s>>=re,o>>=re;return i&&(f=f.negate()),a&&(c=c.negate()),c=new X(T(c.x*vr.beta),c.y,c.z),f.add(c)}precomputeWindow(e){let t=Er?128/e+1:256/e+1,n=[],i=this,s=i;for(let a=0;a<t;a++){s=i,n.push(s);for(let o=1;o<2**(e-1);o++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals(X.BASE)&&(t=ee.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&wn.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=X.normalizeZ(i),wn.set(t,i)));let s=X.ZERO,a=X.BASE,o=1+(Er?128/n:256/n),f=2**(n-1),c=BigInt(2**n-1),h=2**n,l=BigInt(n);for(let b=0;b<o;b++){let w=b*f,v=Number(e&c);e>>=l,v>f&&(v-=h,e+=re);let y=w,B=w+Math.abs(v)-1,S=b%2!==0,I=v<0;v===0?a=a.add(Sr(S,i[y])):s=s.add(Sr(I,i[B]))}return{p:s,f:a}}multiply(e,t){let n=Xi(e),i,s;if(Er){let{k1neg:a,k1:o,k2neg:f,k2:c}=vr.splitScalar(n),{p:h,f:l}=this.wNAF(o,t),{p:b,f:w}=this.wNAF(c,t);h=Sr(a,h),b=Sr(f,b),b=new X(T(b.x*vr.beta),b.y,b.z),i=h.add(b),s=l.add(w)}else{let{p:a,f:o}=this.wNAF(n,t);i=a,s=o}return X.normalizeZ([i,s])[0]}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals(X.ZERO);e==null&&(e=s?qi:Ur(i));let a=e,o=T(a*a),f=T(o*a),c=T(t*o),h=T(n*f),l=T(i*a);if(s)return ee.ZERO;if(l!==re)throw new Error("invZ was invalid");return new ee(c,h)}};X.BASE=new X(oe.Gx,oe.Gy,re);X.ZERO=new X(Q,re,Q);function Sr(r,e){let t=e.negate();return r?t:e}var wn=new WeakMap,ee=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,wn.delete(this)}hasEvenY(){return this.y%Ge===Q}static fromCompressedHex(e){let t=e.length===32,n=ot(t?e:e.subarray(1));if(!dn(n))throw new Error("Point is not on curve");let i=Gi(n),s=ta(i),a=(s&re)===re;t?a&&(s=T(-s)):(e[0]&1)===1!==a&&(s=T(-s));let o=new ee(n,s);return o.assertValidity(),o}static fromUncompressedHex(e){let t=ot(e.subarray(1,mt+1)),n=ot(e.subarray(mt+1,mt*2+1)),i=new ee(t,n);return i.assertValidity(),i}static fromHex(e){let t=pn(e),n=t.length,i=t[0];if(n===mt)return this.fromCompressedHex(t);if(n===kr&&(i===2||i===3))return this.fromCompressedHex(t);if(n===Br&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${kr} compressed bytes or ${Br} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return ee.BASE.multiply(Lr(e))}static fromSignature(e,t,n){let{r:i,s}=oa(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let a=ia(pn(e)),{n:o}=oe,f=n===2||n===3?i+o:i,c=Ur(f,o),h=T(-a*c,o),l=T(s*c,o),b=n&1?"03":"02",w=ee.fromHex(b+vt(f)),v=ee.BASE.multiplyAndAddUnsafe(w,h,l);if(!v)throw new Error("Cannot recover signature: point at infinify");return v.assertValidity(),v}toRawBytes(e=!1){return st(this.toHex(e))}toHex(e=!1){let t=vt(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${vt(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!dn(t)||!dn(n))throw new Error(e);let i=T(n*n),s=Gi(t);if(T(i-s)!==Q)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new ee(this.x,T(-this.y))}double(){return X.fromAffine(this).double().toAffine()}add(e){return X.fromAffine(this).add(X.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return X.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let i=X.fromAffine(this),s=t===Q||t===re||this!==ee.BASE?i.multiplyUnsafe(t):i.multiply(t),a=X.fromAffine(e).multiplyUnsafe(n),o=s.add(a);return o.equals(X.ZERO)?void 0:o.toAffine()}};ee.BASE=new ee(oe.Gx,oe.Gy);ee.ZERO=new ee(Q,Q);function Zi(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function $i(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${St(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:ot(t),left:r.subarray(e+2)}}function Qo(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${St(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=$i(r.subarray(2)),{data:n,left:i}=$i(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${St(i)}`);return{r:e,s:n}}var Te=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=t?St(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Te(Pr(i.slice(0,64)),Pr(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=Qo(t?e:st(e));return new Te(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!Ir(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Ir(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=oe.n>>re;return this.s>e}normalizeS(){return this.hasHighS()?new Te(this.r,T(-this.s,oe.n)):this}toDERRawBytes(){return st(this.toDERHex())}toDERHex(){let e=Zi(Ct(this.s)),t=Zi(Ct(this.r)),n=e.length/2,i=t.length/2,s=Ct(n),a=Ct(i);return`30${Ct(i+n+4)}02${a}${t}02${s}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return st(this.toCompactHex())}toCompactHex(){return vt(this.r)+vt(this.s)}};function Nt(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var Jo=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function St(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=Jo[r[t]];return e}var ea=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function vt(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(Q<=r&&r<ea))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function Vi(r){let e=st(vt(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Ct(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function Pr(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function st(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function ot(r){return Pr(St(r))}function pn(r){return r instanceof Uint8Array?Uint8Array.from(r):st(r)}function Xi(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&Ir(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function T(r,e=oe.P){let t=r%e;return t>=Q?t:e+t}function ge(r,e){let{P:t}=oe,n=r;for(;e-- >Q;)n*=n,n%=t;return n}function ta(r){let{P:e}=oe,t=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),o=BigInt(88),f=r*r*r%e,c=f*f*r%e,h=ge(c,Dt)*c%e,l=ge(h,Dt)*c%e,b=ge(l,Ge)*f%e,w=ge(b,n)*b%e,v=ge(w,i)*w%e,y=ge(v,a)*v%e,B=ge(y,o)*y%e,S=ge(B,a)*v%e,I=ge(S,Dt)*c%e,x=ge(I,s)*w%e,L=ge(x,t)*f%e,z=ge(L,Ge);if(z*z%e!==r)throw new Error("Cannot find square root");return z}function Ur(r,e=oe.P){if(r===Q||e<=Q)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=T(r,e),n=e,i=Q,s=re,a=re,o=Q;for(;t!==Q;){let c=n/t,h=n%t,l=i-a*c,b=s-o*c;n=t,t=h,i=a,s=o,a=l,o=b}if(n!==re)throw new Error("invert: does not exist");return T(i,e)}function ra(r,e=oe.P){let t=new Array(r.length),n=r.reduce((s,a,o)=>a===Q?s:(t[o]=s,T(s*a,e)),re),i=Ur(n,e);return r.reduceRight((s,a,o)=>a===Q?s:(t[o]=T(s*t[o],e),T(s*a,e)),i),t}function na(r){let e=r.length*8-Rt*8,t=ot(r);return e>0?t>>BigInt(e):t}function ia(r,e=!1){let t=na(r);if(e)return t;let{n}=oe;return t>=n?t-n:t}var Et,ln;function Ir(r){return Q<r&&r<oe.n}function dn(r){return Q<r&&r<oe.P}function Lr(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*Rt)throw new Error("Expected 32 bytes of private key");e=Pr(r)}else if(r instanceof Uint8Array){if(r.length!==Rt)throw new Error("Expected 32 bytes of private key");e=ot(r)}else throw new TypeError("Expected valid private key");if(!Ir(e))throw new Error("Expected private key: 0 < key < n");return e}function sa(r){return r instanceof ee?(r.assertValidity(),r):ee.fromHex(r)}function oa(r){if(r instanceof Te)return r.assertValidity(),r;try{return Te.fromDER(r)}catch{return Te.fromCompact(r)}}function Wi(r,e=!1){return ee.fromPrivateKey(r).toRawBytes(e)}function Yi(r){let e=r instanceof Uint8Array,t=typeof r=="string",n=(e||t)&&r.length;return e?n===kr||n===Br:t?n===kr*2||n===Br*2:r instanceof ee}function Qi(r,e,t=!1){if(Yi(r))throw new TypeError("getSharedSecret: first arg must be private key");if(!Yi(e))throw new TypeError("getSharedSecret: second arg must be public key");let n=sa(e);return n.assertValidity(),n.multiply(Lr(r)).toRawBytes(t)}ee.BASE._setWindowSize(8);var xe={node:Wo,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Ar={},it={bytesToHex:St,hexToBytes:st,concatBytes:Nt,mod:T,invert:Ur,isValidPrivateKey(r){try{return Lr(r),!0}catch{return!1}},_bigintTo32Bytes:Vi,_normalizePrivateKey:Lr,hashToPrivateKey:r=>{r=pn(r);let e=Rt+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=T(ot(r),oe.n-re)+re;return Vi(t)},randomBytes:(r=32)=>{if(xe.web)return xe.web.getRandomValues(new Uint8Array(r));if(xe.node){let{randomBytes:e}=xe.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>it.hashToPrivateKey(it.randomBytes(Rt+8)),precompute(r=8,e=ee.BASE){let t=e===ee.BASE?e:new ee(e.x,e.y);return t._setWindowSize(r),t.multiply(Dt),t},sha256:async(...r)=>{if(xe.web){let e=await xe.web.subtle.digest("SHA-256",Nt(...r));return new Uint8Array(e)}else if(xe.node){let{createHash:e}=xe.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(xe.web){let t=await xe.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Nt(...e),i=await xe.web.subtle.sign("HMAC",t,n);return new Uint8Array(i)}else if(xe.node){let{createHmac:t}=xe.node,n=t("sha256",r);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=Ar[r];if(t===void 0){let n=await it.sha256(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Nt(n,n),Ar[r]=t}return it.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof Et!="function")throw new bn("sha256Sync is undefined, you need to set it");let t=Ar[r];if(t===void 0){let n=Et(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Nt(n,n),Ar[r]=t}return Et(t,...e)},_JacobianPoint:X};Object.defineProperties(it,{sha256Sync:{configurable:!1,get(){return Et},set(r){Et||(Et=r)}},hmacSha256Sync:{configurable:!1,get(){return ln},set(r){ln||(ln=r)}}});var ie=class{constructor(e,t,n){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:Re}),this.key=t,this.type=n,this.algorithm={name:e}}};var jt="ECDH",Hr=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=65,this._nSk=32}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=it.randomPrivateKey(),t=new ie(jt,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(Y,je,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,lt,Y,this._nSk),i=new ie(jt,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie(jt,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie(jt,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=Wi(e.key);t(new ie(jt,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(Qi(e.key,t.key).buffer)}catch(s){i(s)}})}};function yn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function fa(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function Ji(r,...e){if(!(r instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function ca(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");yn(r.outputLen),yn(r.blockLen)}function ha(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ua(r,e){Ji(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var la={number:yn,bool:fa,bytes:Ji,hash:ca,exists:ha,output:ua},Be=la;var qt={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var es=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Or=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);var da=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!da)throw new Error("Non little-endian hardware is not supported");var Lc=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Mt(r){if(typeof r!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof r}`);return new TextEncoder().encode(r)}function kt(r){if(typeof r=="string"&&(r=Mt(r)),!(r instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof r})`);return r}function Kr(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var At=class{clone(){return this._cloneInto()}};function Le(r){let e=n=>r().update(kt(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ts(r){let e=(n,i)=>r(i).update(kt(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function Tr(r=32){if(qt.web)return qt.web.getRandomValues(new Uint8Array(r));if(qt.node)return new Uint8Array(qt.node.randomBytes(r).buffer);throw new Error("The environment doesn't have randomBytes function")}function ba(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),s=BigInt(4294967295),a=Number(t>>i&s),o=Number(t&s),f=n?4:0,c=n?0:4;r.setUint32(e+f,a,n),r.setUint32(e+c,o,n)}var zr=class extends At{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Or(this.buffer)}update(e){Be.exists(this);let{view:t,buffer:n,blockLen:i}=this;e=kt(e);let s=e.length;for(let a=0;a<s;){let o=Math.min(i-this.pos,s-a);if(o===i){let f=Or(e);for(;i<=s-a;a+=i)this.process(f,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Be.exists(this),Be.output(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>i-a&&(this.process(n,0),a=0);for(let l=a;l<i;l++)t[l]=0;ba(n,i-8,BigInt(this.length*8),s),this.process(n,0);let o=Or(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=f/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:s,destroyed:a,pos:o}=this;return e.length=i,e.pos=o,e.finished=s,e.destroyed=a,i%t&&e.buffer.set(n),e}};var Nr=BigInt(4294967295),xn=BigInt(32);function rs(r,e=!1){return e?{h:Number(r&Nr),l:Number(r>>xn&Nr)}:{h:Number(r>>xn&Nr)|0,l:Number(r&Nr)|0}}function wa(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){let{h:s,l:a}=rs(r[i],e);[t[i],n[i]]=[s,a]}return[t,n]}var pa=(r,e)=>BigInt(r>>>0)<<xn|BigInt(e>>>0),ya=(r,e,t)=>r>>>t,xa=(r,e,t)=>r<<32-t|e>>>t,_a=(r,e,t)=>r>>>t|e<<32-t,ga=(r,e,t)=>r<<32-t|e>>>t,ma=(r,e,t)=>r<<64-t|e>>>t-32,va=(r,e,t)=>r>>>t-32|e<<64-t,Ea=(r,e)=>e,Sa=(r,e)=>r,Aa=(r,e,t)=>r<<t|e>>>32-t,ka=(r,e,t)=>e<<t|r>>>32-t,Ba=(r,e,t)=>e<<t-32|r>>>64-t,Pa=(r,e,t)=>r<<t-32|e>>>64-t;function Ia(r,e,t,n){let i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}var La=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Ua=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Ha=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Oa=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,Ka=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),Ta=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,za={fromBig:rs,split:wa,toBig:pa,shrSH:ya,shrSL:xa,rotrSH:_a,rotrSL:ga,rotrBH:ma,rotrBL:va,rotr32H:Ea,rotr32L:Sa,rotlSH:Aa,rotlSL:ka,rotlBH:Ba,rotlBL:Pa,add:Ia,add3L:La,add3H:Ua,add4L:Ha,add4H:Oa,add5H:Ta,add5L:Ka},R=za;var[Na,Ca]=R.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Fe=new Uint32Array(80),Ze=new Uint32Array(80),Bt=class extends zr{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:a,Dh:o,Dl:f,Eh:c,El:h,Fh:l,Fl:b,Gh:w,Gl:v,Hh:y,Hl:B}=this;return[e,t,n,i,s,a,o,f,c,h,l,b,w,v,y,B]}set(e,t,n,i,s,a,o,f,c,h,l,b,w,v,y,B){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=a|0,this.Dh=o|0,this.Dl=f|0,this.Eh=c|0,this.El=h|0,this.Fh=l|0,this.Fl=b|0,this.Gh=w|0,this.Gl=v|0,this.Hh=y|0,this.Hl=B|0}process(e,t){for(let x=0;x<16;x++,t+=4)Fe[x]=e.getUint32(t),Ze[x]=e.getUint32(t+=4);for(let x=16;x<80;x++){let L=Fe[x-15]|0,z=Ze[x-15]|0,j=R.rotrSH(L,z,1)^R.rotrSH(L,z,8)^R.shrSH(L,z,7),p=R.rotrSL(L,z,1)^R.rotrSL(L,z,8)^R.shrSL(L,z,7),d=Fe[x-2]|0,H=Ze[x-2]|0,N=R.rotrSH(d,H,19)^R.rotrBH(d,H,61)^R.shrSH(d,H,6),A=R.rotrSL(d,H,19)^R.rotrBL(d,H,61)^R.shrSL(d,H,6),E=R.add4L(p,A,Ze[x-7],Ze[x-16]),g=R.add4H(E,j,N,Fe[x-7],Fe[x-16]);Fe[x]=g|0,Ze[x]=E|0}let{Ah:n,Al:i,Bh:s,Bl:a,Ch:o,Cl:f,Dh:c,Dl:h,Eh:l,El:b,Fh:w,Fl:v,Gh:y,Gl:B,Hh:S,Hl:I}=this;for(let x=0;x<80;x++){let L=R.rotrSH(l,b,14)^R.rotrSH(l,b,18)^R.rotrBH(l,b,41),z=R.rotrSL(l,b,14)^R.rotrSL(l,b,18)^R.rotrBL(l,b,41),j=l&w^~l&y,p=b&v^~b&B,d=R.add5L(I,z,p,Ca[x],Ze[x]),H=R.add5H(d,S,L,j,Na[x],Fe[x]),N=d|0,A=R.rotrSH(n,i,28)^R.rotrBH(n,i,34)^R.rotrBH(n,i,39),E=R.rotrSL(n,i,28)^R.rotrBL(n,i,34)^R.rotrBL(n,i,39),g=n&s^n&o^s&o,P=i&a^i&f^a&f;S=y|0,I=B|0,y=w|0,B=v|0,w=l|0,v=b|0,{h:l,l:b}=R.add(c|0,h|0,H|0,N|0),c=o|0,h=f|0,o=s|0,f=a|0,s=n|0,a=i|0;let D=R.add3L(N,E,P);n=R.add3H(D,H,A,g),i=D|0}({h:n,l:i}=R.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:a}=R.add(this.Bh|0,this.Bl|0,s|0,a|0),{h:o,l:f}=R.add(this.Ch|0,this.Cl|0,o|0,f|0),{h:c,l:h}=R.add(this.Dh|0,this.Dl|0,c|0,h|0),{h:l,l:b}=R.add(this.Eh|0,this.El|0,l|0,b|0),{h:w,l:v}=R.add(this.Fh|0,this.Fl|0,w|0,v|0),{h:y,l:B}=R.add(this.Gh|0,this.Gl|0,y|0,B|0),{h:S,l:I}=R.add(this.Hh|0,this.Hl|0,S|0,I|0),this.set(n,i,s,a,o,f,c,h,l,b,w,v,y,B,S,I)}roundClean(){Fe.fill(0),Ze.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},_n=class extends Bt{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}},gn=class extends Bt{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}},mn=class extends Bt{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}},Cr=Le(()=>new Bt),Dc=Le(()=>new _n),Rc=Le(()=>new gn),jc=Le(()=>new mn);var Mc=BigInt(0),vn=BigInt(1),Da=BigInt(2);function ns(r){fs(r.Fp);for(let e of["n","h"])if(typeof r[e]!="bigint")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);if(!r.Fp.isValid(r.Gx))throw new Error("Invalid generator X coordinate Fp element");if(!r.Fp.isValid(r.Gy))throw new Error("Invalid generator Y coordinate Fp element");for(let e of["nBitLength","nByteLength"])if(r[e]!==void 0&&!Number.isSafeInteger(r[e]))throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);return Object.freeze({...Dr(r.n,r.nBitLength),...r})}var Ra=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function at(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=Ra[r[t]];return e}function ja(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function is(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex "+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function En(r){return ja(at(r))}function me(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+at(Uint8Array.from(r).reverse()))}var Sn=(r,e)=>is(r.toString(16).padStart(e*2,"0")),Pe=(r,e)=>Sn(r,e).reverse();function ce(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):is(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function ve(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}function Dr(r,e){let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function ss(r,e,t=!1){r=ce(r);let n=Dr(e).nByteLength,i=n+8;if(n<16||r.length<i||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let s=t?me(r):En(r);return Z(s,e-vn)+vn}function os(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}var as=r=>(Da<<BigInt(r-1))-vn;var ae=BigInt(0),se=BigInt(1),ft=BigInt(2),Ma=BigInt(3),An=BigInt(4),cs=BigInt(5),hs=BigInt(8),Ga=BigInt(9),Fa=BigInt(16);function Z(r,e){let t=r%e;return t>=ae?t:e+t}function Gt(r,e,t){if(t<=ae||e<ae)throw new Error("Expected power/modulo > 0");if(t===se)return ae;let n=se;for(;e>ae;)e&se&&(n=n*r%t),r=r*r%t,e>>=se;return n}function te(r,e,t){let n=r;for(;e-- >ae;)n*=n,n%=t;return n}function us(r,e){if(r===ae||e<=ae)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=Z(r,e),n=e,i=ae,s=se,a=se,o=ae;for(;t!==ae;){let c=n/t,h=n%t,l=i-a*c,b=s-o*c;n=t,t=h,i=a,s=o,a=l,o=b}if(n!==se)throw new Error("invert: does not exist");return Z(i,e)}function Za(r){let e=(r-se)/ft,t,n,i;for(t=r-se,n=0;t%ft===ae;t/=ft,n++);for(i=ft;i<r&&Gt(i,e,r)!==r-se;i++);if(n===1){let a=(r+se)/An;return function(f,c){let h=f.pow(c,a);if(!f.equals(f.square(h),c))throw new Error("Cannot find square root");return h}}let s=(t+se)/ft;return function(o,f){if(o.pow(f,e)!==o.ONE)throw new Error("Cannot find square root");let c=n,h=Gt(i,t,r),l=o.pow(f,s),b=o.pow(f,t),w=o.ZERO;for(;!o.equals(o.sub(b,o.ONE),o.ZERO);){w=o.square(b);let v;for(v=1;v<c&&!o.equals(o.sub(w,o.ONE),o.ZERO);v++)w=o.square(w);let y=Gt(h,BigInt(1<<c-v-1),r);l=o.mul(l,y),h=Z(y*y,r),b=o.mul(b,h),c=v}return l}}function $a(r){if(r%An===Ma){let e=(r+se)/An;return function(n,i){let s=n.pow(i,e);if(!n.equals(n.square(s),i))throw new Error("Cannot find square root");return s}}if(r%hs===cs){let e=(r-cs)/hs;return function(n,i){let s=n.mul(i,ft),a=n.pow(s,e),o=n.mul(i,a),f=n.mul(n.mul(o,ft),a),c=n.mul(o,n.sub(f,n.ONE));if(!n.equals(n.square(c),i))throw new Error("Cannot find square root");return c}}return r%Fa,Za(r)}var ze=(r,e)=>(Z(r,e)&se)===se,Va=["create","isValid","isZero","negate","invert","sqrt","square","equals","add","sub","mul","pow","div","addN","subN","mulN","squareN"];function fs(r){for(let e of["ORDER","MASK"])if(typeof r[e]!="bigint")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["BYTES","BITS"])if(typeof r[e]!="number")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`);for(let e of Va)if(typeof r[e]!="function")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`)}function Xa(r,e,t){if(t<ae)throw new Error("Expected power > 0");if(t===ae)return r.ONE;if(t===se)return e;let n=r.ONE,i=e;for(;t>ae;)t&se&&(n=r.mul(n,i)),i=r.square(i),t>>=1n;return n}function Ya(r,e){let t=new Array(e.length),n=e.reduce((s,a,o)=>r.isZero(a)?s:(t[o]=s,r.mul(s,a)),r.ONE),i=r.invert(n);return e.reduceRight((s,a,o)=>r.isZero(a)?s:(t[o]=r.mul(s,t[o]),r.mul(s,a)),i),t}function jr(r,e,t=!1,n={}){if(r<=ae)throw new Error(`Expected Fp ORDER > 0, got ${r}`);let{nBitLength:i,nByteLength:s}=Dr(r,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let a=$a(r),o=Object.freeze({ORDER:r,BITS:i,BYTES:s,MASK:as(i),ZERO:ae,ONE:se,create:f=>Z(f,r),isValid:f=>{if(typeof f!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof f}`);return ae<=f&&f<r},isZero:f=>f===ae,isOdd:f=>(f&se)===se,negate:f=>Z(-f,r),equals:(f,c)=>f===c,square:f=>Z(f*f,r),add:(f,c)=>Z(f+c,r),sub:(f,c)=>Z(f-c,r),mul:(f,c)=>Z(f*c,r),pow:(f,c)=>Xa(o,f,c),div:(f,c)=>Z(f*us(c,r),r),squareN:f=>f*f,addN:(f,c)=>f+c,subN:(f,c)=>f-c,mulN:(f,c)=>f*c,invert:f=>us(f,r),sqrt:n.sqrt||(f=>a(o,f)),invertBatch:f=>Ya(o,f),cmov:(f,c,h)=>h?c:f,toBytes:f=>t?Pe(f,s):Sn(f,s),fromBytes:f=>{if(f.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${f.length}`);return t?me(f):En(f)}});return Object.freeze(o)}function ls(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");let t=r.sqrt(e);return r.isOdd(t)?r.negate(t):t}var Wa=BigInt(0),kn=BigInt(1);function ds(r,e){let t=(i,s)=>{let a=s.negate();return i?a:s},n=i=>{let s=Math.ceil(e/i)+1,a=2**(i-1);return{windows:s,windowSize:a}};return{constTimeNegate:t,unsafeLadder(i,s){let a=r.ZERO,o=i;for(;s>Wa;)s&kn&&(a=a.add(o)),o=o.double(),s>>=kn;return a},precomputeWindow(i,s){let{windows:a,windowSize:o}=n(s),f=[],c=i,h=c;for(let l=0;l<a;l++){h=c,f.push(h);for(let b=1;b<o;b++)h=h.add(c),f.push(h);c=h.double()}return f},wNAF(i,s,a){let{windows:o,windowSize:f}=n(i),c=r.ZERO,h=r.BASE,l=BigInt(2**i-1),b=2**i,w=BigInt(i);for(let v=0;v<o;v++){let y=v*f,B=Number(a&l);a>>=w,B>f&&(B-=b,a+=kn);let S=y,I=y+Math.abs(B)-1,x=v%2!==0,L=B<0;B===0?h=h.add(t(x,s[S])):c=c.add(t(L,s[I]))}return{p:c,f:h}}}}function bs(r){if(typeof r.DST!="string")throw new Error("Invalid htf/DST");if(typeof r.p!="bigint")throw new Error("Invalid htf/p");if(typeof r.m!="number")throw new Error("Invalid htf/m");if(typeof r.k!="number")throw new Error("Invalid htf/k");if(r.expand!=="xmd"&&r.expand!=="xof"&&r.expand!==void 0)throw new Error("Invalid htf/expand");if(typeof r.hash!="function"||!Number.isSafeInteger(r.hash.outputLen))throw new Error("Invalid htf/hash function")}function Bn(r){let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}function Qa(r){let e=0n;for(let t=0;t<r.length;t++)e<<=8n,e+=BigInt(r[t]);return e}function $e(r,e){if(r<0||r>=1<<8*e)throw new Error(`bad I2OSP call: value=${r} length=${e}`);let t=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)t[n]=r&255,r>>>=8;return new Uint8Array(t)}function Ja(r,e){let t=new Uint8Array(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}function ef(r,e,t,n){e.length>255&&(e=n(ve(Bn("H2C-OVERSIZE-DST-"),e)));let i=n.outputLen,s=n.blockLen,a=Math.ceil(t/i);if(a>255)throw new Error("Invalid xmd length");let o=ve(e,$e(e.length,1)),f=$e(0,s),c=$e(t,2),h=new Array(a),l=n(ve(f,r,c,$e(0,1),o));h[0]=n(ve(l,$e(1,1),o));for(let w=1;w<=a;w++){let v=[Ja(l,h[w-1]),$e(w+1,1),o];h[w]=n(ve(...v))}return ve(...h).slice(0,t)}function tf(r,e,t,n,i){if(e.length>255){let s=Math.ceil(2*n/8);e=i.create({dkLen:s}).update(Bn("H2C-OVERSIZE-DST-")).update(e).digest()}if(t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:t}).update(r).update($e(t,2)).update(e).update($e(e.length,1)).digest()}function Pn(r,e,t){let n=t.p.toString(2).length,i=Math.ceil((n+t.k)/8),s=e*t.m*i,a=Bn(t.DST),o=r;t.expand==="xmd"?o=ef(r,a,s,t.hash):t.expand==="xof"&&(o=tf(r,a,s,t.k,t.hash));let f=new Array(e);for(let c=0;c<e;c++){let h=new Array(t.m);for(let l=0;l<t.m;l++){let b=i*(l+c*t.m),w=o.subarray(b,b+i);h[l]=Z(Qa(w),t.p)}f[c]=h}return f}var Ve=BigInt(0),Ee=BigInt(1),Ft=BigInt(2),rf=BigInt(8);function nf(r){let e=ns(r);if(typeof e.hash!="function"||!Number.isSafeInteger(e.hash.outputLen))throw new Error("Invalid hash function");for(let t of["a","d"])if(typeof e[t]!="bigint")throw new Error(`Invalid curve param ${t}=${e[t]} (${typeof e[t]})`);for(let t of["randomBytes"])if(typeof e[t]!="function")throw new Error(`Invalid ${t} function`);for(let t of["adjustScalarBytes","domain","uvRatio","mapToCurve","clearCofactor"])if(e[t]!==void 0&&typeof e[t]!="function")throw new Error(`Invalid ${t} function`);return e.htfDefaults!==void 0&&bs(e.htfDefaults),Object.freeze({...e})}function ct(r){let e=nf(r),t=e.Fp,n=e.n,i=t.BYTES;if(i>2048)throw new Error("Field lengths over 2048 are not supported");let s=e.nByteLength,a=Ft**BigInt(s*8),{randomBytes:o}=e,f=t.create;function c(m,u){try{return{isValid:!0,value:t.sqrt(m*t.invert(u))}}catch{return{isValid:!1,value:Ve}}}let h=e.uvRatio||c,l=m=>m,b=e.adjustScalarBytes||l;function w(m,u,_){if(u.length||_)throw new Error("Contexts/pre-hash are not supported");return m}let v=e.domain||w;class y{constructor(u,_,K,O){this.x=u,this.y=_,this.z=K,this.t=O}static fromAffine(u){if(!(u instanceof x))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return u.equals(x.ZERO)?y.ZERO:new y(u.x,u.y,Ee,f(u.x*u.y))}static toAffineBatch(u){let _=t.invertBatch(u.map(K=>K.z));return u.map((K,O)=>K.toAffine(_[O]))}static normalizeZ(u){return this.toAffineBatch(u).map(this.fromAffine)}equals(u){S(u);let{x:_,y:K,z:O}=this,{x:C,y:q,z:M}=u,G=f(_*M),$=f(C*O),J=f(K*M),W=f(q*O);return G===$&&J===W}negate(){return new y(f(-this.x),this.y,this.z,f(-this.t))}double(){let{a:u}=e,{x:_,y:K,z:O}=this,C=f(_*_),q=f(K*K),M=f(Ft*f(O*O)),G=f(u*C),$=_+K,J=f(f($*$)-C-q),W=G+q,le=W-M,Ue=G-q,We=f(J*le),ht=f(W*Ue),Qe=f(J*Ue),Wt=f(le*W);return new y(We,ht,Wt,Qe)}add(u){S(u);let{a:_,d:K}=e,{x:O,y:C,z:q,t:M}=this,{x:G,y:$,z:J,t:W}=u;if(_===BigInt(-1)){let Rn=f((C-O)*($+G)),jn=f((C+O)*($-G)),Jr=f(jn-Rn);if(Jr===Ve)return this.double();let qn=f(q*Ft*W),Mn=f(M*Ft*J),Gn=Mn+qn,Fn=jn+Rn,Zn=Mn-qn,js=f(Gn*Jr),qs=f(Fn*Zn),Ms=f(Gn*Zn),Gs=f(Jr*Fn);return new y(js,qs,Gs,Ms)}let le=f(O*G),Ue=f(C*$),We=f(M*K*W),ht=f(q*J),Qe=f((O+C)*(G+$)-le-Ue),Wt=ht-We,Cn=ht+We,Dn=f(Ue-_*le),Ns=f(Qe*Wt),Cs=f(Cn*Dn),Ds=f(Qe*Dn),Rs=f(Wt*Cn);return new y(Ns,Cs,Rs,Ds)}subtract(u){return this.add(u.negate())}wNAF(u,_){!_&&this.equals(y.BASE)&&(_=x.BASE);let K=_&&_._WINDOW_SIZE||1,O=_&&I.get(_);O||(O=B.precomputeWindow(this,K),_&&K!==1&&(O=y.normalizeZ(O),I.set(_,O)));let{p:C,f:q}=B.wNAF(K,O,u);return y.normalizeZ([C,q])[0]}multiply(u,_){return this.wNAF(j(u,n),_)}multiplyUnsafe(u){let _=j(u,n,!1),K=y.BASE,O=y.ZERO;return _===Ve?O:this.equals(O)||_===Ee?this:this.equals(K)?this.wNAF(_):B.unsafeLadder(this,_)}isSmallOrder(){return this.multiplyUnsafe(e.h).equals(y.ZERO)}isTorsionFree(){return this.multiplyUnsafe(n).equals(y.ZERO)}toAffine(u){let{x:_,y:K,z:O}=this,C=this.equals(y.ZERO);u==null&&(u=C?rf:t.invert(O));let q=f(_*u),M=f(K*u),G=f(O*u);if(C)return x.ZERO;if(G!==Ee)throw new Error("invZ was invalid");return new x(q,M)}clearCofactor(){return e.h===Ee?this:e.clearCofactor?e.clearCofactor(y,this):this.multiplyUnsafe(e.h)}}y.BASE=new y(e.Gx,e.Gy,Ee,f(e.Gx*e.Gy)),y.ZERO=new y(Ve,Ee,Ee,Ve);let B=ds(y,s*8);function S(m){if(!(m instanceof y))throw new TypeError("ExtendedPoint expected")}let I=new WeakMap;class x{constructor(u,_){this.x=u,this.y=_}_setWindowSize(u){this._WINDOW_SIZE=u,I.delete(this)}static fromHex(u,_=!0){let{d:K,a:O}=e;u=ce(u,i);let C=u.slice(),q=u[i-1];C[i-1]=q&-129;let M=me(C);if(_&&M>=t.ORDER)throw new Error("Expected 0 < hex < P");if(!_&&M>=a)throw new Error("Expected 0 < hex < 2**256");let G=f(M*M),$=f(G-Ee),J=f(K*G-O),{isValid:W,value:le}=h($,J);if(!W)throw new Error("Point.fromHex: invalid y coordinate");let Ue=(le&Ee)===Ee;return(q&128)!==0!==Ue&&(le=f(-le)),new x(le,M)}static fromPrivateKey(u){return H(u).point}toRawBytes(){let u=Pe(this.y,i);return u[i-1]|=this.x&Ee?128:0,u}toHex(){return at(this.toRawBytes())}isTorsionFree(){return y.fromAffine(this).isTorsionFree()}equals(u){if(!(u instanceof x))throw new TypeError("Point#equals: expected Point");return this.x===u.x&&this.y===u.y}negate(){return new x(f(-this.x),this.y)}double(){return y.fromAffine(this).double().toAffine()}add(u){return y.fromAffine(this).add(y.fromAffine(u)).toAffine()}subtract(u){return this.add(u.negate())}multiply(u){return y.fromAffine(this).multiply(u,this).toAffine()}clearCofactor(){return y.fromAffine(this).clearCofactor().toAffine()}static hashToCurve(u,_){if(!e.mapToCurve)throw new Error("No mapToCurve defined for curve");u=ce(u);let K=Pn(u,2,{...e.htfDefaults,..._}),{x:O,y:C}=e.mapToCurve(K[0]),{x:q,y:M}=e.mapToCurve(K[1]);return new x(O,C).add(new x(q,M)).clearCofactor()}static encodeToCurve(u,_){if(!e.mapToCurve)throw new Error("No mapToCurve defined for curve");u=ce(u);let K=Pn(u,1,{...e.htfDefaults,..._}),{x:O,y:C}=e.mapToCurve(K[0]);return new x(O,C).clearCofactor()}}x.BASE=new x(e.Gx,e.Gy),x.ZERO=new x(Ve,Ee);class L{constructor(u,_){this.r=u,this.s=_,this.assertValidity()}static fromHex(u){let _=ce(u,2*i),K=x.fromHex(_.slice(0,i),!1),O=me(_.slice(i,2*i));return new L(K,O)}assertValidity(){let{r:u,s:_}=this;if(!(u instanceof x))throw new Error("Expected Point instance");return j(_,n,!1),this}toRawBytes(){return ve(this.r.toRawBytes(),Pe(this.s,i))}toHex(){return at(this.toRawBytes())}}function z(m){return Z(me(m),n)}function j(m,u,_=!0){if(!u)throw new TypeError("Specify max value");if(typeof m=="number"&&Number.isSafeInteger(m)&&(m=BigInt(m)),typeof m=="bigint"&&m<u){if(_){if(Ve<m)return m}else if(Ve<=m)return m}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function p(m){if(m=typeof m=="bigint"||typeof m=="number"?Pe(j(m,a),s):ce(m),m.length!==s)throw new Error(`Expected ${s} bytes, got ${m.length}`);return m}function d(m){let u=b(m.slice(0,s)),_=m.slice(s,2*s),K=z(u),O=x.BASE.multiply(K),C=O.toRawBytes();return{head:u,prefix:_,scalar:K,point:O,pointBytes:C}}function H(m){return d(e.hash(p(m)))}function N(m){return H(m).pointBytes}let A=new Uint8Array;function E(m,u=A){return u=ce(u),z(e.hash(v(m,u,!!e.preHash)))}function g(m,u,_){m=ce(m),e.preHash&&(m=e.preHash(m));let{prefix:K,scalar:O,pointBytes:C}=H(u),q=E(ve(K,m),_),M=x.BASE.multiply(q),G=E(ve(M.toRawBytes(),C,m),_),$=Z(q+G*O,n);return new L(M,$).toRawBytes()}function P(m,u,_,K){if(u=ce(u),e.preHash&&(u=e.preHash(u)),!(_ instanceof x))if(_ instanceof Uint8Array||typeof _=="string")_=x.fromHex(_,!1);else throw new Error(`Invalid publicKey: ${_}`);if(m instanceof L)m.assertValidity();else if(m instanceof Uint8Array||typeof m=="string")m=L.fromHex(m);else throw new Error(`Wrong signature: ${m}`);let{r:O,s:C}=m,q=y.BASE.multiplyUnsafe(C),M=E(ve(O.toRawBytes(),_.toRawBytes(),u),K),G=y.fromAffine(_).multiplyUnsafe(M);return y.fromAffine(O).add(G).subtract(q).multiplyUnsafe(e.h).equals(y.ZERO)}x.BASE._setWindowSize(8);let D={getExtendedPublicKey:H,mod:f,invert:t.invert,hashToPrivateScalar:m=>ss(m,n,!0),randomPrivateKey:()=>o(i),precompute(m=8,u=x.BASE){let _=u.equals(x.BASE)?u:new x(u.x,u.y);return _._setWindowSize(m),_.multiply(Ft),_}};return{CURVE:e,getPublicKey:N,sign:g,verify:P,ExtendedPoint:y,Point:x,Signature:L,utils:D}}var Pt=BigInt(0),In=BigInt(1);function sf(r){for(let e of["a24"])if(typeof r[e]!="bigint")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["montgomeryBits","nByteLength"])if(r[e]!==void 0&&!Number.isSafeInteger(r[e]))throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["adjustScalarBytes","domain","powPminus2"])if(r[e]!==void 0&&typeof r[e]!="function")throw new Error(`Invalid ${e} function`);for(let e of["Gu"])if(r[e]!==void 0&&typeof r[e]!="string")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);return Object.freeze({...r})}function qr(r){let e=sf(r),{P:t}=e,n=S=>Z(S,t),i=e.montgomeryBits,s=Math.ceil(i/8),a=e.nByteLength,o=e.adjustScalarBytes||(S=>S),f=e.powPminus2||(S=>Gt(S,t-BigInt(2),t));function c(S,I,x=!0){if(!I)throw new TypeError("Specify max value");if(typeof S=="number"&&Number.isSafeInteger(S)&&(S=BigInt(S)),typeof S=="bigint"&&S<I){if(x){if(Pt<S)return S}else if(Pt<=S)return S}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function h(S,I,x){let L=n(S*(I-x));return I=n(I-L),x=n(x+L),[I,x]}function l(S,I){let{P:x}=e,L=c(S,x),z=c(I,x),j=e.a24,p=L,d=In,H=Pt,N=L,A=In,E=Pt,g;for(let D=BigInt(i-1);D>=Pt;D--){let m=z>>D&In;E^=m,g=h(E,d,N),d=g[0],N=g[1],g=h(E,H,A),H=g[0],A=g[1],E=m;let u=d+H,_=n(u*u),K=d-H,O=n(K*K),C=_-O,q=N+A,M=N-A,G=n(M*u),$=n(q*K),J=G+$,W=G-$;N=n(J*J),A=n(p*n(W*W)),d=n(_*O),H=n(C*(_+n(j*C)))}g=h(E,d,N),d=g[0],N=g[1],g=h(E,H,A),H=g[0],A=g[1];let P=f(H);return n(d*P)}function b(S){return Pe(n(S),s)}function w(S){let I=ce(S,s);return I[a-1]&=127,me(I)}function v(S){let I=ce(S);if(I.length!==s&&I.length!==a)throw new Error(`Expected ${s} or ${a} bytes, got ${I.length}`);return me(o(I))}function y(S,I){let x=w(I),L=v(S),z=l(x,L);if(z===Pt)throw new Error("Invalid private or public key received");return b(z)}function B(S){return y(S,e.Gu)}return{scalarMult:y,scalarMultBase:B,getSharedSecret:(S,I)=>y(S,I),getPublicKey:S=>B(S),Gu:e.Gu}}var Zt=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ws=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),of=BigInt(0),Ne=BigInt(1),Mr=BigInt(2),af=BigInt(5),ps=BigInt(10),ff=BigInt(20),cf=BigInt(40),ys=BigInt(80);function vs(r){let e=Zt,n=r*r%e*r%e,i=te(n,Mr,e)*n%e,s=te(i,Ne,e)*r%e,a=te(s,af,e)*s%e,o=te(a,ps,e)*a%e,f=te(o,ff,e)*o%e,c=te(f,cf,e)*f%e,h=te(c,ys,e)*c%e,l=te(h,ys,e)*c%e,b=te(l,ps,e)*a%e;return{pow_p_5_8:te(b,Mr,e)*r%e,b2:n}}function Es(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function On(r,e){let t=Zt,n=Z(e*e*e,t),i=Z(n*n*e,t),s=vs(r*i).pow_p_5_8,a=Z(r*n*s,t),o=Z(e*a*a,t),f=a,c=Z(a*ws,t),h=o===r,l=o===Z(-r,t),b=o===Z(-r*ws,t);return h&&(a=f),(l||b)&&(a=c),ze(a,t)&&(a=Z(-a,t)),{isValid:h||l,value:a}}var U=jr(Zt,void 0,!0),hf=(U.ORDER+BigInt(3))/BigInt(8),uf=U.pow(Mr,hf),xs=U.sqrt(U.negate(U.ONE)),lf=(U.ORDER-BigInt(5))/BigInt(8),_s=BigInt(486662);function df(r){let e=U.square(r);e=U.mul(e,Mr);let t=U.add(e,U.ONE),n=U.negate(_s),i=U.square(t),s=U.mul(i,t),a=U.mul(e,_s);a=U.mul(a,n),a=U.add(a,i),a=U.mul(a,n);let o=U.square(s);i=U.square(o),o=U.mul(o,s),o=U.mul(o,a),i=U.mul(i,o);let f=U.pow(i,lf);f=U.mul(f,o);let c=U.mul(f,xs);i=U.square(f),i=U.mul(i,s);let h=U.equals(i,a),l=U.cmov(c,f,h),b=U.mul(n,e),w=U.mul(f,r);w=U.mul(w,uf);let v=U.mul(w,xs),y=U.mul(a,e);i=U.square(w),i=U.mul(i,s);let B=U.equals(i,y),S=U.cmov(v,w,B);i=U.square(l),i=U.mul(i,s);let I=U.equals(i,a),x=U.cmov(b,n,I),L=U.cmov(S,l,I),z=U.isOdd(L);return L=U.cmov(L,U.negate(L),I!==z),{xMn:x,xMd:t,yMn:L,yMd:1n}}var bf=ls(U,U.negate(BigInt(486664)));function wf(r){let{xMn:e,xMd:t,yMn:n,yMd:i}=df(r),s=U.mul(e,i);s=U.mul(s,bf);let a=U.mul(t,n),o=U.sub(e,t),f=U.add(e,t),c=U.mul(a,f),h=U.equals(c,U.ZERO);s=U.cmov(s,U.ZERO,h),a=U.cmov(a,U.ONE,h),o=U.cmov(o,U.ONE,h),f=U.cmov(f,U.ONE,h);let l=U.invertBatch([a,f]);return{x:U.mul(s,l[0]),y:U.mul(o,l[1])}}var Kn={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:U,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Cr,randomBytes:Tr,adjustScalarBytes:Es,uvRatio:On,htfDefaults:{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",p:U.ORDER,m:1,k:128,expand:"xmd",hash:Cr},mapToCurve:r=>wf(r[0])},he=ct(Kn);function Ss(r,e,t){if(e.length>255)throw new Error("Context is too big");return Kr(Mt("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,r)}var s0=ct({...Kn,domain:Ss}),o0=ct({...Kn,domain:Ss,preHash:Cr}),Tn=qr({P:Zt,a24:BigInt("121665"),montgomeryBits:255,nByteLength:32,Gu:"0900000000000000000000000000000000000000000000000000000000000000",powPminus2:r=>{let e=Zt,{pow_p_5_8:t,b2:n}=vs(r);return Z(te(t,BigInt(3),e)*n,e)},adjustScalarBytes:Es});function Ln(r){if(!(r instanceof be))throw new TypeError("RistrettoPoint expected")}var Hn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),pf=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),yf=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),xf=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),_f=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),gs=r=>On(Ne,r),gf=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Un=r=>he.utils.mod(me(r)&gf);function ms(r){let{d:e}=he.CURVE,t=he.CURVE.Fp.ORDER,{mod:n}=he.utils,i=n(Hn*r*r),s=n((i+Ne)*xf),a=BigInt(-1),o=n((a-e*i)*n(i+e)),{isValid:f,value:c}=On(s,o),h=n(c*r);ze(h,t)||(h=n(-h)),f||(c=h),f||(a=i);let l=n(a*(i-Ne)*_f-o),b=c*c,w=n((c+c)*o),v=n(l*pf),y=n(Ne-b),B=n(Ne+b);return new he.ExtendedPoint(n(w*B),n(y*v),n(v*B),n(w*y))}var be=class{constructor(e){this.ep=e}static hashToCurve(e){e=ce(e,64);let t=Un(e.slice(0,32)),n=ms(t),i=Un(e.slice(32,64)),s=ms(i);return new be(n.add(s))}static fromHex(e){e=ce(e,32);let{a:t,d:n}=he.CURVE,i=he.CURVE.Fp.ORDER,{mod:s}=he.utils,a="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",o=Un(e);if(!os(Pe(o,32),e)||ze(o,i))throw new Error(a);let f=s(o*o),c=s(Ne+t*f),h=s(Ne-t*f),l=s(c*c),b=s(h*h),w=s(t*n*l-b),{isValid:v,value:y}=gs(s(w*b)),B=s(y*h),S=s(y*B*w),I=s((o+o)*B);ze(I,i)&&(I=s(-I));let x=s(c*S),L=s(I*x);if(!v||ze(L,i)||x===of)throw new Error(a);return new be(new he.ExtendedPoint(I,x,Ne,L))}toRawBytes(){let{x:e,y:t,z:n,t:i}=this.ep,s=he.CURVE.Fp.ORDER,{mod:a}=he.utils,o=a(a(n+t)*a(n-t)),f=a(e*t),c=a(f*f),{value:h}=gs(a(o*c)),l=a(h*o),b=a(h*f),w=a(l*b*i),v;if(ze(i*w,s)){let B=a(t*Hn),S=a(e*Hn);e=B,t=S,v=a(l*yf)}else v=b;ze(e*w,s)&&(t=a(-t));let y=a((n-t)*v);return ze(y,s)&&(y=a(-y)),Pe(y,32)}toHex(){return at(this.toRawBytes())}toString(){return this.toHex()}equals(e){Ln(e);let t=this.ep,n=e.ep,{mod:i}=he.utils,s=i(t.x*n.y)===i(t.y*n.x),a=i(t.y*n.y)===i(t.x*n.x);return s||a}add(e){return Ln(e),new be(this.ep.add(e.ep))}subtract(e){return Ln(e),new be(this.ep.subtract(e.ep))}multiply(e){return new be(this.ep.multiply(e))}multiplyUnsafe(e){return new be(this.ep.multiplyUnsafe(e))}};be.BASE=new be(he.ExtendedPoint.BASE);be.ZERO=new be(he.ExtendedPoint.ZERO);var $t="X25519",Gr=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=32,this._nSk=32}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=he.utils.randomPrivateKey(),t=new ie($t,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(Y,je,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,lt,Y,this._nSk),i=new ie($t,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie($t,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie($t,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=Tn.getPublicKey(e.key);t(new ie($t,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(Tn.getSharedSecret(e.key,t.key).buffer)}catch(s){i(s)}})}};var[Bs,Ps,Is]=[[],[],[]],mf=BigInt(0),Vt=BigInt(1),vf=BigInt(2),Ef=BigInt(7),Sf=BigInt(256),Af=BigInt(113);for(let r=0,e=Vt,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Bs.push(2*(5*n+t)),Ps.push((r+1)*(r+2)/2%64);let i=mf;for(let s=0;s<7;s++)e=(e<<Vt^(e>>Ef)*Af)%Sf,e&vf&&(i^=Vt<<(Vt<<BigInt(s))-Vt);Is.push(i)}var[kf,Bf]=R.split(Is,!0),As=(r,e,t)=>t>32?R.rotlBH(r,e,t):R.rotlSH(r,e,t),ks=(r,e,t)=>t>32?R.rotlBL(r,e,t):R.rotlSL(r,e,t);function Pf(r,e=24){let t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let a=0;a<10;a++)t[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){let o=(a+8)%10,f=(a+2)%10,c=t[f],h=t[f+1],l=As(c,h,1)^t[o],b=ks(c,h,1)^t[o+1];for(let w=0;w<50;w+=10)r[a+w]^=l,r[a+w+1]^=b}let i=r[2],s=r[3];for(let a=0;a<24;a++){let o=Ps[a],f=As(i,s,o),c=ks(i,s,o),h=Bs[a];i=r[h],s=r[h+1],r[h]=f,r[h+1]=c}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=r[a+o];for(let o=0;o<10;o++)r[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}r[0]^=kf[n],r[1]^=Bf[n]}t.fill(0)}var It=class extends At{constructor(e,t,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Be.number(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=es(this.state)}keccak(){Pf(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Be.exists(this);let{blockLen:t,state:n}=this;e=kt(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(t-this.pos,i-s);for(let o=0;o<a;o++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,t&128&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Be.exists(this,!1),Be.bytes(e),this.finish();let t=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+a),i),this.posOut+=a,i+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Be.number(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Be.output(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:n,outputLen:i,rounds:s,enableXOF:a}=this;return e||(e=new It(t,n,i,a,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=a,e.destroyed=this.destroyed,e}},Xe=(r,e,t)=>Le(()=>new It(e,r,t)),b0=Xe(6,144,224/8),w0=Xe(6,136,256/8),p0=Xe(6,104,384/8),y0=Xe(6,72,512/8),x0=Xe(1,144,224/8),_0=Xe(1,136,256/8),g0=Xe(1,104,384/8),m0=Xe(1,72,512/8),Ls=(r,e,t)=>ts((n={})=>new It(e,r,n.dkLen===void 0?t:n.dkLen,!0)),v0=Ls(31,168,128/8),Fr=Ls(31,136,256/8);var If=Le(()=>Fr.create({dkLen:114})),Lf=Le(()=>Fr.create({dkLen:64})),Xt=BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018365439");function Hs(r){let e=Xt,t=BigInt(1),n=BigInt(2),i=BigInt(3),s=BigInt(11),a=BigInt(22),o=BigInt(44),f=BigInt(88),c=BigInt(223),h=r*r*r%e,l=h*h*r%e,b=te(l,i,e)*l%e,w=te(b,i,e)*l%e,v=te(w,n,e)*h%e,y=te(v,s,e)*v%e,B=te(y,a,e)*y%e,S=te(B,o,e)*B%e,I=te(S,f,e)*S%e,x=te(I,o,e)*B%e,L=te(x,n,e)*h%e,z=te(L,t,e)*r%e;return te(z,c,e)*L%e}function Os(r){return r[0]&=252,r[55]|=128,r[56]=0,r}var k=jr(Xt,456,!0),Uf=(k.ORDER-BigInt(3))/BigInt(4),Us=BigInt(156326);function Hf(r){let e=k.square(r),t=k.equals(e,k.ONE);e=k.cmov(e,k.ZERO,t);let n=k.sub(k.ONE,e),i=k.negate(Us),s=k.square(n),a=k.mul(s,n),o=k.mul(e,k.negate(Us));o=k.mul(o,i),o=k.add(o,s),o=k.mul(o,i);let f=k.square(a);s=k.mul(o,a),f=k.mul(f,s);let c=k.pow(f,Uf);c=k.mul(c,s);let h=k.mul(i,k.negate(e)),l=k.mul(c,r);l=k.cmov(l,k.ZERO,t),s=k.square(c),s=k.mul(s,a);let b=k.equals(s,o),w=k.cmov(h,i,b),v=k.cmov(l,c,b),y=k.isOdd(v);return v=k.cmov(v,k.negate(v),b!==y),{xn:w,xd:n,yn:v,yd:k.ONE}}function Of(r){let{xn:e,xd:t,yn:n,yd:i}=Hf(r),s=k.square(e),a=k.square(t),o=k.square(a),f=k.square(n),c=k.square(i),h=k.sub(s,a),l=k.sub(h,a);h=k.mul(h,a),h=k.mul(h,i),h=k.mul(h,n),h=k.mul(h,4n),l=k.mul(l,s),l=k.mul(l,c);let b=k.mul(f,4n),w=k.add(b,c);w=k.mul(w,o);let v=k.add(w,l);l=k.mul(l,e);let y=k.mul(e,o),B=k.sub(b,c);B=k.mul(B,y),B=k.sub(B,l),w=k.add(s,a),w=k.mul(w,a),w=k.mul(w,t),w=k.mul(w,f),w=k.mul(w,BigInt(-2));let S=k.add(l,w);y=k.mul(y,c),S=k.add(S,y),w=k.mul(v,S);let I=k.equals(w,k.ZERO);h=k.cmov(h,k.ZERO,I),v=k.cmov(v,k.ONE,I),B=k.cmov(B,k.ONE,I),S=k.cmov(S,k.ONE,I);let x=k.invertBatch([v,S]);return{x:k.mul(h,x[0]),y:k.mul(B,x[1])}}var Ks={a:BigInt(1),d:BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018326358"),Fp:k,n:BigInt("181709681073901722637330951972001133588410340171829515070372549795146003961539585716195755291692375963310293709091662304773755859649779"),nBitLength:456,h:BigInt(4),Gx:BigInt("224580040295924300187604334099896036246789641632564134246125461686950415467406032909029192869357953282578032075146446173674602635247710"),Gy:BigInt("298819210078481492676017930443930673437544040154080242095928241372331506189835876003536878655418784733982303233503462500531545062832660"),hash:If,randomBytes:Tr,adjustScalarBytes:Os,domain:(r,e,t)=>{if(e.length>255)throw new Error(`Context is too big: ${e.length}`);return Kr(Mt("SigEd448"),new Uint8Array([t?1:0,e.length]),e,r)},uvRatio:(r,e)=>{let t=Xt,n=Z(r*r*e,t),i=Z(n*r,t),s=Z(i*n*e,t),a=Hs(s),o=Z(i*a,t),f=Z(o*o,t);return{isValid:Z(f*e,t)===r,value:o}},htfDefaults:{DST:"edwards448_XOF:SHAKE256_ELL2_RO_",p:k.ORDER,m:1,k:224,expand:"xof",hash:Fr},mapToCurve:r=>Of(r[0])},Ts=ct(Ks),I0=ct({...Ks,preHash:Lf}),zn=qr({a24:BigInt(39081),montgomeryBits:448,nByteLength:57,P:Xt,Gu:"0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",powPminus2:r=>{let e=Xt,t=Hs(r),n=te(t,BigInt(2),e);return Z(n*r,e)},adjustScalarBytes:Os});var Yt="X448",Zr=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=Ts.utils.randomPrivateKey(),t=new ie(Yt,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(Y,je,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,lt,Y,this._nSk),i=new ie(Yt,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie(Yt,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie(Yt,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=zn.getPublicKey(e.key);t(new ie(Yt,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(zn.getSharedSecret(e.key,t.key).buffer)}catch(s){i(s)}})}};var Ye=class extends De{constructor(e,t,n){super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=t,this._kdf=n}async generateKeyPair(){try{return await this._prim.generateKeyPair()}catch(e){throw new Se(e)}}async deriveKeyPair(e){try{return await this._prim.deriveKeyPair(e)}catch(t){throw new nr(t)}}async serializePublicKey(e){try{return await this._prim.serializePublicKey(e)}catch(t){throw new Qt(t)}}async deserializePublicKey(e){try{return await this._prim.deserializePublicKey(e)}catch(t){throw new ut(t)}}async importKey(e,t,n){try{return await this._prim.importKey(e,t,n)}catch(i){throw new ut(i)}}async encap(e){try{let t=e.nonEphemeralKeyPair===void 0?await this.generateKeyPair():e.nonEphemeralKeyPair,n=await this._prim.serializePublicKey(t.publicKey),i=await this._prim.serializePublicKey(e.recipientPublicKey),s;if(e.senderKey===void 0)s=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey));else{let f=Ut(e.senderKey)?e.senderKey.privateKey:e.senderKey,c=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey)),h=new Uint8Array(await this._prim.dh(f,e.recipientPublicKey));s=Ht(c,h)}let a;if(e.senderKey===void 0)a=Ht(new Uint8Array(n),new Uint8Array(i));else{let f=Ut(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),c=await this._prim.serializePublicKey(f);a=Jn(new Uint8Array(n),new Uint8Array(i),new Uint8Array(c))}let o=await this.generateSharedSecret(s,a);return{enc:n,sharedSecret:o}}catch(t){throw new Jt(t)}}async decap(e){let t;try{t=await this._prim.deserializePublicKey(e.enc)}catch(n){throw new ut(n)}try{let n=Ut(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,i=Ut(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),s=await this._prim.serializePublicKey(i),a;if(e.senderPublicKey===void 0)a=new Uint8Array(await this._prim.dh(n,t));else{let f=new Uint8Array(await this._prim.dh(n,t)),c=new Uint8Array(await this._prim.dh(n,e.senderPublicKey));a=Ht(f,c)}let o;if(e.senderPublicKey===void 0)o=Ht(new Uint8Array(e.enc),new Uint8Array(s));else{let f=await this._prim.serializePublicKey(e.senderPublicKey);o=new Uint8Array(e.enc.byteLength+s.byteLength+f.byteLength),o.set(new Uint8Array(e.enc),0),o.set(new Uint8Array(s),e.enc.byteLength),o.set(new Uint8Array(f),e.enc.byteLength+s.byteLength)}return await this.generateSharedSecret(a,o)}catch(n){throw new er(n)}}async generateSharedSecret(e,t){let n=this._kdf.buildLabeledIkm(ni,e),i=this._kdf.buildLabeledInfo(ai,t,this.secretSize);return await this._kdf.extractAndExpand(Y,n,i,this.secretSize)}},$r=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemP256HkdfSha256,2),3);let n=new Me(e,t),i=new gt(V.DhkemP256HkdfSha256,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},Vr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemP384HkdfSha384,2),3);let n=new _t(e,t),i=new gt(V.DhkemP384HkdfSha384,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}},Xr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemP521HkdfSha512,2),3);let n=new nt(e,t),i=new gt(V.DhkemP521HkdfSha512,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}},Yr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemSecp256K1HkdfSha256,2),3);let n=new Me(e,t),i=new Hr(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemSecp256K1HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},Wr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemX25519HkdfSha256,2),3);let n=new Me(e,t),i=new Gr(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},Qr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(ue(V.DhkemX448HkdfSha512,2),3);let n=new nt(e,t),i=new Zr(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:V.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}};var Nn=class{constructor(e){switch(Object.defineProperty(this,"kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kemSecretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemEncSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPublicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPrivateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadNonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadTagSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.kem){case V.DhkemP256HkdfSha256:this.kemSecretSize=32,this.kemEncSize=65,this.kemPublicKeySize=65,this.kemPrivateKeySize=32;break;case V.DhkemP384HkdfSha384:this.kemSecretSize=48,this.kemEncSize=97,this.kemPublicKeySize=97,this.kemPrivateKeySize=48;break;case V.DhkemP521HkdfSha512:this.kemSecretSize=64,this.kemEncSize=133,this.kemPublicKeySize=133,this.kemPrivateKeySize=66;break;case V.DhkemSecp256K1HkdfSha256:this.kemSecretSize=32,this.kemEncSize=65,this.kemPublicKeySize=65,this.kemPrivateKeySize=32;break;case V.DhkemX25519HkdfSha256:this.kemSecretSize=32,this.kemEncSize=32,this.kemPublicKeySize=32,this.kemPrivateKeySize=32;break;case V.DhkemX448HkdfSha512:this.kemSecretSize=64,this.kemEncSize=56,this.kemPublicKeySize=56,this.kemPrivateKeySize=56;break;default:throw new we("Invalid KEM id")}switch(this.kem=e.kem,e.kdf){case pe.HkdfSha256:case pe.HkdfSha384:case pe.HkdfSha512:break;default:throw new we("Invalid KDF id")}switch(this.kdf=e.kdf,e.aead){case ne.Aes128Gcm:this.aeadKeySize=16,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.Aes256Gcm:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.Chacha20Poly1305:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.ExportOnly:break;default:throw new we("Invalid AEAD id")}this.aead=e.aead,this._suiteId=new Uint8Array(ri),this._suiteId.set(ue(this.kem,2),4),this._suiteId.set(ue(this.kdf,2),6),this._suiteId.set(ue(this.aead,2),8)}async kemContext(){return await this.setup(),this._kem}async kdfContext(){return await this.setup(),this._kdf}async createAeadKey(e){return await this.setup(),pr(this.aead,e,this._api)}async generateKeyPair(){return await this.setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>128)throw new we("Too long ikm");return await this.setup(),await this._kem.deriveKeyPair(e)}async importKey(e,t,n=!0){return await this.setup(),await this._kem.importKey(e,t,n)}async createSenderContext(e){this.validateInputLength(e),await this.setup();let t=await this._kem.encap(e),n;return e.psk!==void 0?n=e.senderKey!==void 0?Ae.AuthPsk:Ae.Psk:n=e.senderKey!==void 0?Ae.Auth:Ae.Base,await this.keyScheduleS(n,t.sharedSecret,t.enc,e)}async createRecipientContext(e){this.validateInputLength(e),await this.setup();let t=await this._kem.decap(e),n;return e.psk!==void 0?n=e.senderPublicKey!==void 0?Ae.AuthPsk:Ae.Psk:n=e.senderPublicKey!==void 0?Ae.Auth:Ae.Base,await this.keyScheduleR(n,t,e)}async seal(e,t,n=Y){let i=await this.createSenderContext(e);return{ct:await i.seal(t,n),enc:i.enc}}async open(e,t,n=Y){return await(await this.createRecipientContext(e)).open(t,n)}async setup(){this._api=await ei(),(this._kem===void 0||this._kdf===void 0)&&(this._kem=this.createKemContext(),this._kdf=this.createKdfContext())}async keySchedule(e,t,n){let i=this.createKdfContext(),s=n.psk===void 0?Y:new Uint8Array(n.psk.id),a=await i.labeledExtract(Y,si,s),o=n.info===void 0?Y:new Uint8Array(n.info),f=await i.labeledExtract(Y,ii,o),c=new Uint8Array(1+a.byteLength+f.byteLength);c.set(new Uint8Array([e]),0),c.set(new Uint8Array(a),1),c.set(new Uint8Array(f),1+a.byteLength);let h=n.psk===void 0?Y:new Uint8Array(n.psk.key),l=i.buildLabeledIkm(oi,h),b=i.buildLabeledInfo(hi,c,i.hashSize),w=await i.extractAndExpand(t,l,b,i.hashSize);if(this.aead===ne.ExportOnly)return{params:{aead:this.aead,exporterSecret:w},kdf:i};let v=i.buildLabeledInfo(fi,c,this.aeadKeySize),y=await i.extractAndExpand(t,l,v,this.aeadKeySize),B=i.buildLabeledInfo(ci,c,this.aeadNonceSize),S=await i.extractAndExpand(t,l,B,this.aeadNonceSize);return{params:{aead:this.aead,exporterSecret:w,key:y,baseNonce:new Uint8Array(S),seq:0},kdf:i}}async keyScheduleS(e,t,n,i){let s=await this.keySchedule(e,t,i);return s.params.key===void 0?new sr(this._api,s.kdf,s.params.exporterSecret,n):new gr(this._api,s.kdf,s.params,n)}async keyScheduleR(e,t,n){let i=await this.keySchedule(e,t,n);return i.params.key===void 0?new ir(this._api,i.kdf,i.params.exporterSecret):new _r(this._api,i.kdf,i.params)}validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>128)throw new we("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new we(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>128)throw new we("Too long psk.key");if(e.psk.id.byteLength>128)throw new we("Too long psk.id")}}createKemContext(){switch(this.kem){case V.DhkemP256HkdfSha256:return new $r(this._api);case V.DhkemP384HkdfSha384:return new Vr(this._api);case V.DhkemP521HkdfSha512:return new Xr(this._api);case V.DhkemX25519HkdfSha256:return new Wr(this._api);case V.DhkemX448HkdfSha512:return new Qr(this._api);default:return new Yr(this._api)}}createKdfContext(){switch(this.kdf){case pe.HkdfSha256:return new Me(this._api,this._suiteId);case pe.HkdfSha384:return new _t(this._api,this._suiteId);default:return new nt(this._api,this._suiteId)}}};export{ne as Aead,Nn as CipherSuite,er as DecapError,nr as DeriveKeyPairError,ut as DeserializeError,Jt as EncapError,tr as ExportError,we as InvalidParamError,pe as Kdf,V as Kem,rr as MessageLimitReachedError,Se as NotSupportedError,et as OpenError,Je as SealError,Qt as SerializeError,Vn as ValidationError};
/*! Bundled license information:

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/group.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/hash-to-curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/ed448.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
