var bt=e=>e instanceof Uint8Array;var z=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),ht=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),mt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mt)throw new Error("Non little-endian hardware is not supported");function Q(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function tt(e){if(typeof e=="string"&&(e=Q(e)),!bt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var Ut=e=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function at(e,t){if(t!==void 0&&(typeof t!="object"||!Ut(t)))throw new Error("Options should be object or undefined");return Object.assign(e,t)}function Z(e,t){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof t=="number"&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}function lt(e,t){if(e.length!==t.length)throw new Error("equalBytes: Different size of Uint8Arrays");let o=!0;for(let r=0;r<e.length;r++)o&&(o=e[r]===t[r]);return o}function rt(e,t,o,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,o,r);let c=BigInt(32),s=BigInt(4294967295),i=Number(o>>c&s),n=Number(o&s),x=r?4:0,l=r?0:4;e.setUint32(t+x,i,r),e.setUint32(t+l,n,r)}function nt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function At(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function ut(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Et(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");nt(e.outputLen),nt(e.blockLen)}function Lt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function _t(e,t){ut(e);let o=t.outputLen;if(e.length<o)throw new Error(`digestInto() expects output buffer of length at least ${o}`)}var St={number:nt,bool:At,bytes:ut,hash:Et,exists:Lt,output:_t},R=St;var K=(e,t)=>e[t++]&255|(e[t++]&255)<<8,ot=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=tt(t),Z(t,32);let o=K(t,0),r=K(t,2),c=K(t,4),s=K(t,6),i=K(t,8),n=K(t,10),x=K(t,12),l=K(t,14);this.r[0]=o&8191,this.r[1]=(o>>>13|r<<3)&8191,this.r[2]=(r>>>10|c<<6)&7939,this.r[3]=(c>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|n<<2)&8191,this.r[7]=(n>>>11|x<<5)&8065,this.r[8]=(x>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let a=0;a<8;a++)this.pad[a]=K(t,16+2*a)}process(t,o,r=!1){let c=r?0:2048,{h:s,r:i}=this,n=i[0],x=i[1],l=i[2],a=i[3],w=i[4],p=i[5],m=i[6],d=i[7],y=i[8],U=i[9],k=K(t,o+0),H=K(t,o+2),O=K(t,o+4),$=K(t,o+6),j=K(t,o+8),g=K(t,o+10),T=K(t,o+12),v=K(t,o+14),u=s[0]+(k&8191),E=s[1]+((k>>>13|H<<3)&8191),L=s[2]+((H>>>10|O<<6)&8191),b=s[3]+((O>>>7|$<<9)&8191),A=s[4]+(($>>>4|j<<12)&8191),_=s[5]+(j>>>1&8191),S=s[6]+((j>>>14|g<<2)&8191),B=s[7]+((g>>>11|T<<5)&8191),I=s[8]+((T>>>8|v<<8)&8191),C=s[9]+(v>>>5|c),h=0,N=h+u*n+E*(5*U)+L*(5*y)+b*(5*d)+A*(5*m);h=N>>>13,N&=8191,N+=_*(5*p)+S*(5*w)+B*(5*a)+I*(5*l)+C*(5*x),h+=N>>>13,N&=8191;let M=h+u*x+E*n+L*(5*U)+b*(5*y)+A*(5*d);h=M>>>13,M&=8191,M+=_*(5*m)+S*(5*p)+B*(5*w)+I*(5*a)+C*(5*l),h+=M>>>13,M&=8191;let P=h+u*l+E*x+L*n+b*(5*U)+A*(5*y);h=P>>>13,P&=8191,P+=_*(5*d)+S*(5*m)+B*(5*p)+I*(5*w)+C*(5*a),h+=P>>>13,P&=8191;let D=h+u*a+E*l+L*x+b*n+A*(5*U);h=D>>>13,D&=8191,D+=_*(5*y)+S*(5*d)+B*(5*m)+I*(5*p)+C*(5*w),h+=D>>>13,D&=8191;let F=h+u*w+E*a+L*l+b*x+A*n;h=F>>>13,F&=8191,F+=_*(5*U)+S*(5*y)+B*(5*d)+I*(5*m)+C*(5*p),h+=F>>>13,F&=8191;let q=h+u*p+E*w+L*a+b*l+A*x;h=q>>>13,q&=8191,q+=_*n+S*(5*U)+B*(5*y)+I*(5*d)+C*(5*m),h+=q>>>13,q&=8191;let G=h+u*m+E*p+L*w+b*a+A*l;h=G>>>13,G&=8191,G+=_*x+S*n+B*(5*U)+I*(5*y)+C*(5*d),h+=G>>>13,G&=8191;let V=h+u*d+E*m+L*p+b*w+A*a;h=V>>>13,V&=8191,V+=_*l+S*x+B*n+I*(5*U)+C*(5*y),h+=V>>>13,V&=8191;let W=h+u*y+E*d+L*m+b*p+A*w;h=W>>>13,W&=8191,W+=_*a+S*l+B*x+I*n+C*(5*U),h+=W>>>13,W&=8191;let X=h+u*U+E*y+L*d+b*m+A*p;h=X>>>13,X&=8191,X+=_*w+S*a+B*l+I*x+C*n,h+=X>>>13,X&=8191,h=(h<<2)+h|0,h=h+N|0,N=h&8191,h=h>>>13,M+=h,s[0]=N,s[1]=M,s[2]=P,s[3]=D,s[4]=F,s[5]=q,s[6]=G,s[7]=V,s[8]=W,s[9]=X}finalize(){let{h:t,pad:o}=this,r=new Uint16Array(10),c=t[1]>>>13;t[1]&=8191;for(let n=2;n<10;n++)t[n]+=c,c=t[n]>>>13,t[n]&=8191;t[0]+=c*5,c=t[0]>>>13,t[0]&=8191,t[1]+=c,c=t[1]>>>13,t[1]&=8191,t[2]+=c,r[0]=t[0]+5,c=r[0]>>>13,r[0]&=8191;for(let n=1;n<10;n++)r[n]=t[n]+c,c=r[n]>>>13,r[n]&=8191;r[9]-=8192;let s=(c^1)-1;for(let n=0;n<10;n++)r[n]&=s;s=~s;for(let n=0;n<10;n++)t[n]=t[n]&s|r[n];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+o[0];t[0]=i&65535;for(let n=1;n<8;n++)i=(t[n]+o[n]|0)+(i>>>16)|0,t[n]=i&65535}update(t){R.exists(this);let{buffer:o,blockLen:r}=this;t=tt(t);let c=t.length;for(let s=0;s<c;){let i=Math.min(r-this.pos,c-s);if(i===r){for(;r<=c-s;s+=r)this.process(t,s);continue}o.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(o,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){R.exists(this),R.output(t,this),this.finished=!0;let{buffer:o,h:r}=this,{pos:c}=this;if(c){for(o[c++]=1;c<16;c++)o[c]=0;this.process(o,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=r[i]>>>0,t[s++]=r[i]>>>8;return t}digest(){let{buffer:t,outputLen:o}=this;this.digestInto(t);let r=t.slice(0,o);return this.destroy(),r}};function Bt(e){let t=(r,c)=>e(c).update(tt(r)).digest(),o=e(new Uint8Array(32));return t.outputLen=o.outputLen,t.blockLen=o.blockLen,t.create=r=>e(r),t}var xt=Bt(e=>new ot(e));var It=Q("expand 16-byte k"),Ct=Q("expand 32-byte k"),Ot=z(It),Pt=z(Ct),pt=e=>!(e.byteOffset%4),Y=e=>{let{core:t,rounds:o,counterRight:r,counterLen:c,allow128bitKeys:s,extendNonceFn:i,blockLen:n}=at({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},e);R.number(c),R.number(o),R.number(n),R.bool(r),R.bool(s);let x=n/4;if(n%4!==0)throw new Error("Salsa/ChaCha: blockLen should be aligned to 4 bytes");return(l,a,w,p,m=0)=>{if(R.bytes(l),R.bytes(a),R.bytes(w),p||(p=new Uint8Array(w.length)),R.bytes(p),R.number(m),m<0||m>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(p.length<w.length)throw new Error(`Salsa/ChaCha: output (${p.length}) is shorter than data (${w.length})`);let d=[],y,U;if(l.length===32)y=l,U=Pt;else if(l.length===16&&s)y=new Uint8Array(32),y.set(l),y.set(l,16),U=Ot,d.push(y);else throw new Error(`Salsa/ChaCha: wrong key length=${l.length}, expected`);if(i){if(a.length<=16)throw new Error("Salsa/ChaCha: extended nonce should be bigger than 16 bytes");y=i(U,y,a.subarray(0,16),new Uint8Array(32)),d.push(y),a=a.subarray(16)}let k=16-c;if(a.length!==k)throw new Error(`Salsa/ChaCha: nonce should be ${k} or 16 bytes`);if(k!==12){let u=new Uint8Array(12);u.set(a,r?0:12-a.length),d.push(a=u)}let H=new Uint8Array(n),O=z(H),$=z(y),j=z(a),g=pt(w)&&z(w),T=pt(p)&&z(p);d.push(O);let v=w.length;for(let u=0,E=m;u<v;E++){if(t(U,$,j,O,E,o),E>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let L=Math.min(n,v-u);if(L===n&&T&&g){let b=u/4;if(u%4!==0)throw new Error("Salsa/ChaCha: wrong block position");for(let A=0;A<x;A++)T[b+A]=g[b+A]^O[A];u+=n;continue}for(let b=0;b<L;b++)p[u+b]=w[u+b]^H[b];u+=L}for(let u=0;u<d.length;u++)d[u].fill(0);return p}};var f=(e,t)=>e<<t|e>>>32-t;function J(e,t,o,r,c,s=20){let i=e[0],n=e[1],x=e[2],l=e[3],a=t[0],w=t[1],p=t[2],m=t[3],d=t[4],y=t[5],U=t[6],k=t[7],H=c,O=o[0],$=o[1],j=o[2],g=i,T=n,v=x,u=l,E=a,L=w,b=p,A=m,_=d,S=y,B=U,I=k,C=H,h=O,N=$,M=j;for(let D=0;D<s;D+=2)g=g+E|0,C=f(C^g,16),_=_+C|0,E=f(E^_,12),g=g+E|0,C=f(C^g,8),_=_+C|0,E=f(E^_,7),T=T+L|0,h=f(h^T,16),S=S+h|0,L=f(L^S,12),T=T+L|0,h=f(h^T,8),S=S+h|0,L=f(L^S,7),v=v+b|0,N=f(N^v,16),B=B+N|0,b=f(b^B,12),v=v+b|0,N=f(N^v,8),B=B+N|0,b=f(b^B,7),u=u+A|0,M=f(M^u,16),I=I+M|0,A=f(A^I,12),u=u+A|0,M=f(M^u,8),I=I+M|0,A=f(A^I,7),g=g+L|0,M=f(M^g,16),B=B+M|0,L=f(L^B,12),g=g+L|0,M=f(M^g,8),B=B+M|0,L=f(L^B,7),T=T+b|0,C=f(C^T,16),I=I+C|0,b=f(b^I,12),T=T+b|0,C=f(C^T,8),I=I+C|0,b=f(b^I,7),v=v+A|0,h=f(h^v,16),_=_+h|0,A=f(A^_,12),v=v+A|0,h=f(h^v,8),_=_+h|0,A=f(A^_,7),u=u+E|0,N=f(N^u,16),S=S+N|0,E=f(E^S,12),u=u+E|0,N=f(N^u,8),S=S+N|0,E=f(E^S,7);let P=0;r[P++]=i+g|0,r[P++]=n+T|0,r[P++]=x+v|0,r[P++]=l+u|0,r[P++]=a+E|0,r[P++]=w+L|0,r[P++]=p+b|0,r[P++]=m+A|0,r[P++]=d+_|0,r[P++]=y+S|0,r[P++]=U+B|0,r[P++]=k+I|0,r[P++]=H+C|0,r[P++]=O+h|0,r[P++]=$+N|0,r[P++]=j+M|0}function kt(e,t,o,r){let c=z(t),s=z(o),i=z(r),n=e[0],x=e[1],l=e[2],a=e[3],w=c[0],p=c[1],m=c[2],d=c[3],y=c[4],U=c[5],k=c[6],H=c[7],O=s[0],$=s[1],j=s[2],g=s[3];for(let T=0;T<20;T+=2)n=n+w|0,O=f(O^n,16),y=y+O|0,w=f(w^y,12),n=n+w|0,O=f(O^n,8),y=y+O|0,w=f(w^y,7),x=x+p|0,$=f($^x,16),U=U+$|0,p=f(p^U,12),x=x+p|0,$=f($^x,8),U=U+$|0,p=f(p^U,7),l=l+m|0,j=f(j^l,16),k=k+j|0,m=f(m^k,12),l=l+m|0,j=f(j^l,8),k=k+j|0,m=f(m^k,7),a=a+d|0,g=f(g^a,16),H=H+g|0,d=f(d^H,12),a=a+d|0,g=f(g^a,8),H=H+g|0,d=f(d^H,7),n=n+p|0,g=f(g^n,16),k=k+g|0,p=f(p^k,12),n=n+p|0,g=f(g^n,8),k=k+g|0,p=f(p^k,7),x=x+m|0,O=f(O^x,16),H=H+O|0,m=f(m^H,12),x=x+m|0,O=f(O^x,8),H=H+O|0,m=f(m^H,7),l=l+d|0,$=f($^l,16),y=y+$|0,d=f(d^y,12),l=l+d|0,$=f($^l,8),y=y+$|0,d=f(d^y,7),a=a+w|0,j=f(j^a,16),U=U+j|0,w=f(w^U,12),a=a+w|0,j=f(j^a,8),U=U+j|0,w=f(w^U,7);return i[0]=n,i[1]=x,i[2]=l,i[3]=a,i[4]=O,i[5]=$,i[6]=j,i[7]=g,r}var Xt=Y({core:J,counterRight:!1,counterLen:8}),jt=Y({core:J,counterRight:!1,counterLen:4,allow128bitKeys:!1}),Tt=Y({core:J,counterRight:!1,counterLen:8,extendNonceFn:kt,allow128bitKeys:!1}),Yt=Y({core:J,counterRight:!1,counterLen:4,rounds:8}),Zt=Y({core:J,counterRight:!1,counterLen:4,rounds:12}),Nt=new Uint8Array(16),yt=(e,t)=>{e.update(t);let o=t.length%16;o&&e.update(Nt.subarray(o))},wt=(e,t,o,r,c)=>{let s=e(t,o,new Uint8Array(32)),i=xt.create(s);c&&yt(i,c),yt(i,r);let n=new Uint8Array(16),x=ht(n);rt(x,0,BigInt(c?c.length:0),!0),rt(x,8,BigInt(r.length),!0),i.update(n);let l=i.digest();return s.fill(0),l},dt=e=>(t,o,r)=>(Z(t,32),Z(o),{tagLength:16,encrypt:s=>{let i=new Uint8Array(s.length+16);e(t,o,s,i,1);let n=wt(e,t,o,i.subarray(0,-16),r);return i.set(n,s.length),i},decrypt:s=>{if(s.length<16)throw new Error("Encrypted data should be at least 16");let i=s.subarray(-16),n=s.subarray(0,-16),x=wt(e,t,o,n,r);if(!lt(i,x))throw new Error("Wrong tag");return e(t,o,n,void 0,1)}}),st=dt(jt),Jt=dt(Tt);var Ht=new Uint8Array(0);var ft=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}checkInit(){if(typeof this._api>"u")throw new Error("Not initialized. Call init()")}},et=class extends ft{constructor(){super()}init(t){this._api=t}};var $t={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},gt=$t;var it=class{constructor(t,o){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=t,this._key=new Uint8Array(o)}async seal(t,o,r){return await this._seal(t,o,r)}async open(t,o,r){return await this._open(t,o,r)}_seal(t,o,r){return new Promise(c=>{let s=st(this._key,new Uint8Array(t),new Uint8Array(r)).encrypt(new Uint8Array(o));c(s.buffer)})}_open(t,o,r){return new Promise(c=>{let s=st(this._key,new Uint8Array(t),new Uint8Array(r)).decrypt(new Uint8Array(o));c(s.buffer)})}},ct=class extends et{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:gt.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(t){return new it(this._api,t)}};export{ct as Chacha20Poly1305};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
