var Hs=Object.create;var jn=Object.defineProperty;var Os=Object.getOwnPropertyDescriptor;var Ks=Object.getOwnPropertyNames;var Ts=Object.getPrototypeOf,Ns=Object.prototype.hasOwnProperty;var Te=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var zs=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ks(e))!Ns.call(r,i)&&i!==t&&jn(r,i,{get:()=>e[i],enumerable:!(n=Os(e,i))||n.enumerable});return r};var qn=(r,e,t)=>(t=r!=null?Hs(Ts(r)):{},zs(e||!r||!r.__esModule?jn(t,"default",{value:r,enumerable:!0}):t,r));var hi=Te(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});function js(r,e){var t=r>>>16&65535,n=r&65535,i=e>>>16&65535,s=e&65535;return n*s+(t*s+n*i<<16>>>0)|0}be.mul=Math.imul||js;function qs(r,e){return r+e|0}be.add=qs;function Ms(r,e){return r-e|0}be.sub=Ms;function Gs(r,e){return r<<e|r>>>32-e}be.rotl=Gs;function Fs(r,e){return r<<32-e|r>>>e}be.rotr=Fs;function $s(r){return typeof r=="number"&&isFinite(r)&&Math.floor(r)===r}be.isInteger=Number.isInteger||$s;be.MAX_SAFE_INTEGER=9007199254740991;be.isSafeInteger=function(r){return be.isInteger(r)&&r>=-be.MAX_SAFE_INTEGER&&r<=be.MAX_SAFE_INTEGER}});var en=Te(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});var li=hi();function Zs(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}D.readInt16BE=Zs;function Vs(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}D.readUint16BE=Vs;function Xs(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}D.readInt16LE=Xs;function Ys(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}D.readUint16LE=Ys;function di(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}D.writeUint16BE=di;D.writeInt16BE=di;function wi(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}D.writeUint16LE=wi;D.writeInt16LE=wi;function Yr(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}D.readInt32BE=Yr;function Wr(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}D.readUint32BE=Wr;function Qr(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}D.readInt32LE=Qr;function Jr(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}D.readUint32LE=Jr;function or(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}D.writeUint32BE=or;D.writeInt32BE=or;function ar(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}D.writeUint32LE=ar;D.writeInt32LE=ar;function Ws(r,e){e===void 0&&(e=0);var t=Yr(r,e),n=Yr(r,e+4);return t*4294967296+n-(n>>31)*4294967296}D.readInt64BE=Ws;function Qs(r,e){e===void 0&&(e=0);var t=Wr(r,e),n=Wr(r,e+4);return t*4294967296+n}D.readUint64BE=Qs;function Js(r,e){e===void 0&&(e=0);var t=Qr(r,e),n=Qr(r,e+4);return n*4294967296+t-(t>>31)*4294967296}D.readInt64LE=Js;function eo(r,e){e===void 0&&(e=0);var t=Jr(r,e),n=Jr(r,e+4);return n*4294967296+t}D.readUint64LE=eo;function yi(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),or(r/4294967296>>>0,e,t),or(r>>>0,e,t+4),e}D.writeUint64BE=yi;D.writeInt64BE=yi;function pi(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),ar(r>>>0,e,t),ar(r/4294967296>>>0,e,t+4),e}D.writeUint64LE=pi;D.writeInt64LE=pi;function to(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=r/8+t-1;s>=t;s--)n+=e[s]*i,i*=256;return n}D.readUintBE=to;function ro(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=t;s<t+r/8;s++)n+=e[s]*i,i*=256;return n}D.readUintLE=ro;function no(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!li.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var i=1,s=r/8+n-1;s>=n;s--)t[s]=e/i&255,i*=256;return t}D.writeUintBE=no;function io(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!li.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+r/8;s++)t[s]=e/i&255,i*=256;return t}D.writeUintLE=io;function so(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}D.readFloat32BE=so;function oo(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}D.readFloat32LE=oo;function ao(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}D.readFloat64BE=ao;function co(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}D.readFloat64LE=co;function fo(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}D.writeFloat32BE=fo;function uo(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}D.writeFloat32LE=uo;function ho(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}D.writeFloat64BE=ho;function lo(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}D.writeFloat64LE=lo});var cr=Te(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});function wo(r){for(var e=0;e<r.length;e++)r[e]=0;return r}tn.wipe=wo});var xi=Te(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});var ce=en(),rn=cr(),yo=20;function po(r,e,t){for(var n=1634760805,i=857760878,s=2036477234,o=1797285236,a=t[3]<<24|t[2]<<16|t[1]<<8|t[0],c=t[7]<<24|t[6]<<16|t[5]<<8|t[4],f=t[11]<<24|t[10]<<16|t[9]<<8|t[8],h=t[15]<<24|t[14]<<16|t[13]<<8|t[12],l=t[19]<<24|t[18]<<16|t[17]<<8|t[16],d=t[23]<<24|t[22]<<16|t[21]<<8|t[20],w=t[27]<<24|t[26]<<16|t[25]<<8|t[24],x=t[31]<<24|t[30]<<16|t[29]<<8|t[28],p=e[3]<<24|e[2]<<16|e[1]<<8|e[0],S=e[7]<<24|e[6]<<16|e[5]<<8|e[4],m=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],b=n,A=i,L=s,j=o,K=a,I=c,U=f,z=h,Y=l,Z=d,q=w,re=x,G=p,g=S,u=m,y=E,P=0;P<yo;P+=2)b=b+K|0,G^=b,G=G>>>32-16|G<<16,Y=Y+G|0,K^=Y,K=K>>>32-12|K<<12,A=A+I|0,g^=A,g=g>>>32-16|g<<16,Z=Z+g|0,I^=Z,I=I>>>32-12|I<<12,L=L+U|0,u^=L,u=u>>>32-16|u<<16,q=q+u|0,U^=q,U=U>>>32-12|U<<12,j=j+z|0,y^=j,y=y>>>32-16|y<<16,re=re+y|0,z^=re,z=z>>>32-12|z<<12,L=L+U|0,u^=L,u=u>>>32-8|u<<8,q=q+u|0,U^=q,U=U>>>32-7|U<<7,j=j+z|0,y^=j,y=y>>>32-8|y<<8,re=re+y|0,z^=re,z=z>>>32-7|z<<7,A=A+I|0,g^=A,g=g>>>32-8|g<<8,Z=Z+g|0,I^=Z,I=I>>>32-7|I<<7,b=b+K|0,G^=b,G=G>>>32-8|G<<8,Y=Y+G|0,K^=Y,K=K>>>32-7|K<<7,b=b+I|0,y^=b,y=y>>>32-16|y<<16,q=q+y|0,I^=q,I=I>>>32-12|I<<12,A=A+U|0,G^=A,G=G>>>32-16|G<<16,re=re+G|0,U^=re,U=U>>>32-12|U<<12,L=L+z|0,g^=L,g=g>>>32-16|g<<16,Y=Y+g|0,z^=Y,z=z>>>32-12|z<<12,j=j+K|0,u^=j,u=u>>>32-16|u<<16,Z=Z+u|0,K^=Z,K=K>>>32-12|K<<12,L=L+z|0,g^=L,g=g>>>32-8|g<<8,Y=Y+g|0,z^=Y,z=z>>>32-7|z<<7,j=j+K|0,u^=j,u=u>>>32-8|u<<8,Z=Z+u|0,K^=Z,K=K>>>32-7|K<<7,A=A+U|0,G^=A,G=G>>>32-8|G<<8,re=re+G|0,U^=re,U=U>>>32-7|U<<7,b=b+I|0,y^=b,y=y>>>32-8|y<<8,q=q+y|0,I^=q,I=I>>>32-7|I<<7;ce.writeUint32LE(b+n|0,r,0),ce.writeUint32LE(A+i|0,r,4),ce.writeUint32LE(L+s|0,r,8),ce.writeUint32LE(j+o|0,r,12),ce.writeUint32LE(K+a|0,r,16),ce.writeUint32LE(I+c|0,r,20),ce.writeUint32LE(U+f|0,r,24),ce.writeUint32LE(z+h|0,r,28),ce.writeUint32LE(Y+l|0,r,32),ce.writeUint32LE(Z+d|0,r,36),ce.writeUint32LE(q+w|0,r,40),ce.writeUint32LE(re+x|0,r,44),ce.writeUint32LE(G+p|0,r,48),ce.writeUint32LE(g+S|0,r,52),ce.writeUint32LE(u+m|0,r,56),ce.writeUint32LE(y+E|0,r,60)}function bi(r,e,t,n,i){if(i===void 0&&(i=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(i===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-e.length,s.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,o=i}for(var a=new Uint8Array(64),c=0;c<t.length;c+=64){po(a,s,r);for(var f=c;f<c+64&&f<t.length;f++)n[f]=t[f]^a[f-c];xo(s,0,o)}return rn.wipe(a),i===0&&rn.wipe(s),n}fr.streamXOR=bi;function bo(r,e,t,n){return n===void 0&&(n=0),rn.wipe(t),bi(r,e,t,t,n)}fr.stream=bo;function xo(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}});var nn=Te(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});function go(r,e,t){return~(r-1)&e|r-1&t}dt.select=go;function mo(r,e){return(r|0)-(e|0)-1>>>31&1}dt.lessOrEqual=mo;function gi(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}dt.compare=gi;function _o(r,e){return r.length===0||e.length===0?!1:gi(r,e)!==0}dt.equal=_o});var _i=Te(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});var Eo=nn(),ur=cr();Le.DIGEST_LENGTH=16;var mi=function(){function r(e){this.digestLength=Le.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var t=e[0]|e[1]<<8;this._r[0]=t&8191;var n=e[2]|e[3]<<8;this._r[1]=(t>>>13|n<<3)&8191;var i=e[4]|e[5]<<8;this._r[2]=(n>>>10|i<<6)&7939;var s=e[6]|e[7]<<8;this._r[3]=(i>>>7|s<<9)&8191;var o=e[8]|e[9]<<8;this._r[4]=(s>>>4|o<<12)&255,this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=(o>>>14|a<<2)&8191;var c=e[12]|e[13]<<8;this._r[7]=(a>>>11|c<<5)&8065;var f=e[14]|e[15]<<8;this._r[8]=(c>>>8|f<<8)&8191,this._r[9]=f>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return r.prototype._blocks=function(e,t,n){for(var i=this._fin?0:2048,s=this._h[0],o=this._h[1],a=this._h[2],c=this._h[3],f=this._h[4],h=this._h[5],l=this._h[6],d=this._h[7],w=this._h[8],x=this._h[9],p=this._r[0],S=this._r[1],m=this._r[2],E=this._r[3],b=this._r[4],A=this._r[5],L=this._r[6],j=this._r[7],K=this._r[8],I=this._r[9];n>=16;){var U=e[t+0]|e[t+1]<<8;s+=U&8191;var z=e[t+2]|e[t+3]<<8;o+=(U>>>13|z<<3)&8191;var Y=e[t+4]|e[t+5]<<8;a+=(z>>>10|Y<<6)&8191;var Z=e[t+6]|e[t+7]<<8;c+=(Y>>>7|Z<<9)&8191;var q=e[t+8]|e[t+9]<<8;f+=(Z>>>4|q<<12)&8191,h+=q>>>1&8191;var re=e[t+10]|e[t+11]<<8;l+=(q>>>14|re<<2)&8191;var G=e[t+12]|e[t+13]<<8;d+=(re>>>11|G<<5)&8191;var g=e[t+14]|e[t+15]<<8;w+=(G>>>8|g<<8)&8191,x+=g>>>5|i;var u=0,y=u;y+=s*p,y+=o*(5*I),y+=a*(5*K),y+=c*(5*j),y+=f*(5*L),u=y>>>13,y&=8191,y+=h*(5*A),y+=l*(5*b),y+=d*(5*E),y+=w*(5*m),y+=x*(5*S),u+=y>>>13,y&=8191;var P=u;P+=s*S,P+=o*p,P+=a*(5*I),P+=c*(5*K),P+=f*(5*j),u=P>>>13,P&=8191,P+=h*(5*L),P+=l*(5*A),P+=d*(5*b),P+=w*(5*E),P+=x*(5*m),u+=P>>>13,P&=8191;var k=u;k+=s*m,k+=o*S,k+=a*p,k+=c*(5*I),k+=f*(5*K),u=k>>>13,k&=8191,k+=h*(5*j),k+=l*(5*L),k+=d*(5*A),k+=w*(5*b),k+=x*(5*E),u+=k>>>13,k&=8191;var O=u;O+=s*E,O+=o*m,O+=a*S,O+=c*p,O+=f*(5*I),u=O>>>13,O&=8191,O+=h*(5*K),O+=l*(5*j),O+=d*(5*L),O+=w*(5*A),O+=x*(5*b),u+=O>>>13,O&=8191;var T=u;T+=s*b,T+=o*E,T+=a*m,T+=c*S,T+=f*p,u=T>>>13,T&=8191,T+=h*(5*I),T+=l*(5*K),T+=d*(5*j),T+=w*(5*L),T+=x*(5*A),u+=T>>>13,T&=8191;var N=u;N+=s*A,N+=o*b,N+=a*E,N+=c*m,N+=f*S,u=N>>>13,N&=8191,N+=h*p,N+=l*(5*I),N+=d*(5*K),N+=w*(5*j),N+=x*(5*L),u+=N>>>13,N&=8191;var C=u;C+=s*L,C+=o*A,C+=a*b,C+=c*E,C+=f*m,u=C>>>13,C&=8191,C+=h*S,C+=l*p,C+=d*(5*I),C+=w*(5*K),C+=x*(5*j),u+=C>>>13,C&=8191;var F=u;F+=s*j,F+=o*L,F+=a*A,F+=c*b,F+=f*E,u=F>>>13,F&=8191,F+=h*m,F+=l*S,F+=d*p,F+=w*(5*I),F+=x*(5*K),u+=F>>>13,F&=8191;var Q=u;Q+=s*K,Q+=o*j,Q+=a*L,Q+=c*A,Q+=f*b,u=Q>>>13,Q&=8191,Q+=h*E,Q+=l*m,Q+=d*S,Q+=w*p,Q+=x*(5*I),u+=Q>>>13,Q&=8191;var W=u;W+=s*I,W+=o*K,W+=a*j,W+=c*L,W+=f*A,u=W>>>13,W&=8191,W+=h*b,W+=l*E,W+=d*m,W+=w*S,W+=x*p,u+=W>>>13,W&=8191,u=(u<<2)+u|0,u=u+y|0,y=u&8191,u=u>>>13,P+=u,s=y,o=P,a=k,c=O,f=T,h=N,l=C,d=F,w=Q,x=W,t+=16,n-=16}this._h[0]=s,this._h[1]=o,this._h[2]=a,this._h[3]=c,this._h[4]=f,this._h[5]=h,this._h[6]=l,this._h[7]=d,this._h[8]=w,this._h[9]=x},r.prototype.finish=function(e,t){t===void 0&&(t=0);var n=new Uint16Array(10),i,s,o,a;if(this._leftover){for(a=this._leftover,this._buffer[a++]=1;a<16;a++)this._buffer[a]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(i=this._h[1]>>>13,this._h[1]&=8191,a=2;a<10;a++)this._h[a]+=i,i=this._h[a]>>>13,this._h[a]&=8191;for(this._h[0]+=i*5,i=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=i,i=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=i,n[0]=this._h[0]+5,i=n[0]>>>13,n[0]&=8191,a=1;a<10;a++)n[a]=this._h[a]+i,i=n[a]>>>13,n[a]&=8191;for(n[9]-=8192,s=(i^1)-1,a=0;a<10;a++)n[a]&=s;for(s=~s,a=0;a<10;a++)this._h[a]=this._h[a]&s|n[a];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,o=this._h[0]+this._pad[0],this._h[0]=o&65535,a=1;a<8;a++)o=(this._h[a]+this._pad[a]|0)+(o>>>16)|0,this._h[a]=o&65535;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},r.prototype.update=function(e){var t=0,n=e.length,i;if(this._leftover){i=16-this._leftover,i>n&&(i=n);for(var s=0;s<i;s++)this._buffer[this._leftover+s]=e[t+s];if(n-=i,t+=i,this._leftover+=i,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(i=n-n%16,this._blocks(e,t,i),t+=i,n-=i),n){for(var s=0;s<n;s++)this._buffer[this._leftover+s]=e[t+s];this._leftover+=n}return this},r.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},r.prototype.clean=function(){return ur.wipe(this._buffer),ur.wipe(this._r),ur.wipe(this._h),ur.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},r}();Le.Poly1305=mi;function vo(r,e){var t=new mi(r);t.update(e);var n=t.digest();return t.clean(),n}Le.oneTimeAuth=vo;function So(r,e){return r.length!==Le.DIGEST_LENGTH||e.length!==Le.DIGEST_LENGTH?!1:Eo.equal(r,e)}Le.equal=So});var Si=Te(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});var hr=xi(),Ao=_i(),It=cr(),Ei=en(),ko=nn();Ue.KEY_LENGTH=32;Ue.NONCE_LENGTH=12;Ue.TAG_LENGTH=16;var vi=new Uint8Array(16),Bo=function(){function r(e){if(this.nonceLength=Ue.NONCE_LENGTH,this.tagLength=Ue.TAG_LENGTH,e.length!==Ue.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return r.prototype.seal=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);hr.stream(this._key,s,o,4);var a=t.length+this.tagLength,c;if(i){if(i.length!==a)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(a);return hr.streamXOR(this._key,s,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),o,c.subarray(0,c.length-this.tagLength),n),It.wipe(s),c},r.prototype.open=function(e,t,n,i){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var s=new Uint8Array(16);s.set(e,s.length-e.length);var o=new Uint8Array(32);hr.stream(this._key,s,o,4);var a=new Uint8Array(this.tagLength);if(this._authenticate(a,o,t.subarray(0,t.length-this.tagLength),n),!ko.equal(a,t.subarray(t.length-this.tagLength,t.length)))return null;var c=t.length-this.tagLength,f;if(i){if(i.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");f=i}else f=new Uint8Array(c);return hr.streamXOR(this._key,s,t.subarray(0,t.length-this.tagLength),f,4),It.wipe(s),f},r.prototype.clean=function(){return It.wipe(this._key),this},r.prototype._authenticate=function(e,t,n,i){var s=new Ao.Poly1305(t);i&&(s.update(i),i.length%16>0&&s.update(vi.subarray(i.length%16))),s.update(n),n.length%16>0&&s.update(vi.subarray(n.length%16));var o=new Uint8Array(8);i&&Ei.writeUint64LE(i.length,o),s.update(o),Ei.writeUint64LE(n.length,o),s.update(o);for(var a=s.digest(),c=0;c<a.length;c++)e[c]=a[c];s.clean(),It.wipe(a),It.wipe(o)},r}();Ue.ChaCha20Poly1305=Bo});var Hi=Te(()=>{});var de=class extends Error{constructor(e){let t;e instanceof Error?t=e.message:typeof e=="string"?t=e:t="",super(t),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message===""?this.message=this.name:this.message=this.name+": "+this.message}},pe=class extends de{},Mn=class extends de{},Xt=class extends de{},ft=class extends de{},Yt=class extends de{},Wt=class extends de{},Qt=class extends de{},Qe=class extends de{},Je=class extends de{},Jt=class extends de{},er=class extends de{},Ie=class extends de{};var Se;(function(r){r[r.Base=0]="Base",r[r.Psk=1]="Psk",r[r.Auth=2]="Auth",r[r.AuthPsk=3]="AuthPsk"})(Se||(Se={}));var M;(function(r){r[r.DhkemP256HkdfSha256=16]="DhkemP256HkdfSha256",r[r.DhkemP384HkdfSha384=17]="DhkemP384HkdfSha384",r[r.DhkemP521HkdfSha512=18]="DhkemP521HkdfSha512",r[r.DhkemSecp256K1HkdfSha256=19]="DhkemSecp256K1HkdfSha256",r[r.DhkemX25519HkdfSha256=32]="DhkemX25519HkdfSha256",r[r.DhkemX448HkdfSha512=33]="DhkemX448HkdfSha512"})(M||(M={}));var we;(function(r){r[r.HkdfSha256=1]="HkdfSha256",r[r.HkdfSha384=2]="HkdfSha384",r[r.HkdfSha512=3]="HkdfSha512"})(we||(we={}));var ne;(function(r){r[r.Aes128Gcm=1]="Aes128Gcm",r[r.Aes256Gcm=2]="Aes256Gcm",r[r.Chacha20Poly1305=3]="Chacha20Poly1305",r[r.ExportOnly=65535]="ExportOnly"})(ne||(ne={}));var Cs={},Gn=Ds(globalThis,Cs);function Ds(r,e){return new Proxy(r,{get(t,n,i){return n in e?e[n]:r[n]},set(t,n,i){return n in e&&delete e[n],r[n]=i,!0},deleteProperty(t,n){let i=!1;return n in e&&(delete e[n],i=!0),n in r&&(delete r[n],i=!0),i},ownKeys(t){let n=Reflect.ownKeys(r),i=Reflect.ownKeys(e),s=new Set(i);return[...n.filter(o=>!s.has(o)),...i]},defineProperty(t,n,i){return n in e&&delete e[n],Reflect.defineProperty(r,n,i),!0},getOwnPropertyDescriptor(t,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(r,n)},has(t,n){return n in e||n in r}})}var Fn=()=>typeof Gn<"u",$n=()=>typeof caches<"u";var Bt=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function le(r,e){if(e<=0)throw new Error("i2Osp: too small size");if(r>=256**e)throw new Error("i2Osp: too large integer");let t=new Uint8Array(e);for(let n=0;n<e&&r;n++)t[e-(n+1)]=r%256,r=r>>8;return t}function Zn(r,e){if(r.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let t=new Uint8Array(r.byteLength);for(let n=0;n<r.byteLength;n++)t[n]=r[n]^e[n];return t}function Pt(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r,0),t.set(e,r.length),t}function Vn(r,e,t){let n=new Uint8Array(r.length+e.length+t.length);return n.set(r,0),n.set(e,r.length),n.set(t,r.length+e.length),n}var Ne=class{constructor(e){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e}};async function Xn(){if((Fn()||$n())&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:r}=await import("crypto");return r.subtle}catch{throw new Ie("Web Cryptograph API not supported")}}var ze=["deriveBits"],Yn=["encrypt","decrypt"];var V=new Uint8Array(0),Xr=new Uint8Array([72,80,75,69,45,118,49]),Wn=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),tt=new Uint8Array([75,69,77,0,0]),Ce=new Uint8Array([100,107,112,95,112,114,107]),Qn=new Uint8Array([101,97,101,95,112,114,107]),Jn=new Uint8Array([105,110,102,111,95,104,97,115,104]),ei=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),ti=new Uint8Array([115,101,99,114,101,116]),ri=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]),ni=new Uint8Array([107,101,121]),ii=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),si=new Uint8Array([101,120,112]),oi=new Uint8Array([115,101,99]),ai=new Uint8Array([99,97,110,100,105,100,97,116,101]),ut=new Uint8Array([115,107]),ci=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),fi=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),ui=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]);var ht=class extends Ne{constructor(e,t,n){super(e),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._kdf=t,this.exporterSecret=n}async seal(e,t){return await this._emitError1()}async open(e,t){return await this._emitError1()}async setupBidirectional(e,t){return await this._emitError2()}async export(e,t){if(e.byteLength>128)throw new pe("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,oi,new Uint8Array(e),t)}catch(n){throw new Qt(n)}}_emitError1(){return new Promise((e,t)=>{t(new Ie("Not available on export-only mode"))})}_emitError2(){return new Promise((e,t)=>{t(new Ie("Not available on export-only mode"))})}},tr=class extends ht{},rr=class extends ht{constructor(e,t,n,i){super(e,t,n),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=i}};var nr=class{constructor(e,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e,this._api=t}async seal(e,t,n){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let i={name:"AES-GCM",iv:e,additionalData:n};return await this._api.encrypt(i,this._key,t)}async open(e,t,n){this._key===void 0&&(this._key=await this.importKey(this._rawKey),new Uint8Array(this._rawKey).fill(0));let i={name:"AES-GCM",iv:e,additionalData:n};return await this._api.decrypt(i,this._key,t)}async importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,Yn)}},ir=class extends nr{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}},sr=class extends nr{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}};var Ai=qn(Si(),1);var lr=class{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ne.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Ai.ChaCha20Poly1305(new Uint8Array(e))}async seal(e,t,n){return await this._seal(e,t,n)}async open(e,t,n){return await this._open(e,t,n)}_seal(e,t,n){return new Promise(i=>{let s=this._key.seal(new Uint8Array(e),new Uint8Array(t),new Uint8Array(n));i(s.buffer)})}_open(e,t,n){return new Promise((i,s)=>{let o=this._key.open(new Uint8Array(e),new Uint8Array(t),new Uint8Array(n));o instanceof Uint8Array?i(o.buffer):s(new Error("failed to open."))})}};var wt=class extends ht{constructor(e,t,n){if(super(e,t,n.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_f",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_r",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.key===void 0||n.baseNonce===void 0||n.seq===void 0)throw new Error("Required parameters are missing");switch(this._aead=n.aead,this._aead){case ne.Aes128Gcm:this._nK=16,this._nN=12,this._nT=16;break;case ne.Aes256Gcm:this._nK=32,this._nN=12,this._nT=16;break;case ne.Chacha20Poly1305:this._nK=32,this._nN=12,this._nT=16;break;default:this._nK=0,this._nN=0,this._nT=0;break}let i=dr(this._aead,n.key,this._api);this._f={key:i,baseNonce:n.baseNonce,seq:n.seq},this._r={key:i,baseNonce:V,seq:0}}computeNonce(e){let t=le(e.seq,e.baseNonce.byteLength);return Zn(e.baseNonce,t)}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new Jt("Message limit reached");e.seq+=1}async setupBidirectional(e,t){try{this._r.baseNonce=new Uint8Array(await this.export(t,this._nN));let n=await this.export(e,this._nK);this._r.key=dr(this._aead,n,this._api),this._r.seq=0}catch(n){throw this._r.baseNonce=V,n}}};function dr(r,e,t){switch(r){case ne.Aes128Gcm:return new ir(e,t);case ne.Aes256Gcm:return new sr(e,t);case ne.Chacha20Poly1305:return new lr(e);default:throw new Error("Invalid or unsupported AEAD id")}}function sn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function Po(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function ki(r,...e){if(!(r instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function Io(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");sn(r.outputLen),sn(r.blockLen)}function Lo(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Uo(r,e){ki(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Ho={number:sn,bool:Po,bytes:ki,hash:Io,exists:Lo,output:Uo},fe=Ho;var Lt={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Bi=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),wr=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ke=(r,e)=>r<<32-e|r>>>e,Oo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Oo)throw new Error("Non little-endian hardware is not supported");var Mc=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ut(r){if(typeof r!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof r}`);return new TextEncoder().encode(r)}function Re(r){if(typeof r=="string"&&(r=Ut(r)),!(r instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof r})`);return r}function yr(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var De=class{clone(){return this._cloneInto()}};function xe(r){let e=n=>r().update(Re(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Pi(r){let e=(n,i)=>r(i).update(Re(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function pr(r=32){if(Lt.web)return Lt.web.getRandomValues(new Uint8Array(r));if(Lt.node)return new Uint8Array(Lt.node.randomBytes(r).buffer);throw new Error("The environment doesn't have randomBytes function")}var br=class extends De{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,fe.hash(e);let n=Re(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return fe.exists(this),this.iHash.update(e),this}digestInto(e){fe.exists(this),fe.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ht=(r,e,t)=>new br(r,e).update(t).digest();Ht.create=(r,e)=>new br(r,e);function Ko(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,f=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+f,a,n)}var yt=class extends De{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=wr(this.buffer)}update(e){fe.exists(this);let{view:t,buffer:n,blockLen:i}=this;e=Re(e);let s=e.length;for(let o=0;o<s;){let a=Math.min(i-this.pos,s-o);if(a===i){let c=wr(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fe.exists(this),fe.output(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:s}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let l=o;l<i;l++)t[l]=0;Ko(n,i-8,BigInt(this.length*8),s),this.process(n,0);let a=wr(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=c/4,h=this.get();if(f>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,h[l],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};var To=(r,e,t)=>r&e^~r&t,No=(r,e,t)=>r&e^r&t^e&t,zo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),je=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),qe=new Uint32Array(64),xr=class extends yt{constructor(){super(64,32,8,!1),this.A=je[0]|0,this.B=je[1]|0,this.C=je[2]|0,this.D=je[3]|0,this.E=je[4]|0,this.F=je[5]|0,this.G=je[6]|0,this.H=je[7]|0}get(){let{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)qe[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){let d=qe[l-15],w=qe[l-2],x=ke(d,7)^ke(d,18)^d>>>3,p=ke(w,17)^ke(w,19)^w>>>10;qe[l]=p+qe[l-7]+x+qe[l-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:f,H:h}=this;for(let l=0;l<64;l++){let d=ke(a,6)^ke(a,11)^ke(a,25),w=h+d+To(a,c,f)+zo[l]+qe[l]|0,p=(ke(n,2)^ke(n,13)^ke(n,22))+No(n,i,s)|0;h=f,f=c,c=a,a=o+w|0,o=s,s=i,i=n,n=w+p|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,h=h+this.H|0,this.set(n,i,s,o,a,c,f,h)}roundClean(){qe.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},on=class extends xr{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Ii=xe(()=>new xr),Jc=xe(()=>new on);var gr=BigInt(4294967295),an=BigInt(32);function Li(r,e=!1){return e?{h:Number(r&gr),l:Number(r>>an&gr)}:{h:Number(r>>an&gr)|0,l:Number(r&gr)|0}}function Co(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){let{h:s,l:o}=Li(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}var Do=(r,e)=>BigInt(r>>>0)<<an|BigInt(e>>>0),Ro=(r,e,t)=>r>>>t,jo=(r,e,t)=>r<<32-t|e>>>t,qo=(r,e,t)=>r>>>t|e<<32-t,Mo=(r,e,t)=>r<<32-t|e>>>t,Go=(r,e,t)=>r<<64-t|e>>>t-32,Fo=(r,e,t)=>r>>>t-32|e<<64-t,$o=(r,e)=>e,Zo=(r,e)=>r,Vo=(r,e,t)=>r<<t|e>>>32-t,Xo=(r,e,t)=>e<<t|r>>>32-t,Yo=(r,e,t)=>e<<t-32|r>>>64-t,Wo=(r,e,t)=>r<<t-32|e>>>64-t;function Qo(r,e,t,n){let i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}var Jo=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),ea=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,ta=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),ra=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,na=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),ia=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,sa={fromBig:Li,split:Co,toBig:Do,shrSH:Ro,shrSL:jo,rotrSH:qo,rotrSL:Mo,rotrBH:Go,rotrBL:Fo,rotr32H:$o,rotr32L:Zo,rotlSH:Vo,rotlSL:Xo,rotlBH:Yo,rotlBL:Wo,add:Qo,add3L:Jo,add3H:ea,add4L:ta,add4H:ra,add5H:ia,add5L:na},H=sa;var[oa,aa]=H.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Me=new Uint32Array(80),Ge=new Uint32Array(80),pt=class extends yt{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:h,Fh:l,Fl:d,Gh:w,Gl:x,Hh:p,Hl:S}=this;return[e,t,n,i,s,o,a,c,f,h,l,d,w,x,p,S]}set(e,t,n,i,s,o,a,c,f,h,l,d,w,x,p,S){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=h|0,this.Fh=l|0,this.Fl=d|0,this.Gh=w|0,this.Gl=x|0,this.Hh=p|0,this.Hl=S|0}process(e,t){for(let b=0;b<16;b++,t+=4)Me[b]=e.getUint32(t),Ge[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){let A=Me[b-15]|0,L=Ge[b-15]|0,j=H.rotrSH(A,L,1)^H.rotrSH(A,L,8)^H.shrSH(A,L,7),K=H.rotrSL(A,L,1)^H.rotrSL(A,L,8)^H.shrSL(A,L,7),I=Me[b-2]|0,U=Ge[b-2]|0,z=H.rotrSH(I,U,19)^H.rotrBH(I,U,61)^H.shrSH(I,U,6),Y=H.rotrSL(I,U,19)^H.rotrBL(I,U,61)^H.shrSL(I,U,6),Z=H.add4L(K,Y,Ge[b-7],Ge[b-16]),q=H.add4H(Z,j,z,Me[b-7],Me[b-16]);Me[b]=q|0,Ge[b]=Z|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:h,Eh:l,El:d,Fh:w,Fl:x,Gh:p,Gl:S,Hh:m,Hl:E}=this;for(let b=0;b<80;b++){let A=H.rotrSH(l,d,14)^H.rotrSH(l,d,18)^H.rotrBH(l,d,41),L=H.rotrSL(l,d,14)^H.rotrSL(l,d,18)^H.rotrBL(l,d,41),j=l&w^~l&p,K=d&x^~d&S,I=H.add5L(E,L,K,aa[b],Ge[b]),U=H.add5H(I,m,A,j,oa[b],Me[b]),z=I|0,Y=H.rotrSH(n,i,28)^H.rotrBH(n,i,34)^H.rotrBH(n,i,39),Z=H.rotrSL(n,i,28)^H.rotrBL(n,i,34)^H.rotrBL(n,i,39),q=n&s^n&a^s&a,re=i&o^i&c^o&c;m=p|0,E=S|0,p=w|0,S=x|0,w=l|0,x=d|0,{h:l,l:d}=H.add(f|0,h|0,U|0,z|0),f=a|0,h=c|0,a=s|0,c=o|0,s=n|0,o=i|0;let G=H.add3L(z,Z,re);n=H.add3H(G,U,Y,q),i=G|0}({h:n,l:i}=H.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=H.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=H.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:h}=H.add(this.Dh|0,this.Dl|0,f|0,h|0),{h:l,l:d}=H.add(this.Eh|0,this.El|0,l|0,d|0),{h:w,l:x}=H.add(this.Fh|0,this.Fl|0,w|0,x|0),{h:p,l:S}=H.add(this.Gh|0,this.Gl|0,p|0,S|0),{h:m,l:E}=H.add(this.Hh|0,this.Hl|0,m|0,E|0),this.set(n,i,s,o,a,c,f,h,l,d,w,x,p,S,m,E)}roundClean(){Me.fill(0),Ge.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},cn=class extends pt{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}},fn=class extends pt{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}},un=class extends pt{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}},bt=xe(()=>new pt),of=xe(()=>new cn),af=xe(()=>new fn),Ui=xe(()=>new un);var Ot=class extends Ne{constructor(e,t){super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:we.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}}),this.suiteId=t}buildLabeledIkm(e,t){let n=new Uint8Array(7+this.suiteId.byteLength+e.byteLength+t.byteLength);return n.set(Xr,0),n.set(this.suiteId,7),n.set(e,7+this.suiteId.byteLength),n.set(t,7+this.suiteId.byteLength+e.byteLength),n}buildLabeledInfo(e,t,n){let i=new Uint8Array(9+this.suiteId.byteLength+e.byteLength+t.byteLength);return i.set(new Uint8Array([0,n]),0),i.set(Xr,2),i.set(this.suiteId,9),i.set(e,9+this.suiteId.byteLength),i.set(t,9+this.suiteId.byteLength+e.byteLength),i}async extract(e,t){if(e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)switch(this.algHash.hash){case"SHA-256":return Ht(Ii,new Uint8Array(e),new Uint8Array(t));case"SHA-384":return Ht(Ui,new Uint8Array(e),new Uint8Array(t));default:return Ht(bt,new Uint8Array(e),new Uint8Array(t))}let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",n,t)}async expand(e,t,n){let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),s=new ArrayBuffer(n),o=new Uint8Array(s),a=V,c=new Uint8Array(t),f=new Uint8Array(1);if(n>255*this.hashSize)throw new Error("Entropy limit reached");let h=new Uint8Array(this.hashSize+c.length+1);for(let l=1,d=0;d<o.length;l++)f[0]=l,h.set(a,0),h.set(c,a.length),h.set(f,a.length+c.length),a=new Uint8Array(await this._api.sign("HMAC",i,h.slice(0,a.length+c.length+1))),o.length-d>=a.length?(o.set(a,d),d+=a.length):(o.set(a.slice(0,o.length-d),d),d+=o.length-d);return s}async extractAndExpand(e,t,n,i){let s=await this._api.importKey("raw",t,"HKDF",!1,ze);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:n},s,i*8)}async labeledExtract(e,t,n){return await this.extract(e,this.buildLabeledIkm(t,n))}async labeledExpand(e,t,n,i){return await this.expand(e,this.buildLabeledInfo(t,n,i),i)}},Fe=class extends Ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:we.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}},xt=class extends Ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:we.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}},rt=class extends Ot{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:we.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var mr=class extends wt{async seal(e,t=V){if(this._r.baseNonce.length===0)throw new Qe("Bidirectional encryption is not setup");let n;try{n=await this._r.key.seal(this.computeNonce(this._r),e,t)}catch(i){throw new Qe(i)}return this.incrementSeq(this._r),n}async open(e,t=V){let n;try{n=await this._f.key.open(this.computeNonce(this._f),e,t)}catch(i){throw new Je(i)}return this.incrementSeq(this._f),n}};var _r=class extends wt{constructor(e,t,n,i){super(e,t,n),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=i}async seal(e,t=V){let n;try{n=await this._f.key.seal(this.computeNonce(this._f),e,t)}catch(i){throw new Qe(i)}return this.incrementSeq(this._f),n}async open(e,t=V){if(this._r.baseNonce.length===0)throw new Je("Bidirectional encryption is not setup");let n;try{n=await this._r.key.open(this.computeNonce(this._r),e,t)}catch(i){throw new Je(i)}return this.incrementSeq(this._r),n}};var Er=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let t=0;t<this._num.length;t++){if(this._num[t]<e[t])return!0;if(this._num[t]>e[t])return!1}return!1}};var ca=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),fa=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),ua=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),gt=class{constructor(e,t,n){switch(Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,this._api=n,e){case M.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=ci,this._bitmask=255,this._pkcs8AlgId=ca;break;case M.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=fi,this._bitmask=255,this._pkcs8AlgId=fa;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=ui,this._bitmask=1,this._pkcs8AlgId=ua;break}}async serializePublicKey(e){let t=await this._api.exportKey("raw",e);if(t.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");return t}async deserializePublicKey(e){if(e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");try{return await this._api.importKey("raw",e,this._alg,!0,[])}catch{throw new Error("Invalid public key for the ciphersuite")}}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");if(n&&t.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!n&&t.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");try{if(n)return await this._api.importKey(e,t,this._alg,!0,[]);let i=new Uint8Array(t),s=new Uint8Array(this._pkcs8AlgId.length+i.length);return s.set(this._pkcs8AlgId,0),s.set(i,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",s,this._alg,!0,ze)}catch{throw new Error("Invalid key for the ciphersuite")}}async derivePublicKey(e){let t=await this._api.exportKey("jwk",e);return delete t.d,delete t.key_ops,await this._api.importKey("jwk",t,this._alg,!0,[])}async generateKeyPair(){return await this._api.generateKey(this._alg,!0,ze)}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(V,Ce,new Uint8Array(e)),n=new Er(this._nSk);for(let o=0;n.isZero()||!n.lessThan(this._order);o++){if(o>255)throw new Error("Faild to derive a key pair");let a=new Uint8Array(await this._hkdf.labeledExpand(t,ai,le(o,1),this._nSk));a[0]=a[0]&this._bitmask,n.set(a)}let i=new Uint8Array(this._pkcs8AlgId.length+n.val().length);i.set(this._pkcs8AlgId,0),i.set(n.val(),this._pkcs8AlgId.length);let s=await this._api.importKey("pkcs8",i,this._alg,!0,ze);return n.reset(),{privateKey:s,publicKey:await this.derivePublicKey(s)}}async dh(e,t){return await this._api.deriveBits({name:"ECDH",public:t},e,this._nDh*8)}};var ha=qn(Hi(),1);var X=BigInt(0),te=BigInt(1),$e=BigInt(2),Nt=BigInt(3),Oi=BigInt(8),oe=Object.freeze({a:X,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:te,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),Ki=(r,e)=>(r+e/$e)/e,vr={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=oe,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-te*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=Ki(s*r,e),c=Ki(-n*r,e),f=B(r-a*t-c*i,e),h=B(-a*n-c*s,e),l=f>o,d=h>o;if(l&&(f=e-f),d&&(h=e-h),f>o||h>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:l,k1:f,k2neg:d,k2:h}}},mt=32,zt=32;var Br=mt+1,Pr=2*mt+1;function Ti(r){let{a:e,b:t}=oe,n=B(r*r),i=B(n*r);return B(i+e*r+t)}var Sr=oe.a===X,dn=class extends Error{constructor(e){super(e)}};function Ni(r){if(!(r instanceof $))throw new TypeError("JacobianPoint expected")}var $=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof J))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(J.ZERO)?$.ZERO:new $(e.x,e.y,te)}static toAffineBatch(e){let t=pa(e.map(n=>n.z));return e.map((n,i)=>n.toAffine(t[i]))}static normalizeZ(e){return $.toAffineBatch(e).map($.fromAffine)}equals(e){Ni(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e,c=B(i*i),f=B(a*a),h=B(t*f),l=B(s*c),d=B(B(n*a)*f),w=B(B(o*i)*c);return h===l&&d===w}negate(){return new $(this.x,B(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,i=B(e*e),s=B(t*t),o=B(s*s),a=e+s,c=B($e*(B(a*a)-i-o)),f=B(Nt*i),h=B(f*f),l=B(h-$e*c),d=B(f*(c-l)-Oi*o),w=B($e*t*n);return new $(l,d,w)}add(e){Ni(e);let{x:t,y:n,z:i}=this,{x:s,y:o,z:a}=e;if(s===X||o===X)return this;if(t===X||n===X)return e;let c=B(i*i),f=B(a*a),h=B(t*f),l=B(s*c),d=B(B(n*a)*f),w=B(B(o*i)*c),x=B(l-h),p=B(w-d);if(x===X)return p===X?this.double():$.ZERO;let S=B(x*x),m=B(x*S),E=B(h*S),b=B(p*p-m-$e*E),A=B(p*(E-b)-d*m),L=B(i*a*x);return new $(b,A,L)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=$.ZERO;if(typeof e=="bigint"&&e===X)return t;let n=Ri(e);if(n===te)return this;if(!Sr){let l=t,d=this;for(;n>X;)n&te&&(l=l.add(d)),d=d.double(),n>>=te;return l}let{k1neg:i,k1:s,k2neg:o,k2:a}=vr.splitScalar(n),c=t,f=t,h=this;for(;s>X||a>X;)s&te&&(c=c.add(h)),a&te&&(f=f.add(h)),h=h.double(),s>>=te,a>>=te;return i&&(c=c.negate()),o&&(f=f.negate()),f=new $(B(f.x*vr.beta),f.y,f.z),c.add(f)}precomputeWindow(e){let t=Sr?128/e+1:256/e+1,n=[],i=this,s=i;for(let o=0;o<t;o++){s=i,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),n.push(s);i=s.double()}return n}wNAF(e,t){!t&&this.equals($.BASE)&&(t=J.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&wn.get(t);i||(i=this.precomputeWindow(n),t&&n!==1&&(i=$.normalizeZ(i),wn.set(t,i)));let s=$.ZERO,o=$.BASE,a=1+(Sr?128/n:256/n),c=2**(n-1),f=BigInt(2**n-1),h=2**n,l=BigInt(n);for(let d=0;d<a;d++){let w=d*c,x=Number(e&f);e>>=l,x>c&&(x-=h,e+=te);let p=w,S=w+Math.abs(x)-1,m=d%2!==0,E=x<0;x===0?o=o.add(Ar(m,i[p])):s=s.add(Ar(E,i[S]))}return{p:s,f:o}}multiply(e,t){let n=Ri(e),i,s;if(Sr){let{k1neg:o,k1:a,k2neg:c,k2:f}=vr.splitScalar(n),{p:h,f:l}=this.wNAF(a,t),{p:d,f:w}=this.wNAF(f,t);h=Ar(o,h),d=Ar(c,d),d=new $(B(d.x*vr.beta),d.y,d.z),i=h.add(d),s=l.add(w)}else{let{p:o,f:a}=this.wNAF(n,t);i=o,s=a}return $.normalizeZ([i,s])[0]}toAffine(e){let{x:t,y:n,z:i}=this,s=this.equals($.ZERO);e==null&&(e=s?Oi:Hr(i));let o=e,a=B(o*o),c=B(a*o),f=B(t*a),h=B(n*c),l=B(i*o);if(s)return J.ZERO;if(l!==te)throw new Error("invZ was invalid");return new J(f,h)}};$.BASE=new $(oe.Gx,oe.Gy,te);$.ZERO=new $(X,te,X);function Ar(r,e){let t=e.negate();return r?t:e}var wn=new WeakMap,J=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,wn.delete(this)}hasEvenY(){return this.y%$e===X}static fromCompressedHex(e){let t=e.length===32,n=st(t?e:e.subarray(1));if(!ln(n))throw new Error("Point is not on curve");let i=Ti(n),s=ya(i),o=(s&te)===te;t?o&&(s=B(-s)):(e[0]&1)===1!==o&&(s=B(-s));let a=new J(n,s);return a.assertValidity(),a}static fromUncompressedHex(e){let t=st(e.subarray(1,mt+1)),n=st(e.subarray(mt+1,mt*2+1)),i=new J(t,n);return i.assertValidity(),i}static fromHex(e){let t=yn(e),n=t.length,i=t[0];if(n===mt)return this.fromCompressedHex(t);if(n===Br&&(i===2||i===3))return this.fromCompressedHex(t);if(n===Pr&&i===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${Br} compressed bytes or ${Pr} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return J.BASE.multiply(Ur(e))}static fromSignature(e,t,n){let{r:i,s}=ma(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let o=xa(yn(e)),{n:a}=oe,c=n===2||n===3?i+a:i,f=Hr(c,a),h=B(-o*f,a),l=B(s*f,a),d=n&1?"03":"02",w=J.fromHex(d+_t(c)),x=J.BASE.multiplyAndAddUnsafe(w,h,l);if(!x)throw new Error("Cannot recover signature: point at infinify");return x.assertValidity(),x}toRawBytes(e=!1){return it(this.toHex(e))}toHex(e=!1){let t=_t(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${_t(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!ln(t)||!ln(n))throw new Error(e);let i=B(n*n),s=Ti(t);if(B(i-s)!==X)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new J(this.x,B(-this.y))}double(){return $.fromAffine(this).double().toAffine()}add(e){return $.fromAffine(this).add($.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return $.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let i=$.fromAffine(this),s=t===X||t===te||this!==J.BASE?i.multiplyUnsafe(t):i.multiply(t),o=$.fromAffine(e).multiplyUnsafe(n),a=s.add(o);return a.equals($.ZERO)?void 0:a.toAffine()}};J.BASE=new J(oe.Gx,oe.Gy);J.ZERO=new J(X,X);function zi(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function Ci(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${vt(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:st(t),left:r.subarray(e+2)}}function la(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${vt(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=Ci(r.subarray(2)),{data:n,left:i}=Ci(t);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${vt(i)}`);return{r:e,s:n}}var He=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let i=t?vt(e):e;if(i.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new He(Ir(i.slice(0,64)),Ir(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s:i}=la(t?e:it(e));return new He(n,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!Lr(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Lr(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=oe.n>>te;return this.s>e}normalizeS(){return this.hasHighS()?new He(this.r,B(-this.s,oe.n)):this}toDERRawBytes(){return it(this.toDERHex())}toDERHex(){let e=zi(Tt(this.s)),t=zi(Tt(this.r)),n=e.length/2,i=t.length/2,s=Tt(n),o=Tt(i);return`30${Tt(i+n+4)}02${o}${t}02${s}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return it(this.toCompactHex())}toCompactHex(){return _t(this.r)+_t(this.s)}};function Kt(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}var da=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function vt(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=da[r[t]];return e}var wa=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function _t(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(X<=r&&r<wa))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function Di(r){let e=it(_t(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Tt(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function Ir(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function it(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function st(r){return Ir(vt(r))}function yn(r){return r instanceof Uint8Array?Uint8Array.from(r):it(r)}function Ri(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&Lr(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function B(r,e=oe.P){let t=r%e;return t>=X?t:e+t}function me(r,e){let{P:t}=oe,n=r;for(;e-- >X;)n*=n,n%=t;return n}function ya(r){let{P:e}=oe,t=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=r*r*r%e,f=c*c*r%e,h=me(f,Nt)*f%e,l=me(h,Nt)*f%e,d=me(l,$e)*c%e,w=me(d,n)*d%e,x=me(w,i)*w%e,p=me(x,o)*x%e,S=me(p,a)*p%e,m=me(S,o)*x%e,E=me(m,Nt)*f%e,b=me(E,s)*w%e,A=me(b,t)*c%e,L=me(A,$e);if(L*L%e!==r)throw new Error("Cannot find square root");return L}function Hr(r,e=oe.P){if(r===X||e<=X)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=B(r,e),n=e,i=X,s=te,o=te,a=X;for(;t!==X;){let f=n/t,h=n%t,l=i-o*f,d=s-a*f;n=t,t=h,i=o,s=a,o=l,a=d}if(n!==te)throw new Error("invert: does not exist");return B(i,e)}function pa(r,e=oe.P){let t=new Array(r.length),n=r.reduce((s,o,a)=>o===X?s:(t[a]=s,B(s*o,e)),te),i=Hr(n,e);return r.reduceRight((s,o,a)=>o===X?s:(t[a]=B(s*t[a],e),B(s*o,e)),i),t}function ba(r){let e=r.length*8-zt*8,t=st(r);return e>0?t>>BigInt(e):t}function xa(r,e=!1){let t=ba(r);if(e)return t;let{n}=oe;return t>=n?t-n:t}var Et,hn;function Lr(r){return X<r&&r<oe.n}function ln(r){return X<r&&r<oe.P}function Ur(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*zt)throw new Error("Expected 32 bytes of private key");e=Ir(r)}else if(r instanceof Uint8Array){if(r.length!==zt)throw new Error("Expected 32 bytes of private key");e=st(r)}else throw new TypeError("Expected valid private key");if(!Lr(e))throw new Error("Expected private key: 0 < key < n");return e}function ga(r){return r instanceof J?(r.assertValidity(),r):J.fromHex(r)}function ma(r){if(r instanceof He)return r.assertValidity(),r;try{return He.fromDER(r)}catch{return He.fromCompact(r)}}function qi(r,e=!1){return J.fromPrivateKey(r).toRawBytes(e)}function ji(r){let e=r instanceof Uint8Array,t=typeof r=="string",n=(e||t)&&r.length;return e?n===Br||n===Pr:t?n===Br*2||n===Pr*2:r instanceof J}function Mi(r,e,t=!1){if(ji(r))throw new TypeError("getSharedSecret: first arg must be private key");if(!ji(e))throw new TypeError("getSharedSecret: second arg must be public key");let n=ga(e);return n.assertValidity(),n.multiply(Ur(r)).toRawBytes(t)}J.BASE._setWindowSize(8);var ge={node:ha,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var kr={},nt={bytesToHex:vt,hexToBytes:it,concatBytes:Kt,mod:B,invert:Hr,isValidPrivateKey(r){try{return Ur(r),!0}catch{return!1}},_bigintTo32Bytes:Di,_normalizePrivateKey:Ur,hashToPrivateKey:r=>{r=yn(r);let e=zt+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=B(st(r),oe.n-te)+te;return Di(t)},randomBytes:(r=32)=>{if(ge.web)return ge.web.getRandomValues(new Uint8Array(r));if(ge.node){let{randomBytes:e}=ge.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>nt.hashToPrivateKey(nt.randomBytes(zt+8)),precompute(r=8,e=J.BASE){let t=e===J.BASE?e:new J(e.x,e.y);return t._setWindowSize(r),t.multiply(Nt),t},sha256:async(...r)=>{if(ge.web){let e=await ge.web.subtle.digest("SHA-256",Kt(...r));return new Uint8Array(e)}else if(ge.node){let{createHash:e}=ge.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(ge.web){let t=await ge.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=Kt(...e),i=await ge.web.subtle.sign("HMAC",t,n);return new Uint8Array(i)}else if(ge.node){let{createHmac:t}=ge.node,n=t("sha256",r);return e.forEach(i=>n.update(i)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=kr[r];if(t===void 0){let n=await nt.sha256(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Kt(n,n),kr[r]=t}return nt.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof Et!="function")throw new dn("sha256Sync is undefined, you need to set it");let t=kr[r];if(t===void 0){let n=Et(Uint8Array.from(r,i=>i.charCodeAt(0)));t=Kt(n,n),kr[r]=t}return Et(t,...e)},_JacobianPoint:$};Object.defineProperties(nt,{sha256Sync:{configurable:!1,get(){return Et},set(r){Et||(Et=r)}},hmacSha256Sync:{configurable:!1,get(){return hn},set(r){hn||(hn=r)}}});var ie=class{constructor(e,t,n){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:ze}),this.key=t,this.type=n,this.algorithm={name:e}}};var Ct="ECDH",Or=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=65,this._nSk=32}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=nt.randomPrivateKey(),t=new ie(Ct,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(V,Ce,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,ut,V,this._nSk),i=new ie(Ct,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie(Ct,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie(Ct,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=qi(e.key);t(new ie(Ct,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(Mi(e.key,t.key).buffer)}catch(s){i(s)}})}};var Uf=BigInt(0),pn=BigInt(1),Ea=BigInt(2);function Gi(r){Xi(r.Fp);for(let e of["n","h"])if(typeof r[e]!="bigint")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);if(!r.Fp.isValid(r.Gx))throw new Error("Invalid generator X coordinate Fp element");if(!r.Fp.isValid(r.Gy))throw new Error("Invalid generator Y coordinate Fp element");for(let e of["nBitLength","nByteLength"])if(r[e]!==void 0&&!Number.isSafeInteger(r[e]))throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);return Object.freeze({...Kr(r.n,r.nBitLength),...r})}var va=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function ot(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=va[r[t]];return e}function Sa(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function Fi(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex "+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,i=r.slice(n,n+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[t]=s}return e}function bn(r){return Sa(ot(r))}function _e(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+ot(Uint8Array.from(r).reverse()))}var xn=(r,e)=>Fi(r.toString(16).padStart(e*2,"0")),Be=(r,e)=>xn(r,e).reverse();function ue(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):Fi(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Ee(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,i)=>n+i.length,0),t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){let s=r[n];t.set(s,i),i+=s.length}return t}function Kr(r,e){let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function $i(r,e,t=!1){r=ue(r);let n=Kr(e).nByteLength,i=n+8;if(n<16||r.length<i||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let s=t?_e(r):bn(r);return R(s,e-pn)+pn}function Zi(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}var Vi=r=>(Ea<<BigInt(r-1))-pn;var ae=BigInt(0),se=BigInt(1),at=BigInt(2),ka=BigInt(3),gn=BigInt(4),Yi=BigInt(5),Wi=BigInt(8),Ba=BigInt(9),Pa=BigInt(16);function R(r,e){let t=r%e;return t>=ae?t:e+t}function Dt(r,e,t){if(t<=ae||e<ae)throw new Error("Expected power/modulo > 0");if(t===se)return ae;let n=se;for(;e>ae;)e&se&&(n=n*r%t),r=r*r%t,e>>=se;return n}function ee(r,e,t){let n=r;for(;e-- >ae;)n*=n,n%=t;return n}function Qi(r,e){if(r===ae||e<=ae)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=R(r,e),n=e,i=ae,s=se,o=se,a=ae;for(;t!==ae;){let f=n/t,h=n%t,l=i-o*f,d=s-a*f;n=t,t=h,i=o,s=a,o=l,a=d}if(n!==se)throw new Error("invert: does not exist");return R(i,e)}function Ia(r){let e=(r-se)/at,t,n,i;for(t=r-se,n=0;t%at===ae;t/=at,n++);for(i=at;i<r&&Dt(i,e,r)!==r-se;i++);if(n===1){let o=(r+se)/gn;return function(c,f){let h=c.pow(f,o);if(!c.equals(c.square(h),f))throw new Error("Cannot find square root");return h}}let s=(t+se)/at;return function(a,c){if(a.pow(c,e)!==a.ONE)throw new Error("Cannot find square root");let f=n,h=Dt(i,t,r),l=a.pow(c,s),d=a.pow(c,t),w=a.ZERO;for(;!a.equals(a.sub(d,a.ONE),a.ZERO);){w=a.square(d);let x;for(x=1;x<f&&!a.equals(a.sub(w,a.ONE),a.ZERO);x++)w=a.square(w);let p=Dt(h,BigInt(1<<f-x-1),r);l=a.mul(l,p),h=R(p*p,r),d=a.mul(d,h),f=x}return l}}function La(r){if(r%gn===ka){let e=(r+se)/gn;return function(n,i){let s=n.pow(i,e);if(!n.equals(n.square(s),i))throw new Error("Cannot find square root");return s}}if(r%Wi===Yi){let e=(r-Yi)/Wi;return function(n,i){let s=n.mul(i,at),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,at),o),f=n.mul(a,n.sub(c,n.ONE));if(!n.equals(n.square(f),i))throw new Error("Cannot find square root");return f}}return r%Pa,Ia(r)}var Oe=(r,e)=>(R(r,e)&se)===se,Ua=["create","isValid","isZero","negate","invert","sqrt","square","equals","add","sub","mul","pow","div","addN","subN","mulN","squareN"];function Xi(r){for(let e of["ORDER","MASK"])if(typeof r[e]!="bigint")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["BYTES","BITS"])if(typeof r[e]!="number")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`);for(let e of Ua)if(typeof r[e]!="function")throw new Error(`Invalid field param ${e}=${r[e]} (${typeof r[e]})`)}function Ha(r,e,t){if(t<ae)throw new Error("Expected power > 0");if(t===ae)return r.ONE;if(t===se)return e;let n=r.ONE,i=e;for(;t>ae;)t&se&&(n=r.mul(n,i)),i=r.square(i),t>>=1n;return n}function Oa(r,e){let t=new Array(e.length),n=e.reduce((s,o,a)=>r.isZero(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.invert(n);return e.reduceRight((s,o,a)=>r.isZero(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function Nr(r,e,t=!1,n={}){if(r<=ae)throw new Error(`Expected Fp ORDER > 0, got ${r}`);let{nBitLength:i,nByteLength:s}=Kr(r,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=La(r),a=Object.freeze({ORDER:r,BITS:i,BYTES:s,MASK:Vi(i),ZERO:ae,ONE:se,create:c=>R(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return ae<=c&&c<r},isZero:c=>c===ae,isOdd:c=>(c&se)===se,negate:c=>R(-c,r),equals:(c,f)=>c===f,square:c=>R(c*c,r),add:(c,f)=>R(c+f,r),sub:(c,f)=>R(c-f,r),mul:(c,f)=>R(c*f,r),pow:(c,f)=>Ha(a,c,f),div:(c,f)=>R(c*Qi(f,r),r),squareN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,invert:c=>Qi(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>Oa(a,c),cmov:(c,f,h)=>h?f:c,toBytes:c=>t?Be(c,s):xn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return t?_e(c):bn(c)}});return Object.freeze(a)}function Ji(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");let t=r.sqrt(e);return r.isOdd(t)?r.negate(t):t}var Ka=BigInt(0),mn=BigInt(1);function es(r,e){let t=(i,s)=>{let o=s.negate();return i?o:s},n=i=>{let s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:t,unsafeLadder(i,s){let o=r.ZERO,a=i;for(;s>Ka;)s&mn&&(o=o.add(a)),a=a.double(),s>>=mn;return o},precomputeWindow(i,s){let{windows:o,windowSize:a}=n(s),c=[],f=i,h=f;for(let l=0;l<o;l++){h=f,c.push(h);for(let d=1;d<a;d++)h=h.add(f),c.push(h);f=h.double()}return c},wNAF(i,s,o){let{windows:a,windowSize:c}=n(i),f=r.ZERO,h=r.BASE,l=BigInt(2**i-1),d=2**i,w=BigInt(i);for(let x=0;x<a;x++){let p=x*c,S=Number(o&l);o>>=w,S>c&&(S-=d,o+=mn);let m=p,E=p+Math.abs(S)-1,b=x%2!==0,A=S<0;S===0?h=h.add(t(b,s[m])):f=f.add(t(A,s[E]))}return{p:f,f:h}}}}function ts(r){if(typeof r.DST!="string")throw new Error("Invalid htf/DST");if(typeof r.p!="bigint")throw new Error("Invalid htf/p");if(typeof r.m!="number")throw new Error("Invalid htf/m");if(typeof r.k!="number")throw new Error("Invalid htf/k");if(r.expand!=="xmd"&&r.expand!=="xof"&&r.expand!==void 0)throw new Error("Invalid htf/expand");if(typeof r.hash!="function"||!Number.isSafeInteger(r.hash.outputLen))throw new Error("Invalid htf/hash function")}function _n(r){let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}function Ta(r){let e=0n;for(let t=0;t<r.length;t++)e<<=8n,e+=BigInt(r[t]);return e}function Ze(r,e){if(r<0||r>=1<<8*e)throw new Error(`bad I2OSP call: value=${r} length=${e}`);let t=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)t[n]=r&255,r>>>=8;return new Uint8Array(t)}function Na(r,e){let t=new Uint8Array(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}function za(r,e,t,n){e.length>255&&(e=n(Ee(_n("H2C-OVERSIZE-DST-"),e)));let i=n.outputLen,s=n.blockLen,o=Math.ceil(t/i);if(o>255)throw new Error("Invalid xmd length");let a=Ee(e,Ze(e.length,1)),c=Ze(0,s),f=Ze(t,2),h=new Array(o),l=n(Ee(c,r,f,Ze(0,1),a));h[0]=n(Ee(l,Ze(1,1),a));for(let w=1;w<=o;w++){let x=[Na(l,h[w-1]),Ze(w+1,1),a];h[w]=n(Ee(...x))}return Ee(...h).slice(0,t)}function Ca(r,e,t,n,i){if(e.length>255){let s=Math.ceil(2*n/8);e=i.create({dkLen:s}).update(_n("H2C-OVERSIZE-DST-")).update(e).digest()}if(t>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:t}).update(r).update(Ze(t,2)).update(e).update(Ze(e.length,1)).digest()}function En(r,e,t){let n=t.p.toString(2).length,i=Math.ceil((n+t.k)/8),s=e*t.m*i,o=_n(t.DST),a=r;t.expand==="xmd"?a=za(r,o,s,t.hash):t.expand==="xof"&&(a=Ca(r,o,s,t.k,t.hash));let c=new Array(e);for(let f=0;f<e;f++){let h=new Array(t.m);for(let l=0;l<t.m;l++){let d=i*(l+f*t.m),w=a.subarray(d,d+i);h[l]=R(Ta(w),t.p)}c[f]=h}return c}var Ve=BigInt(0),ve=BigInt(1),Rt=BigInt(2),Da=BigInt(8);function Ra(r){let e=Gi(r);if(typeof e.hash!="function"||!Number.isSafeInteger(e.hash.outputLen))throw new Error("Invalid hash function");for(let t of["a","d"])if(typeof e[t]!="bigint")throw new Error(`Invalid curve param ${t}=${e[t]} (${typeof e[t]})`);for(let t of["randomBytes"])if(typeof e[t]!="function")throw new Error(`Invalid ${t} function`);for(let t of["adjustScalarBytes","domain","uvRatio","mapToCurve","clearCofactor"])if(e[t]!==void 0&&typeof e[t]!="function")throw new Error(`Invalid ${t} function`);return e.htfDefaults!==void 0&&ts(e.htfDefaults),Object.freeze({...e})}function ct(r){let e=Ra(r),t=e.Fp,n=e.n,i=t.BYTES;if(i>2048)throw new Error("Field lengths over 2048 are not supported");let s=e.nByteLength,o=Rt**BigInt(s*8),{randomBytes:a}=e,c=t.create;function f(g,u){try{return{isValid:!0,value:t.sqrt(g*t.invert(u))}}catch{return{isValid:!1,value:Ve}}}let h=e.uvRatio||f,l=g=>g,d=e.adjustScalarBytes||l;function w(g,u,y){if(u.length||y)throw new Error("Contexts/pre-hash are not supported");return g}let x=e.domain||w;class p{constructor(u,y,P,k){this.x=u,this.y=y,this.z=P,this.t=k}static fromAffine(u){if(!(u instanceof b))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return u.equals(b.ZERO)?p.ZERO:new p(u.x,u.y,ve,c(u.x*u.y))}static toAffineBatch(u){let y=t.invertBatch(u.map(P=>P.z));return u.map((P,k)=>P.toAffine(y[k]))}static normalizeZ(u){return this.toAffineBatch(u).map(this.fromAffine)}equals(u){m(u);let{x:y,y:P,z:k}=this,{x:O,y:T,z:N}=u,C=c(y*N),F=c(O*k),Q=c(P*N),W=c(T*k);return C===F&&Q===W}negate(){return new p(c(-this.x),this.y,this.z,c(-this.t))}double(){let{a:u}=e,{x:y,y:P,z:k}=this,O=c(y*y),T=c(P*P),N=c(Rt*c(k*k)),C=c(u*O),F=y+P,Q=c(c(F*F)-O-T),W=C+T,Pe=W-N,We=C-T,kt=c(Q*Pe),$t=c(W*We),Zt=c(Q*We),Vt=c(Pe*W);return new p(kt,$t,Vt,Zt)}add(u){m(u);let{a:y,d:P}=e,{x:k,y:O,z:T,t:N}=this,{x:C,y:F,z:Q,t:W}=u;if(y===BigInt(-1)){let Kn=c((O-k)*(F+C)),Tn=c((O+k)*(F-C)),Vr=c(Tn-Kn);if(Vr===Ve)return this.double();let Nn=c(T*Rt*W),zn=c(N*Rt*Q),Cn=zn+Nn,Dn=Tn+Kn,Rn=zn-Nn,Ps=c(Cn*Vr),Is=c(Dn*Rn),Ls=c(Cn*Rn),Us=c(Vr*Dn);return new p(Ps,Is,Us,Ls)}let Pe=c(k*C),We=c(O*F),kt=c(N*P*W),$t=c(T*Q),Zt=c((k+O)*(C+F)-Pe-We),Vt=$t-kt,Hn=$t+kt,On=c(We-y*Pe),Ss=c(Zt*Vt),As=c(Hn*On),ks=c(Zt*On),Bs=c(Vt*Hn);return new p(Ss,As,Bs,ks)}subtract(u){return this.add(u.negate())}wNAF(u,y){!y&&this.equals(p.BASE)&&(y=b.BASE);let P=y&&y._WINDOW_SIZE||1,k=y&&E.get(y);k||(k=S.precomputeWindow(this,P),y&&P!==1&&(k=p.normalizeZ(k),E.set(y,k)));let{p:O,f:T}=S.wNAF(P,k,u);return p.normalizeZ([O,T])[0]}multiply(u,y){return this.wNAF(j(u,n),y)}multiplyUnsafe(u){let y=j(u,n,!1),P=p.BASE,k=p.ZERO;return y===Ve?k:this.equals(k)||y===ve?this:this.equals(P)?this.wNAF(y):S.unsafeLadder(this,y)}isSmallOrder(){return this.multiplyUnsafe(e.h).equals(p.ZERO)}isTorsionFree(){return this.multiplyUnsafe(n).equals(p.ZERO)}toAffine(u){let{x:y,y:P,z:k}=this,O=this.equals(p.ZERO);u==null&&(u=O?Da:t.invert(k));let T=c(y*u),N=c(P*u),C=c(k*u);if(O)return b.ZERO;if(C!==ve)throw new Error("invZ was invalid");return new b(T,N)}clearCofactor(){return e.h===ve?this:e.clearCofactor?e.clearCofactor(p,this):this.multiplyUnsafe(e.h)}}p.BASE=new p(e.Gx,e.Gy,ve,c(e.Gx*e.Gy)),p.ZERO=new p(Ve,ve,ve,Ve);let S=es(p,s*8);function m(g){if(!(g instanceof p))throw new TypeError("ExtendedPoint expected")}let E=new WeakMap;class b{constructor(u,y){this.x=u,this.y=y}_setWindowSize(u){this._WINDOW_SIZE=u,E.delete(this)}static fromHex(u,y=!0){let{d:P,a:k}=e;u=ue(u,i);let O=u.slice(),T=u[i-1];O[i-1]=T&-129;let N=_e(O);if(y&&N>=t.ORDER)throw new Error("Expected 0 < hex < P");if(!y&&N>=o)throw new Error("Expected 0 < hex < 2**256");let C=c(N*N),F=c(C-ve),Q=c(P*C-k),{isValid:W,value:Pe}=h(F,Q);if(!W)throw new Error("Point.fromHex: invalid y coordinate");let We=(Pe&ve)===ve;return(T&128)!==0!==We&&(Pe=c(-Pe)),new b(Pe,N)}static fromPrivateKey(u){return U(u).point}toRawBytes(){let u=Be(this.y,i);return u[i-1]|=this.x&ve?128:0,u}toHex(){return ot(this.toRawBytes())}isTorsionFree(){return p.fromAffine(this).isTorsionFree()}equals(u){if(!(u instanceof b))throw new TypeError("Point#equals: expected Point");return this.x===u.x&&this.y===u.y}negate(){return new b(c(-this.x),this.y)}double(){return p.fromAffine(this).double().toAffine()}add(u){return p.fromAffine(this).add(p.fromAffine(u)).toAffine()}subtract(u){return this.add(u.negate())}multiply(u){return p.fromAffine(this).multiply(u,this).toAffine()}clearCofactor(){return p.fromAffine(this).clearCofactor().toAffine()}static hashToCurve(u,y){if(!e.mapToCurve)throw new Error("No mapToCurve defined for curve");u=ue(u);let P=En(u,2,{...e.htfDefaults,...y}),{x:k,y:O}=e.mapToCurve(P[0]),{x:T,y:N}=e.mapToCurve(P[1]);return new b(k,O).add(new b(T,N)).clearCofactor()}static encodeToCurve(u,y){if(!e.mapToCurve)throw new Error("No mapToCurve defined for curve");u=ue(u);let P=En(u,1,{...e.htfDefaults,...y}),{x:k,y:O}=e.mapToCurve(P[0]);return new b(k,O).clearCofactor()}}b.BASE=new b(e.Gx,e.Gy),b.ZERO=new b(Ve,ve);class A{constructor(u,y){this.r=u,this.s=y,this.assertValidity()}static fromHex(u){let y=ue(u,2*i),P=b.fromHex(y.slice(0,i),!1),k=_e(y.slice(i,2*i));return new A(P,k)}assertValidity(){let{r:u,s:y}=this;if(!(u instanceof b))throw new Error("Expected Point instance");return j(y,n,!1),this}toRawBytes(){return Ee(this.r.toRawBytes(),Be(this.s,i))}toHex(){return ot(this.toRawBytes())}}function L(g){return R(_e(g),n)}function j(g,u,y=!0){if(!u)throw new TypeError("Specify max value");if(typeof g=="number"&&Number.isSafeInteger(g)&&(g=BigInt(g)),typeof g=="bigint"&&g<u){if(y){if(Ve<g)return g}else if(Ve<=g)return g}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function K(g){if(g=typeof g=="bigint"||typeof g=="number"?Be(j(g,o),s):ue(g),g.length!==s)throw new Error(`Expected ${s} bytes, got ${g.length}`);return g}function I(g){let u=d(g.slice(0,s)),y=g.slice(s,2*s),P=L(u),k=b.BASE.multiply(P),O=k.toRawBytes();return{head:u,prefix:y,scalar:P,point:k,pointBytes:O}}function U(g){return I(e.hash(K(g)))}function z(g){return U(g).pointBytes}let Y=new Uint8Array;function Z(g,u=Y){return u=ue(u),L(e.hash(x(g,u,!!e.preHash)))}function q(g,u,y){g=ue(g),e.preHash&&(g=e.preHash(g));let{prefix:P,scalar:k,pointBytes:O}=U(u),T=Z(Ee(P,g),y),N=b.BASE.multiply(T),C=Z(Ee(N.toRawBytes(),O,g),y),F=R(T+C*k,n);return new A(N,F).toRawBytes()}function re(g,u,y,P){if(u=ue(u),e.preHash&&(u=e.preHash(u)),!(y instanceof b))if(y instanceof Uint8Array||typeof y=="string")y=b.fromHex(y,!1);else throw new Error(`Invalid publicKey: ${y}`);if(g instanceof A)g.assertValidity();else if(g instanceof Uint8Array||typeof g=="string")g=A.fromHex(g);else throw new Error(`Wrong signature: ${g}`);let{r:k,s:O}=g,T=p.BASE.multiplyUnsafe(O),N=Z(Ee(k.toRawBytes(),y.toRawBytes(),u),P),C=p.fromAffine(y).multiplyUnsafe(N);return p.fromAffine(k).add(C).subtract(T).multiplyUnsafe(e.h).equals(p.ZERO)}b.BASE._setWindowSize(8);let G={getExtendedPublicKey:U,mod:c,invert:t.invert,hashToPrivateScalar:g=>$i(g,n,!0),randomPrivateKey:()=>a(i),precompute(g=8,u=b.BASE){let y=u.equals(b.BASE)?u:new b(u.x,u.y);return y._setWindowSize(g),y.multiply(Rt),y}};return{CURVE:e,getPublicKey:z,sign:q,verify:re,ExtendedPoint:p,Point:b,Signature:A,utils:G}}var St=BigInt(0),vn=BigInt(1);function ja(r){for(let e of["a24"])if(typeof r[e]!="bigint")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["montgomeryBits","nByteLength"])if(r[e]!==void 0&&!Number.isSafeInteger(r[e]))throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);for(let e of["adjustScalarBytes","domain","powPminus2"])if(r[e]!==void 0&&typeof r[e]!="function")throw new Error(`Invalid ${e} function`);for(let e of["Gu"])if(r[e]!==void 0&&typeof r[e]!="string")throw new Error(`Invalid curve param ${e}=${r[e]} (${typeof r[e]})`);return Object.freeze({...r})}function zr(r){let e=ja(r),{P:t}=e,n=m=>R(m,t),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(m=>m),c=e.powPminus2||(m=>Dt(m,t-BigInt(2),t));function f(m,E,b=!0){if(!E)throw new TypeError("Specify max value");if(typeof m=="number"&&Number.isSafeInteger(m)&&(m=BigInt(m)),typeof m=="bigint"&&m<E){if(b){if(St<m)return m}else if(St<=m)return m}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function h(m,E,b){let A=n(m*(E-b));return E=n(E-A),b=n(b+A),[E,b]}function l(m,E){let{P:b}=e,A=f(m,b),L=f(E,b),j=e.a24,K=A,I=vn,U=St,z=A,Y=vn,Z=St,q;for(let G=BigInt(i-1);G>=St;G--){let g=L>>G&vn;Z^=g,q=h(Z,I,z),I=q[0],z=q[1],q=h(Z,U,Y),U=q[0],Y=q[1],Z=g;let u=I+U,y=n(u*u),P=I-U,k=n(P*P),O=y-k,T=z+Y,N=z-Y,C=n(N*u),F=n(T*P),Q=C+F,W=C-F;z=n(Q*Q),Y=n(K*n(W*W)),I=n(y*k),U=n(O*(y+n(j*O)))}q=h(Z,I,z),I=q[0],z=q[1],q=h(Z,U,Y),U=q[0],Y=q[1];let re=c(U);return n(I*re)}function d(m){return Be(n(m),s)}function w(m){let E=ue(m,s);return E[o-1]&=127,_e(E)}function x(m){let E=ue(m);if(E.length!==s&&E.length!==o)throw new Error(`Expected ${s} or ${o} bytes, got ${E.length}`);return _e(a(E))}function p(m,E){let b=w(E),A=x(m),L=l(b,A);if(L===St)throw new Error("Invalid private or public key received");return d(L)}function S(m){return p(m,e.Gu)}return{scalarMult:p,scalarMultBase:S,getSharedSecret:(m,E)=>p(m,E),getPublicKey:m=>S(m),Gu:e.Gu}}var jt=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),rs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),qa=BigInt(0),Ke=BigInt(1),Cr=BigInt(2),Ma=BigInt(5),ns=BigInt(10),Ga=BigInt(20),Fa=BigInt(40),is=BigInt(80);function fs(r){let e=jt,n=r*r%e*r%e,i=ee(n,Cr,e)*n%e,s=ee(i,Ke,e)*r%e,o=ee(s,Ma,e)*s%e,a=ee(o,ns,e)*o%e,c=ee(a,Ga,e)*a%e,f=ee(c,Fa,e)*c%e,h=ee(f,is,e)*f%e,l=ee(h,is,e)*f%e,d=ee(l,ns,e)*o%e;return{pow_p_5_8:ee(d,Cr,e)*r%e,b2:n}}function us(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Bn(r,e){let t=jt,n=R(e*e*e,t),i=R(n*n*e,t),s=fs(r*i).pow_p_5_8,o=R(r*n*s,t),a=R(e*o*o,t),c=o,f=R(o*rs,t),h=a===r,l=a===R(-r,t),d=a===R(-r*rs,t);return h&&(o=c),(l||d)&&(o=f),Oe(o,t)&&(o=R(-o,t)),{isValid:h||l,value:o}}var v=Nr(jt,void 0,!0),$a=(v.ORDER+BigInt(3))/BigInt(8),Za=v.pow(Cr,$a),ss=v.sqrt(v.negate(v.ONE)),Va=(v.ORDER-BigInt(5))/BigInt(8),os=BigInt(486662);function Xa(r){let e=v.square(r);e=v.mul(e,Cr);let t=v.add(e,v.ONE),n=v.negate(os),i=v.square(t),s=v.mul(i,t),o=v.mul(e,os);o=v.mul(o,n),o=v.add(o,i),o=v.mul(o,n);let a=v.square(s);i=v.square(a),a=v.mul(a,s),a=v.mul(a,o),i=v.mul(i,a);let c=v.pow(i,Va);c=v.mul(c,a);let f=v.mul(c,ss);i=v.square(c),i=v.mul(i,s);let h=v.equals(i,o),l=v.cmov(f,c,h),d=v.mul(n,e),w=v.mul(c,r);w=v.mul(w,Za);let x=v.mul(w,ss),p=v.mul(o,e);i=v.square(w),i=v.mul(i,s);let S=v.equals(i,p),m=v.cmov(x,w,S);i=v.square(l),i=v.mul(i,s);let E=v.equals(i,o),b=v.cmov(d,n,E),A=v.cmov(m,l,E),L=v.isOdd(A);return A=v.cmov(A,v.negate(A),E!==L),{xMn:b,xMd:t,yMn:A,yMd:1n}}var Ya=Ji(v,v.negate(BigInt(486664)));function Wa(r){let{xMn:e,xMd:t,yMn:n,yMd:i}=Xa(r),s=v.mul(e,i);s=v.mul(s,Ya);let o=v.mul(t,n),a=v.sub(e,t),c=v.add(e,t),f=v.mul(o,c),h=v.equals(f,v.ZERO);s=v.cmov(s,v.ZERO,h),o=v.cmov(o,v.ONE,h),a=v.cmov(a,v.ONE,h),c=v.cmov(c,v.ONE,h);let l=v.invertBatch([o,c]);return{x:v.mul(s,l[0]),y:v.mul(a,l[1])}}var Pn={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:v,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:bt,randomBytes:pr,adjustScalarBytes:us,uvRatio:Bn,htfDefaults:{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",p:v.ORDER,m:1,k:128,expand:"xmd",hash:bt},mapToCurve:r=>Wa(r[0])},he=ct(Pn);function hs(r,e,t){if(e.length>255)throw new Error("Context is too big");return yr(Ut("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,r)}var Zf=ct({...Pn,domain:hs}),Vf=ct({...Pn,domain:hs,preHash:bt}),In=zr({P:jt,a24:BigInt("121665"),montgomeryBits:255,nByteLength:32,Gu:"0900000000000000000000000000000000000000000000000000000000000000",powPminus2:r=>{let e=jt,{pow_p_5_8:t,b2:n}=fs(r);return R(ee(t,BigInt(3),e)*n,e)},adjustScalarBytes:us});function Sn(r){if(!(r instanceof ye))throw new TypeError("RistrettoPoint expected")}var kn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Qa=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ja=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ec=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),tc=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),as=r=>Bn(Ke,r),rc=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),An=r=>he.utils.mod(_e(r)&rc);function cs(r){let{d:e}=he.CURVE,t=he.CURVE.Fp.ORDER,{mod:n}=he.utils,i=n(kn*r*r),s=n((i+Ke)*ec),o=BigInt(-1),a=n((o-e*i)*n(i+e)),{isValid:c,value:f}=Bn(s,a),h=n(f*r);Oe(h,t)||(h=n(-h)),c||(f=h),c||(o=i);let l=n(o*(i-Ke)*tc-a),d=f*f,w=n((f+f)*a),x=n(l*Qa),p=n(Ke-d),S=n(Ke+d);return new he.ExtendedPoint(n(w*S),n(p*x),n(x*S),n(w*p))}var ye=class{constructor(e){this.ep=e}static hashToCurve(e){e=ue(e,64);let t=An(e.slice(0,32)),n=cs(t),i=An(e.slice(32,64)),s=cs(i);return new ye(n.add(s))}static fromHex(e){e=ue(e,32);let{a:t,d:n}=he.CURVE,i=he.CURVE.Fp.ORDER,{mod:s}=he.utils,o="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",a=An(e);if(!Zi(Be(a,32),e)||Oe(a,i))throw new Error(o);let c=s(a*a),f=s(Ke+t*c),h=s(Ke-t*c),l=s(f*f),d=s(h*h),w=s(t*n*l-d),{isValid:x,value:p}=as(s(w*d)),S=s(p*h),m=s(p*S*w),E=s((a+a)*S);Oe(E,i)&&(E=s(-E));let b=s(f*m),A=s(E*b);if(!x||Oe(A,i)||b===qa)throw new Error(o);return new ye(new he.ExtendedPoint(E,b,Ke,A))}toRawBytes(){let{x:e,y:t,z:n,t:i}=this.ep,s=he.CURVE.Fp.ORDER,{mod:o}=he.utils,a=o(o(n+t)*o(n-t)),c=o(e*t),f=o(c*c),{value:h}=as(o(a*f)),l=o(h*a),d=o(h*c),w=o(l*d*i),x;if(Oe(i*w,s)){let S=o(t*kn),m=o(e*kn);e=S,t=m,x=o(l*Ja)}else x=d;Oe(e*w,s)&&(t=o(-t));let p=o((n-t)*x);return Oe(p,s)&&(p=o(-p)),Be(p,32)}toHex(){return ot(this.toRawBytes())}toString(){return this.toHex()}equals(e){Sn(e);let t=this.ep,n=e.ep,{mod:i}=he.utils,s=i(t.x*n.y)===i(t.y*n.x),o=i(t.y*n.y)===i(t.x*n.x);return s||o}add(e){return Sn(e),new ye(this.ep.add(e.ep))}subtract(e){return Sn(e),new ye(this.ep.subtract(e.ep))}multiply(e){return new ye(this.ep.multiply(e))}multiplyUnsafe(e){return new ye(this.ep.multiplyUnsafe(e))}};ye.BASE=new ye(he.ExtendedPoint.BASE);ye.ZERO=new ye(he.ExtendedPoint.ZERO);var qt="X25519",Dr=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=32,this._nSk=32}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=he.utils.randomPrivateKey(),t=new ie(qt,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(V,Ce,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,ut,V,this._nSk),i=new ie(qt,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie(qt,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie(qt,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=In.getPublicKey(e.key);t(new ie(qt,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(In.getSharedSecret(e.key,t.key).buffer)}catch(s){i(s)}})}};var[ws,ys,ps]=[[],[],[]],nc=BigInt(0),Mt=BigInt(1),ic=BigInt(2),sc=BigInt(7),oc=BigInt(256),ac=BigInt(113);for(let r=0,e=Mt,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],ws.push(2*(5*n+t)),ys.push((r+1)*(r+2)/2%64);let i=nc;for(let s=0;s<7;s++)e=(e<<Mt^(e>>sc)*ac)%oc,e&ic&&(i^=Mt<<(Mt<<BigInt(s))-Mt);ps.push(i)}var[cc,fc]=H.split(ps,!0),ls=(r,e,t)=>t>32?H.rotlBH(r,e,t):H.rotlSH(r,e,t),ds=(r,e,t)=>t>32?H.rotlBL(r,e,t):H.rotlSL(r,e,t);function uc(r,e=24){let t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,f=t[c],h=t[c+1],l=ls(f,h,1)^t[a],d=ds(f,h,1)^t[a+1];for(let w=0;w<50;w+=10)r[o+w]^=l,r[o+w+1]^=d}let i=r[2],s=r[3];for(let o=0;o<24;o++){let a=ys[o],c=ls(i,s,a),f=ds(i,s,a),h=ws[o];i=r[h],s=r[h+1],r[h]=c,r[h+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=cc[n],r[1]^=fc[n]}t.fill(0)}var At=class extends De{constructor(e,t,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,fe.number(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Bi(this.state)}keccak(){uc(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){fe.exists(this);let{blockLen:t,state:n}=this;e=Re(e);let i=e.length;for(let s=0;s<i;){let o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,t&128&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){fe.exists(this,!1),fe.bytes(e),this.finish();let t=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();let o=Math.min(n-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return fe.number(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(fe.output(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new At(t,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}},Xe=(r,e,t)=>xe(()=>new At(e,r,t)),ru=Xe(6,144,224/8),nu=Xe(6,136,256/8),iu=Xe(6,104,384/8),su=Xe(6,72,512/8),ou=Xe(1,144,224/8),au=Xe(1,136,256/8),cu=Xe(1,104,384/8),fu=Xe(1,72,512/8),bs=(r,e,t)=>Pi((n={})=>new At(e,r,n.dkLen===void 0?t:n.dkLen,!0)),uu=bs(31,168,128/8),Rr=bs(31,136,256/8);var hc=xe(()=>Rr.create({dkLen:114})),lc=xe(()=>Rr.create({dkLen:64})),Gt=BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018365439");function gs(r){let e=Gt,t=BigInt(1),n=BigInt(2),i=BigInt(3),s=BigInt(11),o=BigInt(22),a=BigInt(44),c=BigInt(88),f=BigInt(223),h=r*r*r%e,l=h*h*r%e,d=ee(l,i,e)*l%e,w=ee(d,i,e)*l%e,x=ee(w,n,e)*h%e,p=ee(x,s,e)*x%e,S=ee(p,o,e)*p%e,m=ee(S,a,e)*S%e,E=ee(m,c,e)*m%e,b=ee(E,a,e)*S%e,A=ee(b,n,e)*h%e,L=ee(A,t,e)*r%e;return ee(L,f,e)*A%e}function ms(r){return r[0]&=252,r[55]|=128,r[56]=0,r}var _=Nr(Gt,456,!0),dc=(_.ORDER-BigInt(3))/BigInt(4),xs=BigInt(156326);function wc(r){let e=_.square(r),t=_.equals(e,_.ONE);e=_.cmov(e,_.ZERO,t);let n=_.sub(_.ONE,e),i=_.negate(xs),s=_.square(n),o=_.mul(s,n),a=_.mul(e,_.negate(xs));a=_.mul(a,i),a=_.add(a,s),a=_.mul(a,i);let c=_.square(o);s=_.mul(a,o),c=_.mul(c,s);let f=_.pow(c,dc);f=_.mul(f,s);let h=_.mul(i,_.negate(e)),l=_.mul(f,r);l=_.cmov(l,_.ZERO,t),s=_.square(f),s=_.mul(s,o);let d=_.equals(s,a),w=_.cmov(h,i,d),x=_.cmov(l,f,d),p=_.isOdd(x);return x=_.cmov(x,_.negate(x),d!==p),{xn:w,xd:n,yn:x,yd:_.ONE}}function yc(r){let{xn:e,xd:t,yn:n,yd:i}=wc(r),s=_.square(e),o=_.square(t),a=_.square(o),c=_.square(n),f=_.square(i),h=_.sub(s,o),l=_.sub(h,o);h=_.mul(h,o),h=_.mul(h,i),h=_.mul(h,n),h=_.mul(h,4n),l=_.mul(l,s),l=_.mul(l,f);let d=_.mul(c,4n),w=_.add(d,f);w=_.mul(w,a);let x=_.add(w,l);l=_.mul(l,e);let p=_.mul(e,a),S=_.sub(d,f);S=_.mul(S,p),S=_.sub(S,l),w=_.add(s,o),w=_.mul(w,o),w=_.mul(w,t),w=_.mul(w,c),w=_.mul(w,BigInt(-2));let m=_.add(l,w);p=_.mul(p,f),m=_.add(m,p),w=_.mul(x,m);let E=_.equals(w,_.ZERO);h=_.cmov(h,_.ZERO,E),x=_.cmov(x,_.ONE,E),S=_.cmov(S,_.ONE,E),m=_.cmov(m,_.ONE,E);let b=_.invertBatch([x,m]);return{x:_.mul(h,b[0]),y:_.mul(S,b[1])}}var _s={a:BigInt(1),d:BigInt("726838724295606890549323807888004534353641360687318060281490199180612328166730772686396383698676545930088884461843637361053498018326358"),Fp:_,n:BigInt("181709681073901722637330951972001133588410340171829515070372549795146003961539585716195755291692375963310293709091662304773755859649779"),nBitLength:456,h:BigInt(4),Gx:BigInt("224580040295924300187604334099896036246789641632564134246125461686950415467406032909029192869357953282578032075146446173674602635247710"),Gy:BigInt("298819210078481492676017930443930673437544040154080242095928241372331506189835876003536878655418784733982303233503462500531545062832660"),hash:hc,randomBytes:pr,adjustScalarBytes:ms,domain:(r,e,t)=>{if(e.length>255)throw new Error(`Context is too big: ${e.length}`);return yr(Ut("SigEd448"),new Uint8Array([t?1:0,e.length]),e,r)},uvRatio:(r,e)=>{let t=Gt,n=R(r*r*e,t),i=R(n*r,t),s=R(i*n*e,t),o=gs(s),a=R(i*o,t),c=R(a*a,t);return{isValid:R(c*e,t)===r,value:a}},htfDefaults:{DST:"edwards448_XOF:SHAKE256_ELL2_RO_",p:_.ORDER,m:1,k:224,expand:"xof",hash:Rr},mapToCurve:r=>yc(r[0])},Es=ct(_s),bu=ct({..._s,preHash:lc}),Ln=zr({a24:BigInt(39081),montgomeryBits:448,nByteLength:57,P:Gt,Gu:"0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",powPminus2:r=>{let e=Gt,t=gs(r),n=ee(t,BigInt(2),e);return R(n*r,e)},adjustScalarBytes:ms});var Ft="X448",jr=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){return await this._serializePublicKey(e)}async deserializePublicKey(e){return await this._deserializePublicKey(e)}async importKey(e,t,n){if(e!=="raw")throw new Error("Unsupported format");return await this._importKey(t,n)}async derivePublicKey(e){return await this._derivePublicKey(e)}async generateKeyPair(){let e=Es.utils.randomPrivateKey(),t=new ie(Ft,e,"private");return{publicKey:await this.derivePublicKey(t),privateKey:t}}async deriveKeyPair(e){let t=await this._hkdf.labeledExtract(V,Ce,new Uint8Array(e)),n=await this._hkdf.labeledExpand(t,ut,V,this._nSk),i=new ie(Ft,new Uint8Array(n),"private");return{privateKey:i,publicKey:await this.derivePublicKey(i)}}async dh(e,t){return await this._dh(e,t)}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_deserializePublicKey(e){return new Promise((t,n)=>{e.byteLength!==this._nPk?n(new Error("Invalid public key for the ciphersuite")):t(new ie(Ft,new Uint8Array(e),"public"))})}_importKey(e,t){return new Promise((n,i)=>{t&&e.byteLength!==this._nPk&&i(new Error("Invalid public key for the ciphersuite")),!t&&e.byteLength!==this._nSk&&i(new Error("Invalid private key for the ciphersuite")),n(new ie(Ft,new Uint8Array(e),t?"public":"private"))})}_derivePublicKey(e){return new Promise(t=>{let n=Ln.getPublicKey(e.key);t(new ie(Ft,n,"public"))})}_dh(e,t){return new Promise((n,i)=>{try{n(Ln.getSharedSecret(e.key,t.key).buffer)}catch(s){i(s)}})}};var Ye=class extends Ne{constructor(e,t,n){super(e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._prim=t,this._kdf=n}async generateKeyPair(){try{return await this._prim.generateKeyPair()}catch(e){throw new Ie(e)}}async deriveKeyPair(e){try{return await this._prim.deriveKeyPair(e)}catch(t){throw new er(t)}}async serializePublicKey(e){try{return await this._prim.serializePublicKey(e)}catch(t){throw new Xt(t)}}async deserializePublicKey(e){try{return await this._prim.deserializePublicKey(e)}catch(t){throw new ft(t)}}async importKey(e,t,n){try{return await this._prim.importKey(e,t,n)}catch(i){throw new ft(i)}}async encap(e){try{let t=e.nonEphemeralKeyPair===void 0?await this.generateKeyPair():e.nonEphemeralKeyPair,n=await this._prim.serializePublicKey(t.publicKey),i=await this._prim.serializePublicKey(e.recipientPublicKey),s;if(e.senderKey===void 0)s=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey));else{let c=Bt(e.senderKey)?e.senderKey.privateKey:e.senderKey,f=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey)),h=new Uint8Array(await this._prim.dh(c,e.recipientPublicKey));s=Pt(f,h)}let o;if(e.senderKey===void 0)o=Pt(new Uint8Array(n),new Uint8Array(i));else{let c=Bt(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),f=await this._prim.serializePublicKey(c);o=Vn(new Uint8Array(n),new Uint8Array(i),new Uint8Array(f))}let a=await this.generateSharedSecret(s,o);return{enc:n,sharedSecret:a}}catch(t){throw new Yt(t)}}async decap(e){let t;try{t=await this._prim.deserializePublicKey(e.enc)}catch(n){throw new ft(n)}try{let n=Bt(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,i=Bt(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),s=await this._prim.serializePublicKey(i),o;if(e.senderPublicKey===void 0)o=new Uint8Array(await this._prim.dh(n,t));else{let c=new Uint8Array(await this._prim.dh(n,t)),f=new Uint8Array(await this._prim.dh(n,e.senderPublicKey));o=Pt(c,f)}let a;if(e.senderPublicKey===void 0)a=Pt(new Uint8Array(e.enc),new Uint8Array(s));else{let c=await this._prim.serializePublicKey(e.senderPublicKey);a=new Uint8Array(e.enc.byteLength+s.byteLength+c.byteLength),a.set(new Uint8Array(e.enc),0),a.set(new Uint8Array(s),e.enc.byteLength),a.set(new Uint8Array(c),e.enc.byteLength+s.byteLength)}return await this.generateSharedSecret(o,a)}catch(n){throw new Wt(n)}}async generateSharedSecret(e,t){let n=this._kdf.buildLabeledIkm(Qn,e),i=this._kdf.buildLabeledInfo(ri,t,this.secretSize);return await this._kdf.extractAndExpand(V,n,i,this.secretSize)}},qr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemP256HkdfSha256,2),3);let n=new Fe(e,t),i=new gt(M.DhkemP256HkdfSha256,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},Mr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemP384HkdfSha384,2),3);let n=new xt(e,t),i=new gt(M.DhkemP384HkdfSha384,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}},Gr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemP521HkdfSha512,2),3);let n=new rt(e,t),i=new gt(M.DhkemP521HkdfSha512,n,e);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}},Fr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemSecp256K1HkdfSha256,2),3);let n=new Fe(e,t),i=new Or(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemSecp256K1HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},$r=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemX25519HkdfSha256,2),3);let n=new Fe(e,t),i=new Dr(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},Zr=class extends Ye{constructor(e){let t=new Uint8Array(tt);t.set(le(M.DhkemX448HkdfSha512,2),3);let n=new rt(e,t),i=new jr(n);super(e,i,n),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:M.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}};var Un=class{constructor(e){switch(Object.defineProperty(this,"kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kemSecretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemEncSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPublicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"kemPrivateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadNonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"aeadTagSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.kem){case M.DhkemP256HkdfSha256:this.kemSecretSize=32,this.kemEncSize=65,this.kemPublicKeySize=65,this.kemPrivateKeySize=32;break;case M.DhkemP384HkdfSha384:this.kemSecretSize=48,this.kemEncSize=97,this.kemPublicKeySize=97,this.kemPrivateKeySize=48;break;case M.DhkemP521HkdfSha512:this.kemSecretSize=64,this.kemEncSize=133,this.kemPublicKeySize=133,this.kemPrivateKeySize=66;break;case M.DhkemSecp256K1HkdfSha256:this.kemSecretSize=32,this.kemEncSize=65,this.kemPublicKeySize=65,this.kemPrivateKeySize=32;break;case M.DhkemX25519HkdfSha256:this.kemSecretSize=32,this.kemEncSize=32,this.kemPublicKeySize=32,this.kemPrivateKeySize=32;break;case M.DhkemX448HkdfSha512:this.kemSecretSize=64,this.kemEncSize=56,this.kemPublicKeySize=56,this.kemPrivateKeySize=56;break;default:throw new pe("Invalid KEM id")}switch(this.kem=e.kem,e.kdf){case we.HkdfSha256:case we.HkdfSha384:case we.HkdfSha512:break;default:throw new pe("Invalid KDF id")}switch(this.kdf=e.kdf,e.aead){case ne.Aes128Gcm:this.aeadKeySize=16,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.Aes256Gcm:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.Chacha20Poly1305:this.aeadKeySize=32,this.aeadNonceSize=12,this.aeadTagSize=16;break;case ne.ExportOnly:break;default:throw new pe("Invalid AEAD id")}this.aead=e.aead,this._suiteId=new Uint8Array(Wn),this._suiteId.set(le(this.kem,2),4),this._suiteId.set(le(this.kdf,2),6),this._suiteId.set(le(this.aead,2),8)}async kemContext(){return await this.setup(),this._kem}async kdfContext(){return await this.setup(),this._kdf}async createAeadKey(e){return await this.setup(),dr(this.aead,e,this._api)}async generateKeyPair(){return await this.setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>128)throw new pe("Too long ikm");return await this.setup(),await this._kem.deriveKeyPair(e)}async importKey(e,t,n=!0){return await this.setup(),await this._kem.importKey(e,t,n)}async createSenderContext(e){this.validateInputLength(e),await this.setup();let t=await this._kem.encap(e),n;return e.psk!==void 0?n=e.senderKey!==void 0?Se.AuthPsk:Se.Psk:n=e.senderKey!==void 0?Se.Auth:Se.Base,await this.keyScheduleS(n,t.sharedSecret,t.enc,e)}async createRecipientContext(e){this.validateInputLength(e),await this.setup();let t=await this._kem.decap(e),n;return e.psk!==void 0?n=e.senderPublicKey!==void 0?Se.AuthPsk:Se.Psk:n=e.senderPublicKey!==void 0?Se.Auth:Se.Base,await this.keyScheduleR(n,t,e)}async seal(e,t,n=V){let i=await this.createSenderContext(e);return{ct:await i.seal(t,n),enc:i.enc}}async open(e,t,n=V){return await(await this.createRecipientContext(e)).open(t,n)}async setup(){this._api=await Xn(),(this._kem===void 0||this._kdf===void 0)&&(this._kem=this.createKemContext(),this._kdf=this.createKdfContext())}async keySchedule(e,t,n){let i=this.createKdfContext(),s=n.psk===void 0?V:new Uint8Array(n.psk.id),o=await i.labeledExtract(V,ei,s),a=n.info===void 0?V:new Uint8Array(n.info),c=await i.labeledExtract(V,Jn,a),f=new Uint8Array(1+o.byteLength+c.byteLength);f.set(new Uint8Array([e]),0),f.set(new Uint8Array(o),1),f.set(new Uint8Array(c),1+o.byteLength);let h=n.psk===void 0?V:new Uint8Array(n.psk.key),l=i.buildLabeledIkm(ti,h),d=i.buildLabeledInfo(si,f,i.hashSize),w=await i.extractAndExpand(t,l,d,i.hashSize);if(this.aead===ne.ExportOnly)return{params:{aead:this.aead,exporterSecret:w},kdf:i};let x=i.buildLabeledInfo(ni,f,this.aeadKeySize),p=await i.extractAndExpand(t,l,x,this.aeadKeySize),S=i.buildLabeledInfo(ii,f,this.aeadNonceSize),m=await i.extractAndExpand(t,l,S,this.aeadNonceSize);return{params:{aead:this.aead,exporterSecret:w,key:p,baseNonce:new Uint8Array(m),seq:0},kdf:i}}async keyScheduleS(e,t,n,i){let s=await this.keySchedule(e,t,i);return s.params.key===void 0?new rr(this._api,s.kdf,s.params.exporterSecret,n):new _r(this._api,s.kdf,s.params,n)}async keyScheduleR(e,t,n){let i=await this.keySchedule(e,t,n);return i.params.key===void 0?new tr(this._api,i.kdf,i.params.exporterSecret):new mr(this._api,i.kdf,i.params)}validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>128)throw new pe("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new pe(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>128)throw new pe("Too long psk.key");if(e.psk.id.byteLength>128)throw new pe("Too long psk.id")}}createKemContext(){switch(this.kem){case M.DhkemP256HkdfSha256:return new qr(this._api);case M.DhkemP384HkdfSha384:return new Mr(this._api);case M.DhkemP521HkdfSha512:return new Gr(this._api);case M.DhkemX25519HkdfSha256:return new $r(this._api);case M.DhkemX448HkdfSha512:return new Zr(this._api);default:return new Fr(this._api)}}createKdfContext(){switch(this.kdf){case we.HkdfSha256:return new Fe(this._api,this._suiteId);case we.HkdfSha384:return new xt(this._api,this._suiteId);default:return new rt(this._api,this._suiteId)}}};export{ne as Aead,Un as CipherSuite,Wt as DecapError,er as DeriveKeyPairError,ft as DeserializeError,Yt as EncapError,Qt as ExportError,pe as InvalidParamError,we as Kdf,M as Kem,Jt as MessageLimitReachedError,Ie as NotSupportedError,Je as OpenError,Qe as SealError,Xt as SerializeError,Mn as ValidationError};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/group.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/hash-to-curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/lib/esm/ed448.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
