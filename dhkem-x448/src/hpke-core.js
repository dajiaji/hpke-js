var m={Base:0,Psk:1,Auth:2,AuthPsk:3},Pe={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33},h=Pe,Se={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},x=Se,ve={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},y=ve;var f=class extends Error{constructor(e){let r;e instanceof Error?r=e.message:typeof e=="string"?r=e:r="",super(r),this.name=this.constructor.name}},l=class extends f{},ue=class extends f{},S=class extends f{},k=class extends f{},C=class extends f{},B=class extends f{},R=class extends f{},G=class extends f{},Y=class extends f{},F=class extends f{},q=class extends f{},w=class extends f{};function ne(){return new Promise((i,e)=>{e(new w("Not supported"))})}var c=new Uint8Array(0);var Ae=new Uint8Array([115,101,99]),v=class{constructor(e,r,t){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e,this._kdf=r,this.exporterSecret=t}async seal(e,r){return await ne()}async open(e,r){return await ne()}async export(e,r){if(e.byteLength>8192)throw new l("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,Ae,new Uint8Array(e),r)}catch(t){throw new R(t)}}},W=class extends v{},X=class extends v{constructor(e,r,t,n){super(e,r,t),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=n}};var Ke={},ce=Ee(globalThis,Ke);function Ee(i,e){return new Proxy(i,{get(r,t,n){return t in e?e[t]:i[t]},set(r,t,n){return t in e&&delete e[t],i[t]=n,!0},deleteProperty(r,t){let n=!1;return t in e&&(delete e[t],n=!0),t in i&&(delete i[t],n=!0),n},ownKeys(r){let t=Reflect.ownKeys(i),n=Reflect.ownKeys(e),a=new Set(n);return[...t.filter(o=>!a.has(o)),...n]},defineProperty(r,t,n){return t in e&&delete e[t],Reflect.defineProperty(i,t,n),!0},getOwnPropertyDescriptor(r,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(i,t)},has(r,t){return t in e||t in i}})}var he=()=>typeof ce<"u",le=()=>typeof caches<"u";var z=i=>typeof i=="object"&&i!==null&&typeof i.privateKey=="object"&&typeof i.publicKey=="object";function _(i,e){if(e<=0)throw new Error("i2Osp: too small size");if(i>=256**e)throw new Error("i2Osp: too large integer");let r=new Uint8Array(e);for(let t=0;t<e&&i;t++)r[e-(t+1)]=i%256,i=i>>8;return r}function fe(i,e){if(i.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let r=new Uint8Array(i.byteLength);for(let t=0;t<i.byteLength;t++)r[t]=i[t]^e[t];return r}function j(i,e){let r=new Uint8Array(i.length+e.length);return r.set(i,0),r.set(e,i.length),r}function de(i,e,r){let t=new Uint8Array(i.length+e.length+r.length);return t.set(i,0),t.set(e,i.length),t.set(r,i.length+e.length),t}function ye(i){let e=i.replace(/-/g,"+").replace(/_/g,"/"),r=atob(e),t=new Uint8Array(r.length);for(let n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t}async function A(){if((he()||le())&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:i}=await import("crypto");return i.subtle}catch{throw new w("Web Cryptograph API not supported")}}var be=["encrypt","decrypt"];var se=class{constructor(e){Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e}async seal(e,r,t){await this._setup();let n={name:"AES-GCM",iv:e,additionalData:t};return await this._api.encrypt(n,this._key,r)}async open(e,r,t){await this._setup();let n={name:"AES-GCM",iv:e,additionalData:t};return await this._api.decrypt(n,this._key,r)}async _setup(){if(this._key!==void 0)return;this._api=await A();let e=await this._importKey(this._rawKey);new Uint8Array(this._rawKey).fill(0),this._key=e}async _importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,be)}},T=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:y.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new se(e)}},$=class extends T{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:y.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}};var J=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:y.ExportOnly}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}createEncryptionContext(e){throw new w("Export only")}};var K=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await A())}};var pe=new Uint8Array([72,80,75,69,45,118,49]),D=class extends K{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:x.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:c}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(e){this._suiteId=e}buildLabeledIkm(e,r){this._checkInit();let t=new Uint8Array(7+this._suiteId.byteLength+e.byteLength+r.byteLength);return t.set(pe,0),t.set(this._suiteId,7),t.set(e,7+this._suiteId.byteLength),t.set(r,7+this._suiteId.byteLength+e.byteLength),t}buildLabeledInfo(e,r,t){this._checkInit();let n=new Uint8Array(9+this._suiteId.byteLength+e.byteLength+r.byteLength);return n.set(new Uint8Array([0,t]),0),n.set(pe,2),n.set(this._suiteId,9),n.set(e,9+this._suiteId.byteLength),n.set(r,9+this._suiteId.byteLength+e.byteLength),n}async extract(e,r){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)throw new l("The salt length must be the same as the hashSize");let t=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",t,r)}async expand(e,r,t){await this._setup();let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),a=new ArrayBuffer(t),o=new Uint8Array(a),s=c,u=new Uint8Array(r),b=new Uint8Array(1);if(t>255*this.hashSize)throw new Error("Entropy limit reached");let p=new Uint8Array(this.hashSize+u.length+1);for(let M=1,d=0;d<o.length;M++)b[0]=M,p.set(s,0),p.set(u,s.length),p.set(b,s.length+u.length),s=new Uint8Array(await this._api.sign("HMAC",n,p.slice(0,s.length+u.length+1))),o.length-d>=s.length?(o.set(s,d),d+=s.length):(o.set(s.slice(0,o.length-d),d),d+=o.length-d);return a}async extractAndExpand(e,r,t,n){await this._setup();let a=await this._api.importKey("raw",r,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:t},a,n*8)}async labeledExtract(e,r,t){return await this.extract(e,this.buildLabeledIkm(r,t))}async labeledExpand(e,r,t,n){return await this.expand(e,this.buildLabeledInfo(r,t,n),n)}_checkInit(){if(this._suiteId===c)throw new Error("Not initialized. Call init()")}},E=class extends D{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:x.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}},I=class extends D{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:x.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}},L=class extends D{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:x.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var U=class extends v{constructor(e,r,t){if(super(e,r,t.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t.key===void 0||t.baseNonce===void 0||t.seq===void 0)throw new Error("Required parameters are missing");this._aead=t.aead,this._nK=this._aead.keySize,this._nN=this._aead.nonceSize,this._nT=this._aead.tagSize;let n=this._aead.createEncryptionContext(t.key);this._ctx={key:n,baseNonce:t.baseNonce,seq:t.seq}}computeNonce(e){let r=_(e.seq,e.baseNonce.byteLength);return fe(e.baseNonce,r)}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new F("Message limit reached");e.seq+=1}};var Z=class extends U{async open(e,r=c){let t;try{t=await this._ctx.key.open(this.computeNonce(this._ctx),e,r)}catch(n){throw new Y(n)}return this.incrementSeq(this._ctx),t}};var Q=class extends U{constructor(e,r,t,n){super(e,r,t),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=n}async seal(e,r=c){let t;try{t=await this._ctx.key.seal(this.computeNonce(this._ctx),e,r)}catch(n){throw new G(n)}return this.incrementSeq(this._ctx),t}};var Le=new Uint8Array([75,69,77,0,0]),Ue=new Uint8Array([101,97,101,95,112,114,107]),Oe=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]),O=class{constructor(e,r,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e,this._prim=r,this._kdf=t;let n=new Uint8Array(Le);n.set(_(this.id,2),3),this._kdf.init(n)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>8192)throw new l("Too long ikm");return await this._prim.deriveKeyPair(e)}async serializePublicKey(e){return await this._prim.serializePublicKey(e)}async deserializePublicKey(e){return await this._prim.deserializePublicKey(e)}async serializePrivateKey(e){return await this._prim.serializePrivateKey(e)}async deserializePrivateKey(e){return await this._prim.deserializePrivateKey(e)}async importKey(e,r,t=!0){return await this._prim.importKey(e,r,t)}async encap(e){let r=e.nonEphemeralKeyPair===void 0?await this.generateKeyPair():e.nonEphemeralKeyPair,t=await this._prim.serializePublicKey(r.publicKey),n=await this._prim.serializePublicKey(e.recipientPublicKey);try{let a;if(e.senderKey===void 0)a=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey));else{let u=z(e.senderKey)?e.senderKey.privateKey:e.senderKey,b=new Uint8Array(await this._prim.dh(r.privateKey,e.recipientPublicKey)),p=new Uint8Array(await this._prim.dh(u,e.recipientPublicKey));a=j(b,p)}let o;if(e.senderKey===void 0)o=j(new Uint8Array(t),new Uint8Array(n));else{let u=z(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),b=await this._prim.serializePublicKey(u);o=de(new Uint8Array(t),new Uint8Array(n),new Uint8Array(b))}let s=await this._generateSharedSecret(a,o);return{enc:t,sharedSecret:s}}catch(a){throw new C(a)}}async decap(e){let r=await this._prim.deserializePublicKey(e.enc),t=z(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,n=z(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),a=await this._prim.serializePublicKey(n);try{let o;if(e.senderPublicKey===void 0)o=new Uint8Array(await this._prim.dh(t,r));else{let u=new Uint8Array(await this._prim.dh(t,r)),b=new Uint8Array(await this._prim.dh(t,e.senderPublicKey));o=j(u,b)}let s;if(e.senderPublicKey===void 0)s=j(new Uint8Array(e.enc),new Uint8Array(a));else{let u=await this._prim.serializePublicKey(e.senderPublicKey);s=new Uint8Array(e.enc.byteLength+a.byteLength+u.byteLength),s.set(new Uint8Array(e.enc),0),s.set(new Uint8Array(a),e.enc.byteLength),s.set(new Uint8Array(u),e.enc.byteLength+a.byteLength)}return await this._generateSharedSecret(o,s)}catch(o){throw new B(o)}}async _generateSharedSecret(e,r){let t=this._kdf.buildLabeledIkm(Ue,e),n=this._kdf.buildLabeledInfo(Oe,r,this.secretSize);return await this._kdf.extractAndExpand(c,t,n,this.secretSize)}};var N=["deriveBits"],we=new Uint8Array([100,107,112,95,112,114,107]),At=new Uint8Array([115,107]);var V=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let r=0;r<this._num.length;r++){if(this._num[r]<e[r])return!0;if(this._num[r]>e[r])return!1}return!1}};var He=new Uint8Array([99,97,110,100,105,100,97,116,101]),ze=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),je=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),Te=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),De=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),Ne=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),Me=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),H=class extends K{constructor(e,r){switch(super(),Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=r,e){case h.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=ze,this._bitmask=255,this._pkcs8AlgId=De;break;case h.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=je,this._bitmask=255,this._pkcs8AlgId=Ne;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=Te,this._bitmask=1,this._pkcs8AlgId=Me;break}}async serializePublicKey(e){await this._setup();try{return await this._api.exportKey("raw",e)}catch(r){throw new S(r)}}async deserializePublicKey(e){await this._setup();try{return await this._api.importKey("raw",e,this._alg,!0,[])}catch(r){throw new k(r)}}async serializePrivateKey(e){await this._setup();try{let r=await this._api.exportKey("jwk",e);if(!("d"in r))throw new Error("Not private key");let t=ye(r.d);if(t.byteLength!==this._nSk)throw new Error("Invalid length of the key");return t}catch(r){throw new S(r)}}async deserializePrivateKey(e){try{if(await this._setup(),e.byteLength!==this._nSk)throw new Error("Invalid length of the key");return await this._importRawKey(e,!1)}catch(r){throw new k(r)}}async importKey(e,r,t){await this._setup();try{if(e==="raw")return await this._importRawKey(r,t);if(r instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(r,t)}catch(n){throw new k(n)}}async _importRawKey(e,r){if(r&&e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!r&&e.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");if(r)return await this._api.importKey("raw",e,this._alg,!0,[]);let t=new Uint8Array(e),n=new Uint8Array(this._pkcs8AlgId.length+t.length);return n.set(this._pkcs8AlgId,0),n.set(t,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",n,this._alg,!0,N)}async _importJWK(e,r){if(typeof e.crv>"u"||e.crv!==this._alg.namedCurve)throw new Error(`Invalid crv: ${e.crv}`);if(r){if(typeof e.d<"u")throw new Error("Invalid key: `d` should not be set");return await this._api.importKey("jwk",e,this._alg,!0,[])}if(typeof e.d>"u")throw new Error("Invalid key: `d` not found");return await this._api.importKey("jwk",e,this._alg,!0,N)}async derivePublicKey(e){await this._setup();try{let r=await this._api.exportKey("jwk",e);return delete r.d,delete r.key_ops,await this._api.importKey("jwk",r,this._alg,!0,[])}catch(r){throw new k(r)}}async generateKeyPair(){await this._setup();try{return await this._api.generateKey(this._alg,!0,N)}catch(e){throw new w(e)}}async deriveKeyPair(e){await this._setup();try{let r=await this._hkdf.labeledExtract(c,we,new Uint8Array(e)),t=new V(this._nSk);for(let o=0;t.isZero()||!t.lessThan(this._order);o++){if(o>255)throw new Error("Faild to derive a key pair");let s=new Uint8Array(await this._hkdf.labeledExpand(r,He,_(o,1),this._nSk));s[0]=s[0]&this._bitmask,t.set(s)}let n=new Uint8Array(this._pkcs8AlgId.length+t.val().length);n.set(this._pkcs8AlgId,0),n.set(t.val(),this._pkcs8AlgId.length);let a=await this._api.importKey("pkcs8",n,this._alg,!0,N);return t.reset(),{privateKey:a,publicKey:await this.derivePublicKey(a)}}catch(r){throw new q(r)}}async dh(e,r){try{return await this._setup(),await this._api.deriveBits({name:"ECDH",public:r},e,this._nDh*8)}catch(t){throw new S(t)}}};var ee=class extends O{constructor(){let e=new E,r=new H(h.DhkemP256HkdfSha256,e);super(h.DhkemP256HkdfSha256,r,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:h.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}},te=class extends O{constructor(){let e=new I,r=new H(h.DhkemP384HkdfSha384,e);super(h.DhkemP384HkdfSha384,r,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:h.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}},re=class extends O{constructor(){let e=new L,r=new H(h.DhkemP521HkdfSha512,e);super(h.DhkemP521HkdfSha512,r,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:h.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}};var Ce=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),Be=new Uint8Array([101,120,112]),Re=new Uint8Array([105,110,102,111,95,104,97,115,104]),Ge=new Uint8Array([107,101,121]),Ye=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),Fe=new Uint8Array([115,101,99,114,101,116]),qe=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),ie=class{constructor(e){if(Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e.kem!="number")this._kem=e.kem;else switch(e.kem){case h.DhkemP256HkdfSha256:this._kem=new ee;break;case h.DhkemP384HkdfSha384:this._kem=new te;break;case h.DhkemP521HkdfSha512:this._kem=new re;break;default:throw new l(`The KEM (${e.kem}) cannot be specified by KemId. Use submodule for the KEM`)}if(typeof e.kdf!="number")this._kdf=e.kdf;else switch(e.kdf){case x.HkdfSha256:this._kdf=new E;break;case x.HkdfSha384:this._kdf=new I;break;default:this._kdf=new L;break}if(typeof e.aead!="number")this._aead=e.aead;else switch(e.aead){case y.Aes128Gcm:this._aead=new T;break;case y.Aes256Gcm:this._aead=new $;break;case y.ExportOnly:this._aead=new J;break;default:throw new l(`The AEAD (${e.aead}) cannot be specified by AeadId. Use submodule for the AEAD`)}this._suiteId=new Uint8Array(qe),this._suiteId.set(_(this._kem.id,2),4),this._suiteId.set(_(this._kdf.id,2),6),this._suiteId.set(_(this._aead.id,2),8)}get kem(){return this._kem}get kdf(){return this._kdf}get aead(){return this._aead}async generateKeyPair(){return await this._setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){return await this._setup(),await this._kem.deriveKeyPair(e)}async importKey(e,r,t=!0){return await this._setup(),await this._kem.importKey(e,r,t)}async createSenderContext(e){this._validateInputLength(e),await this._setup();let r=await this._kem.encap(e),t;return e.psk!==void 0?t=e.senderKey!==void 0?m.AuthPsk:m.Psk:t=e.senderKey!==void 0?m.Auth:m.Base,await this._keyScheduleS(t,r.sharedSecret,r.enc,e)}async createRecipientContext(e){this._validateInputLength(e),await this._setup();let r=await this._kem.decap(e),t;return e.psk!==void 0?t=e.senderPublicKey!==void 0?m.AuthPsk:m.Psk:t=e.senderPublicKey!==void 0?m.Auth:m.Base,await this._keyScheduleR(t,r,e)}async seal(e,r,t=c){let n=await this.createSenderContext(e);return{ct:await n.seal(r,t),enc:n.enc}}async open(e,r,t=c){return await(await this.createRecipientContext(e)).open(r,t)}async _setup(){if(this._api!==void 0)return;let e=await A();this._kdf.init(this._suiteId),this._api=e}async _keySchedule(e,r,t){let n=t.psk===void 0?c:new Uint8Array(t.psk.id),a=await this._kdf.labeledExtract(c,Ye,n),o=t.info===void 0?c:new Uint8Array(t.info),s=await this._kdf.labeledExtract(c,Re,o),u=new Uint8Array(1+a.byteLength+s.byteLength);u.set(new Uint8Array([e]),0),u.set(new Uint8Array(a),1),u.set(new Uint8Array(s),1+a.byteLength);let b=t.psk===void 0?c:new Uint8Array(t.psk.key),p=this._kdf.buildLabeledIkm(Fe,b),M=this._kdf.buildLabeledInfo(Be,u,this._kdf.hashSize),d=await this._kdf.extractAndExpand(r,p,M,this._kdf.hashSize);if(this._aead.id===y.ExportOnly)return{aead:this._aead,exporterSecret:d};let me=this._kdf.buildLabeledInfo(Ge,u,this._aead.keySize),xe=await this._kdf.extractAndExpand(r,p,me,this._aead.keySize),ge=this._kdf.buildLabeledInfo(Ce,u,this._aead.nonceSize),ke=await this._kdf.extractAndExpand(r,p,ge,this._aead.nonceSize);return{aead:this._aead,exporterSecret:d,key:xe,baseNonce:new Uint8Array(ke),seq:0}}async _keyScheduleS(e,r,t,n){let a=await this._keySchedule(e,r,n);return a.key===void 0?new X(this._api,this._kdf,a.exporterSecret,t):new Q(this._api,this._kdf,a,t)}async _keyScheduleR(e,r,t){let n=await this._keySchedule(e,r,t);return n.key===void 0?new W(this._api,this._kdf,n.exporterSecret):new Z(this._api,this._kdf,n)}_validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>8192)throw new l("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new l(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>8192)throw new l("Too long psk.key");if(e.psk.id.byteLength>8192)throw new l("Too long psk.id")}}};var oe=class extends ie{};export{y as AeadId,oe as CipherSuite,B as DecapError,q as DeriveKeyPairError,k as DeserializeError,C as EncapError,R as ExportError,f as HpkeError,l as InvalidParamError,x as KdfId,h as KemId,F as MessageLimitReachedError,w as NotSupportedError,Y as OpenError,G as SealError,S as SerializeError,ue as ValidationError};
