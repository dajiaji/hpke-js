var Q=class extends Error{constructor(e){let t;e instanceof Error?t=e.message:typeof e=="string"?t=e:t="",super(t),this.name=this.constructor.name}},R=class extends Q{},mt=class extends Q{},G=class extends Q{},M=class extends Q{},Re=class extends Q{},Ge=class extends Q{},Fe=class extends Q{},Xe=class extends Q{},$e=class extends Q{},Ve=class extends Q{},ne=class extends Q{},$=class extends Q{};var li={},gt=hi(globalThis,li);function hi(r,e){return new Proxy(r,{get(t,i,n){return i in e?e[i]:r[i]},set(t,i,n){return i in e&&delete e[i],r[i]=n,!0},deleteProperty(t,i){let n=!1;return i in e&&(delete e[i],n=!0),i in r&&(delete r[i],n=!0),n},ownKeys(t){let i=Reflect.ownKeys(r),n=Reflect.ownKeys(e),a=new Set(n);return[...i.filter(s=>!a.has(s)),...n]},defineProperty(t,i,n){return i in e&&delete e[i],Reflect.defineProperty(r,i,n),!0},getOwnPropertyDescriptor(t,i){return i in e?Reflect.getOwnPropertyDescriptor(e,i):Reflect.getOwnPropertyDescriptor(r,i)},has(t,i){return i in e||i in r}})}async function di(){if(gt!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto.subtle;try{let{webcrypto:r}=await import("crypto");return r.subtle}catch(r){throw new $(r)}}var re=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){this._api===void 0&&(this._api=await di())}};var be={Base:0,Psk:1,Auth:2,AuthPsk:3},_={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48,MlKem512:64,MlKem768:65,MlKem1024:66,XWing:25722},se={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3,Sha3256:4,Sha3384:5,Sha3512:6,Shake128:16,Shake256:17,TurboShake128:18,TurboShake256:19},ee={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};var H=new Uint8Array(0);var _t=new Uint8Array([75,69,77,0,0]);var Ae=r=>typeof r=="object"&&r!==null&&typeof r.privateKey=="object"&&typeof r.publicKey=="object";function ae(r,e){if(e<=0)throw new Error("i2Osp: too small size");if(r>=256**e)throw new Error("i2Osp: too large integer");let t=new Uint8Array(e);for(let i=0;i<e&&r;i++)t[e-(i+1)]=r%256,r=r>>8;return t}function Be(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r,0),t.set(e,r.length),t}function ue(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),i=new Uint8Array(t.length);for(let n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i}async function Xt(){if(gt!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:r}=await import("crypto");return r}catch{throw new Error("Web Cryptograph API not supported")}}function $t(r,e){if(r.byteLength!==e.byteLength)throw new Error("xor: different length inputs");let t=new Uint8Array(r.byteLength);for(let i=0;i<r.byteLength;i++)t[i]=r[i]^e[i];return t}var bi=new Uint8Array([101,97,101,95,112,114,107]),pi=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);function yi(r,e,t){let i=new Uint8Array(r.length+e.length+t.length);return i.set(r,0),i.set(e,r.length),i.set(t,r.length+e.length),i}var te=class{constructor(e,t,i){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e,this._prim=t,this._kdf=i;let n=new Uint8Array(_t);n.set(ae(this.id,2),3),this._kdf.init(n)}async serializePublicKey(e){return await this._prim.serializePublicKey(e)}async deserializePublicKey(e){return await this._prim.deserializePublicKey(e)}async serializePrivateKey(e){return await this._prim.serializePrivateKey(e)}async deserializePrivateKey(e){return await this._prim.deserializePrivateKey(e)}async importKey(e,t,i=!0){return await this._prim.importKey(e,t,i)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>8192)throw new R("Too long ikm");return await this._prim.deriveKeyPair(e)}async encap(e){let t;e.ekm===void 0?t=await this.generateKeyPair():Ae(e.ekm)?t=e.ekm:t=await this.deriveKeyPair(e.ekm);let i=await this._prim.serializePublicKey(t.publicKey),n=await this._prim.serializePublicKey(e.recipientPublicKey);try{let a;if(e.senderKey===void 0)a=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey));else{let u=Ae(e.senderKey)?e.senderKey.privateKey:e.senderKey,l=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey)),f=new Uint8Array(await this._prim.dh(u,e.recipientPublicKey));a=Be(l,f)}let s;if(e.senderKey===void 0)s=Be(new Uint8Array(i),new Uint8Array(n));else{let u=Ae(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),l=await this._prim.serializePublicKey(u);s=yi(new Uint8Array(i),new Uint8Array(n),new Uint8Array(l))}let o=await this._generateSharedSecret(a,s);return{enc:i,sharedSecret:o}}catch(a){throw new Re(a)}}async decap(e){let t=await this._prim.deserializePublicKey(e.enc),i=Ae(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,n=Ae(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),a=await this._prim.serializePublicKey(n);try{let s;if(e.senderPublicKey===void 0)s=new Uint8Array(await this._prim.dh(i,t));else{let u=new Uint8Array(await this._prim.dh(i,t)),l=new Uint8Array(await this._prim.dh(i,e.senderPublicKey));s=Be(u,l)}let o;if(e.senderPublicKey===void 0)o=Be(new Uint8Array(e.enc),new Uint8Array(a));else{let u=await this._prim.serializePublicKey(e.senderPublicKey);o=new Uint8Array(e.enc.byteLength+a.byteLength+u.byteLength),o.set(new Uint8Array(e.enc),0),o.set(new Uint8Array(a),e.enc.byteLength),o.set(new Uint8Array(u),e.enc.byteLength+a.byteLength)}return await this._generateSharedSecret(s,o)}catch(s){throw new Ge(s)}}async _generateSharedSecret(e,t){let i=this._kdf.buildLabeledIkm(bi,e),n=this._kdf.buildLabeledInfo(pi,t,this.secretSize);return await this._kdf.extractAndExpand(H.buffer,i.buffer,n.buffer,this.secretSize)}};var Y=["deriveBits"],pe=new Uint8Array([100,107,112,95,112,114,107]),Ee=new Uint8Array([115,107]);var vt=class{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(this._num[e]!==0)return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let t=0;t<this._num.length;t++){if(this._num[t]<e[t])return!0;if(this._num[t]>e[t])return!1}return!1}};var wi=new Uint8Array([99,97,110,100,105,100,97,116,101]),xi=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),mi=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),gi=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),_i=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),vi=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),ki=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]),ye=class extends re{constructor(e,t){switch(super(),Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,e){case _.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=xi,this._bitmask=255,this._pkcs8AlgId=_i;break;case _.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=mi,this._bitmask=255,this._pkcs8AlgId=vi;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=gi,this._bitmask=1,this._pkcs8AlgId=ki;break}}async serializePublicKey(e){await this._setup();try{return await this._api.exportKey("raw",e)}catch(t){throw new G(t)}}async deserializePublicKey(e){await this._setup();try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){await this._setup();try{let t=await this._api.exportKey("jwk",e);if(!("d"in t))throw new Error("Not private key");return ue(t.d).buffer}catch(t){throw new G(t)}}async deserializePrivateKey(e){await this._setup();try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){await this._setup();try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){await this._setup();try{return await this._api.generateKey(this._alg,!0,Y)}catch(e){throw new $(e)}}async deriveKeyPair(e){await this._setup();try{let t=await this._hkdf.labeledExtract(H.buffer,pe,new Uint8Array(e)),i=new vt(this._nSk);for(let a=0;i.isZero()||!i.lessThan(this._order);a++){if(a>255)throw new Error("Faild to derive a key pair");let s=new Uint8Array(await this._hkdf.labeledExpand(t,wi,ae(a,1),this._nSk));s[0]=s[0]&this._bitmask,i.set(s)}let n=await this._deserializePkcs8Key(i.val());return i.reset(),{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new ne(t)}}async derivePublicKey(e){await this._setup();try{let t=await this._api.exportKey("jwk",e);return delete t.d,delete t.key_ops,await this._api.importKey("jwk",t,this._alg,!0,[])}catch(t){throw new M(t)}}async dh(e,t){try{return await this._setup(),await this._api.deriveBits({name:"ECDH",public:t},e,this._nDh*8)}catch(i){throw new G(i)}}async _importRawKey(e,t){if(t&&e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!t&&e.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");return t?await this._api.importKey("raw",e,this._alg,!0,[]):await this._deserializePkcs8Key(new Uint8Array(e))}async _importJWK(e,t){if(typeof e.crv>"u"||e.crv!==this._alg.namedCurve)throw new Error(`Invalid crv: ${e.crv}`);if(t){if(typeof e.d<"u")throw new Error("Invalid key: `d` should not be set");return await this._api.importKey("jwk",e,this._alg,!0,[])}if(typeof e.d>"u")throw new Error("Invalid key: `d` not found");return await this._api.importKey("jwk",e,this._alg,!0,Y)}async _deserializePkcs8Key(e){let t=new Uint8Array(this._pkcs8AlgId.length+e.length);return t.set(this._pkcs8AlgId,0),t.set(e,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",t,this._alg,!0,Y)}};var V=class{constructor(e,t,i,n=[]){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extractable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"algorithm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.key=t,this.type=i,this.algorithm={name:e},this.usages=n,i==="public"&&(this.usages=[])}};var kr=new Uint8Array([72,80,75,69,45,118,49]),rt=class extends re{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:se.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:H}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(e){this._suiteId=e}buildLabeledIkm(e,t){this._checkInit();let i=new Uint8Array(7+this._suiteId.byteLength+e.byteLength+t.byteLength);return i.set(kr,0),i.set(this._suiteId,7),i.set(e,7+this._suiteId.byteLength),i.set(t,7+this._suiteId.byteLength+e.byteLength),i}buildLabeledInfo(e,t,i){this._checkInit();let n=new Uint8Array(9+this._suiteId.byteLength+e.byteLength+t.byteLength);return n.set(new Uint8Array([0,i]),0),n.set(kr,2),n.set(this._suiteId,9),n.set(e,9+this._suiteId.byteLength),n.set(t,9+this._suiteId.byteLength+e.byteLength),n}async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)throw new R("The salt length must be the same as the hashSize");let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}async expand(e,t,i){await this._setup();let n=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),a=new ArrayBuffer(i),s=new Uint8Array(a),o=H,u=new Uint8Array(t),l=new Uint8Array(1);if(i>255*this.hashSize)throw new Error("Entropy limit reached");let f=new Uint8Array(this.hashSize+u.length+1);for(let c=1,h=0;h<s.length;c++)l[0]=c,f.set(o,0),f.set(u,o.length),f.set(l,o.length+u.length),o=new Uint8Array(await this._api.sign("HMAC",n,f.slice(0,o.length+u.length+1))),s.length-h>=o.length?(s.set(o,h),h+=o.length):(s.set(o.slice(0,s.length-h),h),h+=s.length-h);return a}async extractAndExpand(e,t,i,n){await this._setup();let a=await this._api.importKey("raw",t,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:i},a,n*8)}async labeledExtract(e,t,i){return await this.extract(e,this.buildLabeledIkm(t,i).buffer)}async labeledExpand(e,t,i,n){return await this.expand(e,this.buildLabeledInfo(t,i,n).buffer,n)}_checkInit(){if(this._suiteId===H)throw new Error("Not initialized. Call init()")}},Ie=class extends rt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:se.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}},De=class extends rt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:se.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}},Oe=class extends rt{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:se.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}};var Vt=["encrypt","decrypt"];var Kr=BigInt(0);function Pi(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function it(r,e=""){if(!Number.isSafeInteger(r)||r<0){let t=e&&`"${e}" `;throw new Error(`${t}expected integer >0, got ${r}`)}}function ie(r,e,t=""){let i=Pi(r),n=r?.length,a=e!==void 0;if(!i||a&&n!==e){let s=t&&`"${t}" `,o=a?` of length ${e}`:"",u=i?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+u)}return r}function Sr(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash must wrapped by utils.createHasher");it(r.outputLen),it(r.blockLen)}function Te(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Wt(r,e){ie(r,void 0,"digestInto() output");let t=e.outputLen;if(r.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function Ki(r){if(typeof r=="bigint"){if(!kt(r))throw new Error("positive bigint expected, got "+r)}else it(r);return r}function we(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Pt(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ce(r,e){return r<<32-e|r>>>e}var Ar=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Si=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ai(r){if(ie(r),Ar)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=Si[r[t]];return e}var _e={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pr(r){if(r>=_e._0&&r<=_e._9)return r-_e._0;if(r>=_e.A&&r<=_e.F)return r-(_e.A-10);if(r>=_e.a&&r<=_e.f)return r-(_e.a-10)}function Ei(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(Ar)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let i=new Uint8Array(t);for(let n=0,a=0;n<t;n++,a+=2){let s=Pr(r.charCodeAt(a)),o=Pr(r.charCodeAt(a+1));if(s===void 0||o===void 0){let u=r[a]+r[a+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+a)}i[n]=s*16+o}return i}function Ii(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Kr:BigInt("0x"+r)}function Yt(r){return Ii(Ai(Kt(ie(r)).reverse()))}function Oi(r,e){it(e),r=Ki(r);let t=Ei(r.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function Er(r,e){return Oi(r,e).reverse()}function Kt(r){return Uint8Array.from(r)}var kt=r=>typeof r=="bigint"&&Kr<=r;function Li(r,e,t){return kt(r)&&kt(e)&&kt(t)&&e<=r&&r<t}function qt(r,e,t,i){if(!Li(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Ir(r,e={},t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function i(a,s,o){let u=r[a];if(o&&u===void 0)return;let l=typeof u;if(l!==s||u===null)throw new Error(`param "${a}" is invalid: expected ${s}, got ${l}`)}let n=(a,s)=>Object.entries(a).forEach(([o,u])=>i(o,u,s));n(e,!1),n(t,!0)}function nt(r,e={}){let t=(n,a)=>r(a).update(n).digest(),i=r(void 0);return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=n=>r(n),Object.assign(t,e),Object.freeze(t)}async function Or(r=32){let e=await Xt(),t=new Uint8Array(r);return e.getRandomValues(t),t}var at=r=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,r])});var St=class{constructor(e,t){if(Object.defineProperty(this,"oHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iHash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Sr(e),ie(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,n=new Uint8Array(i);n.set(t.length>i?e.create().update(t).digest():t);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),we(n)}update(e){return Te(this),this.iHash.update(e),this}digestInto(e){Te(this),ie(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:i,finished:n,destroyed:a,blockLen:s,outputLen:o}=this;return e=e,e.finished=n,e.destroyed=a,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Le=(r,e,t)=>new St(r,e).update(t).digest();Le.create=(r,e)=>new St(r,e);function Lr(r,e,t){return r&e^~r&t}function Hr(r,e,t){return r&e^r&t^e&t}var ot=class{constructor(e,t,i,n){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"padOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isLE",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"view",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Pt(this.buffer)}update(e){Te(this),ie(e);let{view:t,buffer:i,blockLen:n}=this,a=e.length;for(let s=0;s<a;){let o=Math.min(n-this.pos,a-s);if(o===n){let u=Pt(e);for(;n<=a-s;s+=n)this.process(u,s);continue}i.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Te(this),Wt(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:n,isLE:a}=this,{pos:s}=this;t[s++]=128,we(this.buffer.subarray(s)),this.padOffset>n-s&&(this.process(i,0),s=0);for(let c=s;c<n;c++)t[c]=0;i.setBigUint64(n-8,BigInt(this.length*8),a),this.process(i,0);let o=Pt(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let l=u/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<l;c++)o.setUint32(4*c,f[c],a)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:i,length:n,finished:a,destroyed:s,pos:o}=this;return e.destroyed=s,e.finished=a,e.length=n,e.pos=o,n%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}},ve=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),q=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var At=BigInt(4294967295),jr=BigInt(32);function Hi(r,e=!1){return e?{h:Number(r&At),l:Number(r>>jr&At)}:{h:Number(r>>jr&At)|0,l:Number(r&At)|0}}function Et(r,e=!1){let t=r.length,i=new Uint32Array(t),n=new Uint32Array(t);for(let a=0;a<t;a++){let{h:s,l:o}=Hi(r[a],e);[i[a],n[a]]=[s,o]}return[i,n]}var Jt=(r,e,t)=>r>>>t,Zt=(r,e,t)=>r<<32-t|e>>>t,Ce=(r,e,t)=>r>>>t|e<<32-t,Ne=(r,e,t)=>r<<32-t|e>>>t,st=(r,e,t)=>r<<64-t|e>>>t-32,ut=(r,e,t)=>r>>>t-32|e<<64-t;function xe(r,e,t,i){let n=(e>>>0)+(i>>>0);return{h:r+t+(n/2**32|0)|0,l:n|0}}var Ur=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Br=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,zr=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),Dr=(r,e,t,i,n)=>e+t+i+n+(r/2**32|0)|0,Tr=(r,e,t,i,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(n>>>0),Cr=(r,e,t,i,n,a)=>e+t+i+n+a+(r/2**32|0)|0;var Ui=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),He=new Uint32Array(64),Qt=class extends ot{constructor(e){super(64,e,8,!1)}get(){let{A:e,B:t,C:i,D:n,E:a,F:s,G:o,H:u}=this;return[e,t,i,n,a,s,o,u]}set(e,t,i,n,a,s,o,u){this.A=e|0,this.B=t|0,this.C=i|0,this.D=n|0,this.E=a|0,this.F=s|0,this.G=o|0,this.H=u|0}process(e,t){for(let c=0;c<16;c++,t+=4)He[c]=e.getUint32(t,!1);for(let c=16;c<64;c++){let h=He[c-15],p=He[c-2],x=ce(h,7)^ce(h,18)^h>>>3,w=ce(p,17)^ce(p,19)^p>>>10;He[c]=w+He[c-7]+x+He[c-16]|0}let{A:i,B:n,C:a,D:s,E:o,F:u,G:l,H:f}=this;for(let c=0;c<64;c++){let h=ce(o,6)^ce(o,11)^ce(o,25),p=f+h+Lr(o,u,l)+Ui[c]+He[c]|0,w=(ce(i,2)^ce(i,13)^ce(i,22))+Hr(i,n,a)|0;f=l,l=u,u=o,o=s+p|0,s=a,a=n,n=i,i=p+w|0}i=i+this.A|0,n=n+this.B|0,a=a+this.C|0,s=s+this.D|0,o=o+this.E|0,u=u+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(i,n,a,s,o,u,l,f)}roundClean(){we(He)}destroy(){this.set(0,0,0,0,0,0,0,0),we(this.buffer)}},er=class extends Qt{constructor(){super(32),Object.defineProperty(this,"A",{enumerable:!0,configurable:!0,writable:!0,value:ve[0]|0}),Object.defineProperty(this,"B",{enumerable:!0,configurable:!0,writable:!0,value:ve[1]|0}),Object.defineProperty(this,"C",{enumerable:!0,configurable:!0,writable:!0,value:ve[2]|0}),Object.defineProperty(this,"D",{enumerable:!0,configurable:!0,writable:!0,value:ve[3]|0}),Object.defineProperty(this,"E",{enumerable:!0,configurable:!0,writable:!0,value:ve[4]|0}),Object.defineProperty(this,"F",{enumerable:!0,configurable:!0,writable:!0,value:ve[5]|0}),Object.defineProperty(this,"G",{enumerable:!0,configurable:!0,writable:!0,value:ve[6]|0}),Object.defineProperty(this,"H",{enumerable:!0,configurable:!0,writable:!0,value:ve[7]|0})}},Nr=Et(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Bi=Nr[0],zi=Nr[1],je=new Uint32Array(80),Ue=new Uint32Array(80),It=class extends ot{constructor(e){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:i,Bl:n,Ch:a,Cl:s,Dh:o,Dl:u,Eh:l,El:f,Fh:c,Fl:h,Gh:p,Gl:x,Hh:w,Hl:b}=this;return[e,t,i,n,a,s,o,u,l,f,c,h,p,x,w,b]}set(e,t,i,n,a,s,o,u,l,f,c,h,p,x,w,b){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=n|0,this.Ch=a|0,this.Cl=s|0,this.Dh=o|0,this.Dl=u|0,this.Eh=l|0,this.El=f|0,this.Fh=c|0,this.Fl=h|0,this.Gh=p|0,this.Gl=x|0,this.Hh=w|0,this.Hl=b|0}process(e,t){for(let v=0;v<16;v++,t+=4)je[v]=e.getUint32(t),Ue[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){let F=je[v-15]|0,X=Ue[v-15]|0,T=Ce(F,X,1)^Ce(F,X,8)^Jt(F,X,7),C=Ne(F,X,1)^Ne(F,X,8)^Zt(F,X,7),z=je[v-2]|0,g=Ue[v-2]|0,A=Ce(z,g,19)^st(z,g,61)^Jt(z,g,6),E=Ne(z,g,19)^ut(z,g,61)^Zt(z,g,6),S=zr(C,E,Ue[v-7],Ue[v-16]),I=Dr(S,T,A,je[v-7],je[v-16]);je[v]=I|0,Ue[v]=S|0}let{Ah:i,Al:n,Bh:a,Bl:s,Ch:o,Cl:u,Dh:l,Dl:f,Eh:c,El:h,Fh:p,Fl:x,Gh:w,Gl:b,Hh:B,Hl:N}=this;for(let v=0;v<80;v++){let F=Ce(c,h,14)^Ce(c,h,18)^st(c,h,41),X=Ne(c,h,14)^Ne(c,h,18)^ut(c,h,41),T=c&p^~c&w,C=h&x^~h&b,z=Tr(N,X,C,zi[v],Ue[v]),g=Cr(z,B,F,T,Bi[v],je[v]),A=z|0,E=Ce(i,n,28)^st(i,n,34)^st(i,n,39),S=Ne(i,n,28)^ut(i,n,34)^ut(i,n,39),I=i&a^i&o^a&o,y=n&s^n&u^s&u;B=w|0,N=b|0,w=p|0,b=x|0,p=c|0,x=h|0,{h:c,l:h}=xe(l|0,f|0,g|0,A|0),l=o|0,f=u|0,o=a|0,u=s|0,a=i|0,s=n|0;let m=Ur(A,S,y);i=Br(m,g,E,I),n=m|0}({h:i,l:n}=xe(this.Ah|0,this.Al|0,i|0,n|0)),{h:a,l:s}=xe(this.Bh|0,this.Bl|0,a|0,s|0),{h:o,l:u}=xe(this.Ch|0,this.Cl|0,o|0,u|0),{h:l,l:f}=xe(this.Dh|0,this.Dl|0,l|0,f|0),{h:c,l:h}=xe(this.Eh|0,this.El|0,c|0,h|0),{h:p,l:x}=xe(this.Fh|0,this.Fl|0,p|0,x|0),{h:w,l:b}=xe(this.Gh|0,this.Gl|0,w|0,b|0),{h:B,l:N}=xe(this.Hh|0,this.Hl|0,B|0,N|0),this.set(i,n,a,s,o,u,l,f,c,h,p,x,w,b,B,N)}roundClean(){we(je,Ue)}destroy(){we(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},tr=class extends It{constructor(){super(64),Object.defineProperty(this,"Ah",{enumerable:!0,configurable:!0,writable:!0,value:J[0]|0}),Object.defineProperty(this,"Al",{enumerable:!0,configurable:!0,writable:!0,value:J[1]|0}),Object.defineProperty(this,"Bh",{enumerable:!0,configurable:!0,writable:!0,value:J[2]|0}),Object.defineProperty(this,"Bl",{enumerable:!0,configurable:!0,writable:!0,value:J[3]|0}),Object.defineProperty(this,"Ch",{enumerable:!0,configurable:!0,writable:!0,value:J[4]|0}),Object.defineProperty(this,"Cl",{enumerable:!0,configurable:!0,writable:!0,value:J[5]|0}),Object.defineProperty(this,"Dh",{enumerable:!0,configurable:!0,writable:!0,value:J[6]|0}),Object.defineProperty(this,"Dl",{enumerable:!0,configurable:!0,writable:!0,value:J[7]|0}),Object.defineProperty(this,"Eh",{enumerable:!0,configurable:!0,writable:!0,value:J[8]|0}),Object.defineProperty(this,"El",{enumerable:!0,configurable:!0,writable:!0,value:J[9]|0}),Object.defineProperty(this,"Fh",{enumerable:!0,configurable:!0,writable:!0,value:J[10]|0}),Object.defineProperty(this,"Fl",{enumerable:!0,configurable:!0,writable:!0,value:J[11]|0}),Object.defineProperty(this,"Gh",{enumerable:!0,configurable:!0,writable:!0,value:J[12]|0}),Object.defineProperty(this,"Gl",{enumerable:!0,configurable:!0,writable:!0,value:J[13]|0}),Object.defineProperty(this,"Hh",{enumerable:!0,configurable:!0,writable:!0,value:J[14]|0}),Object.defineProperty(this,"Hl",{enumerable:!0,configurable:!0,writable:!0,value:J[15]|0})}},rr=class extends It{constructor(){super(48),Object.defineProperty(this,"Ah",{enumerable:!0,configurable:!0,writable:!0,value:q[0]|0}),Object.defineProperty(this,"Al",{enumerable:!0,configurable:!0,writable:!0,value:q[1]|0}),Object.defineProperty(this,"Bh",{enumerable:!0,configurable:!0,writable:!0,value:q[2]|0}),Object.defineProperty(this,"Bl",{enumerable:!0,configurable:!0,writable:!0,value:q[3]|0}),Object.defineProperty(this,"Ch",{enumerable:!0,configurable:!0,writable:!0,value:q[4]|0}),Object.defineProperty(this,"Cl",{enumerable:!0,configurable:!0,writable:!0,value:q[5]|0}),Object.defineProperty(this,"Dh",{enumerable:!0,configurable:!0,writable:!0,value:q[6]|0}),Object.defineProperty(this,"Dl",{enumerable:!0,configurable:!0,writable:!0,value:q[7]|0}),Object.defineProperty(this,"Eh",{enumerable:!0,configurable:!0,writable:!0,value:q[8]|0}),Object.defineProperty(this,"El",{enumerable:!0,configurable:!0,writable:!0,value:q[9]|0}),Object.defineProperty(this,"Fh",{enumerable:!0,configurable:!0,writable:!0,value:q[10]|0}),Object.defineProperty(this,"Fl",{enumerable:!0,configurable:!0,writable:!0,value:q[11]|0}),Object.defineProperty(this,"Gh",{enumerable:!0,configurable:!0,writable:!0,value:q[12]|0}),Object.defineProperty(this,"Gl",{enumerable:!0,configurable:!0,writable:!0,value:q[13]|0}),Object.defineProperty(this,"Hh",{enumerable:!0,configurable:!0,writable:!0,value:q[14]|0}),Object.defineProperty(this,"Hl",{enumerable:!0,configurable:!0,writable:!0,value:q[15]|0})}},ir=nt(()=>new er,at(1)),nr=nt(()=>new tr,at(3)),ar=nt(()=>new rr,at(2));var Di=BigInt(0),ct=BigInt(1),Ti=BigInt(2),Ci=BigInt(7),Ni=BigInt(256),Mi=BigInt(113),Ri=[],Gi=[],Mr=[];for(let r=0,e=ct,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Ri.push(2*(5*i+t)),Gi.push((r+1)*(r+2)/2%64);let n=Di;for(let a=0;a<7;a++)e=(e<<ct^(e>>Ci)*Mi)%Ni,e&Ti&&(n^=ct<<(ct<<BigInt(a))-ct);Mr.push(n)}var Rr=Et(Mr,!0),Ha=Rr[0],ja=Rr[1];var Gr=BigInt(0);function Me(r,e){let t=r%e;return t>=Gr?t:e+t}function D(r,e,t){let i=r;for(;e-- >Gr;)i*=i,i%=t;return i}function Fr(r,e){return function(i){let n=r(i);return{secretKey:n,publicKey:e(n)}}}var ft=BigInt(0),We=BigInt(1),Ot=BigInt(2);function Fi(r){return Ir(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function lt(r){let e=Fi(r),{P:t,type:i,adjustScalarBytes:n,powPminus2:a,randomBytes:s}=e,o=i==="x25519";if(!o&&i!=="x448")throw new Error("invalid type");let u=s||Or,l=o?255:448,f=o?32:56,c=BigInt(o?9:5),h=BigInt(o?121665:39081),p=o?Ot**BigInt(254):Ot**BigInt(447),x=o?BigInt(8)*Ot**BigInt(251)-We:BigInt(4)*Ot**BigInt(445)-We,w=p+x+We,b=y=>Me(y,t),B=N(c);function N(y){return Er(b(y),f)}function v(y){let m=Kt(ie(y,f,"uCoordinate"));return o&&(m[31]&=127),b(Yt(m))}function F(y){return Yt(n(Kt(ie(y,f,"scalar"))))}function X(y,m){let k=A(v(m),F(y));if(k===ft)throw new Error("invalid private or public key received");return N(k)}function T(y){return X(y,B)}let C=T,z=X;function g(y,m,k){let j=b(y*(m-k));return m=b(m-j),k=b(k+j),{x_2:m,x_3:k}}function A(y,m){qt("u",y,ft,t),qt("scalar",m,p,w);let k=m,j=y,P=We,d=ft,O=y,U=We,L=ft;for(let fe=BigInt(l-1);fe>=ft;fe--){let me=k>>fe&We;L^=me,{x_2:P,x_3:O}=g(L,P,O),{x_2:d,x_3:U}=g(L,d,U),L=me;let le=P+d,he=b(le*le),de=P-d,ge=b(de*de),wr=he-ge,ci=O+U,fi=O-U,xr=b(fi*le),mr=b(ci*de),gr=xr+mr,_r=xr-mr;O=b(gr*gr),U=b(j*b(_r*_r)),P=b(he*ge),d=b(wr*(he+b(h*wr)))}({x_2:P,x_3:O}=g(L,P,O)),{x_2:d,x_3:U}=g(L,d,U);let oe=a(d);return b(P*oe)}let E={secretKey:f,publicKey:f,seed:f},S=async y=>(y===void 0&&(y=await u(f)),ie(y,E.seed,"seed"),y),I={randomSecretKey:S};return Object.freeze({keygen:Fr(S,C),getSharedSecret:z,getPublicKey:C,scalarMult:X,scalarMultBase:T,utils:I,GuBytes:B.slice(),lengths:E})}var sr=class extends re{constructor(e){super(),Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e}async seal(e,t,i){await this._setupKey();let n={name:"AES-GCM",iv:e,additionalData:i};return await this._api.encrypt(n,this._key,t)}async open(e,t,i){await this._setupKey();let n={name:"AES-GCM",iv:e,additionalData:i};return await this._api.decrypt(n,this._key,t)}async _setupKey(){if(this._key!==void 0)return;await this._setup();let e=await this._importKey(this._rawKey);new Uint8Array(this._rawKey).fill(0),this._key=e}async _importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,Vt)}},Ye=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new sr(e)}},ht=class extends Ye{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}};var dt=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.ExportOnly}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}createEncryptionContext(e){throw new $("Export only")}};function ur(){return new Promise((r,e)=>{e(new $("Not supported"))})}var Xi=new Uint8Array([115,101,99]),qe=class{constructor(e,t,i){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e,this._kdf=t,this.exporterSecret=i}async seal(e,t){return await ur()}async open(e,t){return await ur()}async export(e,t){if(e.byteLength>8192)throw new R("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,Xi,new Uint8Array(e),t)}catch(i){throw new Fe(i)}}},Lt=class extends qe{},Ht=class extends qe{constructor(e,t,i,n){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=n}};var Je=class extends qe{constructor(e,t,i){if(super(e,t,i.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),i.key===void 0||i.baseNonce===void 0||i.seq===void 0)throw new Error("Required parameters are missing");this._aead=i.aead,this._nK=this._aead.keySize,this._nN=this._aead.nonceSize,this._nT=this._aead.tagSize;let n=this._aead.createEncryptionContext(i.key);this._ctx={key:n,baseNonce:i.baseNonce,seq:i.seq}}computeNonce(e){let t=ae(e.seq,e.baseNonce.byteLength);return $t(e.baseNonce,t).buffer}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new Ve("Message limit reached");e.seq+=1}};var jt=class extends Je{async open(e,t=H.buffer){let i;try{i=await this._ctx.key.open(this.computeNonce(this._ctx),e,t)}catch(n){throw new $e(n)}return this.incrementSeq(this._ctx),i}};var Ut=class extends Je{constructor(e,t,i,n){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=n}async seal(e,t=H.buffer){let i;try{i=await this._ctx.key.seal(this.computeNonce(this._ctx),e,t)}catch(n){throw new Xe(n)}return this.incrementSeq(this._ctx),i}};var $i=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),Vi=new Uint8Array([101,120,112]),Wi=new Uint8Array([105,110,102,111,95,104,97,115,104]),Yi=new Uint8Array([107,101,121]),qi=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),Ji=new Uint8Array([115,101,99,114,101,116]),Zi=new Uint8Array([72,80,75,69,0,0,0,0,0,0]),Bt=class extends re{constructor(e){if(super(),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e.kem=="number")throw new R("KemId cannot be used");if(this._kem=e.kem,typeof e.kdf=="number")throw new R("KdfId cannot be used");if(this._kdf=e.kdf,typeof e.aead=="number")throw new R("AeadId cannot be used");this._aead=e.aead,this._suiteId=new Uint8Array(Zi),this._suiteId.set(ae(this._kem.id,2),4),this._suiteId.set(ae(this._kdf.id,2),6),this._suiteId.set(ae(this._aead.id,2),8),this._kdf.init(this._suiteId)}get kem(){return this._kem}get kdf(){return this._kdf}get aead(){return this._aead}async createSenderContext(e){this._validateInputLength(e),await this._setup();let t=await this._kem.encap(e),i;return e.psk!==void 0?i=e.senderKey!==void 0?be.AuthPsk:be.Psk:i=e.senderKey!==void 0?be.Auth:be.Base,await this._keyScheduleS(i,t.sharedSecret,t.enc,e)}async createRecipientContext(e){this._validateInputLength(e),await this._setup();let t=await this._kem.decap(e),i;return e.psk!==void 0?i=e.senderPublicKey!==void 0?be.AuthPsk:be.Psk:i=e.senderPublicKey!==void 0?be.Auth:be.Base,await this._keyScheduleR(i,t,e)}async seal(e,t,i=H.buffer){let n=await this.createSenderContext(e);return{ct:await n.seal(t,i),enc:n.enc}}async open(e,t,i=H.buffer){return await(await this.createRecipientContext(e)).open(t,i)}async _keySchedule(e,t,i){let n=i.psk===void 0?H:new Uint8Array(i.psk.id),a=await this._kdf.labeledExtract(H.buffer,qi,n),s=i.info===void 0?H:new Uint8Array(i.info),o=await this._kdf.labeledExtract(H.buffer,Wi,s),u=new Uint8Array(1+a.byteLength+o.byteLength);u.set(new Uint8Array([e]),0),u.set(new Uint8Array(a),1),u.set(new Uint8Array(o),1+a.byteLength);let l=i.psk===void 0?H:new Uint8Array(i.psk.key),f=this._kdf.buildLabeledIkm(Ji,l).buffer,c=this._kdf.buildLabeledInfo(Vi,u,this._kdf.hashSize).buffer,h=await this._kdf.extractAndExpand(t,f,c,this._kdf.hashSize);if(this._aead.id===ee.ExportOnly)return{aead:this._aead,exporterSecret:h};let p=this._kdf.buildLabeledInfo(Yi,u,this._aead.keySize).buffer,x=await this._kdf.extractAndExpand(t,f,p,this._aead.keySize),w=this._kdf.buildLabeledInfo($i,u,this._aead.nonceSize).buffer,b=await this._kdf.extractAndExpand(t,f,w,this._aead.nonceSize);return{aead:this._aead,exporterSecret:h,key:x,baseNonce:new Uint8Array(b),seq:0}}async _keyScheduleS(e,t,i,n){let a=await this._keySchedule(e,t,n);return a.key===void 0?new Ht(this._api,this._kdf,a.exporterSecret,i):new Ut(this._api,this._kdf,a,i)}async _keyScheduleR(e,t,i){let n=await this._keySchedule(e,t,i);return n.key===void 0?new Lt(this._api,this._kdf,n.exporterSecret):new jt(this._api,this._kdf,n)}_validateInputLength(e){if(e.info!==void 0&&e.info.byteLength>65536)throw new R("Too long info");if(e.psk!==void 0){if(e.psk.key.byteLength<32)throw new R(`PSK must have at least ${32} bytes`);if(e.psk.key.byteLength>8192)throw new R("Too long psk.key");if(e.psk.id.byteLength>8192)throw new R("Too long psk.id")}}};var bt=class extends Bt{};var Jo=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,110,4,34,4,32]);var ns=new Uint8Array([48,70,2,1,0,48,5,6,3,43,101,111,4,58,4,56]);var Qi={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48},en={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},tn={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535};function rn(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function zt(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Dt(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function W(r,e,t=""){let i=rn(r),n=r?.length,a=e!==void 0;if(!i||a&&n!==e){let s=t&&`"${t}" `,o=a?` of length ${e}`:"",u=i?`length=${n}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+o+", got "+u)}return r}function cr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function $r(r,e){W(r,void 0,"output");let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function ke(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Pe(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function nn(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var an=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Vr(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Wr(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}var Yr=(r,e)=>{function t(i,...n){if(W(i,void 0,"key"),!an)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let f=n[0];W(f,r.varSizeNonce?void 0:r.nonceLength,"nonce")}let a=r.tagLength;a&&n[1]!==void 0&&W(n[1],void 0,"AAD");let s=e(i,...n),o=(f,c)=>{if(c!==void 0){if(f!==2)throw new Error("cipher output not supported");W(c,void 0,"output")}},u=!1;return{encrypt(f,c){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,W(f),o(s.encrypt.length,c),s.encrypt(f,c)},decrypt(f,c){if(W(f),a&&f.length<a)throw new Error('"ciphertext" expected length bigger than tagLength='+a);return o(s.decrypt.length,c),s.decrypt(f,c)}}}return Object.assign(t,r),t};function fr(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error('"output" expected Uint8Array of length '+r+", got: "+e.length);if(t&&!on(e))throw new Error("invalid output, must be aligned");return e}function qr(r,e,t){zt(t);let i=new Uint8Array(16),n=nn(i);return n.setBigUint64(0,BigInt(e),t),n.setBigUint64(8,BigInt(r),t),i}function on(r){return r.byteOffset%4===0}function Ze(r){return Uint8Array.from(r)}var Zr=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),sn=Zr("expand 16-byte k"),un=Zr("expand 32-byte k"),cn=ke(sn),fn=ke(un);function K(r,e){return r<<e|r>>>32-e}function lr(r){return r.byteOffset%4===0}var Tt=64,ln=16,Qr=2**32-1,Jr=Uint32Array.of();function hn(r,e,t,i,n,a,s,o){let u=n.length,l=new Uint8Array(Tt),f=ke(l),c=lr(n)&&lr(a),h=c?ke(n):Jr,p=c?ke(a):Jr;for(let x=0;x<u;s++){if(r(e,t,i,f,s,o),s>=Qr)throw new Error("arx: counter overflow");let w=Math.min(Tt,u-x);if(c&&w===Tt){let b=x/4;if(x%4!==0)throw new Error("arx: invalid block position");for(let B=0,N;B<ln;B++)N=b+B,p[N]=h[N]^f[B];x+=Tt;continue}for(let b=0,B;b<w;b++)B=x+b,a[B]=n[B]^l[b];x+=w}}function ei(r,e){let{allowShortKeys:t,extendNonceFn:i,counterLength:n,counterRight:a,rounds:s}=Vr({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Dt(n),Dt(s),zt(a),zt(t),(o,u,l,f,c=0)=>{W(o,void 0,"key"),W(u,void 0,"nonce"),W(l,void 0,"data");let h=l.length;if(f===void 0&&(f=new Uint8Array(h)),W(f,void 0,"output"),Dt(c),c<0||c>=Qr)throw new Error("arx: counter overflow");if(f.length<h)throw new Error(`arx: output (${f.length}) is shorter than data (${h})`);let p=[],x=o.length,w,b;if(x===32)p.push(w=Ze(o)),b=fn;else if(x===16&&t)w=new Uint8Array(32),w.set(o),w.set(o,16),b=cn,p.push(w);else throw W(o,32,"arx key"),new Error("invalid key size");lr(u)||p.push(u=Ze(u));let B=ke(w);if(i){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(b,B,ke(u.subarray(0,16)),B),u=u.subarray(16)}let N=16-n;if(N!==u.length)throw new Error(`arx: nonce must be ${N} or 16 bytes`);if(N!==12){let F=new Uint8Array(12);F.set(u,a?0:12-u.length),u=F,p.push(u)}let v=ke(u);return hn(r,b,B,v,l,f,c,s),Pe(...p),f}}function Z(r,e){return r[e++]&255|(r[e++]&255)<<8}var hr=class{constructor(e){Object.defineProperty(this,"blockLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"outputLen",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"buffer",{enumerable:!0,configurable:!0,writable:!0,value:new Uint8Array(16)}),Object.defineProperty(this,"r",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"h",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(10)}),Object.defineProperty(this,"pad",{enumerable:!0,configurable:!0,writable:!0,value:new Uint16Array(8)}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e=Ze(W(e,32,"key"));let t=Z(e,0),i=Z(e,2),n=Z(e,4),a=Z(e,6),s=Z(e,8),o=Z(e,10),u=Z(e,12),l=Z(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|a<<9)&8191,this.r[4]=(a>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|o<<2)&8191,this.r[7]=(o>>>11|u<<5)&8065,this.r[8]=(u>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Z(e,16+2*f)}process(e,t,i=!1){let n=i?0:2048,{h:a,r:s}=this,o=s[0],u=s[1],l=s[2],f=s[3],c=s[4],h=s[5],p=s[6],x=s[7],w=s[8],b=s[9],B=Z(e,t+0),N=Z(e,t+2),v=Z(e,t+4),F=Z(e,t+6),X=Z(e,t+8),T=Z(e,t+10),C=Z(e,t+12),z=Z(e,t+14),g=a[0]+(B&8191),A=a[1]+((B>>>13|N<<3)&8191),E=a[2]+((N>>>10|v<<6)&8191),S=a[3]+((v>>>7|F<<9)&8191),I=a[4]+((F>>>4|X<<12)&8191),y=a[5]+(X>>>1&8191),m=a[6]+((X>>>14|T<<2)&8191),k=a[7]+((T>>>11|C<<5)&8191),j=a[8]+((C>>>8|z<<8)&8191),P=a[9]+(z>>>5|n),d=0,O=d+g*o+A*(5*b)+E*(5*w)+S*(5*x)+I*(5*p);d=O>>>13,O&=8191,O+=y*(5*h)+m*(5*c)+k*(5*f)+j*(5*l)+P*(5*u),d+=O>>>13,O&=8191;let U=d+g*u+A*o+E*(5*b)+S*(5*w)+I*(5*x);d=U>>>13,U&=8191,U+=y*(5*p)+m*(5*h)+k*(5*c)+j*(5*f)+P*(5*l),d+=U>>>13,U&=8191;let L=d+g*l+A*u+E*o+S*(5*b)+I*(5*w);d=L>>>13,L&=8191,L+=y*(5*x)+m*(5*p)+k*(5*h)+j*(5*c)+P*(5*f),d+=L>>>13,L&=8191;let oe=d+g*f+A*l+E*u+S*o+I*(5*b);d=oe>>>13,oe&=8191,oe+=y*(5*w)+m*(5*x)+k*(5*p)+j*(5*h)+P*(5*c),d+=oe>>>13,oe&=8191;let fe=d+g*c+A*f+E*l+S*u+I*o;d=fe>>>13,fe&=8191,fe+=y*(5*b)+m*(5*w)+k*(5*x)+j*(5*p)+P*(5*h),d+=fe>>>13,fe&=8191;let me=d+g*h+A*c+E*f+S*l+I*u;d=me>>>13,me&=8191,me+=y*o+m*(5*b)+k*(5*w)+j*(5*x)+P*(5*p),d+=me>>>13,me&=8191;let le=d+g*p+A*h+E*c+S*f+I*l;d=le>>>13,le&=8191,le+=y*u+m*o+k*(5*b)+j*(5*w)+P*(5*x),d+=le>>>13,le&=8191;let he=d+g*x+A*p+E*h+S*c+I*f;d=he>>>13,he&=8191,he+=y*l+m*u+k*o+j*(5*b)+P*(5*w),d+=he>>>13,he&=8191;let de=d+g*w+A*x+E*p+S*h+I*c;d=de>>>13,de&=8191,de+=y*f+m*l+k*u+j*o+P*(5*b),d+=de>>>13,de&=8191;let ge=d+g*b+A*w+E*x+S*p+I*h;d=ge>>>13,ge&=8191,ge+=y*c+m*f+k*l+j*u+P*o,d+=ge>>>13,ge&=8191,d=(d<<2)+d|0,d=d+O|0,O=d&8191,d=d>>>13,U+=d,a[0]=O,a[1]=U,a[2]=L,a[3]=oe,a[4]=fe,a[5]=me,a[6]=le,a[7]=he,a[8]=de,a[9]=ge}finalize(){let{h:e,pad:t}=this,i=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=n,n=e[o]>>>13,e[o]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+n,n=i[o]>>>13,i[o]&=8191;i[9]-=8192;let a=(n^1)-1;for(let o=0;o<10;o++)i[o]&=a;a=~a;for(let o=0;o<10;o++)e[o]=e[o]&a|i[o];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let o=1;o<8;o++)s=(e[o]+t[o]|0)+(s>>>16)|0,e[o]=s&65535;Pe(i)}update(e){cr(this),W(e),e=Ze(e);let{buffer:t,blockLen:i}=this,n=e.length;for(let a=0;a<n;){let s=Math.min(i-this.pos,n-a);if(s===i){for(;i<=n-a;a+=i)this.process(e,a);continue}t.set(e.subarray(a,a+s),this.pos),this.pos+=s,a+=s,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Pe(this.h,this.r,this.buffer,this.pad)}digestInto(e){cr(this),$r(e,this),this.finished=!0;let{buffer:t,h:i}=this,{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let a=0;for(let s=0;s<8;s++)e[a++]=i[s]>>>0,e[a++]=i[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}};function dn(r){let e=(i,n)=>r(n).update(i).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}var ti=dn(r=>new hr(r));function bn(r,e,t,i,n,a=20){let s=r[0],o=r[1],u=r[2],l=r[3],f=e[0],c=e[1],h=e[2],p=e[3],x=e[4],w=e[5],b=e[6],B=e[7],N=n,v=t[0],F=t[1],X=t[2],T=s,C=o,z=u,g=l,A=f,E=c,S=h,I=p,y=x,m=w,k=b,j=B,P=N,d=v,O=F,U=X;for(let oe=0;oe<a;oe+=2)T=T+A|0,P=K(P^T,16),y=y+P|0,A=K(A^y,12),T=T+A|0,P=K(P^T,8),y=y+P|0,A=K(A^y,7),C=C+E|0,d=K(d^C,16),m=m+d|0,E=K(E^m,12),C=C+E|0,d=K(d^C,8),m=m+d|0,E=K(E^m,7),z=z+S|0,O=K(O^z,16),k=k+O|0,S=K(S^k,12),z=z+S|0,O=K(O^z,8),k=k+O|0,S=K(S^k,7),g=g+I|0,U=K(U^g,16),j=j+U|0,I=K(I^j,12),g=g+I|0,U=K(U^g,8),j=j+U|0,I=K(I^j,7),T=T+E|0,U=K(U^T,16),k=k+U|0,E=K(E^k,12),T=T+E|0,U=K(U^T,8),k=k+U|0,E=K(E^k,7),C=C+S|0,P=K(P^C,16),j=j+P|0,S=K(S^j,12),C=C+S|0,P=K(P^C,8),j=j+P|0,S=K(S^j,7),z=z+I|0,d=K(d^z,16),y=y+d|0,I=K(I^y,12),z=z+I|0,d=K(d^z,8),y=y+d|0,I=K(I^y,7),g=g+A|0,O=K(O^g,16),m=m+O|0,A=K(A^m,12),g=g+A|0,O=K(O^g,8),m=m+O|0,A=K(A^m,7);let L=0;i[L++]=s+T|0,i[L++]=o+C|0,i[L++]=u+z|0,i[L++]=l+g|0,i[L++]=f+A|0,i[L++]=c+E|0,i[L++]=h+S|0,i[L++]=p+I|0,i[L++]=x+y|0,i[L++]=w+m|0,i[L++]=b+k|0,i[L++]=B+j|0,i[L++]=N+P|0,i[L++]=v+d|0,i[L++]=F+O|0,i[L++]=X+U|0}var pn=ei(bn,{counterRight:!1,counterLength:4,allowShortKeys:!1}),yn=new Uint8Array(16),ri=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(yn.subarray(t))},wn=new Uint8Array(32);function ii(r,e,t,i,n){n!==void 0&&W(n,void 0,"AAD");let a=r(e,t,wn),s=qr(i.length,n?n.length:0,!0),o=ti.create(a);n&&ri(o,n),ri(o,i),o.update(s);let u=o.digest();return Pe(a,s),u}var xn=r=>(e,t,i)=>({encrypt(a,s){let o=a.length;s=fr(o+16,s,!1),s.set(a);let u=s.subarray(0,-16);r(e,t,u,u,1);let l=ii(r,e,t,u,i);return s.set(l,o),Pe(l),s},decrypt(a,s){s=fr(a.length-16,s,!1);let o=a.subarray(0,-16),u=a.subarray(-16),l=ii(r,e,t,o,i);if(!Wr(u,l))throw new Error("invalid tag");return s.set(a.subarray(0,-16)),r(e,t,s,s,1),Pe(l),s}}),dr=Yr({blockSize:64,nonceLength:12,tagLength:16},xn(pn));var br=class{constructor(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=new Uint8Array(e)}async seal(e,t,i){return await this._seal(e,t,i)}async open(e,t,i){return await this._open(e,t,i)}_seal(e,t,i){return new Promise(n=>{let a=dr(this._key,new Uint8Array(e),new Uint8Array(i)).encrypt(new Uint8Array(t));n(a.buffer)})}_open(e,t,i){return new Promise(n=>{let a=dr(this._key,new Uint8Array(e),new Uint8Array(i)).decrypt(new Uint8Array(t));n(a.buffer)})}},pt=class{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:ee.Chacha20Poly1305}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new br(e)}};var mn=BigInt(1),ni=BigInt(2),gn=BigInt(3),_n=BigInt(5),ai=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed");function vn(r){let e=BigInt(10),t=BigInt(20),i=BigInt(40),n=BigInt(80),a=ai,o=r*r%a*r%a,u=D(o,ni,a)*o%a,l=D(u,mn,a)*r%a,f=D(l,_n,a)*l%a,c=D(f,e,a)*f%a,h=D(c,t,a)*c%a,p=D(h,i,a)*h%a,x=D(p,n,a)*p%a,w=D(x,n,a)*p%a,b=D(w,e,a)*f%a;return{pow_p_5_8:D(b,ni,a)*r%a,b2:o}}function kn(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var yt=(()=>{let r=ai;return lt({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:i}=vn(e);return Me(D(t,gn,r)*i,r)},adjustScalarBytes:kn})})();var Ke=class extends Ie{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return Le(ir,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var Qe="X25519",Ct=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=32,this._nSk=32}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(t){throw new G(t)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(t){throw new G(t)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){try{let e=await yt.utils.randomSecretKey(),t=new V(Qe,e,"private",Y);return{publicKey:await this.derivePublicKey(t),privateKey:t}}catch(e){throw new $(e)}}async deriveKeyPair(e){try{let t=await this._hkdf.labeledExtract(H.buffer,pe,new Uint8Array(e)),i=await this._hkdf.labeledExpand(t,Ee,H,this._nSk),n=new V(Qe,new Uint8Array(i),"private",Y);return{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new ne(t)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(t){throw new M(t)}}async dh(e,t){try{return await this._dh(e,t)}catch(i){throw new G(i)}}async derive(e,t){try{return await this._derive(e,t)}catch(i){throw new G(i)}}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_serializePrivateKey(e){return new Promise(t=>{t(e.key.buffer)})}_importRawKey(e,t){return new Promise((i,n)=>{t&&e.byteLength!==this._nPk&&n(new Error("Invalid length of the key")),!t&&e.byteLength!==this._nSk&&n(new Error("Invalid length of the key")),i(new V(Qe,new Uint8Array(e),t?"public":"private",t?[]:Y))})}_importJWK(e,t){return new Promise((i,n)=>{(typeof e.kty>"u"||e.kty!=="OKP")&&n(new Error(`Invalid kty: ${e.kty}`)),(typeof e.crv>"u"||e.crv!=="X25519")&&n(new Error(`Invalid crv: ${e.crv}`)),t?(typeof e.d<"u"&&n(new Error("Invalid key: `d` should not be set")),typeof e.x>"u"&&n(new Error("Invalid key: `x` not found")),i(new V(Qe,ue(e.x),"public"))):(typeof e.d!="string"&&n(new Error("Invalid key: `d` not found")),i(new V(Qe,ue(e.d),"private",Y)))})}_derivePublicKey(e){return new Promise((t,i)=>{try{let n=yt.getPublicKey(e.key);t(new V(Qe,n,"public"))}catch(n){i(n)}})}_dh(e,t){return new Promise((i,n)=>{try{i(yt.getSharedSecret(e.key,t.key).buffer)}catch(a){n(a)}})}_derive(e,t){return new Promise((i,n)=>{try{i(yt.getSharedSecret(e,t))}catch(a){n(a)}})}},wt=class extends te{constructor(){let e=new Ke;super(_.DhkemX25519HkdfSha256,new Ct(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemX25519HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};var ui=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Pn=BigInt(1),pr=BigInt(2),oi=BigInt(3),Kn=BigInt(11),Sn=BigInt(22),si=BigInt(44),An=BigInt(88),En=BigInt(223);function In(r){let e=ui,t=r*r*r%e,i=t*t*r%e,n=D(i,oi,e)*i%e,a=D(n,oi,e)*i%e,s=D(a,pr,e)*t%e,o=D(s,Kn,e)*s%e,u=D(o,Sn,e)*o%e,l=D(u,si,e)*u%e,f=D(l,An,e)*l%e,c=D(f,si,e)*u%e,h=D(c,pr,e)*t%e,p=D(h,Pn,e)*r%e;return D(p,En,e)*h%e}function On(r){return r[0]&=252,r[55]|=128,r[56]=0,r}var Nt=(()=>{let r=ui;return lt({P:r,type:"x448",powPminus2:e=>{let t=In(e),i=D(t,pr,r);return Me(i*e,r)},adjustScalarBytes:On})})();var Se=class extends Oe{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return Le(nr,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var et="X448",Mt=class{constructor(e){Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=e,this._nPk=56,this._nSk=56}async serializePublicKey(e){try{return await this._serializePublicKey(e)}catch(t){throw new G(t)}}async deserializePublicKey(e){try{return await this._importRawKey(e,!0)}catch(t){throw new M(t)}}async serializePrivateKey(e){try{return await this._serializePrivateKey(e)}catch(t){throw new G(t)}}async deserializePrivateKey(e){try{return await this._importRawKey(e,!1)}catch(t){throw new M(t)}}async importKey(e,t,i){try{if(e==="raw")return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(n){throw new M(n)}}async generateKeyPair(){try{let e=await Nt.utils.randomSecretKey(),t=new V(et,e,"private",Y);return{publicKey:await this.derivePublicKey(t),privateKey:t}}catch(e){throw new $(e)}}async deriveKeyPair(e){try{let t=await this._hkdf.labeledExtract(H.buffer,pe,new Uint8Array(e)),i=await this._hkdf.labeledExpand(t,Ee,H,this._nSk),n=new V(et,new Uint8Array(i),"private",Y);return{privateKey:n,publicKey:await this.derivePublicKey(n)}}catch(t){throw new ne(t)}}async derivePublicKey(e){try{return await this._derivePublicKey(e)}catch(t){throw new M(t)}}async dh(e,t){try{return await this._dh(e,t)}catch(i){throw new G(i)}}_serializePublicKey(e){return new Promise(t=>{t(e.key.buffer)})}_serializePrivateKey(e){return new Promise(t=>{t(e.key.buffer)})}_importRawKey(e,t){return new Promise((i,n)=>{t&&e.byteLength!==this._nPk&&n(new Error("Invalid length of the key")),!t&&e.byteLength!==this._nSk&&n(new Error("Invalid length of the key")),i(new V(et,new Uint8Array(e),t?"public":"private",t?[]:Y))})}_importJWK(e,t){return new Promise((i,n)=>{e.kty!=="OKP"&&n(new Error(`Invalid kty: ${e.kty}`)),e.crv!=="X448"&&n(new Error(`Invalid crv: ${e.crv}`)),t?(typeof e.d<"u"&&n(new Error("Invalid key: `d` should not be set")),typeof e.x!="string"&&n(new Error("Invalid key: `x` not found")),i(new V(et,ue(e.x),"public"))):(typeof e.d!="string"&&n(new Error("Invalid key: `d` not found")),i(new V(et,ue(e.d),"private",Y)))})}_derivePublicKey(e){return new Promise((t,i)=>{try{let n=Nt.getPublicKey(e.key);t(new V(et,n,"public"))}catch(n){i(n)}})}_dh(e,t){return new Promise((i,n)=>{try{i(Nt.getSharedSecret(e.key,t.key).buffer)}catch(a){n(a)}})}},xt=class extends te{constructor(){let e=new Se;super(_.DhkemX448HkdfSha512,new Mt(e),e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemX448HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:56})}};var tt=class extends De{async extract(e,t){if(await this._setup(),e.byteLength===0&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)return Le(ar,new Uint8Array(e),new Uint8Array(t)).buffer;let i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}};var Rt=class extends te{constructor(){let e=new Ke,t=new ye(_.DhkemP256HkdfSha256,e);super(_.DhkemP256HkdfSha256,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}};var Gt=class extends te{constructor(){let e=new tt,t=new ye(_.DhkemP384HkdfSha384,e);super(_.DhkemP384HkdfSha384,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}};var Ft=class extends te{constructor(){let e=new Se,t=new ye(_.DhkemP521HkdfSha512,e);super(_.DhkemP521HkdfSha512,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}};var yr=class extends bt{constructor(e){if(typeof e.kem=="number")switch(e.kem){case _.DhkemP256HkdfSha256:e.kem=new Rt;break;case _.DhkemP384HkdfSha384:e.kem=new Gt;break;case _.DhkemP521HkdfSha512:e.kem=new Ft;break;case _.DhkemX25519HkdfSha256:e.kem=new wt;break;case _.DhkemX448HkdfSha512:e.kem=new xt;break;default:throw new R(`The KEM (${e.kem}) cannot be specified by KemId. Use submodule for the KEM`)}if(typeof e.kdf=="number")switch(e.kdf){case se.HkdfSha256:e.kdf=new Ke;break;case se.HkdfSha384:e.kdf=new tt;break;default:e.kdf=new Se;break}if(typeof e.aead=="number")switch(e.aead){case ee.Aes128Gcm:e.aead=new Ye;break;case ee.Aes256Gcm:e.aead=new ht;break;case ee.Chacha20Poly1305:e.aead=new pt;break;default:e.aead=new dt;break}super(e)}async generateKeyPair(){return await this._setup(),await this._kem.generateKeyPair()}async deriveKeyPair(e){return await this._setup(),await this._kem.deriveKeyPair(e)}async importKey(e,t,i=!0){return await this._setup(),await this._kem.importKey(e,t,i)}};export{tn as Aead,ee as AeadId,yr as CipherSuite,Ge as DecapError,ne as DeriveKeyPairError,M as DeserializeError,Re as EncapError,Fe as ExportError,Q as HpkeError,R as InvalidParamError,en as Kdf,se as KdfId,Qi as Kem,_ as KemId,Ve as MessageLimitReachedError,$ as NotSupportedError,$e as OpenError,Xe as SealError,G as SerializeError,mt as ValidationError};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
